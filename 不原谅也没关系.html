<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>不原谅也没关系</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.36.1): A free (gratis and libre) story format.

Copyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(""===e)throw new c("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new c("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+"")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+"",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+"",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+"");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(" ")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(" "),i=n.indexOf(t+"");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2020 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-webkit-transition:none!important;-o-transition:none!important;transition:none!important}:-webkit-full-screen{height:100%;width:100%}:-ms-fullscreen{height:100%;width:100%}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0\00a0"}[data-icon-after]:after{content:"\00a0\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}</style>
<style id="style-core-macro" type="text/css">@-webkit-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{-webkit-animation:cursor-blink 1s infinite;-o-animation:cursor-blink 1s infinite;animation:cursor-blink 1s infinite;content:"\2590";opacity:1}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-webkit-transition:visibility .2s step-end,opacity .2s ease-in;-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{-webkit-box-sizing:border-box;box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-overlay:not(.open){-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-dialog.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-webkit-transition:margin-left .2s ease-in;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-webkit-transition:left .2s ease-in;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-webkit-transition:visibility .2s step-end;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{-webkit-transition:margin-left 0s;-o-transition:margin-left 0s;transition:margin-left 0s}#ui-bar{-webkit-transition:left 0s;-o-transition:left 0s;transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript must be enabled to play.</noscript></div>
		<div id="init-lacking"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<tw-storydata name="不原谅也没关系" startnode="1" creator="Twine" creator-version="2.8.1" format="SugarCube" format-version="2.36.1" ifid="85816D36-BEAC-4DDF-A1C8-66EE68513F15" options="" tags="" zoom="0.3" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css"></style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name="未命名片段" tags="" position="34800,2200" size="100,100">
[[读者须知]]
[[目录]]
[[推荐语]]
[[一部关于复杂性创伤后应激障碍（CPTSD）识别与治疗的图谱]]
[[创伤不是你的错，但复原是你自己的责任]]
[[译者序]]
[[中文版序]]
[[前言]]

正文
[[第一部分 疗愈概述]]

[[第二部分 疗愈的细节]]

[[第三部分 疗愈的方法]]

[[致谢]]
[[参考文献]]
</tw-passagedata><tw-passagedata pid="2" name="讨好后期的疗愈" tags="" position="35100,900" size="100,100">
后期的疗愈
为了重获自信果敢，我建议幸存者想象自己正在对抗当前或过去的不公。不过，这类
角色扮演通常需要小心谨慎，因为它可能会触发治疗性闪回，重现过去的恐惧感受。
当幸存者学会在角色扮演中自信果敢地体会当下的感受时，他们就能更深刻地理解恐
惧是如何诱发讨好行为的。此后他们就可以开始练习在觉察到恐惧的同时仍然保持自信果
敢。有了足够的练习，就能治愈过往因未学会“虽惧犹战”而导致的发展停滞。这反过来又
有助于解构在应对恐惧时做出的自我伤害式的反应（如过度给予或妥协）。这种练习还能
使幸存者更善于管理闪回。
随着后期疗愈的进行，幸存者会越来越“了解自己的想法”。他们会慢慢戒掉自动附和
他人偏好和同意他人意见的习惯，能更容易地表达自己的观点并做出自己的选择。最重要
的是，他们将学会关注自己的内心。
许多讨好类型的人得以幸存的方式是不断地将注意力集中在父母身上，并弄清楚如
何安抚他们。有些讨好类型的人几乎成了“通灵者”，能够准确地洞悉父母的情绪和期望。
这有助于他们做出最恰当的反应来化解父母带来的危险，有些人甚至能因此赢得一些认
可。
现在幸存者需要改变这种习惯，需要努力地去关注自己的内在体验，而不是一直向外
投射注意力去读懂别人。那些仍然习惯于讨好别人的人，必须努力减少讨好行为。多年
来，我注意到，来访者努力取悦我的程度就能反映出他父母的危险程度。
若想要康复，我们需要逐渐觉察到那些无意识的迎合行为和镜像模仿[5]行为。这有助
于我们改变反射性地赞同他人的习惯。显著减少言语迎合将是一个巨大的进步，而减少不
真诚的情绪迎合则是一项更有力的成就。不真诚的情绪迎合体现在一些行为上，例如，面
对伤人的讽刺表现得很欢乐，面对惩罚表现得充满爱意，遭到反复伤害时表现得很宽容。
为了克服这种行为，我们需要设定界限，以帮助我们忠于自己真实的情感体验。我称之为
情绪个体化（Emotional Individuation）。
在进阶的疗愈中，情绪个体化意味着逐渐放弃改变自身情绪来迎合他人情绪状态的习
惯。但这并不是指压抑真诚的共情，我们知道，与亲密的人一起哭、一起笑是一种真正美
妙的体验。情绪个体化真正的意思是，你没必要受压力驱使而假装自己总是和别人有同样
的感受：你不觉得好笑就不必笑；当朋友难过时，你也不必表现得你也很难过；当你感觉
难过时，也不必强装高兴。
幸运的是，治疗师的工作让我在这方面学到了很多。当来访者抑郁时，我让自己也表
现得抑郁对他并没有帮助。但我总是真诚地针对来访者的抑郁表达共情，因为我可以通过
自己的抑郁经历对他的情绪感同身受。我可以关心他的情绪，但不必抛弃自己当下的幸福
感。同样地，当你对某件事情兴致勃勃时，我可能正感到沮丧，但我可以真诚地体会你的
快乐，而无须带着羞耻感抛弃暂时沮丧的自己。
让我们再来看一个例子。你愉快地向我讲述，你很喜欢最近看的一部老式音乐剧。但
我正情绪低落，也不喜欢老式音乐剧。如果我是一个战类型的人，我们可能就会变得更加
疏远。而如果我是一个讨好类型的人，我可能会压抑自己糟糕的心情和对音乐的偏好，强
颜欢笑地称赞弗雷德·阿斯泰尔（Fred Astaire）。但是，在这种情况下，更理想的做法其
实是表现出更大的真诚。我可以对你说：“我很高兴你享受如此愉快的时光。”毕竟我真的
相信萝卜青菜各有所爱。
写到这里，我想起了一位名叫布鲁诺的老年来访者，他当时在接受临终关怀治疗。他
在一次面谈中对我说：“我无法忍受与那个新来的志愿者交谈。她每次来看我时都表现得
很沮丧。到底是我快死了还是她快死了？她甚至比另一个面带微笑的志愿者更糟糕，虽然
那人总是表现得像刚走进了迪斯尼乐园一样。”</tw-passagedata><tw-passagedata pid="3" name="CPTSD的主要症状" tags="" position="31000,1350" size="100,100">CPTSD的主要症状
CPTSD是一种更为严重的创伤后应激障碍（PTSD）。它与后者这种较著名的创伤综
合征的区别，在于CPTSD最常见、最棘手的五个主要症状：情绪闪回（Emotional
Flashbacks）[4]、毒性羞耻感（Toxic Shame）、自我遗弃（Self-abandonment）、恶性内在
批判（Vicious Inner Critic，或称内在批判者）[5]和社交焦虑（Social Anxiety）。
[[情绪闪回：CPTSD最典型的症状]]
[[毒性羞耻感：情绪闪回的表象]]</tw-passagedata><tw-passagedata pid="4" name="情绪闪回：CPTSD最典型的症状" tags="" position="30925,1550" size="100,100">@情绪闪回：CPTSD最典型的症状
情绪闪回可能是CPTSD最明显、最典型的症状。遭受创伤性遗弃的幸存者极易发生
痛苦的情绪闪回。情绪闪回与PTSD的闪回不同，通常不会涉及视觉重现（Visual
Component）。
情绪闪回是一种突然发生且通常持续时间较长的退行（Regression）[6]，幸存者会退
行至童年遭受虐待或遗弃时所产生的强烈的情绪状态。这种情绪状态可能包括强烈的恐
惧、羞耻、疏离、愤怒、悲伤和抑郁，甚至出现不必要的战或逃（Fight or Flight）反应。
在此必须指出，情绪闪回和生活中的大多数事情一样，并不是“全或无”的。也就是
说，并非所有闪回都能被归为退行。闪回程度或轻微，或严重，持续时间也可能从片刻到
数周不等，只有达到一定的程度和持续时间，才会被心理治疗师判定为退行。
写到这里，我想起了印象中自己第一次出现情绪闪回的情境，直到十年后，我才知道
当时的现象是什么。
当时，我正和我的第一任伴侣在一起生活。那天，她因为某件我已经记不清的事突然
对我怒吼，我们感情的蜜月期在那一刻戛然而止。我记忆中最清晰的就是那种怒吼带给我
的感受：它就像一阵猛烈的热风，我感觉自己快要被它刮走了；我内心的火光也仿佛要被
熄灭，如同快被吹熄的烛火。
后来，当我第一次听说灵光（Aura）[7]这个概念的时候，我闪回到了当时的情境，感
觉自己的灵光被彻底夺走了。在情绪闪回发作的时刻，我感到自己完全迷失了方向，无法
说话和做出回应，甚至无法思考。我非常害怕，浑身颤抖，觉得自己特别渺小。不知怎么
地，最后我踉跄地走到门口，离开了那房子，情绪才慢慢平复了下来。
如前文所说，我花了十年的时间才意识到，这种令我困惑不安的现象其实是一种情绪
闪回。又过了几年，我逐渐明白了这种退行的本质其实是我童年情绪的闪回——我的母亲
曾无数次凶神恶煞地对我发泄怒火，使我陷入惊恐、羞耻、解离[8]与无助中。
情绪闪回会激发强烈的战或逃反应，这种反应是人类的本能，也会使交感神经系统过
度兴奋。交感神经系统占据整个神经系统的一半，负责控制神经的反应和激活。比如，当
恐惧是闪回中的主导情绪时，人会感到极度焦虑、恐慌，甚至出现自杀倾向；而当绝望是
主导情绪时，则会引发深度麻木、麻痹，使人迫切地想要逃避。
在情绪闪回中，常见的体验还包括：感到渺小、年幼、脆弱、无力和无助。这些症状
通常还会叠加，从而使人感到屈辱，并且让人产生具有精神毁灭性的毒性羞耻感。
</tw-passagedata><tw-passagedata pid="5" name="毒性羞耻感：情绪闪回的表象" tags="" position="31050,1550" size="100,100">@毒性羞耻感：情绪闪回的表象
约翰·布雷萧（John Bradshaw）在《治愈束缚你的羞耻感》（Healing The Shame That
Binds You）中开创性地探讨了毒性羞耻感。毒性羞耻感会让CPTSD幸存者觉得自己惹人
厌、丑陋、愚蠢或有致命缺陷，这种强烈的感受会摧毁幸存者的自尊，触发情绪闪回，使
幸存者重新体验被父母蔑视、打击、忽视和拒绝的感受。
我刚从事心理咨询工作时，曾遇到一位名叫戴维的来访者，他是一位帅气聪明的职业
演员。有一次，戴维在试镜失败之后前来面谈。他情绪激动，大喊道：“虽然我从来没有
告诉过别人，但我知道自己真的特别丑。像我这么其貌不扬的人居然还想当演员，真是太
蠢了。”我永远也不会忘记自己听到这话时内心的震惊和难以置信：这么帅的人居然会觉
得自己丑！但在进一步的探究中，我理解了他的心理。
戴维在童年经历了各种虐待和忽视。他是一个大家庭里最不受欢迎的老幺。他酗酒的
父亲一直不停地攻击他，用厌恶的眼光盯着他。更糟的是，其他的家庭成员也都效仿他的
父亲，经常对他表示深深的蔑视，以此来羞辱他。他的哥哥最喜欢一边做呕吐状的鬼脸一
边嘲笑他：“我一见到你就想吐。”
毒性羞耻感能够在顷刻间摧毁人的自尊。家人过去对你造成的创伤可能会让你在当
下的情绪闪回中立刻退行至一种“自己没有价值、必被鄙夷”的感受和想法中。当你困于其
中，毒性羞耻感就会发展为极度痛苦的自我疏离，让你陷入混杂的被遗弃感
（Abandonment Mélange）中——仿佛身处被全世界抛弃的绝望的深渊。
“混杂的被遗弃感”是一种混杂着恐惧、焦虑和毒性羞耻感的痛苦感受，这种感受还会
与遗弃抑郁（Abandonment Depression）相互作用。遗弃抑郁充满着犹如走入死巷的无助
感和无望感，这种感觉深深折磨着遭受创伤的孩子。
毒性羞耻感还会阻碍我们寻求他人的慰藉和支持。当童年被遗弃的经历在闪回中重现
时，我们常常会孤立自己，无助地向强烈的羞辱感投降。
如果你深陷于自己毫无价值、有缺陷或自卑的感受中而无法自拔，或是迷失在自我厌
恶和恶性的自我批判中，那么你可能正处于一次情绪闪回中。针对情绪闪回的解决措施，
可以参见第八章列出的解决情绪闪回的13个实用步骤。
许多幸存者和在我网站上留言的网友都告诉我，情绪闪回这一概念给了他们很大的安
慰，使他们对自己充满困扰的生活多了一些理解。一类常见的评论是：“现在我明白了，
为什么我尝试过的那些心理和精神治疗方法都收效甚微。”还有许多人提到，他们从自己
或他人给出的一系列羞辱性误诊中解脱了出来。这也相应地帮助他们摆脱了一种自毁式的
习惯，即收集证据来证明自己是有缺陷的或有精神问题的。许多人还获得了更大的动力去
改掉自我憎恨和自我厌恶的习惯。
</tw-passagedata><tw-passagedata pid="6" name="CPTSD的其他症状" tags="" position="31150,1350" size="100,100">@CPTSD的其他症状
创伤幸存者不一定出现CPTSD的所有症状，并且他们的症状有许多不同的组合方
式。影响具体症状的因素包括幸存者的4F反应[10]类型及其童年遭受虐待或忽视的形式。
CPTSD的其他常见症状
绝望的孤独感和被遗弃感
脆弱的自尊
依恋障碍
发展停滞
人际关系困难
极端的情绪波动（例如假性环性心境[11]障碍，详见第十二章）
发生解离——在行为活动和精神状态层面分散注意力
极易触发战或逃反应
对应激情境的过度敏感
自杀意念


[[自杀意念]]</tw-passagedata><tw-passagedata pid="7" name="自杀意念" tags="" position="31200,1550" size="100,100">自杀意念
自杀意念（Suicidal Ideation）是CPTSD的一种常见症状，经常出现在剧烈而长时间的
闪回期间。自杀意念是一种求死的抑郁思维或幻想，它可以在主动自杀意念和被动自杀意
念之间转化。主动自杀意念会让人主动采取结束生命的行动，而被动自杀意念则不同，它
会因患者没有主动的自杀意图而逐渐停止。
在我认识的CPTSD幸存者表现出的症状中，被动自杀意念远比主动自杀意念更常
见。从希望自己死去，到幻想结束生命的方式，这些都属于被动自杀意念。深陷其中时，
幸存者甚至会祈祷自己从此生此世中解脱出来，或幻想自己被某种灾难夺去生命。他们甚
至可能会产生冲到行驶的车前或从高楼跳下的想法或强迫观念，但并不会真的付诸实践。
如果幸存者没有强烈主动的自杀意图，这种幻想通常会停止。而主动自杀意念则不
同，它会让人主动采取结束生命的行动。
训练有素的心理医生和救助人员能够区分主动和被动自杀意念，并且在遇到第二种情
况时不会惊慌失措、小题大做。心理治疗师会和来访者一起来探索后者的自杀念头和感
受，因为他们知道，在大多数情况下，来访者通过口头宣泄来排解自杀意念背后的痛苦有
助于消除自杀意念。对于不常见的主动自杀意念，口头宣泄也能帮助心理治疗师判断来访
者是否确实存在自杀风险，以及是否需要采取行动来保护来访者。
我在本书中主要探讨被动自杀意念，是因为它不像主动自杀意念那样引人警惕。被动
自杀意念往往意味着幸存者闪回到了幼年时期的感受，再次沉浸在强烈的被遗弃感之中，
以致幸存者很自然地希望老天爷或某人某事能结束这一切。对幸存者而言，意识到自己正
陷入自杀意念是很有帮助的——他可以借此察觉到自己的痛苦有多深，也可以把这种意念
看作一次特别强烈的闪回信号，然后使用第八章的闪回管理步骤来应对。
</tw-passagedata><tw-passagedata pid="8" name="第一章 CPTSD的疗愈之旅" tags="" position="34250,1875" size="100,100">@第一章 CPTSD的疗愈之旅
我是基于自身经历来写这本书的：我是一名复杂性创伤后应激障碍（Complex Post￾Traumatic Stress Disorder，简称为CPTSD）[1]幸存者[2]，经过多年的治疗，症状已大幅减
轻。在漫长而坎坷的疗愈旅途中，我也在黑暗中看到了曙光。不仅如此，我还观察到我的
一些朋友和许多长期来访者也有了类似的疗愈经历。
首先要告诉大家一个关于CPTSD的好消息。CPTSD是一系列习得的反应，它意味着
幸存者未能完成人生中许多重要的发展任务[3]。这表示CPTSD是受外部环境影响而产生
的，不是基因导致的。换句话说，不同于其他大多数容易与之混淆的病症，它既不是先天
的，也非性格所致。它是幸存者在后天习得的，并没有被刻在幸存者的基因里。
这是个特别好的消息，因为后天习得的东西既可以被抛弃，也可以通过努力得来。父
母没能给予你的东西，现在可以由你自己获得或由其他人来提供。
CPTSD的疗愈过程通常包括自助疗愈和关系型疗愈。关系型疗愈可以来自书籍作
者、朋友、伴侣、老师、治疗师、咨询小组，或以上这些人群的任意组合。我喜欢将关系
型疗愈称为代表团的再抚育（Reparenting by Committee）。然而必须强调的是，一些在创
伤性家庭中成长的幸存者由于遭到了父母的彻底背叛，可能需要相当长的时间才能再次信
任他人，并与他人建立起疗愈型的关系。在这种情况下，宠物、书籍和在线治疗网站也能
对他们进行颇为有效的疗愈。
我认为创伤性家庭是普遍存在的。联合国的数据显示，全球每年有多达10亿的儿童遭
受着不同形式的暴力，包括躯体虐待、情感虐待、性虐待、忽视和欺凌等。金氏基金会
（The Kim Foundation）近期的统计数据显示，18岁以上的美国人中有26%被诊断出患有
心理障碍。
创伤性虐待与遗弃行为可能发生于言语、情绪、精神或躯体层面。在足够严重时，任
何类型的虐待和遗弃行为都有可能导致儿童患上CPTSD，性虐待尤其会对受害者的精神
和身体造成严重的创伤。而如果父母双方都存在对孩子的情感忽视行为，那么仅受到情感
忽视就能导致孩子患上CPTSD（具体见第五章）。若孩子受到多层面的虐待和遗弃，其
CPTSD的程度则会相应加重。
本书介绍了一种多层面的综合性CPTSD治疗方法，它针对的是最常见的CPTSD类
型，这类CPTSD源于个体在成长过程中遭受到了家庭成员的严重虐待或忽视。所以，本
书所提及的疗法可以帮这类CPTSD幸存者从被虐待或遗弃的创伤中复原。


[[CPTSD的主要症状]]

[[CPTSD的其他症状]]

[[CPTSD的成因]]
[[可能出现的误诊]]
[[更多关于创伤的信息]]
[[4F反应：战、逃、僵、讨好]]
</tw-passagedata><tw-passagedata pid="9" name="CPTSD的成因" tags="" position="31275,1350" size="100,100">CPTSD的成因
那些因为被虐待或遗弃而遭受创伤的儿童是如何发展出CPTSD的呢？
尽管CPTSD的成因通常与童年长期遭受躯体虐待或性虐待有关，但我的观察使我相
信，持续的言语虐待或情绪虐待也会引起CPTSD。当婴幼儿为了寻求联结和依附而悲伤
地哭唤时，许多病态的父母会做出轻蔑的回应。这种蔑视对婴幼儿来说极具伤害性，即便
对成人来说也极为有害。
有特别严重的虐待行为的父母会将体罚与蔑视结合，这样做会加重孩子的遗弃创伤。
打个不恰当却十分贴切的比方：在奴隶社会，奴隶主通常会使用蔑视和鄙视来摧毁奴隶的
自尊，这样的行为会让奴隶感到自己没有价值、没有力量，并陷入习得性无助。于是，奴
隶主之后只需投入很少的精力和注意力就能对奴隶加以控制了。再打个比方，邪教头目在
用短暂、虚假、“无条件”的爱哄骗信徒入教之后，也常通过蔑视来打压信徒，直至其陷入
彻底的服从。
蔑视如同一杯掺杂了言语虐待和情绪虐待的有毒鸡尾酒，是一种汇集了诋毁、愤怒和
厌恶的致命混合物。父母对孩子发泄愤怒会在孩子心中制造恐惧，而被厌恶则会让孩子产
生羞耻感，于是孩子很快就会学会压抑哭泣，并不再寻求关注。用不了多久，孩子就会完
全放弃向他人寻求帮助或联结。在此后的生活中，一旦孩子想要亲近他人或获得接纳的尝
试受到挫败，他便只能忍受由被遗弃带来的惊慌绝望。
除了受到言语和情绪层面的双重虐待之外，单是情感忽视也可能使孩子患上
CPTSD。第五章中我会详细讨论这一重要主题。如果你因为自己受到的创伤看起来不如
别人的严重而谴责自己小题大做，那么请先阅读第五章，读完之后再回到此处继续阅读。
大多数创伤的表象之下通常都潜藏着情感忽视。当孩子呼唤关注、联结和帮助时，父
母如果经常予以忽视或不加理睬，就会将孩子遗弃在无边的恐惧中，使其最终放弃努力，
并被无助与无望所带来的死一般的消沉感受压垮。
父母的这种拒绝行为会放大孩子的恐惧，并最终为这种感觉“镀”上一层羞耻感。长此
以往，这种恐惧和羞耻感会演变为有毒的内在批判，这种内在批判会让孩子始终将父母的
遗弃归咎于自己的行为，直至他们将自己变成了可怕的敌人，并陷入CPTSD的深渊。</tw-passagedata><tw-passagedata pid="10" name="可能出现的误诊" tags="" position="31400,1350" size="100,100">@可能出现的误诊
著名的创伤学专家约翰·布里埃（John Briere）曾讽刺道，如果CPTSD能够得到应有
的重视，那么所有心理健康专业人士遵循的《精神疾病诊断与统计手册》（The
Diagnostic and Statistical Manual of Mental Disorders，简称为DSM），将会从现在的字典
般的厚度缩减到像一本小册子那么薄。换句话说，大多数成人的心理障碍在极大程度上都
受到了童年创伤的影响。
我曾目睹许多CPTSD幸存者被误诊患有各种类型的心理疾病，包括焦虑症和抑郁
症。许多人还被不公平、不准确地贴上双相情感障碍、自恋型人格障碍、依赖型人格障
碍、自闭症谱系障碍及边缘型人格障碍的标签（但我并不否认CPTSD有时会与这些病症
共存）。
CPTSD还会与注意缺陷多动障碍和强迫症相混淆。我认为，对后两者更准确的诊断
应该是“对创伤的固着逃反应”（请见后文关于4F反应的讨论）。同样，对抑郁障碍和解离
障碍更准确的诊断应该是“对创伤的固着僵反应”。
这并不代表被误诊患有上述这些疾病的人没有与之相似或相关的症状，问题的关键
是，对幸存者实际的困扰而言，这些疾病的标签是片面的，而且会让幸存者感到不必要的
羞耻。把CPTSD简单归结为“焦虑症”，就好比把食物过敏视为“长期眼睛发痒”一样。如果
在治疗CPTSD时过于关注焦虑症状，就如同在治疗食物过敏时只治疗眼睛发痒，都属于
治标不治本。焦虑和眼睛发痒的症状能够暂时通过药物抑制，但引发此症状的根源却没有
得到解决。
上述大多数病症通常都被视作先天的性格缺陷，而非后天习得的不健康的应激适应模
式（即幸存者在遭受童年创伤时被迫习得的适应方式）。这往往对治疗造成了阻碍。只有
当我们认识到这些适应方式是后天习得的，它们才能够被大幅减轻或消除，并被更健康、
有效的应激适应方式取代。
此外，我认为许多物质成瘾和行为成瘾也都始于幸存者对父母的虐待或遗弃行为的不
适感，是幸存者为了减轻和转移由CPTSD引起的精神、情绪和身体痛苦而尝试的适应方
式。
</tw-passagedata><tw-passagedata pid="11" name="更多关于创伤的信息" tags="" position="31525,1350" size="100,100">@更多关于创伤的信息
如果攻击或遗弃行为激发了过于强烈的战或逃反应，以致在威胁消失后这个反应还无
法平息，就会造成创伤。此时，受到创伤的人会被困在一种肾上腺素高亢的状态，其交感
神经系统也持续被锁定在“开启”状态，使其无法激活副交感神经系统的放松功能。
一个常见的例子是：如果孩子在学校遭受过霸凌者的攻击和伤害，那么他可能会持续
处于过度警觉、恐惧的状态，直到有人采取措施，保证他不会再次受到攻击和伤害，他才
能放松过度活跃的交感神经系统。
如果孩子根据以往的经验知道，在受伤、害怕或需要帮助时，他至少能获得父母其中
一方的帮助，他就会把这类遭遇告诉自己的爸爸或妈妈。在父母的帮助下，他能够通过口
头宣泄、哭泣或发泄愤怒，来哀悼自己暂时丧失的安全感（第十一章将具体讨论哀悼的方
式）。此外，如果他的父母能举报霸凌者，并采取行动确保这类事件不再发生，那么这个
孩子通常就能从创伤中解脱出来。他会自然地放松下来，回到副交感神经系统正常运行的
状态，重获安全感。
如果孩子经历了“单纯”
[12]的单次创伤事件，但是尚未出现CPTSD的症状，那么让他
的心理状态回到正轨通常比较容易。但如果霸凌事件多次发生，而孩子却没有寻求帮助；
或者孩子生活的环境太过危险，致使父母也无力保障他的安全，他就会被“冻结”在创伤
中，开始出现一些创伤的症状。这时，只靠父母的安抚可能也不足以让孩子摆脱创伤了。
不过，创伤如果不是在很长一段时间内持续存在的，那么孩子可能只需要短期的治疗就能
被治愈——当然，前提是环境中的危险因素能被有效地消除。
然而，如果孩子在遭受外界霸凌的同时，还持续遭受着来自家庭内部的躯体虐待或情
感遗弃，那么他的创伤就会发展为特别严重的情绪闪回，因为他已经患上了CPTSD。
</tw-passagedata><tw-passagedata pid="12" name="4F反应：战、逃、僵、讨好" tags="" position="31725,1350" size="100,100">@4F反应：战、逃、僵、讨好
前文提到的战或逃反应是所有人在面临危险时与生俱来的本能反应。对这种本能更为
全面和准确的描述应该是战、逃、僵、讨好反应。战反应指人在面临威胁时突然做出攻击
性反应。逃反应指人通过逃离来应对威胁，或象征性地开启过度活跃的状态来逃避。僵反
应指人在意识到抵抗无用时放弃抵抗，麻木地陷入解离或崩溃状态，仿佛接受了注定会受
伤。讨好反应指人在应对威胁时，试图通过讨好或协助来预先阻止和安抚攻击者。这4种
反应合称为“4F反应”，它们具有复杂的神经机制，使人以4种不同的方式应对危险。
遭受创伤的孩子为了生存，通常会过度使用这4种反应中的一种。而随着时间的推
移，这4种反应会分别发展成根深蒂固的防御模式，包括自恋型（战反应）、强迫[13]型
（逃反应）、解离型（僵反应）或关系依赖[14]型（讨好反应）防御。这些防御模式能帮
助孩子从可怕的童年中幸存下来，却也会导致他们应对生活的方式变得受限而狭窄。更糟
的是，尽管他们在成年后已无须严重依赖如此“原始”的防御模式，但他们仍然被卡在这些
模式中。
很多因素都会影响人们所倾向的4F反应类型，包括童年遭受虐待或忽视的形式、出
生排行、遗传因素等。在第六章和第七章，我会详细探讨每种类型的4F反应以及相应的
防御模式。这两章会帮助你判断自己的4F反应类型和防御模式，并针对你的4F反应类型
来解决特定的问题。不过接下来，我将先介绍几个案例，以此探讨父母造成的创伤是如何
导致孩子产生这些防御模式的。案例中的四个孩子正好分别符合创伤幸存者的四种基本类
型：鲍勃：战—自恋型
卡罗尔：逃—强迫型
莫德：僵—解离型
肖恩：讨好—关系依赖型

[[诱发CPTSD的家庭中的4F反应类型]]</tw-passagedata><tw-passagedata pid="13" name="诱发CPTSD的家庭中的4F反应类型" tags="" position="31700,1550" size="100,100">@诱发CPTSD的家庭中的4F反应类型
卡罗尔是家中的替罪羊。通常来说，自恋型或边缘型人格的父母会选择至少一个孩子
作为家里的替罪羊。指定替罪羊的过程便是霸凌者通过攻击弱者，从而卸除和外化自身的
痛苦、压力和挫败感的过程。通常来说，替罪羊能给霸凌者带来短暂的安慰，却不能有效
地消除或释放他们的痛苦，因此，当霸凌者内心的不适再度出现时，他们就会再度攻击替
罪羊。
威尔海姆·赖希（Wilhelm Reich）在他卓越的著作《法西斯主义大众心理学》（The
Mass Psychology of Fascism）中解释了替罪羊现象是如何发生的。从霸道的父母对某个特
定孩子的迫害，到纳粹将犹太人作为替罪羊的可怕行径，这些行为都是这一现象的例子。
在类似卡罗尔家这种创伤性家庭中，爱找替罪羊的父母通常会联合其他家庭成员一起来对
付替罪羊。
卡罗尔是通过看家庭录像对自己的童年有了更深的了解。她的父母非常自恋且毫不自
知，因此毫不遮掩地录下了他们对卡罗尔进行言语和情绪虐待的许多事件。这些事件通常
是在他们拍摄自己最偏爱的孩子（卡罗尔的哥哥）时，顺便录到影像背景中的。极度自恋
的父母很少会为自己的攻击行为感到尴尬，他们自认有权力因为任何不快而惩罚孩子，不
论这种行为在旁人看来有多么不合理。
卡罗尔的父母很早就开始对她进行攻击了。在她还未满一岁时，他们就用轻蔑的态度
责备她弄脏了尿布。到她三岁时，她经常会因为在说话或玩耍时发出声响而遭到惩罚，这
使她时常处于恐惧中，并最终产生了类似多动症的症状。
于是，家里宽敞的后院成了卡罗尔的避难所，她会在那儿尽情地玩耍——攀爬、奔
跑、跳跃，或用玩具、树叶、杂草、木棍和石头建造村庄，再将其捣毁。她能一直从早饭
时间玩到晚饭时间，常常忘记进屋吃午饭。她后来回想起来，觉得自己这么做能让母亲轻
松一点儿，因为母亲从来不会唤她进屋吃饭。
卡罗尔一度不承认自己在家中受到虐待的事实，但这些家庭录像成了压垮她的最后一
根稻草。在录像中，她会经常玩一种“游戏”：她晃晃悠悠地走在客厅里，触摸各种小物
件，但之后又立马反复用力抽打自己的手掌，并称自己为“坏女孩”。有相当多的镜头捕捉
到，当她这么做时，她的父母和兄弟姐妹就在一旁发出嘲笑她的欢闹声。
在孩子年幼时，如果轻蔑取代了人性善意的滋养，孩子就会感到被羞辱且不堪重负。
年幼的孩子因为太过无助又无法抗议，甚至无法理解被虐待的不公，最终就会相信自己是
有问题的、有致命缺陷的。因此，他们常常认为自己应该受到父母的迫害。
在卡罗尔四岁时，她“不小心”从二楼的窗户跌落。几年之后，她又在街上被一辆车撞
倒在地。成年后，她认为是这两次受伤导致了令她疼痛不堪的早发性脊柱侧凸，并认为自
己因此太过痛苦而不自觉地想要结束生命。
幸运的是，校园生活给了卡罗尔一丝喘息的机会。在她三年级时，一位友善的老师发
现了她的聪明才智，并给予了她充分的肯定，于是她很快成了一名优等生。但不幸的是，
她每时每刻都生活在严重的焦虑中，这种焦虑很快就演变为对学习成绩的强迫倾向，后来
又让她成了完美主义者和工作狂，这些都严重影响了她的生活。
在卡罗尔的青春期，她周围的人都夸赞她哥哥的成绩，并和她的家人一起将她贬低
为“坏胚子”，这加重了卡罗尔的创伤，并使她感到更加痛苦。
最为不幸的是，在卡罗尔成年后，尽管她看似已经逃离了家庭，但是情况还是进一步
恶化：她总会被自恋的人吸引，这些人像她的父母一样虐待和蔑视她，所以她其实仍然生
活在原生家庭的阴影中。这种著名的心理现象被称为强迫性重复（Repetition
Compulsion）或重演（Reenactment），创伤幸存者极易出现这种现象。因此本书会用很
大的篇幅讨论这一现象。
卡罗尔的哥哥鲍勃是父母最宠爱的孩子，也是父母心中的英雄。他不像卡罗尔一样童
年被恐惧和拒绝支配。但鲍勃受到了父母自恋式的期待：如果他做出为父母争光的行为，
父母就会给予他些许表扬；但如果他的表现稍有不完美，父母就会收回对他的认可。于
是，鲍勃被塑造成了一个“全才”。他还被父母“收编”，一起把卡罗尔当作替罪羊，久而久
之，相比于父母对卡罗尔的折磨，他对卡罗尔的折磨有过之而无不及。
我认为在不健全家庭中，手足虐待现象是非常普遍的。在这类家庭中，兄弟姐妹对受
害者（替罪羊）造成的创伤与父母对其造成的创伤一样严重。事实上，在那些父母疏离冷
漠的家庭中，兄弟姐妹也可能是创伤的主要制造者。特别是在我们的社会文化中，对孩子
的情绪虐待随处可见。在孩子发生争执时，旁人常常忠告父母让孩子“自己解决”。但是，
一个力气只有哥哥姐姐一半的孩子如何在没有更强大的同盟下解决问题，阻止哥哥姐姐对
自己的折磨呢？
鲍勃自己也没能逃出父母的病态影响。寻找替罪羊成了他的一种习惯，并且使他发展
出一种自恋者的“第六感”——他能够探测出其他为家庭所害的受害者，并把这些人作为自
己施虐的目标。
父母对他的利用和完美主义标准深深伤害了他，致使他成长为一个彻底的“自恋
狂”和“控制狂”。他强势地试图去塑造他“爱”的人，就像他的父母塑造他那样。卡罗尔在
接受治疗时曾告诉我，他的哥哥鲍勃平日里还会严厉地鞭挞他的第四任妻子。
这个家庭中的第三个孩子叫莫德，比卡罗尔小两岁。在她出生时，父母已经为塑造鲍
勃和卡罗尔的角色而心力交瘁。他们把鲍勃和卡罗尔分别塑造为“英雄”和“替罪羊”后，已
经没有足够的精力和兴趣再去管莫德了。
于是莫德成了典型的“迷失的孩子”，全靠自己照顾自己。她很快发现，食物和白日梦
是她仅有的慰藉。而且由于鲍勃也喜欢欺负她，所以她总是尽可能地待在自己的房间里。
久而久之，莫德麻木地陷入了一种轻度的解离性抑郁，并且一到社交场合就会感到极度的
焦虑和排斥。卡罗尔后来回想起来，鲍勃当时对莫德可能还有猥亵行为。她猜测这就是莫
德难以适应托儿所和学前班的原因。
在莫德四岁时，一位性格古怪的姨妈送了她一台电视，这台电视被放在她的房间里，
她立刻着了迷。渐渐地，她陷入了一种依恋障碍，与电视产生了一种比人更亲密的关系。
可悲的是，她如今仍然迷失在这种关系中，住在堆满废物的杂乱公寓里，靠残疾补助为
生。
和许多因为原生家庭问题而患上CPTSD的孩子一样，莫德无法从兄弟姐妹那里得到
安慰，因为她的父母无意间奉行了“分而治之”的原则，用不同的方式养育孩子，并在孩子
之间示范并鼓励各种挖苦和找碴的行为。不仅如此，合作或温暖的互动往往会遭到嘲笑。
在不健全家庭中，每个孩子都只能得到极少的滋养，也没有更多的资源可以相互给
予。而对父母微乎其微的爱的争夺，也导致了病态的手足竞争的进一步加剧。
在莫德出生两年后，肖恩出生了。一开始，他似乎注定要和莫德一样，步上迷失、解
离的命运，但随着他日渐成熟，他变成了爱丽丝·米勒（Alice Miller）在《天才儿童的悲
剧》（The Drama of The Gifted Child）一书中所描述的“天才儿童”。
肖恩与生俱来的天赋是他的同情心和感受力，他能敏锐地感觉到母亲内心的需求，并
想办法满足她。这样做有时能让母亲平静下来，使她变得不那么可怕和尖酸刻薄。
多年来，肖恩不断磨炼这项技能，最终他像是练就了透视眼一样，几乎能洞悉母亲所
有的需求、心情和喜好。有时，他似乎能比母亲自己更先知道她需要什么。他变得非常善
于平息她的怒火，有时甚至能得到她的些许认可。
与此同时，他的母亲意识到自己日渐衰老，也知道她那酗酒的丈夫很可能会先她一步
去世。她不想孤独终老，便开始利用肖恩富有同情心的天性，诱导他成为任自己差遣的保
姆。于是，肖恩一直住在家里，直到母亲去世后，29岁的他才从情感的牢笼中解脱出来。
这种情况就是关系依赖型奴役，我们会在第七章中详细探讨。
肖恩一位认识他每位哥哥姐姐的朋友曾惊奇地感叹，这家的兄弟姐妹好像都有着不同
的父母似的。
最后，我还必须提醒，替罪羊并不都像卡罗尔这样，只会出现逃反应。在不同家庭
中，这一角色可能引发4F反应中的任何一种，也可能随着时间的推移从一个人转移到另
一个人身上。此外，父母双方或兄弟姐妹也可能选择不同的替罪羊。
[1]复杂性创伤后应激障碍指一个人在经历长期、反复的人为创伤事件后形成的一种
精神障碍，其症状表现不仅包括PTSD的核心症状（反复体验创伤内容、逃避和创伤相关的
刺激物、身体过分紧张警惕），还包括情绪失调、人际关系困难、自我负性认知等。2018
年，世界卫生组织发布了《国际疾病分类》第11版（ICD-11），将CPTSD正式确立为一种
独立的精神障碍诊断。在本书中，作者将CPTSD的一系列症状统称为“复杂性创伤后压力
综合征”。——编者注
[2]作者将所有CPTSD患者统称为幸存者（Survivors），与本书的原文书名“From
Surviving To Thriving”相呼应。——编者注
[3]在心理学中，发展任务指一个人在人生的每一个阶段，在其心理、社会、生理等
因素的影响下，发展出该阶段所应该有的品质。——编者注
[4]本书中的“闪回”，如非特指，则均代表情绪闪回。——编者注
[5]“Critic”指内心中批判的人格和声音，作者全文使用“Critic”这一形容人的
名词将这一概念拟人化，故全书中统一译为“批判者”。——译者注
[6]退行指人们在应激状态下，放弃已经习得的适应技巧，而退回到早期生活阶段，
使用原始、幼稚的方式来应对当下的焦虑。退行是一种不成熟的心理防御机制。——作者
注
[7]“Aura”在本书中被译为灵光，最早可追溯到希腊语，意思是微风、空气，后引
申为呼吸，是生命的象征。——编者注
[8]解离是一种心理防御机制，表现为在面对重大压力时产生的感觉抽离、情绪麻
木、自我认同混乱、失去现实感、失忆等反应，这时幸存者看自己就像是在看另一个人。
——编者注
[9]毒性羞耻感是一种无法感知自己的个人价值的心理状态。——编者注
[10]4F反应即4种创伤反应，分别是战（Fight）、逃（Flight）、僵（Freeze）、讨
好（Fawn），因为4种反应的英文单词的首字母都是F，所以它们合称为4F反应。——作者
注
[11]环性心境是一种心境持续不稳定的现象。该现象持续时间至少为2年，其间抑郁
期和轻躁狂期交错且反复出现，但相应时期的病情严重程度和持续时长均未达到确诊为抑
郁症或双相障碍的标准。——编者注
[12]作者在这里是将“单纯”的PTSD与“复杂性”的PTSD，即与CPTSD做对比。——
译者注
[13]本书以“强迫”一词描述某些症状或倾向时，指类似于强迫症般的想法或行为，
不指勉强他人、逼迫他人的行为。强迫症是一组以强迫思维或行为为主要临床表现的神经
精神疾病，其特点为有意识的强迫和反强迫并存，一些无意义甚至违背自己意愿的想法或
冲动反复侵入患者的日常生活。——编者注
[14]关系依赖表现为缺乏独立性，感到自己无助、无能，深怕被遗弃；不断地给予和
付出，习惯或希望被对方需要，将自己的需求依附于别人。——译者注
</tw-passagedata><tw-passagedata pid="14" name="第二章 康复的各个层面" tags="" position="34425,1875" size="100,100">@第二章 康复的各个层面
从CPTSD中康复的过程无疑是复杂的。我之所以强调这一点，是因为有很多针对单
一层面的创伤疗法声称能够使所有症状消失。在我看来，CPTSD是由多层面的伤害共同
导致的，单一的治疗方式无法治愈所有层面的伤害。比如，虐待型和遗弃型的父母会从很
多层面伤害孩子，这些层面包括认知层面、情绪层面、精神层面、身体层面和人际关系层
面。
此外，幸存者如果使用了过度简化的疗法，却没有取得其宣称的疗效，便可能会被毒
性羞耻感束缚。我之所以撰写本书，很大一部分原因就是我自己曾多次因为“最新的万能
疗法”未能使我康复而陷入更深的自卑。
幸存者想要康复，就要学会自我支持，以满足自己因童年创伤而未被满足的各个层面
的发展需求。
本章简要概述了CPTSD疗愈过程中涉及的许多任务，我将在第二部分更全面地探讨
这些任务。

[[CPTSD中关键的发展停滞]]
[[认知疗愈]]

[[情绪疗愈]]

[[灵性疗愈]]

[[身体疗愈]]
</tw-passagedata><tw-passagedata pid="15" name="CPTSD中关键的发展停滞" tags="" position="30575,1075" size="100,100">@CPTSD中关键的发展停滞
小说家大卫·米切尔（David Mitchell）有一佳句：火是太阳在木头中释放自己[1]。我
觉得这是一种看待发展停滞有益的视角——有效的疗愈就是在无意识中释放出自己的潜
力。你的潜力与生俱来，只是由于童年创伤而未被开发。
我在下面列出了CPTSD中最常见的发展停滞。你会发现自己缺乏或完全不具备这些
健康人所拥有的关键特质。通常而言，不同的创伤幸存者会出现不同类型和数量的发展停
滞，其影响因素有：4F反应类型、童年虐待或忽视的形式、幸存者的天性，以及已完成
的疗愈任务。
自我接纳
清晰的身份认同
自我同情
自我保护
从关系中获得慰藉的能力
放松的能力
充分表达自我的能力
意志力和行动力
平和的心境
自我关怀
相信生命可贵
自尊
自信
因为我在早期的疗愈过程中带着怨恨，所以尽管我努力在这些发展停滞的领域培养自
己，却收效甚微。“为什么我必须做这些呢？”我的内心总是重复这个问题。那些本应针对
父母的怨恨常常回弹到我自己身上，从而破坏或阻碍我对自己的关爱。好在持续的疗愈工
作帮我逐渐消除了这种怨恨，让我学会了像对待一个需要帮助且真正值得帮助的孩子那
样，进行自我关怀。
有一种特别可悲的发展停滞困扰着许多幸存者，那就是意志力和自驱力的丧失。许多
病态的父母对孩子正在萌芽的进取心做出了具有破坏性的反应。如果这种情况贯穿孩子的
整个童年，他就会感到人生迷茫且毫无意义，甚至可能一生都会漫无目的地漂泊，如同没
有马达的小船。即使他成功确定了自己的目标，可能也很难持续且专注地付出努力来实现
目标。治疗这项发展停滞至关重要，因为许多心理学研究表明，相较于智力和天赋，毅力
（Persistence）这种心理特性对实现自我价值、获得人生满足感更为关键。
激发意志力的能力似乎与恰当地表达愤怒的能力有关。我治疗过的很多来访者都被困
于失去意志力这种成年人的无助感中。那些从中康复的人通常都多次参与了针对哀悼和表
达愤怒的治疗，本书会不断提及这些疗法。当疗愈取得了足够的进展时，你将会形成自己
的意志力。一开始你可以先假装自己能做到，直到能够真正做到。这就是斯蒂芬·约翰逊
（Stephen Johnson）所说的“努力的奇迹”。
一些发展停滞的幸存者有自信却无自尊。童年时，我的逃反应转化为了对学习成绩的
追求，因为成绩好能使我获得外界的奖励。但这些奖励始终无法消除我的毒性羞耻感，无
法让我感到自己是个有价值的人。
与此同时，由恶性内在批判演化来的内在批判者就像我的父母一样，总能在我身上找
到缺陷来否定我得到的正面反馈。考试得99分从来不能让我感到骄傲，那丢了的1分反而
会刺激我进行深刻的自我批判。就像我治疗过的许多幸存者一样，我患上了冒充者综合
征（Imposter&#39;s Syndrome）[2]。这种病症否定了我从外界收到的正面反馈，并且让我坚
信，如果大家真的了解我，就会发现我是个失败者。后来，我终于变得对自己的才能有了
自信，尽管我的自尊还是低到尘埃里。</tw-passagedata><tw-passagedata pid="16" name="认知疗愈" tags="" position="30800,1075" size="100,100">认知疗愈
由于CPTSD对我们关于自身的想法和信念造成了伤害，所以康复的第一个层面通常
涉及修复这些伤害。
认知疗愈的目标是让大脑变得对自己更友好，其重点在于识别并消除童年时被灌输的
破坏性想法和思维。此外，我们还需要学会选择健康且更准确的方式来看待和谈论自己。
笼统而言，就是要改进我们向自己讲述自身痛苦的方式。
我们需要了解，糟糕的养育方式是如何造成我们心中难以磨灭的创伤的。为了做到这
一点，我们可以学着摆脱不公允的自责，转而指责父母糟糕的养育方式；还可以激励自己
摆脱父母的影响，自由地规划自己的疗愈之旅，并为此建立对自己的绝对忠诚。这种忠诚
会推动我们的认知疗愈进程，将我们的大脑解放出来，进而停止对自己许多正常特质的攻
击。
幸存者的内心被父母植入了自我憎恨的内在批判，而认知疗愈对摆脱这种内在批判起
到了关键作用。当我写到这里时，我儿子的朋友正在对他说：“我搭的这个乐高模型会传
播脑部疾病，然后把人吃掉。”我惊异于这样的巧合，心想：这多么形象地刻画了那些给
孩子造成创伤的父母啊。


[[缩减批判者]]
[[发展停滞的健康自我]]
[[心理教育与认知疗愈]]
[[正念]]</tw-passagedata><tw-passagedata pid="17" name="情绪疗愈" tags="" position="31300,1100" size="100,100">
情绪疗愈
导致创伤的父母对我们造成的情绪伤害并不亚于对我们造成的思想伤害，因此，我们
也需要在情绪层面上进行大量的疗愈工作。同时，由于我们所处的社会文化有时也会伤害
我们的情绪天性（Emotional Nature），所以情绪层面的康复需要我们特别重视。


[[情绪层面的康复]]
[[情绪智力]]
[[毒性羞耻感与“灵魂谋杀”]]
[[哀悼是一种情绪智力]]</tw-passagedata><tw-passagedata pid="18" name="灵性疗愈" tags="" position="31750,1125" size="100,100">灵性疗愈
精神信仰无疑是非常个人化的话题，是每个人的私事。我所写的内容无意干涉他人的
信仰，而是想介绍一些心理学概念，这些概念属于非宗教性质的灵性领域。然而，我知道
一些创伤幸存者在童年遭受过痛苦的心灵（Spiritual）虐待，如果“灵性”（Spiritual）这个
词让你觉得被冒犯或勾起了你的任何不快，请跳过这一部分内容。本书的工具箱中还有很
多其他有用的工具。

[[通过更高层次的归属感来缓解被遗弃的痛苦]]
[[感恩]]
[[足够好的抚育]]</tw-passagedata><tw-passagedata pid="19" name="身体疗愈" tags="" position="32100,1125" size="100,100">
身体疗愈
创伤会以多种方式对人体造成伤害，所以我们需要了解CPTSD对我们身体层面造成
的伤害，从而激励自己采取措施，帮助自己实现在身体层面的疗愈。
长期创伤造成的生理伤害，大多数都是因为我们被迫长期处于过度觉醒状态，被困于
战、逃、僵或讨好的反应模式中。当我们长期处于紧张状态（即交感神经系统活跃）时，
有害的生理变化便会根植于我们的身体。以下是CPTSD对身体造成的一些常见影响。
过度警觉
呼吸浅，节奏杂乱
肾上腺素持续分泌
盔甲化（Armoring），如慢性肌肉紧张
冲刺和防御反应对身体造成的损伤
身体无法放松，感觉不踏实
过度活跃而导致的睡眠问题
消化道紧张，从而引发消化系统疾病
过度使用酒精、食物或药物进行自我药疗[10]而造成的生理损伤
此外，如果受到躯体虐待或性虐待，幸存者就会缺乏或丧失通过触摸身体来安抚自己
的能力；如果受到言语或情绪虐待，那么幸存者就很难发展出被眼神接触或人声抚慰的能力。

[[自助躯体疗法]]
[[CPTSD和躯体疗法]]
[[自我药疗]]
[[解决饮食问题]]</tw-passagedata><tw-passagedata pid="20" name="第三章 改善关系" tags="" position="34600,1875" size="100,100">[[预先警告]]
[[CPTSD是一种依恋障碍]]

[[寻找足够好的关系型帮助]]

[[再抚育]]
</tw-passagedata><tw-passagedata pid="21" name="预先警告" tags="" position="31300,700" size="100,100">@预先警告
有些幸存者遭到了父母极其严重的背叛，因此要求他们立刻再次信任他人是不公平、
不合理的。本章建议幸存者试着接受他人的帮助，但如果这些建议让你感到沮丧或难以接
受，那么请跳过这一章。本书中还有大量其他的内容能帮你减轻CPTSD的许多症状。康
复是相对的，并不存在完全彻底的康复，因此你无须采纳书中的所有建议，只需选择最适
合你的。
此外，我网站上的留言者、我的许多来访者以及我个人的经验都表明，真正的关系型
疗愈可以来自人际关系以外的关系。哺乳类宠物就是特别好的疗愈型关系对象，它们的依
恋需求[1]和依恋方式与人类非常相似，因此能够与人类发展出疗愈型关系。卡尔·罗杰斯
（Carl Rogers）[2]指出，年幼的孩子必须拥有无条件的积极关注才能茁壮成长，而狗和猫
可以成为这种关注的绝佳来源。
自然、音乐和艺术也能提供关系型疗愈。此外，对一些幸存者来说，藏身于一本好书
之后的作者也可以在安全距离中帮助他们推进疗愈进程。
即使幸存者经历了最令人发指的背叛，有时奇迹也会出现，使幸存者找到一段与他人
的治愈性联结，尤其是在疗愈的后期阶段。

</tw-passagedata><tw-passagedata pid="22" name="CPTSD是一种依恋障碍" tags="" position="31425,700" size="100,100">CPTSD是一种依恋障碍
许多治疗师认为CPTSD是一种依恋障碍。这指的是，幸存者在童年阶段找不到一个
可以与之发展健康的亲密关系的安全可靠的成人，因此也就无法向他人学到建立亲密关系
的关键技巧。当与照料者建立健康关系的发展需求没有得到满足时，幸存者在成年后通常
就很难找到并维系健康的支持性关系。

[[社交焦虑的成因]]
[[我的关系型疗愈之旅]]
[[疗愈消解了孤独的羞耻感]]</tw-passagedata><tw-passagedata pid="23" name="寻找足够好的关系型帮助" tags="" position="31925,700" size="100,100">@寻找足够好的关系型帮助
我认识一些幸存者，他们很幸运地可以从伴侣或朋友身上获得关系型疗愈，而这些伴
侣或朋友通常有足够好的父母，或者是自己已经完成了治愈之旅，并得到了显著的康复。
此外，依恋理论研究者提出了赢得的安全型依恋（Earned Secure Attachment）的概
念，来描述CPTSD幸存者足够康复的状态（Recovered Enough State），即幸存者的依恋
障碍得到充分治愈的状态。这种状态的标志通常是幸存者形成了至少一段足够可靠的支持
性关系。
当幸存者在治疗关系之外还建立起了赢得的安全型依恋关系，就标志着治疗的成功结
束。这种关系的对象通常是幸存者的伴侣或最好的朋友，与他们在一起时，幸存者可以真
正地做自己。
许多在我网站上留言的人都热情洋溢地分享了他们通过线上康复团体或论坛，得到他
人帮助的故事。对那些仍然难以在人前表现自身脆弱的人来说，线上康复团体或论坛特别
有帮助。有时线上的距离感和相对的匿名性可以减少幸存者对自我表露的恐惧，同时又能
加强疗愈型的关系。基于这一原因，似乎有越来越多的治疗师开始提供电话咨询了。
在第十三章中，我介绍了如何寻找一位足够好的治疗师的方法，也更深入地探讨了
治疗性关系型疗愈的原则，以帮助你明确对治疗师的合理期待。此外，关系型疗愈也可
能来自相互咨询（Co-counseling）[4]关系。关于建立相互咨询关系的指南也请见第十三
章。

[[切断与父母的联系]]
[[学会处理关系中的冲突]]</tw-passagedata><tw-passagedata pid="24" name="再抚育" tags="" position="32300,700" size="100,100">再抚育
再抚育（Reparenting）是关系型疗愈的关键。受创伤的孩子有许多发展需求未得到满
足，而再抚育的主要目标是满足这些需求。在本书中，我们将反复提及这些需求中最基本
的两个：爱与保护。
第十六章的一号工具箱“康复意图建议”，将CPTSD幸存者可能尚未解决的各种处于停
滞状态的发展需求转化成了具体的目标，从而为疗愈工作指明了方向。

[[当自己的父母]]
[[自我母育与“无条件的爱”]]
[[“无条件的爱”的界限]]
[[养育你的内在小孩]]
[[自我父育与“时光机营救行动”]]
[[代表团的再抚育]]
[[自我关系与他人关系之道]]</tw-passagedata><tw-passagedata pid="25" name="第四章 疗愈的进程" tags="" position="34750,1875" size="100,100">[[疗愈的阶段]]

[[康复的迹象]]

[[从求生到茁壮]]
</tw-passagedata><tw-passagedata pid="26" name="疗愈的阶段" tags="" position="32275,200" size="100,100">@第四章 疗愈的进程
疗愈的阶段
尽管我们常常在多个层面同时推进疗愈进程，但在某种程度上，疗愈是一个渐进的过
程。它始于认知层面，通过心理教育和正念疗法来帮助我们理解自己患有CPTSD。这种
认知层面的觉醒能使我们学着削弱CPTSD对生活的诸多破坏力。
认知层面疗愈的下一步是长期缩减批判者。一些幸存者需要在这一步做出很大的努
力，才能进入情绪层面的疗愈阶段，即学习如何有效地哀悼。
对童年的损失进行深切哀悼的阶段可能会持续若干年。当哀悼取得足够的进展，幸存
者会自然地进入下一层面的疗愈，包括哀悼失去的安全感，以此克服恐惧；哀悼失去的自
尊，从而消除毒性羞耻感。
当我们越来越善于进行这种深层次的哀悼时，就可以开始解决创伤的核心问题——遗
弃抑郁。在此阶段，我们将通过第十二章介绍的身体治疗方法消除遗弃抑郁引发的身体盔
甲化及其他生理反应。在这一阶段结束时，我们将学会怀着同情心支撑自己度过抑郁时
期。
最后，我们要学会解构每个疗愈层面旧有的、会加深痛苦的防御。这涉及一系列复杂
的任务，而许多幸存者需要依靠关系型疗愈来完成这些任务。我们将在第十三章对此作出
进一步探讨。

[[在循序渐进的疗愈中培养耐心]]
[[接受“疗愈将持续终身”的事实]]</tw-passagedata><tw-passagedata pid="27" name="康复的迹象" tags="" position="32650,200" size="100,100">@康复的迹象
康复的标志之一，是在有效的疗愈工作下情绪闪回次数不断减少。足够多的练习会使
你逐渐变得更善于管理被触发的状态，而这又会反过来降低情绪闪回发生的频率、强度和
持续时间。
康复的另一个关键标志是，你的内在批判者开始缩减，并不再主导你的心理。随着它
的缩减，你对自己友好的自我（Ego）有了成长的空间，并发展出一种正念，能在内在批
判者占据上风时有所觉察。这会让你逐渐拒绝内在批判者的完美主义和极端化。你会渐渐
不再因为正常的小缺点而迫害自己，也会更少地执拗于对他人小失误的失望。
康复的另一个迹象是放松的能力逐渐增强。这种能力越强，你就越能防止在被触发闪
回时做出过度反应，进而能以健康、非自我毁灭的方式来善用战、逃、僵和讨好反应。这
意味着你只有在受到真正的攻击时才会回击，只有在无能为力时才会逃跑，只有在需要进
入敏锐观察模式时才会定住，只有在需要自我牺牲时才会讨好。
还有一些状态意味着这种过度反应的减少，一种是在战和讨好这两极之间取得良好的
平衡，当你逐渐实现这一平衡时，你便能在维护自己的需求和向他人的需求妥协之间健康
地摇摆。另一种状态是在逃和僵的两极之间实现极佳的平衡，这包括：做与不做之间的平
衡、交感与副交感神经系统之间的平衡、左脑与右脑处理之间的平衡。第六章末尾将更详
细地探讨平衡自己体内战与讨好、逃与僵这两对反应的重要性。
深层次的康复还体现为，你越来越能在足够安全的人际关系中放松。这同时会促使你
在值得信赖的关系中更多地展露自己的真实和脆弱。如果足够幸运的话，你可能最终会获
得一种亲密、相互支持的关系，彼此甘苦与共。
最后，进阶的康复也意味着放弃根治情绪闪回的救赎幻想。放弃这个救赎幻想是在挫
折中前进的又一个鲜活例子。我们通常必须与自我否定努力斗争，才能逐渐接受一个不公
平的现实，即我们永远无法完全摆脱情绪闪回。如果我们不接受这一点，就很难带着自我
同情、自我安慰和自我保护去快速识别和应对情绪闪回。

[[识别康复迹象的困难]]</tw-passagedata><tw-passagedata pid="28" name="从求生到茁壮" tags="" position="32900,200" size="100,100">@从求生到茁壮
为了康复，我们需要学习处理难以预测的内在情绪变化。也许其最终的落点就在我所
说的“求生↔茁壮”这一循环往复的维度上。
在进入疗愈阶段之前，我们可能觉得人生不过是为了求生而挣扎。然而，当疗愈取得
一定的进展时，我们便能体验到重新茁壮成长的感觉。这些体验一开始可能是乐观、充满
希望的，我们确信自己确实在不断复原。然而，疗愈从来不是一帆风顺的，一个情绪闪回
袭来，我们就又回到了这一维度的求生端，甚至会忘记自己在求生中曾有过喘息的机会。
就这样，我们再次被困在了“混杂的被遗弃感”的焦虑麻木中，并不可避免地重新陷入低
潮。啊，这太不公平了！我们仿佛又回到了艰难的求生状态。
在求生模式下，即便是平时最微不足道、最简单的任务也会变得难上加难。这种感觉
就像回到了童年最糟糕的时期，一切都太艰难了。如果闪回特别强烈，死神塔纳托斯[1]就
会找上门。塔纳托斯被弗洛伊德解释为“死亡的愿望”，在闪回情境下，它与我们在第一章 中介绍的自杀意念相对应。此时，我们的求生意志受到了极大的挫伤。但随着正念的加
强，我们可以逐渐意识到自杀意念是闪回的标志，并用第八章的闪回管理步骤来拯救自
己。
随着疗愈的进展，即使回到求生模式也并不会把我们推向“求生↔茁壮”维度中彻底绝
望的那一端，但它仍会让人感觉非常糟糕，特别是当它伴随着高度焦虑或让人动弹不得的
抑郁时。
当闪回管理不太有效时，求生模式会变得尤为困难。在这种情况下，“人生艰难”的感
觉会持续几天甚至几周。这时闪回往往会发展为长期的退行。
在退行中我们可能会受到强烈的诱惑，想采用过去那些不太理想的自我安慰方式。基
于不同的4F反应类型，这通常表现为暴饮暴食、过度工作、贪睡，以及性发泄等。
退行有时还会导致我们开始进行自我药疗，因为我们有一种难以抗拒的冲动，急切地
想让自己停留在维度上茁壮的那一端，即使事实上我们早已无法强留。然而，随着疗愈的
推进和正念的加强，我们会开始注意到，这种自我药疗的行为其实表明我们正处于求生模
式的闪回中，而不再真正处于茁壮端。并且通过自我药疗来人为地延长一种偏好的体验，
会进一步加剧我们的退行。这时最好的方法是重新唤起自我接纳意识，重新承诺支持自
己，无论我们处于这一维度的什么位置。
我认为退行有时就像是我们的心灵在召唤，让我们去解决重要的发展停滞问题。这种
情况意味着，我们需要在长期的痛苦中学会坚定的自我接纳，同时也需要发展出坚不可摧
的自我保护意识。保护自己免受不公的强烈意愿是人的一项基本天性，我们需要逐步强化
这种天性，以抵御内在批判者的攻击。
此外，借助第十三章的正念技巧，我们可以练习和培养深切的自我同情，从而提高我
们在求生模式中生存下来的能力。如果在疗愈取得了足够大的进展的同时，我们还获得了
可以信赖的伙伴，那么我们就可以争取他们的支持，帮助我们进行口头宣泄，释放困于求
生模式的痛苦。
值得重申的是，所有人都会必然面临这种存在性痛苦：即承受从茁壮模式变为求生模
式时所产生的失望。然而，创伤幸存者在处理这种转变时更为艰难，因为我们被长久地遗
弃在求生模式一端。但随着疗愈的进展，我们可以学会在陷入求生模式时更多地支持自
己。


[[有疗愈意义的闪回与成长之痛]]
[[最佳压力]]
[[黑暗中的曙光]]
[[“未经审视的人生不值得过”]]
[[“别担心，要开心”的情绪霸权]]</tw-passagedata><tw-passagedata pid="29" name="第五章 如果我不曾被打呢？" tags="" position="34900,1875" size="100,100">@第五章 如果我不曾被打呢？
躯体虐待和性虐待通常是儿童经历的最显见的创伤，特别是当这些虐待持续发生的时
候。然而，在使人患上CPTSD的家庭中，许多同样会造成创伤的行为却未被注意到，比
如情绪和言语层面的虐待行为。这往往是因为躯体虐待比言语及情绪上的虐待更为明显。
而我认为，情感创伤导致儿童患上CPTSD的情况并不少于身体创伤。

[[否认和“最小化”]]

[[生长迟滞综合征]]

[[停止对情感遗弃的“最小化”]]
</tw-passagedata><tw-passagedata pid="30" name="否认和“最小化”" tags="" position="33800,400" size="100,100">否认和“最小化”
否认童年被遗弃对自己造成的创伤性影响会严重阻碍幸存者疗愈的进程。在童年时
期，持续的情感忽视通常会使我们产生压倒性恐惧、羞耻和空虚感。成年后，我们可能会
不断地闪回至这种“混杂的被遗弃感”中。若要康复，我们必须认识到：恐惧、羞耻和抑郁
是缺爱童年留下的阴影。如果缺乏这样的认识，那种根本的、未被满足的、对抚慰性人际
关系的需求，便会将你束缚在无限、无谓的痛苦之中。
对抗否认不是一项简单的任务。孩子很想相信父母爱自己、关心自己，因此他们会否
认那些恶劣的忽视和虐待，或将其“最小化”。
许多遭受童年创伤的幸存者都没有意识到言语虐待和情绪虐待会造成创伤，而那些处
于康复阶段的被洗脑的受害者（他们也很容易患上CPTSD）通常都能意识到。许多受到
言语和情绪虐待的幸存者从不会承认这些行为对心灵的伤害。他们从未准确地将当下的痛
苦归咎于这些行为。当他们试图承认那些伤害时，通常会被这样的想法所蒙蔽：与那些经
常被殴打的小孩相比，我的遭遇不算什么，他们比我惨多了。小时候，我的父亲经常扇我
耳光，但我朋友的父亲经常用拳头揍他，相比之下，我就把父亲的行为“最小化”了。
去最小化（De-Minimization）是一个对抗否认的重要方法，它可以破解幸存者故意
淡化童年创伤的防御机制。对童年创伤的影响“去最小化”是一个持续终生的过程，这个过
程就像剥开一个光滑辛辣的洋葱。对一些人来说，洋葱的最外层是躯体层面的虐待，如性
虐待或过度体罚；里面的几层是言语、精神和情绪层面的虐待；核心层则是言语、精神和
情绪层面的忽视。
讽刺的是，我父亲对我的躯体虐待反倒让我感到庆幸，因为这种虐待显而易见，以致
我到了青春期就能够意识到这是我父亲对我的暴行，而再也无法对这种虐待进行压制、合
理化、轻描淡写和一笑置之（但很久之后我才明白，其实我的母亲也在虐待我，只是我一
直不愿意承认，还一直把她当作我理想中的母亲罢了）。
识别父母的虐待行为最终帮我意识到父母对我的隐性压迫，并让我发现了童年遗弃行
为在言语和情绪层面的虐待。然而很久以后我终于意识到，对我和许多幸存者来说，言语
和情绪虐待对我们的伤害比躯体虐待要大得多。
持续的批评会系统地摧毁我们的自尊，并最终内化为有毒的内在批判者，不断地将我
们判定为有缺陷的存在。更糟糕的是，轻蔑的话语充满了情绪毒素，会给孩子注入恐惧和
毒性羞耻感，进而使他不再寻求别人的注意，并且避免以任何引人注意的方式表达自己。
用不了多久，他就不会再去寻求任何形式的帮助或联结。

[[内在批判者的神经生物学理论]]
[[情感忽视：造成CPTSD的核心伤害]]
[[情感饥渴与成瘾]]</tw-passagedata><tw-passagedata pid="31" name="生长迟滞综合征" tags="" position="34150,400" size="100,100">@生长迟滞综合征
如果孩子一直没有遇到慈爱的照料者，爱的匮乏感会逐渐增强，有时会演变为生长迟
滞综合征（Failure to Thrive Syndrome）。
生长迟滞是20世纪中期出现的一个术语，用来描述一种在医院引入新的抗菌操作后出
现的婴儿死亡的现象。当时，医院因为担心婴儿被细菌感染，所以制定了一个新的卫生标
准，禁止护士抱婴儿，但随之而来的是婴儿死亡率的攀升。
后来，研究人员在东欧孤独院也发现了类似的现象，因为没有足够的工作人员来满足
婴儿的触摸抚慰需求（Contact-Comfort Needs），所以许多婴儿没有能活下来。现在现代
医学已经接受了这样的科学事实原则——婴儿需要大量的身体接触和抚育才能茁壮成长。
根据我的经验，生长迟滞并不是一种“全或无”的现象，而是一个连续光谱，从遗弃抑
郁到死亡都涵盖其中。许多CPTSD幸存者在婴儿时期从未得到过身体接触和抚育，从而
未能茁壮成长。我相信他们中的很多人都徘徊于光谱的末端，一次次痛苦地经历死一般的
感受。我的几位来访者常开玩笑说，当他们在处于闪回状态时，感觉到了“死亡的暖意”。
此外，遗弃经历确实会导致一些受到创伤的儿童死亡：也许他们的免疫系统会变弱，
使他们更易患病；也许正如唐纳德·卡尔谢（Donald Kalshed）所暗示的那样，他们会不自
觉地被致命的“意外”吸引，想借此终止他们的痛苦。有一次，当我与一位来访者处理深深
困扰她的闪回时，她向我讲述了一段痛苦的回忆。十岁时，她迷迷糊糊地从两辆停着的汽
车之间走出来，走入了来往的车流中。之后她被一辆卡车撞倒，经过几个月的住院治疗才
保住了腿。在她的回溯中，最令人伤心的是，她记得当在医院醒来发现自己还活着时，她
感到了极度的失望。


[[依恋需求的进化基础]]
[[情感遗弃会降低情绪智力和关系智力]]</tw-passagedata><tw-passagedata pid="32" name="停止对情感遗弃的“最小化”" tags="" position="34425,400" size="100,100">@停止对情感遗弃的“最小化”
与处理躯体虐待一样，有效修复言语虐待和情绪虐待的创伤，有时犹如打开一扇门，
让人不再轻视情感遗弃带来的可怕影响。我有时最为同情那些“仅仅”遭到情感忽视的幸存
者，因为忽视行为很难被视为明确地遭到虐待与遗弃的证据。大多数人几乎没有四岁之前
的记忆，但其实这种伤害在四岁以前大多已经造成了。这类幸存者通常需要进行非常深刻
的内省工作，才能意识到当前的闪回痛苦是被情感遗弃时那种感受的重现。
幸存者可能需要很长的时间才能记起并正视情感忽视对自己的影响。这通常是一个用
直觉将许多线索拼凑起来的过程。当对童年的重建达到一定程度时，谜底往往就会被揭
开。这有时会让人恍然大悟，发现情感忽视确实是当下痛苦的核心原因，而且这种顿悟会
带来一种深刻的令人宽慰的认知——脆弱的自尊、频繁的闪回、一直难以建立的支持性关
系，这些痛苦都源自父母封闭的心。
很遗憾，我在写第一本书时对情感遗弃的理解不如现在深刻。但愿我在那本书中并没
有过度聚焦于躯体虐待在童年创伤中的作用，而忽视了情绪虐待。向许多幸存者传达这一
点是非常困难的，因为他们会将自己与我进行不当地比较，从而轻视自身的困境并感到羞
耻：“我的情况远没有你那么糟糕，我的母亲从来不打我！”
讽刺的是，我觉得迄今发生在我身上最糟糕的事情就是在成长过程中遭到情感遗弃。
事实上，直到我学会将无数次情绪闪回的痛苦视为童年绝望的孤独感时，才有效克服了使
我一次次陷入忽视型关系的强迫性重复。但再次强调，这并不是要否认或轻视其他层面的
虐待，比如躯体、性、言语虐待。

[[练习展现脆弱]]
[[叙述的力量]]</tw-passagedata><tw-passagedata pid="33" name="第六章 我属于何种创伤类型" tags="" position="35050,1875" size="100,100">@第六章 我属于何种创伤类型
人类对童年创伤的反应具有一定的差异性。本章介绍的创伤类型主要用于识别和治疗
不同类型的CPTSD。本章的模型阐述了四种基本的生存策略和防御类型，它们是从人类
本能的战、逃、僵和讨好反应发展而来的。
童年遭受的虐待或忽视形式、出生排行、遗传因素等差异会导致不同的人倾向于特定
的4F反应生存策略。而你从小发展的这些策略，是为了阻止、避免或减轻进一步的创
伤。战类型的人会发展出一种类似自恋的防御模式；逃类型的人会发展出一种类似强迫症
的防御模式；僵类型的人会发展出一种类似解离的防御模式；讨好类型的人会发展出一种
类似关系依赖型的防御模式。


[[恰当地使用4F反应]]
[[作为依恋障碍的CPTSD]]
[[战类型和自恋型防御]]

[[逃类型和强迫型防御]]

[[僵类型和解离型防御]]

[[讨好类型和关系依赖型防御]]

[[混合的创伤类型]]

[[自我评估与康复]]
</tw-passagedata><tw-passagedata pid="34" name="恰当地使用4F反应" tags="" position="33725,725" size="100,100">@恰当地使用4F反应
童年时得到“足够好的抚育”的人，在成年后面对危险能够做出健康灵活的应对，恰当
地使用4F反应：他们能健康地使用战反应，帮助自己确立合适的界限、保持自信果敢，
以及必要时为自己提供积极的自我保护；他们能恰当地使用逃反应，能在意识到对抗会
加剧危险时及时逃脱和撤退。如果进一步的行动或抵抗只会徒劳无功或适得其反，他们可
以适当地僵住，放弃挣扎。此外，僵反应有时是我们面对危险时的第一反应，它能让我
们通过静止、沉默和伪装来争取时间，评估风险并决定接下来的最佳选择是战、逃、继续
僵，还是讨好。最后，他们能够以不卑躬屈膝的方式进行讨好，并且欣然地倾听、协助
和妥协，正如他们能够主张和表达自我，提出自己的需求、权利和观点。表6.1列出了4F
反应的积极特性。后文将对这四种防御反应的成因进行更深入的阐述。
表6.1 4F反应的积极特性
那些在童年反复遭受创伤的人，往往会过度依赖4F反应中的一到两种反应来求生。
固着于任何一种4F反应，不仅会降低对其他反应的使用能力，还会严重损害全然放松的
能力，将我们禁锢在狭隘、贫乏的人生体验中。
日积月累、习惯性的4F防御反应“有助于”我们不去关注内在批判者的唠叨声和它引起
的痛苦感受。但是对4F反应的过度关注，则会使我们对过去未解决的创伤缺乏觉察，也
会对自己当下因疏离感而产生的痛苦感到迟钝。
表6.2列出了每种防御反应的消极特性。当我们处于情绪闪回时，真实或想象的危险
通常都会触发相关反应，使我们进入这些角色或状态，并引发相关的行为。
表6.2 4F反应的消极特性
①A型人格是一种人格类型，是以具有高水平的竞争意识、强烈的时间急迫感、较强的攻击性、强烈的成就等行为的集
合为特征的人格倾向。——编者注
②肾上腺素成瘾表现为追求刺激，通过触发身体的压力反应而获得快感。——编者注
③微观管理指过度管理所有的小细节或小事。通常也被视为过度控制。——编者注
④父母化的孩子（Parentified Child）也被称为“亲职化的孩子”，表现为“父母”和“孩子”两个角色的对调。原因可以归结
为父母没有履行自己的义务，而将其抛给孩子履行。——编者注
</tw-passagedata><tw-passagedata pid="35" name="作为依恋障碍的CPTSD" tags="" position="33850,725" size="100,100">@作为依恋障碍的CPTSD
过度依赖战、逃、僵或讨好反应，是受创伤儿童的一种无意识的尝试，试图以此来应
对持续的危险。这也是孩子的一种防御策略，用于强化“父母真的关心我”的幻觉。
对成年人而言，所有4F反应通常都会对真正的亲密关系产生一种阻碍。这是因为亲
密感往往会触发痛苦的情绪闪回，让人想起自己童年时是如何在缺乏安慰性联结的情况下
求生的。同时过往的经历也使人相信，如果自己在关系中展现脆弱，就会像童年时那样遭
到攻击或遗弃。于是，4F反应防御系统会阻碍那些能够展现脆弱并促成深层联结的关
系，保护我们免遭再次遗弃。
许多战类型的人会通过愤怒而控制狂般地索取无条件的爱来疏远他人，从而避免建
立真正的亲密关系。这种不切实际的要求（满足他们未被满足的童年需求）降低了他们与
他人建立亲密关系的可能性。此外，一些战类型的人会自欺欺人地相信自己是完美的，只
要求对方做出改进。这种防御性的信念使他们自认为有权将关系中的问题完全归咎于他
们的伴侣或朋友。
许多逃类型的人会永远保持忙碌和勤奋的状态，从而避免自己被更深层次的关系触
发。其中一些人会过度努力，希望有一天自己能变得足够完美，从而值得被爱。逃类型的
人很难展现自己不完美的一面。
许多僵类型的人会躲在自己的房间和幻想中，并深信人际交往对自己毫无意义。不
过有些僵类型的人没有因为可怕的童年忽视或虐待而完全放弃人际关系，这些人倾向于在
网络中发展人际关系。他们可以在家里安全地维持这种关系，并按照自己的意愿控制接触
次数。
许多讨好类型的人几乎从不展现自己，以避免情感投入和可能产生的失望。他们躲
在“对他人有帮助”的表象背后，对他人过度倾听、过度取悦或过度服务。在亲密关系中，
他们过度关注伴侣，认为这样就不必冒险暴露真正的自己并遭到更强烈的拒绝。
表6.3比较了这四种类型的人之间的差异。
表6.3 4F反应对依恋和安全本能的歪曲
接下来让我们更细致地分析每一种4F反应的防御方式，从而减少对它们的过度依
赖。
</tw-passagedata><tw-passagedata pid="36" name="战类型和自恋型防御" tags="" position="33975,725" size="100,100">@战类型和自恋型防御
战类型的人会无意识地受到一种信念的驱动，认为权力和控制可以带来安全感、减轻
遗弃感，并牢牢抓住爱。被宠坏的孩子和没有得到足够限制的孩子（这种遗弃会造成一种
独特的痛苦）可能会发展为战类型。还有一些模仿自恋型父母欺凌行为的孩子也有可能习
惯性地做出战反应。许多战类型的孩子都是哥哥或姐姐，他们会压迫年幼的弟弟和妹妹，
就像他们的父母压迫他们一样。
战类型的人会学着用愤怒来回应他们的被遗弃感。他们中的许多人使用蔑视（一种混
合了自恋式愤怒和厌恶的“毒药”）来羞辱和恐吓他人，迫使他人按照自己的意志行事。自
恋者对待他人就像对待自己的附属品一样。我的一位来访者曾讽刺道：“自恋者没有人际
关系，他们只接收俘虏。”
自认为有特权的战类型的人通常把他人当作自己喋喋不休的独白的听众，还可能会
把“被俘虏”的僵类型或讨好类型的人当作支配与臣服（Dominance &amp; Submission）关系中
的奴隶。与极端自恋者交往的代价往往是自我毁灭。


[[迷人的霸凌者]]
[[其他类型的自恋者]]
[[从极端的战反应中康复]]</tw-passagedata><tw-passagedata pid="37" name="逃类型和强迫型防御" tags="" position="34475,725" size="100,100">@逃类型和强迫型防御
极端的逃类型的人就像一台卡在“开启”状态中的机器。他们通过不停忙碌来象征性地
逃避被遗弃的痛苦，强迫性地被一种无意识的信念驱使，认为完美可以带给他们安全和
爱。他们急于求成，在思想上（强迫观念）和行动上（强迫行为）都非常急躁。
在儿童时期，逃类型的人对家庭创伤的反应，会落在过度活跃障碍（Hyperacfive）的
谱系上。逃类型的人会出现两种极端，即发奋学习的优秀学生和失控的多动症辍学者。受
到严重创伤的逃类型幸存者甚至会发展为强迫症。

[[左脑解离]]
[[从极端的逃反应中康复]]</tw-passagedata><tw-passagedata pid="38" name="僵类型和解离型防御" tags="" position="34675,725" size="100,100">@僵类型和解离型防御
僵反应，也被称为伪装反应，往往表现为幸存者躲藏、孤立自己和避免与他人接触。
僵类型的人可能会被困在撤退模式中，他们的开关好像被卡在了“关”的状态。
僵类型的人有一种无意识的信念，认为人和危险是同义词。在所有4F反应类型的人
中，僵类型的人对此最为深信不疑。虽然战、逃、僵、讨好类型的人都普遍患有社交焦
虑，但僵类型的人通常更依赖于孤独的庇护。有些僵类型的人完全放弃了与他人建立关
系，变得极为孤立，甚至也完全放弃了现实中的爱，只寄托于幻想。


[[右脑解离]]
[[从极端的僵反应中康复]]</tw-passagedata><tw-passagedata pid="39" name="讨好类型和关系依赖型防御" tags="" position="34925,700" size="100,100">@讨好类型和关系依赖型防御
讨好类型的人自童年起就被剥夺了所有权利。他们很早就知道，如果能在父母剥削自
己时当一个好帮手或顺从的仆人，他们就可以获得些许的安全和依恋。所以，讨好类型的
人通过迎合他人的愿望、需要和要求来寻求安全感。他们的行为表明，他们建立任何关系
的代价是放弃自身所有的需求、权利、偏好和界限。
对讨好类型或关系依赖型的人来说，父母中通常至少有一个是自恋者。自恋者颠覆了
父母与孩子的关系：孩子被父母化，需要关照父母的需求；而父母则表现得像黏人、任
性的孩子。在这种情况下，孩子可能会变成父母的密友、替代配偶、教练或管家，或被迫
做弟弟妹妹的家长。在最糟的情况下，孩子还可能遭到性剥削。一些关系依赖型孩子的适
应方式是让自己变成开心果。孩子会学会哗众取宠，取悦父母成了他们的主要任务。
父母在迫使孩子进行服务的过程中，通常会吓唬和羞辱孩子，使他无法发展自我意
识。在4F反应类型中，讨好类型的人在健康自我意识方面的发展受阻情况最为严重。


[[从极端的讨好反应中康复]]</tw-passagedata><tw-passagedata pid="40" name="混合的创伤类型" tags="" position="35175,700" size="100,100">@混合的创伤类型
具有单一创伤类型的人无疑是少数。每一种类型都有不同的严重程度，症状从轻微到
极端。大多数创伤幸存者都是4F反应的混合型，都有一个备选反应，当主要反应效果不
佳时，他们就会做出备选反应。如果这两种反应都不起作用，他们一般会有第三或第四种
本能反应。以下是一些常见的混合类型。



[[战-讨好类型]]
[[逃-僵类型]]
[[战-僵类型]]</tw-passagedata><tw-passagedata pid="41" name="自我评估与康复" tags="" position="35425,700" size="100,100">@自我评估与康复
我建议你评估一下自己的4F反应类型，试着明确你的主导类型和混合类型，并思考
你处于每种4F反应中的时长及比例。以下是4F反应从积极到消极的变化路径，你可以评
估自己在相关路径上的位置。

[[从积极到消极的4F反应变化路径]]</tw-passagedata><tw-passagedata pid="42" name="第七章 从基于创伤的关系依赖中康复" tags="" position="35200,1875" size="100,100">@第七章 从基于创伤的关系依赖中康复
如果你在上一章中把自己评估为讨好类型，或处于战↔讨好路径的讨好端，或只是察
觉到自己有一些讨好反应，本章都会对你有参考意义。此外，本章第一节还介绍了所有类
型成因的重要信息。
我之所以用一整章来讨论关系依赖，是因为这是我最了解的防御模式。这些知识来自
我亲身的疗愈历程，以及20多年来专注治疗关系依赖的经验。
在一个顿悟的夜晚，我写下了本章的概要。那天，我注意到自己撞到椅子后焦虑地对
椅子道歉。我忽然第一次意识到，自己在生活中可能曾无数次向物体道歉。这让我突然感
到非常愤怒。但是其实我所愤怒的是让我产生巴甫洛夫式[1]“对不起”反应的过往遭遇。
当时我探索原生家庭已有一段时日，积累的证据很快让我相信，我的父母将讨好反应
深深烙印在了我的身上。我被一个默认的“程序”洗脑了：当周遭事物的自然秩序发生变化
时，我就会讨好性地道歉。这种对明显无害环境的突然焦虑反应，往往是对早期创伤性事
件的情绪闪回。有时，当前的事件与过去的创伤可能只是略微相似，但足以触发战、逃、
僵或讨好反应的心理本能。
我之所以“讨好”椅子，是因为在潜意识中把它当成了危险的父母，而自己就像一个触
碰了禁忌之物的幼童，因为害怕受罚而道歉。当我自由联想到这一点时，我还觉察到自己
有道歉成瘾的情况。我曾因漫长的红灯和天气变化道歉，而且还特别容易因他人的错误和
消极情绪道歉。


[[比较讨好类型的成因与战、逃和僵类型的成因]]
[[基于创伤的关系依赖症]]
[[关系依赖的亚型]]

[[再谈从极端的讨好反应中康复]]
</tw-passagedata><tw-passagedata pid="43" name="比较讨好类型的成因与战、逃和僵类型的成因" tags="" position="34300,1075" size="100,100">@比较讨好类型的成因与战、逃和僵类型的成因
我为战、逃、僵、讨好类型中的第四个类型选择了“讨好”（Fawn）这个词，是因为
在《韦氏词典》（Webster&#39;s Dictionary）中，“讨好”这个词的定义是“表现得恭顺，向他人
奉承、献殷勤”。我认为这种反应正是许多关系依赖者行为的核心。
关系依赖者在幼童时期就知道，对虐待提出抗议只会招致父母更可怕的报复，而逃跑
只会更加危险。许多虐待孩子的父母在孩子顶嘴时会给予其最严厉的惩罚，从而无情地遏
制了孩子的战反应。孩子逐渐学会了放弃战反应，将“不”这个字从字典中剔除，也不再发
展自己健康的、具有决断性的语言技能。而当孩子出现自然的逃反应的征兆时，父母通常
会说：“我会让你知道逃跑的下场！”随之而来的就是一顿打。而当孩子长大一些时，他明
白了离家出走（终极的逃反应）更是无用而不切实际的，甚至更加危险。所以他也放弃了
逃反应。此外，创伤性家庭的数量似乎呈增长趋势，因为目前甚至有许多孩子还未到青春
期就开始离家出走并落入了可怕的境地。
在幼童时期，许多孩子有时会把逃跑的冲动转化为多动症般的绕圈跑。这种适应方式
在某种程度上能够帮助他们逃离无法控制的“混杂的被遗弃感”。虽然在这些不幸的人中，
有许多人后来象征性地逃离了他们的痛苦，但他们的适应模式实际上是恶化为了强迫行
为，如工作狂、购物狂、性爱成瘾，这些都是逃类型的常见表现。
没采取逃反应的幼童可能会发展为僵反应，成为“迷失的孩子”。这类孩子通过日益深
陷解离状态来逃避恐惧。他学会了让父母的言语和情绪虐待“左耳进右耳出”。这种类型的
人往往会在青春期陷入麻痹物质成瘾，如酗酒，因为他需要“镇静剂”来逃避痛苦。
然而，那些后来患有关系依赖症的幼童“明智地”放弃了战、逃和僵反应，而是学会了
讨好父母，让自己显得有用，从而获得些许的安全感。值得重申的是，讨好类型往往类似
于爱丽丝·米勒在《天才儿童的悲剧》中所说的天才儿童。早熟的他们发现，只要能为父
母提供各种帮助，就能换来零星的安全感。
讨好、谄媚和被奴役成了他们的重要生存策略。他们巧妙地放弃了所有可能给父母带
来不便的需求，不再提出不符合父母偏好或可能激怒父母的意见，放弃了各种自我界限来
讨好父母，但父母亲并没有尽责地照顾他们。正如上一章所述，孩子往往会变得“父母
化”，并尽可能地为父母提供帮助。（我想知道除了我之外，还有多少心理治疗师以这种
方式为自己进入这一行做足了准备。）
这些失去自我的现象刚开始出现时，孩子还没有完全学会说话，当然也还不具备洞察
力。对于正处于关系依赖症萌芽阶段的儿童，一切危险的暗示都会立即引发他们的奴性行
为，让他们放弃自身的权利和需求。这种反应模式深深地烙印在他们心中，以致于很多关
系依赖症患者成年后会像狗一样自动对威胁做出反应，仿佛在满地打滚、摇尾乞怜，希望
得到一点怜悯和偶尔的残羹剩饭。《韦氏词典》对“讨好”的第二个定义是：“（指狗）通
过舔手、摇尾巴等表示友好。”可悲的是，有些关系依赖症患者就像狗一样忠于自己的“主
人”，哪怕那些“主人”极其恶劣。
另外，我发现第五章提及的情感遗弃也会导致这种关系依赖症。极度缺乏联结体验是
具有创伤性的，因此被严重忽视的孩子有时会过度发展讨好反应，以应对这种可怕的状
况。一旦孩子意识到，只要自己对父母有用且不提出任何要求，就能得到父母的一些积极
关注，那么通过这种方式来加强与父母的联结就会使关系依赖与日俱增。长此以往，“讨
好”就会成为一种愈发自然的习惯。</tw-passagedata><tw-passagedata pid="44" name="基于创伤的关系依赖症" tags="" position="34425,1075" size="100,100">
基于创伤的关系依赖症
我将基于创伤的关系依赖症定义为一种自我否定与自我遗弃的综合征，它表现为基于
恐惧而无法在关系中表达权利、需求和界限。它是一种丧失自我捍卫能力的障碍，其特点
是战反应处于休眠状态，且容易受到剥削、虐待或忽视。
在与他人交谈时，关系依赖症患者通过倾听和询问（更准确的表达可能是引诱对方说
话），来在关系中寻求安全和接纳。他们邀请对方说话，而不是冒险暴露自己的想法、观
点和感受。他们向对方提问是为了把注意力从自己身上移开，因为他们从父母那里了解
到：说话是危险的，他们说出的话必然会证明自己是没有价值的。
讨好类型的人的绝对准则是：①倾听比说话更安全；②同意比反对更安全；③照顾他
人比寻求帮助更安全；④询问对方想法比表达自己想法更安全；⑤把选择权留给对方比主
动表达自己的偏好更安全。可悲的是，对于尚未康复的讨好类型来说，最能够满足自己的
方式就是帮助别人。讨好类型的人可以通过练习记忆第十六章二号工具箱“公平与亲密的
指导原则”来促进康复。
让我们试着想象两个关系依赖症患者进行第一次约会时可能发生的可笑场景吧。他们
计划一起去看电影，但该如何决定看哪部电影呢？
“你想看什么？”
“哦，我随便，你想看什么？”
“我真的无所谓，什么都行。”
“我也是，你定吧！”
“还是你来定比较好。”
“还是别了，我从来都选不好。”
“我也是，我选的肯定很难看。”
他们就这样无休止地继续，直到错过了最后一场电影，但他们却因为不用提出自己的
想法而松了一口气，然后结束了约会。
许多幸存者最初对“关系依赖”一词颇为反感。他们觉得这个词令人费解，或与自己无
关，而且他们认为这个词是贬义的。还有些人认为，这个词无法准确描述他们的状况。如
果你也是如此，那么可以参考后文有关关系依赖亚型的部分，其中介绍了讨好反应的各种
行为表现。
</tw-passagedata><tw-passagedata pid="45" name="关系依赖的亚型" tags="" position="34550,1075" size="100,100">@关系依赖的亚型
理解以下三种讨好亚型的巨大差异，有助于厘清关于关系依赖的许多困惑：讨好-僵
类型、讨好-逃类型和讨好-战类型。

[[讨好-僵类型：替罪羊]]
[[讨好-逃类型：超级护士]]
[[讨好-战类型：令人窒息的母（父）亲]]
</tw-passagedata><tw-passagedata pid="46" name="再谈从极端的讨好反应中康复" tags="" position="34950,1050" size="100,100">@再谈从极端的讨好反应中康复
针对由父母导致的讨好反应，我通过相关的心理教育已经帮助了很多来访者。他们中
的许多人很快意识到，自己之所以产生关系依赖，是因为他们连最基本的健康利己权利都
会被视作自私，而不断遭到攻击和羞辱。
一位40岁左右的来访者告诉我，她从高中开始就无数次鄙视自己的“自私”，但直到最
近的某个夜晚，她突然顿悟到自己远算不上自私。她在浏览一个为那些拥有自恋型母亲的
成年人开设的网站时，看到了许多留言。她突然意识到母亲才是家中搞垄断的自私者，每
当这位来访者想为自己做点什么时，她就会感到非常焦虑，还会因为自己的行为像母亲一
样可怕而感到羞耻。
讨好类型的人需要明白，当他们担心自己不去讨好就会遭到攻击时，会放弃自己的界
限、权利和需求。了解这一点是康复的必要条件，但不是充分条件。许多关系依赖者虽然
意识到了自己放弃自我的倾向，但真的到了需要在关系中表达自我时，他们又会把一切抛
在脑后。要打破这种模式非常困难。
我在疗愈初期逐渐觉察到，自己在初次约会时会过度询问对方的感受和需求，最后震
惊地发现，自己几乎从不进行自我表达。后来我渐渐意识到，想“更多地展现自己”的想法
让我受到了惊吓，并触发了闪回，使我陷入解离状态，并忘记了原本打算说的话。由于杏
仁核[4]“劫持”了我的左脑，所以我只知道要让约会对象说话，而自己则退行到了久经考验
的安全位置——倾听和询问。
直到我的治疗师建议我在手掌上写下一些关键词，我才得以应对这种场合。这些词促
使我的左脑开始重新运转，让我逐渐能够在与对方对话和了解的过程中，更好地表达自
己。
很久以后我忽然意识到：难怪我会和一个又一个的自恋者走到一起。自恋者之所以喜
欢我，是因为我能让他们尽情地滔滔不绝。我可能也遇到了不少心理健康的人，但她们都
不想继续和我约会，因为我看起来像是在隐瞒什么，让人捉摸不透。
差不多是在同一时期，我的一位讨好类型的朋友也面临着同样的问题。她喜欢开玩笑
说，她的倾听和询问防御可以完美到把任何人——甚至是完全中立、客观的治疗师——都
变成一个滔滔不绝的自恋者。


[[面对展现自我的恐惧]]
[[用哀悼治愈关系依赖]]
[[讨好后期的疗愈]]
[[“不认同我也没关系”]]</tw-passagedata><tw-passagedata pid="47" name="第八章 管理情绪闪回" tags="" position="35350,1875" size="100,100">@第八章 管理情绪闪回
情绪闪回是一种令人不安的强烈的退行，也被称为杏仁核劫持（Amygdala
Hijack），它会使人闪回到童年被遗弃时难以承受的感觉状态中。情绪闪回的常见体验包
括：感觉自身渺小、脆弱和无助；感觉一切都非常困难，感觉生活非常可怕；展现自己让
你感到极度恐慌和脆弱；你的能量似乎耗尽了；在最糟糕的闪回中，你会觉得世界末日马
上就要来临了。一旦困于闪回中，恐惧、羞愧或抑郁便会几乎占据你的整个内心。
陷于闪回中的人其实是在重新经历童年时最糟糕的情绪体验。一切都让人感觉不堪忍
受和困惑，因为在CPTSD的闪回中很少有视觉重现。究其根本，正如戈尔曼[1]的研究所表
明的，“杏仁核劫持”是大脑情绪记忆部分产生了强烈反应，这种反应凌驾于理性大脑之
上。那些经常被触发4F反应的人，他们的大脑会频繁地出现“杏仁核劫持”，以致无足轻重
的小事都会使他们进入恐慌状态。


[[管理情绪闪回的13个实用步骤]]
[[诱因和情绪闪回]]

[[闪回的迹象]]

[[治疗过程中的闪回]]

[[进阶的闪回管理]]
</tw-passagedata><tw-passagedata pid="48" name="管理情绪闪回的13个实用步骤" tags="" position="35625,1050" size="100,100">@管理情绪闪回的13个实用步骤
以下列举的13个实用步骤可以帮你管理情绪闪回。（在陷入情绪闪回时请专注于加
粗部分）
1. 告诉自己：“我正在经历闪回。”闪回会把你带入一种超越时间的心理感受，使
你重新感受到童年时的无助、无望与危险。这时你要提醒自己，你所经历的感受和体
验只是过去的记忆，它们现在已经无法伤害你了。
2. 提醒自己：“虽然感到害怕，但我身边没有危险。此时此刻我很安全。”记住你
现在很安全，已经远离了过去的危险。
3. 你需要，并且有权利设定界限。提醒自己不必容忍他人的虐待。你可以自由地
离开危险的环境，并抗议不公平的行为。
4. 安慰你的内在小孩。你的内在小孩需要知道你是无条件地爱着他的，当他感到
失落和恐惧时，可以寻求你的安慰和保护。
5. 破除“闪回无休无止”的观念。你会在闪回中体验到童年时期的恐惧和遗弃感，
会觉得永无宁日，根本想象不出一个更安全的未来。但是请记住，闪回总会过去的。
6. 提醒自己现在已经拥有了成年人的身体，还有童年时不曾拥有的盟友、技能和
资源，能够保护自己（感觉渺小和脆弱是闪回的迹象）。
7. 慢慢回到身体里。恐惧会使你产生“上头”的忧虑、麻木和放空的感觉，你需要
温和地重新回到自己的身体里。
①柔和地引导身体放松：感受身体的每一个主要肌肉群，柔和地使它们放松下来
（紧张的肌肉会向大脑发送错误的危险信号）。
②慢慢地深呼吸：屏住呼吸也会向大脑传送危险信号。
③放慢速度：冲动与急躁会按下大脑的逃跑反应按钮。
④找一个安全的地方放松并舒缓自己：裹着毯子，抱着枕头或毛绒玩具，躺在床
上或衣柜里，或者洗个澡，小憩一会。
⑤感受身体中的恐惧，但不做出反应：恐惧只是你身体中的一种能量。如果你不
逃避它，它就无法伤害你。
8. 抵制内在批判者极端化、灾难化的思维。
①运用“思维阻断”制止内在批判者，停止其无休止地夸大危险和试图控制不可控
事情的行为。拒绝羞辱、仇恨或遗弃自己。把自我攻击的愤怒转化为对不公平的自我
批判说“不”。
②运用“思维替换”和“思维纠正”的方法，记住自己的一系列优点和成就，用来替
换消极思维。
9. 允许自己哀悼。闪回是释放过去被压抑的恐惧、伤害和遗弃感的机会。请肯定
并抚慰你内在小孩曾经的那些无助无望的感受。健康的哀悼可以把你的眼泪变成自我
同情，把你的愤怒变成自我保护。
10. 培养安全的关系并寻求支持。想要独处时，可以给自己一些独处的时间，但不
要因为羞耻感而孤立自己。感觉羞耻并不意味着你是可耻的。让你的亲密对象了解什
么是闪回，并请他们通过交谈和分享感受来帮你度过闪回阶段。
11. 学会识别触发闪回的诱因。远离那些让你感到不安全的人、地方、活动，以及
可能触发闪回的心理过程。如果诱因无法避免，可以通过练习这些管理闪回的步骤进
行预防。
12. 弄清闪回的根源。闪回是一次机会，可以让你发现、验证和治愈你过往遭受的
虐待或遗弃所带来的伤害。闪回也表明了你仍未充分满足自己的发展需求，并为你提
供动力来满足这些需求。
13. 对缓慢的康复过程要有耐心。此刻你需要时间来代谢肾上腺素，之后也需要相
当长的时间来逐渐减少闪回的强度、持续时间和次数。真正的康复是一个循序渐进的
过程（往往是前进两步就又后退一步），而非一蹴而就的救赎幻想，所以不要因为出
现闪回而自责。
我的一些来访者会把这些步骤贴在显眼的地方，直到记住其中的要点，这帮助他们更
快取得了疗愈进展。
</tw-passagedata><tw-passagedata pid="49" name="诱因和情绪闪回" tags="" position="35750,1050" size="100,100">@诱因和情绪闪回
诱因是一种触发情绪闪回的外在或内在刺激，通常作用于意识之外的潜意识层面。因
此，识别触发闪回的诱因可能非常困难。尽管如此，识别这些诱因至关重要，因为这有时
能帮助我们避开触发闪回的人、情境和行为。
外在诱因是指那些让我们记起最初创伤的人、物、地点、事件、面部表情和交流方式
等刺激，它们使我们闪回到受创时的痛苦感受中。以下是一些常见的强力诱因：看望父
母；看到与童年施虐者相似的人；极具创伤性事件的周年纪念；听到有人用与父母相似的
羞辱性口吻或用语。
然而，许多诱因并不那么明确。有时所有陌生的成年人都可能引发我们的恐惧，尽管
他们与最初的施虐者没有任何相似之处。当我遇到一群青少年时，我仍会偶尔被触发闪
回，因为在我成长的社区中有很多暴力的青少年。为此我那颇有共情能力的儿子开玩笑
说，他不想长大，不想成为一名青少年。
有时可能仅仅是别人注意到我们、看着我们都会引发我们的恐惧和毒性羞耻感。我的
一位来访者曾在咨询时被触发了严重的闪回，只因为有一只猫盯着他看。其他常见的诱因
包括犯错、寻求帮助或不得不在一群人面前讲话。此外，单是感到疲惫、孤独，或者生
病、饥饿也会触发闪回。任何身体部位的疼痛也可能成为诱因。
对于许多幸存者来说，权威人物是最大的诱因。我认识一些幸存者，他们向来遵纪守
法，连停车罚单都没有收到过，却总是在遇到警察或警车时陷入焦虑。
我花了几十年时间才克服了讲课时严重的表现焦虑。没有什么能比即将到来的教学任
务更能触发我的闪回了。幸好我没有因此放弃教学，因为一旦开始之后，我发现自己大部
分时间还是很喜欢这份工作的。在很长一段时间里，除了学会“咬紧牙关”之外，我没有取
得任何真正的进展。直到有一天我意识到，这种表现焦虑其实是我的情绪闪回到了和家人
在晚饭时交谈的不安感。这让我明白了自己是在不自觉地害怕父母会突然出现，并当众嘲
笑我。
起初，我（内在批判者）认为这种想法非常荒谬，但当我在开车去讲课的路上开始想
象并练习积极为自己辩护时，我的焦虑很快就得到了极大的缓解。这一经历让我想到了上
述闪回管理步骤中的第6步，也引发了我对内在批判者发泄愤怒的思考（这一点将在下一
章中进行探讨）。


[[“那个表情”：情绪闪回的常见外在诱因]]
[[不容忽视的内在诱因]]
[[逐渐增强对诱因的认知]]</tw-passagedata><tw-passagedata pid="50" name="闪回的迹象" tags="" position="36075,1050" size="100,100">

[[再谈自我药疗]]
闪回的迹象
闪回常常发生得很突然，让人措手不及；或者另一种更常见的情况是，我们已经处在
闪回中，却没有察觉到。然而，有许多线索可以帮助我们发现并识别闪回。这对康复非常
重要，因为意识到自己经历的是“闪回”（闪回管理的第1步），往往能带来即刻的缓解。
更重要的是，识别闪回能够引导我们继续使用闪回管理的另外12个步骤。
闪回的一个常见迹象是感觉自己渺小、无助和无望。在强烈的闪回中，这种感觉会被
放大为强烈的羞耻感，以致我们不愿意出门或露面；还会表现为感到脆弱、紧张、敏感、
易受伤；可能还会使我们感到成年后建立起的自尊变得荡然无存。这是因为我们闪回到了
童年，当时家中的潜规则根本不允许自己有自尊。
另一个常见的迹象是内在批判者和外在批判者越发恶毒，通常会表现得更加极端化和
灾难化，而且对自我和他人的批判变得更加强烈。常见的例子是陷入非常极端的“全或
无”思维，只能看到自己或他人的缺陷。
在我疗愈过程的中期，我意识到每当自己对他人评头论足时，通常意味着我已经闪回
到了与苛刻的父母在一起的时期。诱因通常是我发现自己的一些弱点突显出来，此时我就
会相应地过度注意别人的缺点，这样我就有理由避开他们，以免被人看到自己不够光鲜的
样子。
闪回的第三个迹象是，对一些情况做出超出常理的情绪反应。这包括两种常见的情
况：①一件小小的不愉快的事，却感觉像一件紧急大事；②一点小小的不公平，却感觉像
对正义的践踏。第一种情况的例子是，当你拿着的书从手中掉落，你就开始没完没了地愤
怒自责。第二种情况的例子是，有一辆车没有打转向灯就突然变道，虽然没有引起事故，
但却引发了你的愤怒，足足让你气了几个小时。
如果在这些时刻没有觉察到自己的反应，我们就可能会爆发自我厌恶和自我憎恨，或
不公平地对无辜的人发怒。而一旦我们意识到这些反应，发现自己闪回到了童年时真正的
紧急状况和不公正待遇中，就可以选择健康的闪回管理方式。此外，我们可以把这些不愉
快的闪回视作我们受到创伤的证据，并从中获得康复。这样做有助于我们把愤怒转化为对
童年时令人发指的不公正待遇的正常愤慨。
</tw-passagedata><tw-passagedata pid="51" name="治疗过程中的闪回" tags="" position="36250,1050" size="100,100">@治疗过程中的闪回
这部分内容是写给正在接受治疗或考虑开始治疗的幸存者的。多年来，我注意到一个
现象，那就是随着来访者对我产生足够的安全感，他们在治疗过程中出现闪回的次数也会
越来越多。有时他们似乎是故意将闪回“安排”在某次治疗前或治疗过程中，好像是为了实
地演练闪回管理的技巧。一些治疗师把这种现象描述为“为建立健康自我而产生的退行”。
我遇到的一位来访者最近就出现了类似的情况。她冲进我的办公室时迟到了5分钟，
看起来满脸通红、焦虑不安。她在治疗开始时喊道：“我真是个失败的人，什么都做不
好。你一定厌倦了对我的治疗。”而这位来访者在不久之前还因为我肯定了她在治疗过程
中取得的成就而非常感动。
在此前的治疗过程中我了解到，她的母亲常常因完美主义而惩罚她，因此我确信这次
迟到触发了她的情绪闪回。那一刻，她右脑的感性功能处于主导地位，而缺乏左脑的理性
思考。正如闪回中经常发生的那样，她暂时失去了成人的认知和理性。这似乎是一种解离
机制，在这个例子中，这一机制使这位来访者忘记了其实我非常重视对她的治疗。
我认为这种解离也解释了为何之前建立的信任会反复消失，这种情况在情绪闪回中非
常常见。随着疗愈的进行，我们会了解到，闪回使我们忘记了过去结交的盟友仍然可靠。
然而通过足够的练习，我们会逐渐学会把对朋友的不信任视作闪回的迹象——这表明我们
闪回到了无人可以信赖的童年。

[[通过哀悼管理闪回（第9步）]]
[[管理内在批判者（第8步）]]</tw-passagedata><tw-passagedata pid="52" name="进阶的闪回管理" tags="" position="36625,1050" size="100,100">[[在遗弃抑郁中醒来]]
[[闪回是内在小孩的求救信号]]
[[灵活运用闪回管理步骤]]
[[存在性诱因]]
[[闪回后期的疗愈]]
[[帮助儿童管理情绪闪回]]</tw-passagedata><tw-passagedata pid="53" name="第九章 缩减内在批判者" tags="" position="34075,2525" size="100,100">@第九章 缩减内在批判者
我的一位来访者将本章所探讨的内容戏称为“内在批判者的险恶伎俩”。


[[内在批判者的成因]]
[[应对14种常见的来自内在批判者的攻击]]
[[由内在批判者引发的闪回]]

[[利用愤怒对内在批判者进行思维阻断]]

[[思维替换和思维纠正]]
</tw-passagedata><tw-passagedata pid="54" name="内在批判者的成因" tags="" position="31800,2600" size="100,100">@内在批判者的成因
诱发闪回的内在批判者通常来自童年时危险重重的家庭。这种危险既可能是父母在不
经意间被动的忽视遗弃，也可能是他们主动的虐待遗弃。当父母没有提供足够安全的联结
和积极的反馈时，孩子就会在焦虑和恐惧中挣扎。许多孩子会仿佛出于“本能地”追求完美
主义来适应这些危险的遗弃。
在家中弥漫的危险氛围会迫使孩子的超我过度追求完美主义并设想各种危害（后文会
列举）。前文已介绍过，超我是一种通过学习父母的规则来寻求接纳的心理。
内在批判者是变质的超我。它的出现意味着超我在超速运转，想拼命赢得父母的认
可。当追求完美主义的努力没能讨得父母的欢心时，内在批判者就会变得越发敌对和刻
薄。它会恶化为一种恶毒的内在声音，越发表现出自我憎恨、自我厌恶和自我遗弃的倾向
和态度。内在批判者会不断指责孩子的缺点，因为它觉得这些缺点是父母拒绝孩子的原
因，而无法理解真正的问题其实是出现在父母的身上。
对遭受创伤的孩子来说，过度亢奋的交感神经系统会越来越促使其变得过度警觉
（Hypervigilance）。过度警觉是一种对危险过度关注的固着反应，其成因是过度暴露于
真实危险之中。为了预测、识别和躲避危险，过度警觉会在孩子的为人处世之道中根深蒂
固，它会限制孩子的注意力，使他不断警惕地观察周围的人。它还会经常使孩子焦虑未
来，想象即将到来的社交活动中的危险。此外，过度警觉通常会演变为一种强烈的表现焦
虑，从而影响孩子在各个层面的自我表达。
正如长时间处于战斗中的士兵会患上PTSD一样，孩子之所以会患上CPTSD，也是因
为觉得自己在不断受到攻击。不幸的是，他现在不仅要应对外部攻击，还要遭受内部攻
击，被困在过度警觉和交感神经系统亢奋中。
受创伤的孩子急切地想要缓解被遗弃的焦虑和抑郁，但受内在批判者驱使的他只会挑
自己的毛病。在这个过程中，内在批判者变得越来越恶毒，最终将父母说的“你是个坏孩
子”转换为第一人称的“我是个坏孩子”。久而久之，孩子的自我贬低变得越发严重：“我真
失败。我真可怜……真坏……真丑……没有价值……愚蠢……有缺陷。”孩子认同了内在
批判者。于是超我战胜了自我，孩子正在形成的自我意识（健康的自我）失去了发展的空
间。
这与战场上的士兵不同，士兵不会发展出有毒的内在批判者。超我恶化的过程是
PTSD演变为CPTSD的一个关键节点。残酷且极权的内在批判者是CPTSD的一个关键的区
别性特征。
我的一位来访者曾悲痛地回忆起他童年时不断重复的话语：“如果我不那么黏人和自
私……如果我的雀斑能消退……如果我能打一场完美的比赛……如果我能在晚餐时不被罐
头青豆噎到……如果我能一直祈祷妈妈的关节炎好起来，也许她就不会嫌弃我，而爸爸也
许就会和我玩传接球了。”
在治疗来访者的过程中，我不断震惊于来访者被内在批判者触发强烈闪回的频繁程
度。CPTSD的内在批判者将我们对遗弃的恐惧与对自身不完美的憎恨结合在一起，然后
用完美主义和设想危害这两条纠缠在一起的“毒蛇”折磨我们。设想危害（Endangerment）
指在足够安全的情况下一直设想危险的过程。
若要康复，幸存者需要学习识别和对抗以下14种来自内在批判者的攻击。如果绕过这
一康复过程，这些根深蒂固的内在“程序”就会继续使人陷入童年时被遗弃的强烈恐惧、羞
耻和无望中。
</tw-passagedata><tw-passagedata pid="55" name="应对14种常见的来自内在批判者的攻击" tags="" position="31925,2600" size="100,100">@应对14种常见的来自内在批判者的攻击
以下每种攻击或“程序”都配有治疗性思维矫正的应对方式，以作为你击退内在批判者
的参考。
完美主义型攻击
1. 完美主义
【思维纠正】我追求完美主义是为了在危险的家庭中获得安全和支持。完美是一
种自我迫害的幻想。我现在不需要完美就能获得安全和爱。我会放弃那些要求我做到
完美的关系。我有权犯错。犯错并不会使我成为一个“错误”。每个错误或意外都是
一个机会，让我在未得到爱的方面练习爱自己。
2. “全或无”和非黑即白思维
【思维纠正】我拒绝极端化或过于笼统的描述、判断或批评。一个意外的负面事
件并不意味着我会永远失败。用“总是”或“从不”这类语言描述我通常都有失偏
颇。
3. 自我憎恨、自我厌恶和毒性羞耻感
【思维纠正】我会忠于自己，站在自己这一边。我是一个足够好的人。我拒绝谩
骂自己。我会把羞耻感转变为责备和厌恶，回击给那些羞辱我正常情感和缺点的人。
只要我没有伤害任何人，就要拒绝因正常的情绪反应（如愤怒、悲伤、恐惧和抑郁）
而受羞辱。此外，我尤其拒绝因难以完全消除自我憎恨的习惯而攻击自己。
4. 微观管理、担忧、执念、循环、过度忧虑未来
【思维纠正】我不会一遍遍地重复检查细节，不会直接下负面的结论，也不会无
休止地怀疑自己。我无法改变过去，所以我原谅自己过去犯下的所有错误。我无法保
证未来完全安全，所以我不再担忧未来可能会犯错。我不会试图控制无法控制的事
情。我不会对自己或他人进行微观管理。我会以一种“足够好”的方式工作，并接
受“努力未必总有成效”这一现实。
“请赐予我平静，去接受我无法改变的；给予我勇气，去改变我能改变的；赐予
我智慧，分辨这两者的区别。”——尼布尔的祈祷文[1]
5. 与他人或自己最完美的时刻进行不公平或贬低性的比较
【思维纠正】我拒绝将自己与他人无端进行比较。我不会将“我的内在与他们的
外在”进行比较。我不会因为自己没有一直处于最佳状态而批判自己。在这个迫使我
们一直表现出快乐的社会中，我不会因为心情不好而对自己失望。
6. 内疚
【思维纠正】感到内疚并不意味着我有过错。我拒绝出于内疚而做出决定和选
择。有时我需要在感到内疚的同时依然照常行事。当我不可避免地无意伤害了某人
时，我会道歉、做出补偿，并停止内疚。我不会一次又一次地道歉。我不再是一个受
害者。我不会接受不公平的指责。内疚有时是伪装的恐惧，请对自己说：“我感到内
疚和害怕，但我并没有错，也没有危险。”
7. “应该”
【思维纠正】我会用“想要”这个词来代替“应该”，并且只在我觉得想要这样
做时才遵循这一点，除非我有法律、伦理或道德上的义务。
8. 精力过于旺盛、停不下来、工作狂
【思维纠正】人不是为了工作而存在的。我不需要永远保持高效。从长远来看，
当我在工作与休闲娱乐之间实现平衡时，我的效率会更高。我不会试图一直保持全力
工作的状态。我认为效率有高低波动是正常的。
9. 对自己或他人进行苛刻评判、人身攻击
【思维纠正】我不会认同童年时的霸凌者和内在批判者，我不会让他们得逞。我
拒绝攻击自己或虐待他人。应该受到批评和指责的是我那糟糕的父母，我不会把这些
批评和指责转嫁给我自己或身边的人。
“我关爱自己。我越是孤独，越是没有朋友，越是没有支持，我就得越尊重我自
己。”——《简·爱》
设想危害型攻击
10. 极端化、灾难化、疑病症
【思维纠正】我虽然感到害怕，但身边其实并不存在危险。父母并没有要惩罚
我。我不会把事情夸大。我拒绝用生活会每况愈下的设想来吓唬自己。我不会再自己
构想恐怖电影场景和灾难片情节。我不会把每一次疼痛都想象成自己快要死了。我一
切安好。
11. 负面关注
【思维纠正】我不会再过度注意和纠结于自己的缺点或生活中可能出现的问题。
我不会轻视或忽视自己的品性。现在我会关注、设想和列举自己的成就、才能和品
质，以及珍视生活给予我的许多礼物，例如自然、音乐、电影、美食、色彩、朋友、
宠物等。
12. 时间紧迫感
【思维纠正】我没有危险，不需要赶时间。除非是真正紧急的情况，否则我不会
着急。我正在学习享受以轻松的节奏进行日常活动。
13. 让人失能的表现焦虑
【思维纠正】我会提醒自己不接受任何人不公正的批评或完美主义式的期望。我
不会因为害怕批评或失败而拖延时间。我不会让恐惧左右自己的决定。
14. 总觉得自己要被攻击
【思维纠正】除非有明显的危险迹象，否则我将使用思维阻断，停止将过去的霸
凌者或内在批判者投射到别人身上。生活中的大部分人都是平和友善的。如果被少数
有敌意的人威胁，法律会保护我们。我会想起朋友的爱和支持。
内在批判者的攻击和大多数事情一样，并不是全有或全无的，其强度和持续时间也各
不相同。你一旦能熟练识别强烈的内在批判者的攻击，通常就会培养出必要的正念，从而
觉察到其更微妙的攻击。这一点至关重要，因为大多数幸存者很多时候都没有意识到自己
是如何不断地进行自我批判的。
就像闪回管理步骤一样，如果你记住这些对内在批判者的反击方式并时常运用，有助
于缩减内在批判者。
</tw-passagedata><tw-passagedata pid="56" name="由内在批判者引发的闪回" tags="" position="32050,2600" size="100,100">@由内在批判者引发的闪回
内在批判者通常会通过上述一系列的攻击来增加闪回的强度，导致闪回演变为越发痛
苦的遗弃抑郁。一次次的攻击反复渗透叠加，将幸存者进一步拖入无望的旋涡中。想象一
下，挨一拳已经很惨了，要是受害者不断地挨拳那真的是痛不欲生。
前文曾提到，CPTSD的闪回通常不包含视觉成分，但在触发闪回的瞬间，幸存者的
脑海中常常会闪现出父母轻蔑的表情。
我的来访者德米特里在面谈开始时告诉我，有一次他正愉快地在厨房里忙活，做着出
门前的准备，突然他不小心打翻了一杯水。他立即想到了他的父亲，一个响亮的声音突然
在他内心响起：“我真是个超级大蠢货！”后来回想起来，他意识到自己那一瞬间陷入了闪
回。焦虑迅速淹没了他，而他很快就迷失在内在批判者那自我攻击式的谩骂声中。“大蠢
货”是内在批判者擅长使用的人身攻击话语，是前文完美主义（1号攻击）、自我厌恶（3
号攻击）、自我苛责（9号攻击）的结合。
这些攻击很快就恶化成了对自身所有不完美之处的大清算。这些不完美之处往往被夸
大其词，且毫无依据。紧接着，内在批判者叫喊道：“我太笨了，啥也做不好（2号攻
击）。一点小事都能被我搞得一团糟！”随后，德米特里的思维很快就被负面关注（11号
攻击）完全支配，这种思维与极端化（10号攻击）结合在一起，并在攻击幻想（14号攻
击）中达到高峰，在这种情况下，他取消了外出计划。
这个例子只是严重闪回对幸存者造成的无尽冲击的冰山一角。在经历了无数次类似的
过程后，德米特里深深陷入了被遗弃的灾难化思维（10号攻击）并得出结论：“难怪我没
有伴侣，也没有朋友，谁愿意和我这样一个失败者在一起呢？”（2号攻击，“全或无”思
维；实际上，他有两个好朋友）。德米特里的被遗弃感最终演变成为自我遗弃。原始的自
我慰藉行为再次出现，他开始通过暴饮暴食来自我麻痹。然后，他退避到卧室，在一个漫
长的回笼觉中进一步解离。
而这一切都只是因为打翻了一杯水这微不足道的失误。
必须强调的是，尽管德米特里的内在批判者对打翻一杯水小题大做，但这并不意味着
他很疯狂或是有缺陷。这一切都是闪回的表现，是在重现童年时的创伤：那时的他犯一
点小错就会遭到父母的强烈责备与拒绝。他的父亲曾无数次轻蔑地对他说：“你连一点小
事都能弄得一团糟。”
当德米特里理解了这次闪回，并从中有所学习和收获后，他对我说：“皮特，我难以
形容我的父母有多可怕。我的家庭生活带给我的是无穷无尽的挫败和痛苦，不管我做什么
都不对。难怪这些年以来我一直都无法摆脱这种思维——‘永远不要放松警惕’！但现在我
的内心有了改变，我发誓从现在开始要对自己宽容一点。”

[[想法也可能触发闪回]]
[[内在批判者是内化的父母]]
[[应对内在批判者的固执]]
[[完美主义和情感忽视]]
[[再谈危害设想]]</tw-passagedata><tw-passagedata pid="57" name="利用愤怒对内在批判者进行思维阻断" tags="" position="32525,2625" size="100,100">@利用愤怒对内在批判者进行思维阻断
思维阻断是通过意志力来摆脱毒性思维和毒性想象的过程。有时，在思维阻断的同
时，想象出一个“停止”指示牌的画面，会有助于强化思维阻断的效果。
由于使孩子受创的父母削弱了孩子本能的战反应，所以恢复战反应，并挖掘出其中蕴
含的愤怒对于治愈CPTSD至关重要。我强烈建议幸存者通过愤怒来阻止内在批判者的攻
击，并借助战反应来更有效地对内在批判者进行思维阻断。我们必须从批判者那里夺回愤
怒，并强制将其转向内在批判者，而非自己。然后，我们可以通过在心中默念“不！”“停
下！”或“闭嘴！”来缩短极端化和完美主义的心理过程。
愤怒地对内在批判者说“不”，便能够在内心设立一个界限，反对不自然、反自我的过
程。它是自我“翻新工程”中的一部分，帮助我们重建自我保护的本能。此外，将愤怒导向
那些造成我们发展出内在批判者并将其留在我们体内的人，有助于强化疗愈效果。
我曾收到一封网站访客发来的电子邮件，他说他读了我写的一些关于对内在批判者抒
发愤怒的文章。他在邮件中写道：“我最近非常喜欢的一个说法是，让那些不太容易做出
战反应的人用这种方法来阻止内在批判者。我曾经非常认同自我怜悯，这种心态对我有过
很大的帮助（有爱的善意），我接受内心源源不断的所有声音，任其自然流淌。所以当我
听到你关于说‘不’和拒绝的理论时，我心想：‘好吧，看来皮特还没有完全参透。’不过，
几天后我试了一下你说的方法，天啊，实在太有效了。我意识到当时的想法很狭隘。我现
在学会了愤怒，这样做让我停止了焦虑，并把羞耻感转化为了责备和愤怒。这让我感觉好
多了！毕竟那些内心的声音并不是我自己的，而是来自我的父母。”
当对自己的成长经历有了准确的认识后，我们往往会产生强烈的动力去克制内在批判
者。一旦我们真正了解，父母通过霸凌让我们自我厌恶，让我们觉得自己是多么的渺小和
无力时，就会自然而然地产生愤怒。而成功地缩减内在批判者通常需要与其进行无数次愤
怒的斗争。
大多数创伤幸存者原本是一张白纸，因为被洗脑而将内在批判者作为自己主要的身份
认同。一个导致孩子患上CPTSD的家庭要求孩子对家长的权威和信仰绝对忠诚。在早期
的思维阻断过程中，大多数幸存者需要健康的愤怒来激励自己，这种愤怒的对象通常是他
们的父母，因为是父母摧毁了他们的自我忠诚和自我个体化[2]。但通过足够的练习，幸存
者健康的观察性自我（也是正念自我）最终能够仅凭意志力就摆脱内在批判者。
我儿子的出生给我带来了巨大的动力，促使我更努力地练习对内在批判者的思维阻
断。在见证儿子成长过程中的许多奇迹的同时，我与他的情感联系日益加深。这让我的内
在批判者感到非常不安，它开始加班加点地运行危害设想“程序”：它没完没了地警告我，
我对儿子迅速加深的依恋十分危险；它试图说服我，如果我对儿子的情感投资，最终变得
像我对父母的爱那样惨淡收场，这对我将会是毁灭性的打击。而且，如果福祸难料的生活
夺走了他的生命，或者让他变成了“坏坯子”，那我该怎么办？
内在批判者会创作出最可怕的恐怖电影，其中的主题包括意外、生理疾病、绑架、精
神疾病、恋母情结式的背叛等。如果我不懂得如何识别、解释和拒绝这些极端化想象，我
与儿子的亲密联结必定会受到严重影响。而如果我想要进一步摆脱内在批判者，单凭思维
阻断还不够，我必须借助愤怒的力量，让这个方法更强力、有效。
我特别喜欢用这样的话语来挑战内在批判者：“我不再害怕你们了，爸爸妈妈。你们
就是那些毒性批判背后的始作俑者，是你们把内在批判者放在了我心里。我要抛开你们那
些有‘毒’的话语。快把你们对我的羞辱和厌恶拿走吧。我对你们可耻的养育方式感到厌
恶。”
有位来访者与我分享了她在家中与内在批判者斗争时想到的一句话：“你彻底毁了我
的童年，现在我不会再让你毁了我的生活。”她告诉我，这个观点已经印刻在她的意识
中，现在经常帮助她对抗内在批判者。


[[羞耻感是对自己的不公指责]]
[[拥抱内在批判者]]</tw-passagedata><tw-passagedata pid="58" name="思维替换和思维纠正" tags="" position="33175,2600" size="100,100">
思维替换和思维纠正
思维替换，尤其是思维纠正这种形式，是对内在批判者进行思维阻断的一种重要工
具。许多年前，我感觉自己的内在批判者就像健美运动员反复锻炼出的肱二头肌一样强
健。我当时猜想，如果用同样的方式针对内在批判者进行自我保护意识的训练，应该也能
增强思维纠正的“肌肉”。事实确实如此，现在，每次闪回几乎总能自动激起我的自我保护
的本能。不夸张地说，无数次积极的思维替换使我获得了“友善待己”的心理状态，而且这
种状态还相当稳定。
我也鼓励你立即用积极想法（如本章开头罗列的那些）来对抗内在批判者的消极想
法。这在CPTSD的疗愈过程中是至关重要的，因为如果不去对抗毒性思维，它就会像病
毒一样失控地传播感染，使你产生羞耻、恐惧和无助的复杂感受。
我们在闪回时快速进行思维替换或思维纠正，往往可以削弱内在批评者的动力，从而
避免陷入闪回的恶性循环。这在对抗内在批判者的过程中非常重要，因为内在批判者一旦
获得了动力，通常会更凶狠地攻击我们。在这些时候，内在批判者会虚伪地蔑视我们，使
我们在“本可以”避免的情况下又陷入自我批判，而“这时正是最需要思维纠正而非自我指
责的时刻”——我的前实习生经常对来访者说这句话。
此外，我鼓励你做一份列表，把自己的积极品质和成就都写下来，当迷失在自我憎恨
中时，你就可以把这份列表读给自己听。第十六章的五号工具箱包含一个实用练习，可以
帮你从多种角度详细制订这份列表。
对自己的积极品质进行书面记录非常有帮助，因为闪回往往会让你暂时忘记自己的积
极品质。在闪回中，左脑的学习功能似乎会暂时停止。核磁共振成像显示，过度警觉的
CPTSD幸存者的左脑活动大大减少。根据我的经验，记住自己所列的优秀品质能够增强
从这种暂时失忆中恢复的能力。
像念经一样反复背诵列表上的部分或全部内容，这一做法也能帮助你对抗特别严酷无
情的内在批判者。如果你无法列出这样一份列表，或在填写五号工具箱时遇到困难，请向
朋友或治疗师征求意见。同时我想提醒大家，优秀品质不一定是完美或永恒不变的。如果
在大多数时候你确实认为自己具有这一品质，那么就可以将其列入表中。
另外，积极的视觉想象也可以作为思维替换的有力辅助手段。一些幸存者逐渐学会
了在脑海中“调取”与过去的成功、成就相关的图像，以及想象自己在安全的地方、有可爱
的朋友或令人安慰的回忆，来缩短令人恐惧的自我批判过程。网络上也有各种引导式冥想
的内容，这些内容用积极的语言和图像来帮助幸存者减轻过度反应，放松身心。


[[视角替换]]
[[视角替换与感恩]]
[[大脑的神经可塑性]]</tw-passagedata><tw-passagedata pid="59" name="第十章 缩减外在批判者" tags="" position="34225,2525" size="100,100">[[外在批判者：人际关系的敌人]]

[[外在批判者在媒体中的示范]]

[[外在批判者与亲密关系]]

[[在外在和内在批判者之间切换]]

[[外在批判者：法官、陪审团和刽子手]]

[[正念和缩减外在批判者]]

[[哀悼能够阻断外在批判者]]

[[通过外在批判者进行健康的发泄]]
</tw-passagedata><tw-passagedata pid="60" name="外在批判者：人际关系的敌人" tags="" position="32975,3275" size="100,100">@外在批判者：人际关系的敌人
CPTSD的批判者包括内在批判者和外在批判者，两者都是你心理活动的一部分。外
在批判者与破坏自尊的内在批判者相对应，内在批判者认为自己有缺陷且没有价值，对
自己采用完美主义和执行危害设想“程序”，而外在批判者则认为他人有缺陷且没有价值，
将同样的危害设想“程序”作用于他人。当外在批判者掌控你的思想时，你会觉得他人看起
来非常可怕、危险、没有价值和难以信任。
与内在批判者一样，外在批判者的攻击通常是内在而无声的，除非你是战类型。我的
一位来访者在陷入外在批判者的攻击状态时，经常会大声抱怨：“所有人都糟透了。人类
是如此自私和可怕，他们要么对你非常恶劣，要么让你失望透顶。”她后来把这种心理状
态称为“厌恶地球型的闪回”。
外在批判者会在我们应对危险而不值得信任的父母时逐渐形成。它帮助我们充分意识
到那些最微妙的信号，察觉到父母正在恶化的危险行为。长此以往，外在批判者逐渐相
信，所有人都将不可避免地变得像父母那样不可信任。所以，一旦我们退行到外在批判者
时，就会执着地认为他人没有价值（不完美）且奸诈（危险）。这种潜意识其实是为了避
免我们对人际关系投入情感。
外在批判者试图保护我们不被遗弃，但如今我们已不再需要进一步用它来进行自我保
护了，因为它会使我们与他人变得疏远，进而使我们陷入被遗弃的境地。它会攻击他人并
把他们吓跑，或者建立起自我孤立的堡垒，而这座堡垒的砖墙就是他人一系列被我们夸大
的缺点。
若想从与他人的联结中获得和谐与安慰，我们就必须终结内在批判者对心灵的独裁统
治，还必须有意识地识别并逐渐破解外在批判者用以破坏亲密关系的工具。
[[4F反应类型和内在/外在批判者的比例]]
[[外在批判者与被动攻击]]
[[拒绝为批判者的观点发声]]
[[由外在批判者主导的闪回]]</tw-passagedata><tw-passagedata pid="61" name="4F反应类型和内在/外在批判者的比例" tags="" position="32850,3100" size="100,100">4F反应类型和内在/外在批判者的比例
基于你的4F反应类型，你可能会相对倾向于由内在或外在批判者主导。不同4F反应
类型的人，其内在或外在批判者的比例通常不同。有些人会极度倾向于其中一种。
逃类型的人，其内在批判者和外在批判者的比例差异最大，他们会通过完美主义式的
努力来追求卓越，这样他们的外在批判者就可以将其他人都判定为低劣的。讨好类型的人
更常由内在批判者主导，他们会通过内在批判者的自我憎恨来进行自我审查，避免因在关
系中表现出真实和脆弱而产生恐惧。僵类型和战类型的人通常会偏向于外在批判者，僵类
型的人会批判式地谴责整个外部世界，来证明“人是危险的”这一非黑即白的观点；战类型
的人则会有一种矛盾行为，一边用外在批判者来控制他人，从而防止被他人遗弃，一边用
易怒的情绪来使他人无法太过亲近自己，并在意识到自己无法控制对方时立刻离开。此
外，不同4F反应类型的亚型也会对内在和外在批判者的比例产生影响。
一位我短暂接触过的逃-战类型来访者，曾非常难过地向我讲述他最近经历的一次背
叛。他要求他的新伴侣按他的方式来放置卫生间卷纸，并一定要从顶部而非底部拉出卷
纸，但她在更换新的卫生间卷纸时却没有听他的，这让他感觉遭到了严重的背叛，于是与
她分手了。听到这里，我竟忍不住不恰当地觉得，她逃离了他，真是运气好。不幸的是，
这位来访者无法接受自己的痛苦很大程度上是一种闪回。他回想起了自己那顽固且控制欲
极强的母亲，她通过严厉的管教让他觉得卷纸必须按照她的方式放置，并从顶部拉出，还
通过惩罚让他相信这是一个普遍的真理。完美主义在外在批判者的“程序”中可能会成为偏
执的徒劳。
有些幸存者在大幅减少了自己的主要批判者后，往往会更受另一种批判者的影响。当
我意识到这一点时，感到失望而震惊，因为此时我正庆幸自己的内在批判者已逐渐缩减。
此后不久我就注意到，自己被一种全新的对他人评头论足的感觉（外在批判者）所困扰，
而这似乎不符合我的性格。对这一情况的好奇和不断增长的正念使我获得了本章所分享的
许多见解。有了足够的正念，这种批判者模式的转变就可以成为一个机会，从而进一步缩
减外在批判者和内在批判者的联合体。
</tw-passagedata><tw-passagedata pid="62" name="外在批判者与被动攻击" tags="" position="33000,3100" size="100,100">@外在批判者与被动攻击
儿童最初不敢对父母的虐待或忽视做出愤怒的反应。除了战类型的儿童之外，大多数
遭受创伤的儿童在很早就知道，对父母的不公平对待提出抗议是一种不可原谅的罪行。他
们一般被迫压制自己的抗议和抱怨，这就使他们将愤怒默默藏于心中。然而这种愤怒并没
有消失，它们不断汇集成怨恨的汪洋，滋养着执着于寻找他人错失和危险性的外在批判
者。
外在批判者会从被父母遗弃的视角来看待所有关系，并且从不放松警惕。它不断地将
未释放的童年愤怒转移到他人身上，夸大当前的失望，并默默地将他人作为替罪羊。幸存
者如果在闪回中进入了外在批判者模式，就会把他人无足轻重的过失作为借口，长时间陷
入对他人评头论足式的思维中，并在心中默默发怒和抱怨。用伊丽莎白·芭蕾特·布朗宁
（Elizabeth Barrett Browning）风格的话说就是：“你是怎样地不完美？让我逐一细算。”
[1]
当将默默地错怪他人变成习惯后，外在批判者就会表现为被动攻击。常见的被动攻
击有以受伤的退缩姿态来疏远自己，或以假惺惺地赞美来推开别人，还包括不善于倾听、
恶意调戏将伪装成玩笑、不给予积极的反馈和赞赏。长期迟到和不履行承诺也可能是一种
无意识、被动攻击式的对他人表达愤怒的方式。
</tw-passagedata><tw-passagedata pid="63" name="拒绝为批判者的观点发声" tags="" position="33300,3100" size="100,100">@拒绝为批判者的观点发声
外在批判者编写了一种破坏亲密关系的“程序”：诚实到过分。在诚实的幌子下，外
在批判者只会消极地注意他人的不完美之处。在完美主义的咒语下，外在批判者会通过罗
列他人正常的弱点和缺陷来打击别人。当对方提出质疑时，许多战类型的人就会回应
道：“我只是想说实话而已！”
内在批判者也自有一套过度诚实的机制，我称之为“先发制人”。由于害怕被批评（就
像在童年时那样），内在批判者会让幸存者先坦白自己的种种缺陷，希望这样别人就不会
再提了——有时自我批判听起来不像他人的批判那么伤人，毕竟，这些批判对你和内在批
判者来说都不新鲜了。
我将真诚视作最重要的价值观之一，但这并不意味着我认同外在批判者对他人的看
法，或内在批判者对自己的不公判断。
如前所述，有毒的批判者们并不是我们内心真实的一部分，它们不是与生俱来的，而
是被以极度负面的方式看待我们的父母所灌输的。正因为如此，我们需要保护自己的亲密
伴侣免受其扭曲的、破坏性的评判。同样重要的是，我们需要避免把自己塑造成有缺陷
的、不值得被爱的人，从而保护自己不被他人疏远。
</tw-passagedata><tw-passagedata pid="64" name="由外在批判者主导的闪回" tags="" position="33150,3100" size="100,100">@由外在批判者主导的闪回
霍莉是一位年长的来访者，属于逃-战类型，她前来咨询时正在为轻微的老年性记忆
减退所苦。她在面谈开始时轻笑道：“我昨晚又在读你写的关于外在批判者的文章。我三
年前读的时候并没有完全领会，但现在读懂了。我想这对缓解我的记忆衰退也有些好处。
“你知道的，每当家里出了什么问题，我总是会责怪我丈夫。我开始意识到，我这是
陷入了一个‘全或无’的外在批判过程。
“几十年来，我一直责怪他把东西乱摆乱放，但我现在开始注意到，是我自己经常把
东西放错位置。昨晚做饭时，我一直在找用来剪菜叶的剪刀。它不在墙上的磁条上，而我
一直强调它应该放在那里。于是我立刻开始在心里埋怨我丈夫。当我翻遍各种抽屉还是找
不到时，我变得越来越生气。
“我找的时间越久，我就越气愤，果然，我开始罗列他的所有缺点。我的怨恨迅速升
级，气到极致时，我决定这次真的要离开他了。我在心里继续积累证据，想要证明他是多
么无可救药，而离开他是一个多么明智的决定。就在这时，我回到炉子旁，发现剪刀就在
我5分钟前放下它的地方，上面还有我剪菠菜时留下的碎屑！
“这是一个多么令人羞愧的顿悟啊！特别是前一天晚上也发生了类似的事情，是关于
牙膏的。我忘了自己有一次整理时把它放入了药柜，还非常肯定是我的丈夫（弗兰克）把
它从原有的位置拿走了。我开始对他破口大骂，他不得不假装要去车里拿东西才得以脱
身。后来，当我去药柜里拿阿司匹林的时候，发现牙膏就在那儿，是我自己把它放到那儿
的！
“天啊，外在批判者瞬间就变成了内在批判者。当我被轻蔑的内在批判者骂得泪流满
面时，我突然有了另一个顿悟，我怎么会因为他的一点小错就觉得他的罪过罄竹难书呢。
他是一个足够好的丈夫，与我相处了35年，而当我陷入消极关注时，我完全想不起他的任
何优点。”
霍莉和我花了大量时间来分析这段体验。她意识到外在批判者通常会触发她一种根深
蒂固、由来已久的感受和观念：“人非常不可靠，他们总是让你失望，你完全不能信任他
们！”
然后我们开始探索她的童年，寻找产生这种认为他人不值得信任的观念的线索。她闭
上眼睛，做了几次深呼吸。当她睁开眼睛时，泪水顺着她的脸颊流了下来：“是我父亲，
他是个无比自私的酗酒的混蛋。抱歉我说了脏话。无论我把自己兼职做保姆赚的钱藏在哪
里，他总是能找到。之后他会醉醺醺地回到家，哭着说他很抱歉，以后再也不会这样做
了。他甚至会让我对他发火！天啊，他就像可怜的弗兰克一样！就坐在那里接受我的指
责。只不过可怜的弗兰克（说到这里她流下了更多眼泪）从来没有对我做过这样的事。他
在大多数方面都很可靠，只是不像我那么有条理。”
</tw-passagedata><tw-passagedata pid="65" name="外在批判者在媒体中的示范" tags="" position="33600,3275" size="100,100">@外在批判者在媒体中的示范
外在批判者的牢固地位很难动摇，因为它的说辞在我们的社会中被正常化了，更糟糕
的是，还被赞美了。讽刺别人似乎是大多数喜剧的标准做法。此外，许多有影响力的、看
似健康的成年人向大众展示的沟通方式充斥着评头论足、讽刺、消极、恐惧和寻找替罪羊
的过程。
把我们社交的控制权交给外在批判者，会妨碍我们在交流中展现脆弱，但正是脆弱使
建立亲密关系成为可能。我们必须放弃无意识的外在批判者生存策略，例如下面的话。
1. “我会通过愤怒的批评让你害怕我，这样我就不会被你伤害。”
2. “每个人都这么自私和堕落，我为什么还要费力与人交往。”
3. “我会全面地控制你，防止你背叛或抛弃我。”
4. “我会大声抱怨，或者一感到孤独就离开，因为‘如果你真的爱我，就不会让我感到
孤独’。”
[[批判者：潜意识中的B级片制片人]]
[[将新闻视为诱因]]</tw-passagedata><tw-passagedata pid="66" name="批判者：潜意识中的B级片制片人" tags="" position="33500,3100" size="100,100">@批判者：潜意识中的B级片制片人
外在批判者通常在情绪闪回时发作得最厉害。在这种时候，它把无意识的遗弃痛苦转
化为对他人和生活总体上的强烈负面看法。它有意无意地执着于翻找或幻想他人曾经或可
能对我们造成的伤害。在不知不觉中，我们可能会在心中积累一系列的画面，记录真实和
想象中的背叛，而这些背叛会让我们无法在人际交往中获得滋养和成长。经年累月，这些
幻想通常会从可怕的画面发展为片段，甚至电影。“不要相信任何人”“为孤独而自豪”“你
只能依靠自己”“爱人总是会离开你的”“孩子会让你心碎”“只有傻瓜才会说出他们真正的想
法”“他们会得寸进尺”，这些都是幸存者在寻求人际交往安全感时可能想出的影片标题。
这些防御性的、往往是潜意识的白日梦，就像是批判者们制造的噩梦。这些噩梦打着
保护我们“安全”的名义，把我们吓得与世隔绝。随着我们取得了足够的康复进展，我们能
够意识到侵入性的反亲密遐想实际上正是缘于自己处于闪回中，且需要调用闪回管理技
能。
外在批判者往往会被“最小化”和否认所掩盖。它的执着和“白日噩梦”往往潜藏在我们
的意识之下，通过不断重复转化为我们的潜意识。例如，外在批判者反复地称别人为“混
蛋”“失败者”“笨蛋”，这种重复就像海边的潮起潮落、城市中的车来车往。
</tw-passagedata><tw-passagedata pid="67" name="将新闻视为诱因" tags="" position="33625,3100" size="100,100">@将新闻视为诱因
有时外在批判者对错误警报的热衷，会让我们极度关注新闻事件。新闻就好像心理层
面的垃圾食品，它用一种消极的方式带来快感，如若不加以抵制，我们就会陷于可怕的过
度警觉。
然后，外在批判者就会加班加点地累积确凿的证据，以证明这个世界确实极度危险。
因此，我们唯一能够自我保护的方法就是自我孤立，或者仅维持最低程度且浅表的人际关
系。在这种时候，就连给朋友打电话的想法都会触发被拒绝或被羞辱的画面，甚至电话还
没拿起来就会发作。当闪回特别强烈时，冒险出门的冲动可能会立即引发我们被口头骚扰
甚至在街上被抢劫的幻想。
情况更糟时，外在批判者的极端想象会恶化为偏执，最严重时会恶化为迫害妄想。我
记得在我20岁出头的时候，有一次极为羞耻的经历。当时我严重睡眠不足，正坐在公园的
长椅上，努力集中精力看我手头的书。我把一段短短的文字读了四遍，但几乎一个字都没
记住。与此同时，我越来越注意到坐在我身后的一群人。我开始感到羞耻，因为他们正享
受着美好的时光，而我却坐在那里，陷于痛苦的自我意识中，感到十分沮丧。
突然间，我意识到他们可能正在轻蔑地谈论我，但我因为太害怕而不敢转身。他们的
评论变得越来越具侮辱性，大笑声也越来越有嘲讽意味。在我的脑海中，我仿佛可以看到
他们都在盯着我、指着我说：“看那个可怜的废物，他在假装自己根本听不见我们！”最
后，我在绝望中转过身，弱弱地说了一句：“你们怎么回事？”
这一刻我感到很震惊，但更感到羞愧，因为他们连看都没看我。他们沉浸在欢乐的笑
声中，甚至没有注意到我转过身来对他们说话。我立刻意识到这一切都是我可怕的胡思乱
想。我羞愧地默默走开了。直到几十年后我才明白，这是我的CPTSD和外在批判者制造
的可怕妄想。
</tw-passagedata><tw-passagedata pid="68" name="外在批判者与亲密关系" tags="" position="33975,3275" size="100,100">@外在批判者与亲密关系
如前所述，CPTSD通常包括依恋障碍，这种依恋障碍源于童年时缺乏具有同情心的
照料者。当发展中的儿童得不到父母的支持和庇护时，他就永远无法学会让他人帮助抚慰
自己的孤独和痛苦，也永远不知道真正的亲密关系来源于分享自己的所有体验。
如果我们的照料者因为我们表现出脆弱而攻击或遗弃我们，那么我们之后就会不愿再
真诚地表达自我，而这种自我表达正是建立亲密关系的基础。外在批判者恐吓我们，所有
人都必定和我们原来的照料者一样危险。潜意识中我们记得自己因寻求父母的支持而遭到
父母的蔑视，这样的记忆打消了我们分享困扰和寻求帮助的意愿。
更糟糕的是，当我们表现出自己的弱点时，遭到攻击的幻想会困扰我们数小时甚至数
天。我曾经历过这种情况，当时我因为求职而接受了八位面试官的面试，而我表现得非常
诚实，并展现了自己的脆弱面。后来我连续失眠了三个晚上，我的外在批判者不停地播放
画面，展示着面试官对我所说的一切都感到轻蔑，并对我遗漏内容感到不满。甚至在对方
热情地雇用我之后，我的外在批判者还在用冒充者综合征来困扰我，幻想着我最终会无法
胜任新工作。
[[没有赢家的局面]]
[[吓跑他人]]</tw-passagedata><tw-passagedata pid="69" name="没有赢家的局面" tags="" position="33900,3125" size="100,100">
没有赢家的局面
外在批判者在吓唬我们不要相信别人的同时，也会让我们过度控制他人，从而降低他
人的危险性。过度控制的行为包括羞辱、过度批评、滔滔不绝的长篇大论（对话控制），
以及整体上的专横。一个极端例子是没有赢家的局面，也被称为“双重束缚”，用通俗的
话讲就是“做也不行，不做也不行”。（只有最严重的战类型的人才会有意识地这样做。这
些人处于自恋程度的顶端，已经达到反社会人格的程度了。）
我有一位名叫斯特林的来访者属于战类型的人，他极其自恋，但还达不到反社会人格
的程度。他希望我在他滔滔不绝时，每当他说完一段话就感同身受地回应一声“嗯”，以此
来表现我在认真倾听。他通常会在句子结尾说“你知道吗？”来提醒我。渐渐地，我开始能
判断出他何时处于闪回状态，因为在闪回时他会对我说“嗯”的频率感到不快。我说“嗯”的
次数太多或太少都会让他不满。如果说得太多，他就会大发雷霆道：“你难道没听说过反
问句吗？”而如果说得太少，他就会抱怨我缺乏同情心，因为我没有给予足够的回应。
内在批判者也会制造这种没有赢家的局面。霍华德在一次面谈时正患严重的流行性感
冒、发着近39℃的高热。他告诉我说：“早上我躺在床上，一会发冷一会发热，而内在批
判者还在鞭策我说：‘你这个懒惰又软弱的废物！别再自怨自艾了，快去赴约面谈吧！’”
霍华德接着告诉我，他与此斗争了大约15分钟，但最后还是内在批判者赢了，所以他
来赴约了。当他坐在我的等候室里时，内在批判者又开始了：“你真是个白痴。你怎么这
么傻，病成这样了还出门？你这个受虐狂、废物，你这样做根本就是想害死自己，又何必
来看心理医生呢？”
</tw-passagedata><tw-passagedata pid="70" name="吓跑他人" tags="" position="34025,3125" size="100,100">@吓跑他人
为了避免与他人亲近所带来的脆弱感，外在批判者也会将内在批判者的各种危言耸听
外放出来，大声描述灾难化的想象。这种想象很容易触发他人的情绪，也会无意识地让他
人对我们产生恐惧。
我们体育馆里的一位篮球球友沉迷于收听本地的一个末日新闻电台。他不停地宣扬我
们这个时代的末日灾难，导致体育馆里的所有人都疏远他。另一个球友开玩笑说不会再传
球给他了，因为那家伙甚至不相信球能穿过篮筐。
那些过度危言耸听而吓唬别人的幸存者，很少能让别人喜欢他们。此外，当他们的
负面关注到达极端，并造成噪声污染时，就会“逼”得别人躲避并遗弃他们。
</tw-passagedata><tw-passagedata pid="71" name="在外在和内在批判者之间切换" tags="" position="34350,3275" size="100,100">@在外在和内在批判者之间切换
许多CPTSD幸存者挣扎于严厉的批判之中，在病态化他人（外在批判者的毒性指
责）和病态化自己（内在批判者的毒性羞耻感）之间来回切换。他们陷入无休止的循环
中，反复细数与他人关系的欠缺和自己的不足。
我父母对这种模式进行了扭曲，他们的版本可以归结为一句话：“尽管我们很糟糕，
但比你强多了。”卡伦·霍妮（Karen Horney）[3]将这种创伤的双重机制描述为：在浮夸的
自我和受鄙视的自我两极之间摇摆的“全或无”思维。
当我们迷失在这个过程中时，会错过体验归属感这一重要情感需求。我们永远生活在
疏离感中，总是处于两种极端之间：要么觉得自己太优秀，别人都配不上我们，要么觉得
自己太不讨人喜欢而不接纳自己。这就是有着雅努斯[4]双面的批判者令人痛苦的社交完美
主义：别人有太多的缺陷，不值得我们去爱；而我们自己也有太多的缺陷，不值得被爱。
典型的内在/外在批判者转换循环若从外在角度出发分析，则是这样的。因为想要逃
避由社交触发的“危险”感受，所以外在批判者的评头论足模式被激活。即使是与他人交往
的想法也会激发幸存者的反对“程序”，从而让他感到有理由孤立自己。然而，长时间的退
缩会重新唤醒他对人际关系的渴求，以及与他人联结的冲动，也会同时使批判者由外在模
式转变为内在模式。于是内在批判者会开始清算幸存者的不足，让幸存者相信自己对别人
来说太可憎了，因此无法与人社交。随之产生的是自我怜悯式的被害幻想，最终重新吸引
外在批判者来佐证他人的可怕……如此不断地循环往复，使幸存者“安全”地躲藏在沉默的
自我疏离中。
摇摆不定的批判者们若从内在角度出发分析，则是这样的。幸存者消极的自我关注会
促使他力争完美。他为此非常努力，不懈工作，以致开始怨恨那些不努力的人。一旦怨恨
积累到一定程度，他人的一个小失误就会触发他的内在批判者变为极端的外在批判者，充
满对他人的失望和沮丧。然后，他会默默执拗地清算人们所有的缺点和背叛行为。他停留
于极端的外在批判者状态的时长通常取决于他的4F反应类型，但他迟早会再次感到内
疚，内在批判者又会突然发作，严厉地批评他对别人评头论足。然后，他又开始认真细数
自己的缺陷。
[[摇摆的批判者们]]</tw-passagedata><tw-passagedata pid="72" name="摇摆的批判者们" tags="" position="34325,3150" size="100,100">@摇摆的批判者们
下述情景是一个在闪回中忧虑的典型例子。
我和妻子已共同生活十多年了。我们花了很大的功夫，协商出了一种（大多数时候）
对彼此公平且灵活的方式，来处理家庭和育儿过程中的无数琐事。但有时，当我经历了长
时间的闪回后，我还是会过度关注家庭秩序中的不完善之处。
内在批判者指责的方面每次都有所不同。如果我进入疲惫的求生状态，内在批判者就
会指责我没有对家庭做出应有的贡献。而如果我开启逃反应模式，并且在家里大搞卫生，
我的外在批判者就会开始斤斤计较。在后一种模式下，我的外在批判者会坚持认为妻子比
我做的少得多。（这些比较通常是关于我最近在家庭里过度贡献的那些方面。）
但是我的讨好倾向相当强烈，没过多久我的内在批判者就开始关注到那些我贡献没有
她大的方面。突然间，我就成了家中自私的懒鬼。随着闪回的继续，我可能会转而责怪自
己的挑剔和狭隘。但在特别强烈的闪回中，外在批判者迟早会回归，并开始对我贡献的分 量和重要性给予更多的肯定，然后贬低妻子，说她懈怠、不思进取、自以为是等。
在我们关系的早期，我会在相当长的时间内重复这种循环，花上数小时甚至数天来发
泄对妻子和自己的不满。我平静的内心会恶化成一个战场，我感觉被她抛弃了，同时也认
为自己抛弃了她，并因此批判自己。在最糟糕的闪回中，这一过程开始不止在我的内心上
演，我们会真的发生冲突。
不过现在的我们已经很少因为家务事发生冲突了。由于我对批判者们有了更深的理
解，它们在我内心的摇摆循环也已大大减少。对外在和内在批判过程的觉察使我能够更早
地识别它们，并更快地将我自己和我的人际关系从泥潭中拯救出来。
</tw-passagedata><tw-passagedata pid="73" name="外在批判者：法官、陪审团和刽子手" tags="" position="34600,3275" size="100,100">@外在批判者：法官、陪审团和刽子手
如前文所述，不是所有的幸存者都会隐藏他们的外在批判者。战类型及其亚型的人可
能会把“被动攻击”的“被动”去掉，变得相当具有攻击性。那些由外在批判者主导的幸存者
往往会产生一种错误的观念，认为自己坚持的主观标准就是客观真理。这样的人被触发
时，会使用外在批判者类似侦探兼律师兼法官的综合职能，在缺乏或没有证据的情况下起
诉对方的“背叛”行为。想象出的轻视、无关紧要的小过失、误读的面部表情，以及不准确
的“心灵”感知，都可以被用于对关系进行审判。在这些诉讼中，外在批判者通常拒绝认可
那些有正面意义的证据——这种私设法庭不会考虑情有可原的情况。此外，在关系中的所
有失望情绪都会导致有罪裁决，帮助批判者给这段关系判处死刑。嫉妒也在这个过程中变
得充满恶意而放肆胡为。
在另一个层面上，外在批判者善于找证据证明自己占据了道德高地。在这个高地上，
他们声称自己有权对他人进行微观管理，这种行为往往借助“为了对方好”被合理化。然
而，这种控制通常是在无意识层面进行的，最初的目的是保护幸存者免于遭受父母早期的
虐待或忽视。
对他人的微观管理也会演变成一系列的控制行为。战类型的人把别人当作俘虏，不请
自来地评估他们的表现，提出不合理的改进要求，控制他们的时间安排、社交日程及衣食
选择。更严重时，他们会戏剧性地表现出自己的嫉妒，且往往没有理由。最糟糕时，外在
批判者与人相处的方式看起来像是在抓犯人，而不是在交朋友。
[[寻找替罪羊]]</tw-passagedata><tw-passagedata pid="74" name="寻找替罪羊" tags="" position="34600,3150" size="100,100">寻找替罪羊
寻找替罪羊是外在批判者不公平地把个人挫败感发泄在他人身上的过程。在童年被遗
弃所造成的愤怒如果没有得到化解，通常会助长外在批判者寻找替罪羊的行为。然而，将
愤怒转移到错误的目标上，并不能疗愈过去产生的或与这种愤怒不相关的创伤。
寻找替罪羊的行为往往是对父母虐待者行为的重演。它是对父母的盲目模仿，因为父
母习惯性地通过不分青红皂白地发怒来释放挫败感。当战类型的父母把他们周围的人当作
替罪羊时，就是在强化一种偏执的镜像模仿，确保在自己感觉不好时其他人也是如此。这
就像我前几天看到的一个车贴：“如果妈妈不开心，大家都不开心。”
童年时我曾多次目睹了这种寻找替罪羊的例子。我的父母痛恨迟到的人，如果我们兄
弟姐妹有人因为什么事迟到了，哪怕是一分钟，我的父母都觉得完全可以用他们“正义”的
愤慨来责骂我们。尽管我们很快就学会了守时，但是情况还是如此。然而，由于他们自己
的CPTSD没有得到治疗，他们表现出的愤怒也只是对自身童年所受伤害未得到表达的愤
怒的冰山一角。当父母冲我们发脾气时，他们闪回到了童年时的痛苦中，那时他们的父母
总是迟到，并且在他们有正常童年需求时没有来满足这些需求。
</tw-passagedata><tw-passagedata pid="75" name="正念和缩减外在批判者" tags="" position="34850,3275" size="100,100">@正念和缩减外在批判者
减少外在批判者的出现需要大量的正念练习。这对于那些有攻击行为的战类型，以及
那些在心中怒骂整个人类群体为“该死的人类”的其他创伤类型的人来说，都同样重要。而
对那些因外在批判者的评头论足而陷入疏离感的幸存者来说，也非常重要。
再说明一次，正念是对我们内心所发生的一切进行细致觉察的过程，特别是思想、画
面、感觉和感受。在攻克外在批判者时，我们必须对思想中认知和情绪这两方面的内容有
更深的觉察。
在攻克内在批判者时也是一样，缩减内在批判者的两个关键方面也是认知和情绪。在
攻克内在和外在批判者时，认知方面涉及用思维阻断和思维替换对过往的观念进行拆除和
重建；而情绪方面则涉及哀悼——这样做是为了切断批判者的“能源”供应——未表达的童
年愤怒，以及被遗弃生涯中未流出的眼泪。
[[当正念加剧了外在批判者时]]
[[思维替换与思维纠正：挤走外在批判者]]</tw-passagedata><tw-passagedata pid="76" name="当正念加剧了外在批判者时" tags="" position="34775,3150" size="100,100">@当正念加剧了外在批判者时
不幸的是，在疗愈初期，我们越是挑战外在批判者，它似乎就变得越发可恶和强大。
我们甚至会认为自己对它的勇敢反抗起到了反作用，反而将它煽动了起来，从而变得更
糟。
我们之所以感到对外在批判者的觉察似乎加剧了它的发作，通常是因为我们闪回到了
童年时的情景，那时父母会因为我们反抗他们的攻击而斥责我们。我们往往并不记得这些
情景，因为病态的父母通常在我们记事之前就已扼杀了我们的反抗能力。尽管如此，对父
母的报复产生恐惧往往是无意识的，它让我们不敢挑战自己的毒性思维。这就是为什么处
于疗愈早期的幸存者常常需要唤起愤怒的自我保护本能，来增强他们的思维阻断能力。
当缩减外在批判者的工作似乎使它变得更强而非更弱时，可能还有另一种情况正在发
生。当解离的情况逐渐减少，我们会开始注意到一直存在于我们潜意识中的外在批判者的
运作过程。由于从这些痛苦的批判过程中解离出来帮助我们在童年时期生存，因此，我们
中的许多人在进入疗愈阶段时，甚至几乎意识不到外在批判者的存在。
在疗愈过程中，我们需要使用正念来减少解离的习惯。只有这样，我们才能看清那个
需要被瓦解、缩减和有意识脱离的外在批判者“程序”。这通常需要我们学习忍受因发现外
在批判者的普遍和强大而引起的痛苦。这种痛苦有时就像一颗难以下咽的药丸，因为一开
始我们很难看到自己与外在批判者斗争的进展。而且，即使我们所做的努力是有成效的，
其进展通常也是缓慢而渐进的，这不免让人失望。尤其是在闪回期间，这时的外在批判者
看起来就像以前一样强大。
如前所述，外在批判者在我们的童年时会恶性生长。它就像一种不断扩散的癌症，需
要许多次痛苦的手术才有可能治愈。尽管如此，我们可以选择接受在对抗外在批判者时的
急性疼痛，因为我们想要遏止外在批判者破坏我们生活乐趣的慢性疼痛。这是一场终身的
战斗。
</tw-passagedata><tw-passagedata pid="77" name="思维替换与思维纠正：挤走外在批判者" tags="" position="34925,3150" size="100,100">@思维替换与思维纠正：挤走外在批判者
我们中的许多人在引导自己去关注他人和生活中美好的、值得信赖的、可爱的东西方
面，依然处于发展停滞状态。在努力缩减外在批判者的过程中，思维替换能够从脑海
中“调用”关于他人的积极想法和画面，从而消解外在批判者对他人的严厉批评，以免这种
习惯性的批评破坏亲密关系。
一种有效的思维替换练习是：列出和某位朋友之间五个积极互动的回忆，以及这位朋
友的五个美好品性。这个练习应用在自己身上时也很有效，可以帮助我们摆脱内在批判者
建立的消极自我形象。第十六章中的五号工具箱中有一个练习，可以让你更加欣赏那些对
你有益的人。
思维通常会触发相应的言语，因此，我建议你在给爱人提供反馈时练习“五正一负”的
原则[5]。约翰·戈特曼的研究表明，保持这个正负比例是拥有和谐亲密关系的共同沟通特
点。这一点很关键，因为外在批判者是童年时由父母的示范作用催生出来的，而父母在给
予反馈时的比例至少是“五负一正”。
</tw-passagedata><tw-passagedata pid="78" name="哀悼能够阻断外在批判者" tags="" position="35225,3275" size="100,100">@哀悼能够阻断外在批判者
哀悼对缩减外在和内在批判者都起到了关键作用。就像对待内在批判者一样，对外在
批判者发泄愤怒有助于使其静默，而哭泣则有助于使其消失。
我们可以利用哀悼产生的愤怒来激发思维纠正，帮助我们挑战外在批判者根深蒂固的
非黑即白的观点，或认为每个人都像我们的父母一样危险。此外，当我们的哀悼化为哭泣
时，它可以释放外在批判者用来吓唬我们，让我们不敢向他人敞开心扉的恐惧。泪水也可
以帮我们认识到，孤独现在给我们带来了许多不必要的痛苦。这反过来可以激励我们敞开
心扉，相信自己有可能找到安全的联结。
[[通过消解移情来弱化外在批判者]]</tw-passagedata><tw-passagedata pid="79" name="通过消解移情来弱化外在批判者" tags="" position="35200,3125" size="100,100">@通过消解移情来弱化外在批判者
移情（Transference，又称“投射”或“转移”）指过去未处理的感受放大了当下的感
受。外在批判者主导的闪回的一个关键特征，就是我们把过去关系中的情感痛苦转移到了
当前的关系中。移情是一个来自过去的“管道”，它向外在批判者输送愤怒，用来控制、攻
击或阻碍现在的关系。就像婴儿会在爱中茁壮成长一样，外在批判者也会在愤怒中成长。
它像寄生虫一样，以被压抑的愤怒为食，然后错误地再将其发泄在当下的失望上。
我最常见到的移情，是将父母遗留的伤害转移到当下我们认为正在伤害我们的人身
上。当这种情况发生时，我们会用超出他们行为严重程度的愤怒或痛苦来做回应。移情会
严重扭曲我们的认知，有时我们会误认为一个无害的人要伤害我们。移情还会煽风点火，
让批判者想象出实际并没有发生的轻视行为。移情通常会在外在批判者爆发时失控。
正如内在批判者将未释放的愤怒转化为自我憎恨一样，外在批判者通过愤怒来控制他
人，或将人拒于千里之外。那些未经表达和处理的关于童年创伤的愤怒是一个隐藏的储备
库，外在批判者可以随时取用其中的资源。所以，通过恰当表达愤怒来哀悼童年的损伤至
关重要，因为它能阻断批判者们的愤怒补给。
哀悼过去未曾表达出来的痛苦（这种痛苦源于父母对我们糟糕的养育方式），能渐渐
消解移情，使我们不再把这些痛苦不公平地转嫁到他人身上。这一点非常关键，因为当外
在批判者们习惯性地将旧有的愤怒投射到亲密的人身上时，爱和亲密关系就不复存在了。
</tw-passagedata><tw-passagedata pid="80" name="通过外在批判者进行健康的发泄" tags="" position="35475,3275" size="100,100">@通过外在批判者进行健康的发泄
有些时候，通过外在批判者进行发泄是一种健康的自我保护行为。有时，外在批判者
的评判是正确的，因为有时候他人的表现确实像我们童年时父母对我们的虐待。因此，外
在批判者的攻击行为有两种健康的应用方式：一种用于在有人真正攻击我们时保护自己，
另一种则用于哀悼童年损伤。下一章我们将会谈到，幸存者通过愤怒地评判父母的残暴虐
待和忽视，获得了极大的裨益。
[[路怒、移情和外在批判者]]</tw-passagedata><tw-passagedata pid="81" name="路怒、移情和外在批判者" tags="" position="35475,3150" size="100,100">@路怒、移情和外在批判者
让我们再看看外在批判者是如何将过去的愤怒转嫁到当下的关系上的。
我的来访者约翰尼在一次面谈时正处于激烈的路怒状态。他在开车来我办公室的路上
遇到了一些令人愤怒的事情。还没落座，他就开始抱怨起来：“人们都太讨厌了。每个人
开车的时候都好像路上只有自己一辆车，开起车来就像整条路都是他的，只在乎自己，根
本不管其他人。那个自大的混蛋一定忘了转向灯是用来干什么的。我真想直接撞上那个自
命不凡的混蛋和他那辆闪亮的新宝马！所有人都只关心自己而不关心别人。天啊，更别提
我老婆了，一说我就停不下来。我都不知道早上为什么要起床……”
约翰尼全方位地发泄着他的怒气。他恨那个超他车的司机，恨路上所有的其他司机，
恨他的妻子、他的雇员、邻居，最后还恨（所幸恨的程度最轻）我，这个总是假装“超级
有同理心”的“收费过高的治疗师”。
约翰尼是个讨好-战类型的人，并且通常以讨好类型为主。在他接受治疗的这两年
里，我从未见过他如此愤怒，因此我感到相当吃惊。当时我确实有点难以保持同理心，但
我明白他正处于闪回状态。我鼓励他通过在垫子上摔打网球拍来进一步发泄（这是一种经
典的释放愤怒的方法，以无害的方式将愤怒外化）。于是约翰尼拼了命地摔打球拍。
当他的愤怒渐渐平息时，我让他闭上眼睛，建议他问自己，这种愤怒情绪是否与过往
的经历有关。过了一会儿，他说：“我很生气，现在不想做你说的任何事情。而且奇怪的
是，我知道你想诱导我谈论我的父亲，但我一直想到我的母亲。她真是个窝囊废！她永远
不会像那个混蛋宝马车司机一样开车，也不曾像我父亲那样对我怒骂，但我就是很生她的
气，因为她忍受了他那么多年，从来没有为我挺身而出或保护我。我有这样的父亲已经够
糟的了，但有这样的母亲让我感到更不公平。”
约翰尼又用网球拍发泄了一番，接着说：“我以为母亲的天职就是要护着自己的孩
子！就像熊妈妈的故事中那样。这太不公平了……这真太他妈的不公平了。我只想把她从
麻木恍惚的状态中摇醒，让她振作起来！”
说到这里他的眼泪流了下来。泪水平息后不久，他顿悟了，并笑了起来，那是一种真
诚的笑，一种如释重负的笑。当我们终于明白一些事困扰我们的原因时，就会发出这样的
笑声。他说：“我知道这听起来很牵强，就像我讨厌的那些心理学鬼话，但这就是生活中
该死的不公平，真的让我非常生气。这就像那种摸到一手烂牌的倒霉，那种踩到狗屎的倒
霉，那种摊上了两个混蛋父母的倒霉。这真太他妈的不公平了！来自父母的不公平是最大
的灾难！
“还有那个在高速公路上不打转向灯就变道的混蛋也是不公平的。我要是没看到他，
就可能会发生一场严重的事故。但说实话，事情其实也没那么严重。我有足够的时间来刹
车，如果做不到的话，就说明我自己也是一个糟糕的司机。
当然这还是很危险的，但再危险也不如在那所房子里长大那么危险，那才是纯粹彻底
的危险。我猜想我愤怒的主要原因是自己不得不在那个糟糕的家庭中长大，这太不公平
了。”
路怒以及对其他司机不太强烈的恼怒，都是外在批判者移情的常见形式。当我们对驾
车时的不快，或对其他轻微的日常烦扰更敏感时，就能通过这样的“冰山一角”探察“冰
山”的全貌，在这条线索的引导下，找到我们过去未被表达的愤怒和伤痛。
我鼓励你在下次因为某个司机的小错而过度愤怒时，尝试一下这个方法。你可以试着
问自己：“这种情况或感觉让我想起了什么？”在下一章中，我们将更深入地探讨哀悼过去
伤痛的过程，当探寻至闪回的深处时，我们就会发现这些伤痛。
[1]伊丽莎白·芭蕾特·布朗宁是英国维多利亚时代诗人。此句改写自她的诗作《我
是怎样地爱你？》（How Do I Love Thee），原句为“我是怎样地爱你，让我逐一细
算”（How do I love thee？Let me count ways）。本书作者将原句改写为“你是怎样
地不完美？让我逐一细算”（How do I find thee lacking？Let me count the
ways）。——编者注
[2]B级片是指低预算拍出来的影片，通常布景简陋、道具粗糙，缺乏质感，没有良好
的品质。——编者注
[3]德裔美籍心理学家和精神病学家，新弗洛伊德主义代表人物、社会心理学先驱。
——编者注
[4]雅努斯（Janus）是古罗马神话中掌管门的神兽，其形象为“门”或“双面人”。
它的两副面孔一个在前，看着未来；一个在后，看着过去。它象征着世界上矛盾的万事万
物。——编者注
[5]“五正一负”的原则是由美国著名心理学家、亲密关系研究专家约翰·戈特曼提
出的。他根据数十年的研究发现，正负向互动比例至少要达到5：1才能维系美满的婚姻，
当比例低于5：1时，离婚概率就会大幅增加。——编者注
[6]路怒（Road Rage）指由于现代的驾驶压力所引起的驾驶者无法控制的愤怒情绪或
攻击性行为。——编者注
</tw-passagedata><tw-passagedata pid="82" name="第十一章 哀悼" tags="" position="34400,2525" size="100,100">[[哀悼能够拓展洞察力和理解力]]
[[哀悼父母关爱的缺失]]
[[衰掉能够改善闪回]]
[[内在批判者会阻碍哀悼]]

[[哀悼的四种方式]]
[[愤怒：减轻羞耻感和恐惧]]

[[哭泣：疏导情绪的有效方式]]

[[口头宣泄：通向亲密关系的最佳路径]]

[[感受：被动地化解悲伤]]

[[使用并加强哀悼的技巧]]</tw-passagedata><tw-passagedata pid="83" name="哀悼能够拓展洞察力和理解力" tags="" position="32975,3500" size="100,100">@哀悼能够拓展洞察力和理解力
我看到哀悼正在饮一杯悲伤的酒，问道：“它尝起来很甜，不是吗？”
“被你发现了，”哀悼回答，
“并且你毁了我的生意。
你已经知道了悲伤是祝福，我还能如何售卖它呢？”
——鲁米
洞察力虽然非常重要，但始终不足以使人实现更深层次的康复。无论幸存者有多么强
烈的疗愈意图或顿悟，都必须学习在经历闪回时爱护自己。当感到恐惧、悲伤、愤怒或难
过时，我们要用善意来回应自己，这一点至关重要。
当幸存者迷失且受困于情绪闪回时，会有一种死亡般的体验，而哀悼对消解这种体验
有着难以估量的益处。哀悼能够代谢最痛苦的被遗弃的感受——特别是那些引起自杀意念
（最严重时是主动自杀意念）的感受。
哀悼也能为幸存者提供支持，帮助他们走出许多由童年创伤造成的、死亡般的痛苦。
本书所探讨的关键童年损失，其实就是我们所有重要的发展停滞，其中最重要的是自我同
情、自尊心、自我保护能力以及自我表达能力的缺失。
</tw-passagedata><tw-passagedata pid="84" name="哀悼父母关爱的缺失" tags="" position="33100,3500" size="100,100">@哀悼父母关爱的缺失
幸存者需要哀悼他们早期未被满足的依恋需求。我们必须哀悼这样一个可怕的事实：安全感和归属感在我们的家庭中极其稀缺，甚至完全不存在。我们还需要哀悼自己的无数
次心碎，因为我们曾一次次努力想要赢得父母的认可和喜爱，却一次次遭受挫败。
随着哀悼能力的增强，我们通常会发现许多未被化解的悲伤，这些悲伤源于我们缺乏
发展和茁壮成长所需的关爱。下面列举的是一些重要的父母关爱类型，对所有儿童的茁壮
成长都必不可少。发现并了解这些未被满足的需求，可以帮助你哀悼那些未被释放的痛
苦。此外，了解这些还可以引导你重新抚育自己，并与自己进行更有爱的互动。
1. 言语关爱：热衷参与多层面的对话。大量慷慨的赞美和积极的反馈。愿意回答孩
子所有的提问。教导、读故事、持续为孩子的语言能力发展提供资源。
2. 精神关爱：看到孩子本身的价值、本能的善良和爱的天性，并以此回应孩子。让
孩子体验愉悦、趣味和爱，从而使孩子保持“生命是一份礼物”这一与生俱来的认知。提供
精神性或哲学性的指导，帮助孩子整合、处理生活中的痛苦。培养孩子创造性的自我表
达。经常接触大自然。
3. 情绪关爱：以持续的关心、重视和专注来对待孩子。欢迎并重视孩子全面的情绪
表达。示范非虐待性的情绪表达模式。教导孩子通过不伤害自己和他人的安全方式来释放
愤怒。给予孩子充分的爱、温暖、温柔和同情。尊重流泪这种释放悲伤的方式。成为孩子
安全的港湾。展现幽默感。
4. 身体关爱：给予孩子关爱和保护。保持孩子健康的饮食和睡眠作息。教导孩子养
成整理仪容、遵守纪律和承担责任的习惯。帮助孩子培养兴趣爱好和个人风格。帮助孩子
平衡休息、娱乐和学习。
人们往往很难有动力去哀悼很久以前的损失。许多损失看起来似乎非常模糊，而且尝
试哀悼这些损失有点像欣然接受牙医的治疗——谁喜欢看牙医呢？可一旦牙痛变得严重，
大家还是会去看。
灵魂的痛楚似乎很难归因为童年的损失，但那些经历过后文描述的哀悼之旅的人无疑
都知道，他们灵魂上的痛楚和心理上的折磨，核心都是一种未被化解的童年损失，即成长
在父母的遗弃之下。
这些损失必须被哀悼，直到幸存者真正明白他的照料者有多么不称职，以及父母对他
的支持有多么欠缺。他需要哀悼，直到不再为父母的虐待或忽视而责怪自己。他需要哀
悼，直到完全意识到是父母糟糕的养育方式带来了阴魂不散的可怕“礼物”——CPTSD。他
需要哀悼，直到明白习得的自动放弃自己的习惯是在重演爱的公然缺席。
对这些可怕的现实进行哀悼，让我们能够努力发展多维度的自我关怀。随着哀悼变得
越发有效，我们的自我同情和自我保护能力会越来越强，我们的内心也会对自己越来越友
好。
</tw-passagedata><tw-passagedata pid="85" name="衰掉能够改善闪回" tags="" position="33225,3500" size="100,100">@衰掉能够改善闪回
“疼痛是过剩的能量，呼唤着释放。”
——杰拉尔德·赫德（Gerald Heard）
对我来说，哀悼有时似乎是神圣的，因为它能让我走出“混杂的被遗弃感”，这种感受
令人极其痛苦和不安，混合了恐惧、羞耻和抑郁，是大多数闪回的情绪核心。
幸存者可以学着用哀悼把自己带出恐惧，因为恐惧意味着安全感的消亡；可以学着用
哀悼把自己带出羞耻，因为羞耻意味着自身价值感的消亡；也可以学着用哀悼把自己带出
抑郁，因为抑郁意味着生命活力的消亡。
通过充分的哀悼，幸存者就会明白，幼时的自己天真无辜、非常可爱。当他们因为没
有出生在充满爱的家庭而哀悼自己的厄运时，他们会在自己的内心深处发现一种强烈的、
不可动摇的自我忠诚。无论他们的内在或外在正经历着什么，他们都准备好了始终支持自
己，并且有意愿和能力这样做。
当你遭受来自内在批判者的攻击时，你会感到不耐烦和挫败，而哀悼可以使你从中解
脱出来。这在发生极其严重的闪回时尤其重要，因为这时内在批判者会霸凌你，让你放弃
自己。在这种时候，对这个来自过去的可怕入侵者发怒和哭泣，可以把你拯救出来，让你
意识到自己已经远离了过去，并且现在非常安全。
</tw-passagedata><tw-passagedata pid="86" name="内在批判者会阻碍哀悼" tags="" position="33350,3500" size="100,100">@内在批判者会阻碍哀悼
通常来说，有效哀悼的最大障碍是内在批判者。当内在批判者特别恶毒时，进行哀悼
可能会适得其反，所以在早期疗愈中治疗师一般不会建议使用哀悼。那些在童年时因表达
情感而反复被指“有病”或遭到惩罚的人，可能会感到哀悼不但没有缓解他们的闪回，反而
加剧了其症状。
我曾见过许多来访者在哭泣时被立即触发了毒性羞耻感。他们本应为自己提供慰藉的
眼泪却引发了可怕的自我攻击：“我太可悲了！难怪没人能忍受我！”“天啊，我这样哭哭
啼啼的，太不值得被爱了！”“我搞砸了，然后因为抱怨而变得更加失败！”“为自己哭泣有
什么用，这只会让我变得更脆弱！”
最后一种攻击特别具有讽刺意味，因为没有什么比痛哭一场更能恢复一个人的内在力
量和应对能力了。我曾在许多场合，仅仅通过激发患者进行痛哭，就化解了其主动自杀行
为。
管理内在批判者往往是早期哀悼的主要任务。这包括认识并挑战内在批判者阻挠或羞
辱哀悼过程的方式。随着幸存者越发不认同内在批判者，他们就可以逐渐在疗愈过程中加
入低强度的口头宣泄，之后再渐渐将悲伤和愤怒的语调加入其中。
一旦内在批判者被充分缩减，同时思维纠正使得内心对自我更加友好，幸存者就可以
开始挖掘哀悼所具有的疗愈潜力。他们会学着以一种增强同情心的方式来哀悼，同情曾经
那个被遗弃的自己，以及如今这个虽然幸存下来但仍在痛苦的闪回中挣扎的自己，从而获
得内心的解脱。
[[通过哀悼缩减内在批判者]]</tw-passagedata><tw-passagedata pid="87" name="通过哀悼缩减内在批判者" tags="" position="33350,3375" size="100,100">@通过哀悼缩减内在批判者
恐惧驱动着毒性的内在批判者。内在批判者以恐惧为养料，并让幸存者闪回到童年担
惊受怕的时期，导致幸存者只会通过父母轻蔑、恐吓或拒绝的视角来看待自己，并模仿他
们，轻蔑地嘲笑自己“有缺陷”“丑陋”“不讨人喜爱”。它会用危险的情景吓唬幸存者，让后
者因为无足轻重的不完美而憎恨自己。
由于恐惧是一种闪回期间的核心情绪体验，所以幸存者需要情绪工具来管理失控的恐
惧。健康的愤怒和哭泣可以缩短恐惧的时间，使其不至于演变为内在批判者那种能够触发
闪回的认知。我曾无数次见到哀悼立刻终止了内在批判者的破坏性“程序”（极端化和灾难
化）。
儿童似乎与生俱来就会通过愤怒和哭泣来释放恐惧。新生的婴儿因失去了子宫的完美
庇护，无法再安全地生活在母亲体内而感到悲伤，所以第一次发出了愤怒的哭嚎，不仅是
为求得关爱和关注，也是为了释放他的恐惧。
然而在创伤性家庭中，愤怒和哭泣也可能使幸存者立即陷入毒性羞耻感，而且有时只
是一个愤怒的想法或幻想就会造成这种情况。因为病态的父母通常会在孩子表达愤怒时对
其施以最严厉的惩罚。这削弱了孩子抒发情绪的能力，使孩子对自己的愤怒和眼泪变得恐
惧和羞愧。于是泪水被抑制，愤怒被困在心中，最终孩子以自我攻击、自我拒绝、自我厌
恶和自我憎恨的方式来对抗自己。自我憎恨是对被父母遗弃最悲痛的重演。
渐渐地，愤怒会成为内在批判者的养料，并且会通过创造一个越来越危险的内部环境
来加剧恐惧。幸存者所说、所想、所感觉、所想象或所希望的一切都会受到恐吓性的内在
攻击。
以下是一些常见的被怒气驱使的内在批判者的攻击。它们是以内在批判者不可避免养
成的第一人称口吻呈现的，例如：“我为什么要问一个这么愚蠢的问题？”“我的表情还能
再丑一点吗？”“我在骗谁呢？像我这种没有价值的失败者怎么敢奢望被爱？”“难怪我觉得
自己像个废物，因为我就是个废物！”
如果你能掌控内在批判者的这种愤怒，并利用它来疏远和缩减内在批判者，那么疗愈
的效果将不可估量。随着你逐渐掌握哀悼的方法，你会注意到内在批判者的音量和攻击频
率都会大幅减弱。事实上，如果缺乏有效的哀悼，缩减内在批判者的进展将会非常有限。
</tw-passagedata><tw-passagedata pid="88" name="哀悼的四种方式" tags="" position="33600,3500" size="100,100">@哀悼的四种方式
若要使哀悼达到最佳效果，幸存者可以尝试四种哀悼方式：愤怒、哭泣、口头宣
泄，以及感受。
</tw-passagedata><tw-passagedata pid="89" name="愤怒：减轻羞耻感和恐惧" tags="" position="33725,3500" size="100,100">@愤怒：减轻羞耻感和恐惧
愤怒，意味着抱怨当前或过去的损失和不公正，是一种积极的哀悼方法。幸存者需
要为了童年时遭受的恐吓、羞辱和忽视等虐待而发怒（有时是盛怒）。随着逐渐善于哀
悼，他们会通过愤怒，抒发出对在家庭中长期缺乏安全感的健康怨恨。他们愤怒的是，在
无数次经历求助无援的背叛时，从来没有人给予他们指导或保护，也没有人对他们的发展
和成就给予公平的或赞赏性的认可。
幸存者可以使用一种不伤害自己和他人的安全泄愤方式，来抒发童年的痛苦。当幸存
者抨击童年创伤，特别是抨击创伤的持续影响（表现为内在批判者的自我憎恨流程）时，
愤怒地对内在批判者（父母的代理人）说“不！”或“闭嘴！”，能够使愤怒外化从而阻止幸
存者把愤怒转向自己，并能恢复已失去的自我保护的本能。在大多数情况下，幸存者不必
直接面对他们的父母表达愤怒和指责。关键在于将矛头对准内在的父母，即过去的父母。
但有一种最常见的例外——父母仍然在虐待幸存者。
愤怒能将幸存者从毒性羞耻感中解救出来。幸存者会盲目地把父母的恶毒指责转化为
羞耻感，而愤怒能将他从中解救出来，并将指责重新引向它该去的地方。这也增加了幸存
者继续战斗的动力，以建立对抗内在批判者的内心界限。
抒发愤怒可以单独进行，也可以在一个见证人面前进行，如一个值得信赖的朋友或治
疗师。不过，经过一段时间的练习后，绝大部分的愤怒还是需要在幸存者自己私密的内心
中默默进行——这是以愤怒为动力的思维阻断，为的是使自己免受内在批判者的攻击。
许多幸存者非常认同内在批判者，以致内在批判者已成为他们的全部自我。这样的幸
存者通常需要非常专注于对抗内在批判者，直到他们发展出自我保护功能。
愤怒有助于将幸存者从闪回时孩子般的无力感中解救出来，并提醒他们现在已经拥有
了成年人的身体，能够保护自己。
综合了这些功能后，愤怒有助于从整体上减少或消除恐惧。它重新唤醒并培养了幸存
者自我保护的本能。通过练习，它会帮助幸存者逐渐建立起一种外部和内部的界限感，使
幸存者远离伤害、免受他人霸凌，并远离那最具破坏性的霸凌——内在批判者的霸凌。
最后，愤怒还可以增强思维纠正和思维替换的效果，幸存者若要树立信念坚信自己本
质上的善良，以及发现自己选择的亲密之人的可爱之处，则需要强化思维纠正和思维替
换。愤怒能帮助幸存者长期渐进地从内在批判者那里夺回自我，并对幸存者的心理进行再
教育，使其既对自身友好，又对亲密关系友好。
[[愤怒有助于消解重复性强迫]]</tw-passagedata><tw-passagedata pid="90" name="愤怒有助于消解重复性强迫" tags="" position="33725,3375" size="100,100">@愤怒有助于消解重复性强迫
幸存者需要重新唤起自己对父母虐待行为的本能愤怒，否则他们就有可能盲目地接受
他人重演这些行为。
我遇到过一位性格温顺、明显很胆小的来访者，她成年后曾三次遭受了她所信赖的男
性的毁灭性诱奸。经过一段时间的面谈，我们将这些遭遇追溯到了她童年时经历的背叛：一位她很信任的叔叔，也是她童年时唯一一名看起来很善良的照顾者，利用了她被父母情
感遗弃而产生的孤独感，逐渐对她的身体进行抚摸，而后一点点发展为越发带有性意味的
接触。
这位来访者对她的叔叔束手无策，因为早在上学前班时，她说“不”的能力就已经被父
母扼杀了。说“不”的能力是自我保护本能的中坚力量，所以，她无法对叔叔的性侵犯进行
抗议。
在她后来的人生中，一位牧师、一位医生和一位治疗师通过重演这个原始场景对她进
行了侵犯。这三次她都迷失在闪回中，因此没有抗议他们的侵犯行为。她只能在事后对此
做出反应，而她的反应方式是将愤怒转向自己，因没有阻止他们而责备和羞辱自己。
在后来的治疗过程中，她终于能通过表达愤怒来进行哀悼。我大约花了六个月的时
间，见证并确认了她对每个侵犯者的愤怒。之后，在某次面谈时，她的脸上洋溢着自豪，
她告诉我有一位同事正在欺骗她，意图对她进行类似的诱奸，而她阻止了这次侵犯。她一
边说，一边流下了喜悦和宽慰的泪水。
当她同事的侵犯处于早期阶段时，其行为看似是友好的触碰。然而，不必要的轻拍背
部的动作逐渐升级为温和的性暗示：抚摸她的手，然后是手臂。她之前从未能够向侵犯者
抗议这些不恰当的挑逗。而这一次，她能在别的同事在场的情况下说出：“请不要碰我。
我不喜欢你碰我，也希望你不要再碰我了。”于是这位同事立即停止了侵犯行为。她很激
动，对自己肃然起敬。
</tw-passagedata><tw-passagedata pid="91" name="哭泣：疏导情绪的有效方式" tags="" position="33975,3500" size="100,100">@哭泣：疏导情绪的有效方式
在哀悼方式中，愤怒是阳性的过程，而哭泣是与之互补的阴性过程。当我们受到伤
害时，我们会本能地感到悲伤和愤怒。
哭泣也是切断内在批判者情绪燃料供给的一个不可替代的工具。泪水可以在恐惧演变
为使自己和他人害怕的思维之前将其释放。事实上，哭泣有时是唯一能化解闪回的方式。
我曾数百次亲身经历，在痛哭一场后，我的内在批判者“枯萎”至无害状态的过程。在其他
数千种场合中，我曾见证我的来访者用眼泪化解了他们的恐惧、羞耻和自我遗弃。我还看
到他们之后进入了一种健康的愤怒状态，下定决心面对他们现在已不能接受的不公平现
象。
我有一位来访者在接受了一年的治疗后搬到了其他地方，她最近写信给我，讲述了她
的一次哭泣经历。她因严重的胃痛而住院，不久后便得知自己得了癌症。她明智地与恶毒
的家人切断了联系，但在新的生活环境中感到很孤独。她被恐惧笼罩，感觉自己处于精神
崩溃的边缘。她写道：“我知道你认为我没有把你说的那些关于哭泣的话听进去。我也是
这么认为的，但是在我感到最无望的时候，我又想起了你的话，于是泪如雨下。我一开始
被吓到了，但很快就体会到了强烈的宽慰，并相信如果我接受手术就会没事。从那时起到
现在已经有12个月了，这段时间我流了很多眼泪（其中还包含了一些怨天尤人的泪水）。
但我似乎已经好了，真的没事了。”
下面是另一个关于眼泪力量的见证。这是从我的一位男性来访者的电子邮件中摘录
的，他在完成为期一年的治疗后又过了六个月给我发来了这封邮件：“我认为是眼泪……
我最近哭了很多次……你说得对，哭泣的感觉很好；我喜欢眼泪，难过的眼泪、感动于世
界之美的眼泪、关于悲伤和失去的眼泪、感激生活终于变得可控甚至美好的眼泪。在过去
的几个月里，我哭的次数比过去几十年都多。我对生活打开了心扉，它变得不那么狭窄
了，它不仅仅是痛苦、羞耻、内疚……还包括别的东西，非常美丽的东西。”
哭泣的另一个好处是，不加压抑的眼泪会刺激副交感神经系统的放松反应。这平衡了
我们在闪回中交感神经系统的过度紧张。
当我们学会了有效的哀悼，我们会允许自己为童年时缺乏父母的积极关注而哀伤。在
那时，父母对我们的关注通常是消极和危险的，而我们为这一可怕的现实感到难过。随着
疗愈的进展，我们也为童年时的自己而哭泣，因为他不被赞赏，也不被认为是特别的、值
得被爱的和讨人喜欢的。
[[哭泣与自我同情]]
[[哭泣与愤怒的共舞]]</tw-passagedata><tw-passagedata pid="92" name="哭泣与自我同情" tags="" position="33900,3375" size="100,100">@哭泣与自我同情
当我们以自我接受的态度来拥抱自己的眼泪时，哭泣将唤醒我们处于发展停滞的自我
同情本能。一旦我们通过持续反复的练习建立起自我同情，它就会成为不断增强的自尊感
的基石。当自我同情的态度成为习惯时，它将消除闪回中经常出现的自我遗弃感。
此外，自我同情能够为建立真正的亲密关系打下基础，我们在此基础上可以建立起真
实的、有益于亲密感的对他人的同情。亲密关系的深度通常取决于我们对自己忠诚的程
度。
</tw-passagedata><tw-passagedata pid="93" name="哭泣与愤怒的共舞" tags="" position="34025,3375" size="100,100">@哭泣与愤怒的共舞
哭泣和愤怒是两个关键的情绪工具，我们通常需要这两者的配合才能完全释放被遗弃
的痛苦。
哭泣和愤怒的配合不同于抱怨，后者是一种不利于哀悼的情绪类型。抱怨是一个微妙
的话题，因为许多以健康方式控诉或哭泣的人有时也会被视作有病的“抱怨者”。但病态的
抱怨往往是愤怒与哭泣的不健康的结合，它是愤怒或悲伤受到压抑后的一种令人厌恶的流
露方式。
下面举两个例子。当一个受到伤害的人只知道表达愤怒时，他压抑的悲伤会不自觉地
渗入到愤怒中，使他听起来像在卖惨或有被害妄想。由于他的悲伤没有得到实质性释放，
再多的抱怨也不能给他带来宽慰，于是他会愤怒且无休止地抱怨，让听众的同情心枯竭。
同样地，当一个受到伤害的人只能哭泣时，被压抑的愤怒会渗入到悲伤中，使他听起来像
是暴躁且没完没了发牢骚的人。我的一个来访者将这种情况描述为“愤怒从一个非常小的
洞里钻出来”。
我们中的许多人都受到社会观念的影响，将愤怒视为属于男性的情绪表达，而将哭泣
视为属于女性的情绪表达。从很小的时候起，男孩就会因为哭泣而感到羞耻，而女孩则会
因为愤怒而感到羞耻。因此，男孩长大后只会通过愤怒来发泄痛苦。于是，悲伤演变为一
种烦躁的情绪、长久的指责或愤怒的宣泄。同样，一些女性不自觉地仅通过抱怨或哭泣的
方式来发泄愤怒，而这种方式会让人陷入更加无助和自怨自艾的境地。
许多男人也依靠愤怒来发泄他们所有的情绪。当他们感到害怕、羞辱或沮丧时，他们
就会生气。与此同时，许多女性只能通过哭泣来抒发这些感受。这通常会导致情绪无法得
到完整的释放，并且阻碍正常的情绪流动过程。男性和女性各有一半正常的情绪释放过程
遭到了抑制。
如果不能完整地表达受伤的感受，幸存者就会陷入情绪化的状态。他未表达的感受会
恶化为一种停滞不前、挥之不去的情绪。这种情绪可能是恶化的怨恨，也可能是带有羞耻
感的自怨自艾，但无论是哪种情绪都不会饱含自我同情。受阻的愤怒会退化为痛苦的闷闷
不乐，而受阻的悲伤会恶化为忧郁的自我放纵。
这与我六岁儿子的健康哀悼形成了鲜明对比。他不得不定期为失去自恋的特权而哀
悼，因为他离弗洛伊德所说的“婴儿陛下”越来越远了。
由于他在学习符合自己年纪的新规则时，会意识到失去了先前的特权，所以他会小小
地哭闹。哭闹是从婴儿的愤怒哭嚎演变而来的，是用愤怒的哭泣来释放痛苦的过程。今天
下午，我要求他放学后要先做完作业才能玩一会，他就因为这种“不公平”而哭闹了一番。
当时我们正爬着37级的楼梯准备回家，他在哭泣的同时发出了一连串愤怒的谴
责：“爸爸，我不喜欢你了。你不讲理。我不要当你的朋友了。”我很感激他以这种健康的
方式表达哀悼，但也对自己平和的反应感到惊讶，因为我在帮助他代谢这个童年早期自恋
特权的损失时，竟然非常平静地接纳了他的愤怒。当我们来到家门口时，他打开门并发出
了真诚的笑声：“爸爸，你看！皮卡丘从桌子上掉下来了。等我完成写字练习之后，我们
可以一起玩神奇宝贝吗？”哀悼几乎瞬间就把他从痛苦的失去中解救了出来，将他的关注
点重新转向了生活中的乐趣以及对美好将来的期待。我也经常看到来访者在痛苦的闪回中
进行哀悼后，重新拾起他们真实的、当下的能力。
当我们在闪回中重新体验早年被遗弃的感受时，如果能够同时利用愤怒和哭泣两种方
式，我们就可以从“混杂的被遗弃感”中获得更彻底的释放。每个幸存者都应该评估自己的
愤怒或哭泣能力是否遭到阻碍或处于停滞，然后努力使其恢复。
当然，有许多男人和女人与上述性别两极化的例子并不相同。还有许多幸存者的愤怒
和哭泣同时受到了阻碍。如果能从内在批判者的禁锢中找回疗愈性的愤怒和哭泣，他们也
将从中获益匪浅。
如果你完全无法哭泣或感到愤怒，可以尝试专注于呼吸，这可能有助于你表达情绪，
尤其是关注呼吸时腹部扩张和收缩的感觉。深入、缓慢和有节奏的呼吸能够拉伸和扩张多
处肌肉和内脏，使人意识到自己当下的感受。
如果这种方法没有效果，你还可以尝试全息呼吸法（Holotropic Breathwork）或赖希
式疗法，它们可以用特殊的呼吸技术帮助你释放受阻的情绪。我知道许多幸存者首次恢复
情绪表达能力就是借助了这些疗愈方法。
</tw-passagedata><tw-passagedata pid="94" name="口头宣泄：通向亲密关系的最佳路径" tags="" position="34350,3500" size="100,100">@口头宣泄：通向亲密关系的最佳路径
“分享快乐，快乐加倍；分担痛苦，痛苦减半。”
——古谚语
口头宣泄是第三种哀悼方式，也是解决情绪闪回的方式之一。口头宣泄是指通过说
话或写作来抒发和释放痛苦。当我们的话语源自真实的感受，语言就被赋予了情感，而痛
苦就可以通过我们所说、所想或所写的话语得到释放。随着哀悼能力的提高，我们可以口
头宣泄我们的损失，用不含羞耻感的语言来讲述自己的经历——我们没能生于珍爱我们的
家庭，这是多么的不公平。
我最喜欢的促进口头宣泄的技巧，是鼓励幸存者在专注于自身感受的同时，毫无保留
地谈论心中想到的任何事情。如果幸存者的感受还没有进入意识层面，那么他可以先关注
身体的感觉，这可以为口头宣泄提供丰富的素材。
口头宣泄具有很好的治疗效果，因为一个人的话语会被他的愤怒、悲伤、恐惧、羞耻
或抑郁的感觉所影响，同时这些话语又将这些真实的感受描述了出来。如果口头宣泄的同
时还伴有哭泣和发怒，那么这种宣泄将更加有效。
[[口头宣泄的神经科学理论]]
[[思考和感受同步]]
[[独自进行口头宣泄]]
[[解离会阻碍口头宣泄]]
[[口头宣泄能治愈被遗弃的创伤]]
[[口头宣泄和亲密关系]]</tw-passagedata><tw-passagedata pid="95" name="口头宣泄的神经科学理论" tags="" position="34150,3375" size="100,100">@口头宣泄的神经科学理论
口头宣泄是一种工具，可以治疗由CPTSD引起的大脑变化。苏珊·沃恩（Susan
Vaughan）关于大脑的核磁共振成像研究表明，情绪闪回会过度激活以情感为导向的右
脑，而抑制以思考为导向的左脑。随着这种大脑半球的两极分化，童年强烈的痛苦会因为
不断重现而被以情感为导向的右脑记住。同时，幸存者无法调用左脑更高的认知功能。这
种认知视角的暂时丧失解释了为什么幸存者很难意识到自己只是在经历闪回，而非真正处
于过去的危险、无助和无望中。
胼胝体是连接大脑左右半球的部分。研究表明，一些CPTSD幸存者的胼胝体比较
小。而进一步的研究发现，大脑能够产生新的神经元和新的神经元连接来改善这种情况以
增强左右脑的联系。
口头宣泄能够有效地重启左脑的认知功能，缓解右脑强烈的情感激活状况。它会培养
幸存者用语言表达感受的能力，最终使幸存者能够准确地解释并与人交流自身的各种感
受。当这一过程经过足够多的重复，大脑就会生成新的神经通路，使左右脑得以协同工
作，使人能够真正同时进行思考和感受。
</tw-passagedata><tw-passagedata pid="96" name="思考和感受同步" tags="" position="34275,3375" size="100,100">@思考和感受同步
当幸存者变得善于口头宣泄时，他就治愈了一个关键的发展停滞。他能够产生健康、
有益且恰当的情绪反应，并用这种方式来思考自己的情绪状态。这些反应的特点是尊重自
己和身边的人。丹尼尔·戈尔曼在他的《情商》一书中提到，这一点就是情绪智力的核心
特质。
由于口头宣泄可以协调左右脑的活动，因此，每当右脑在闪回中被过度激活时，左脑
也会全力参与（从核磁共振成像也能看出这一点）。随着左脑的重新参与，幸存者可以记
起如何使用闪回管理步骤，从而有效地管理闪回。
然而，就像愤怒和哭泣一样，只有在摆脱内在批判者的控制时，口头宣泄才能发挥效
用。在疗愈的早期，许多幸存者觉察不到自己在无意识地过度认同内在批判者的观点，口
头宣泄很容易转变为口头自责，即从内在批判者的自我攻击或极端化角度进行口头发泄，
而这种哀悼很难获得效果。相反，它通常会触发或加剧闪回，从而引发伤害幸存者自己或
亲密关系的行为。在这种情况下，幸存者通常需要治疗师或已充分康复的亲密对象来帮助
他们识别和缩减内在批判者。
口头宣泄是一个特别具有转化力量的哀悼过程。它不仅能像愤怒和哭泣那样帮助幸存
者释放恐惧和消解羞耻感，而且有助于揭露内在批判者那些自我攻击和激发恐惧“程序”的
各种伪装。口头宣泄也有助于我们识别和交流因童年的遗弃经历而长期得不到满足的需
求。</tw-passagedata><tw-passagedata pid="97" name="独自进行口头宣泄" tags="" position="34400,3375" size="100,100">
独自进行口头宣泄
在没有其他人听你说话的情况下独自进行口头宣泄，是一种有效的治疗技巧。未受创
伤的儿童经常会在玩耍时自我口头宣泄，这样做非常有益。如果你的房间不够私密，你可
以开车去一个私密的地方。
通常情况下，你需要充分抑制内在批判者的声音，才能重新获得这种治疗工具。这个
工具非常强大且有助于康复，值得我们与内在批判者进行诸多斗争，从而将它收回到疗愈
CPTSD工具箱中。
我的一位来访者在她的汽车副驾驶座上放了一条半米长的橡胶管和一本电话簿。在她
大量练习表达愤怒的那一年里，每当她脑海中浮现出对她进行洗脑和虐待的父亲时，她就
会用那根 胶管大力敲打电话簿。当然，她在做这些之前会先把车停下。渐渐地，她发
现自己能够在不那么私密的地方低调地进行这一举动。在我看来，在那一年里，她在缩减
内在批判者方面取得了了不起的成效。
</tw-passagedata><tw-passagedata pid="98" name="解离会阻碍口头宣泄" tags="" position="34525,3375" size="100,100">@解离会阻碍口头宣泄
我们需要区分口头宣泄与以下两种情况的区别：一是沉溺于幻想的解离性逃避；二是
毫无益处的强迫性忧虑。解离是在儿童时期形成的一种防御机制，目的是在巨大的被遗弃
痛苦之中转移自己的注意力，保护自己免受伤害。孩子如果得不到支持，就会不得不进入
解离状态，因为他们无法进行有效的哀悼，因而必须通过不允许痛苦完全进入自己的意识
来保护自己。
第六章提到了两种常见的解离类型：右脑解离和左脑解离。
右脑解离可以被视为一种典型的解离，也是僵类型的人最常使用的防御方式。它是
右脑对强烈感受或内在批判者不间断的攻击逐渐感到麻木的过程，也是一个分散注意力的
过程。幸存者的解离通常表现为迷失在幻想、混浊的意识、电视、疲劳或睡眠中。
为了分散注意力而进行的口头表达实际上与口头宣泄恰恰相反。来访者在心理治疗会
谈中有两种常见的逃避痛苦的方式：一种是不断描述一个白日梦般的不可能实现的救赎幻
想；另一种是一遍遍地详述漫长而复杂的梦境，这些梦没有情感内容，来访者也没有认真
尝试内省。
在我的职业生涯早期，曾短暂治疗过一位名叫迪娜的僵-战类型的来访者。她那时陷
入了一个逃避过程——无休止地念叨她的梦境，通过无趣而痛苦的细节来回忆那些梦境。
事实上，她那死气沉沉的叙述方式与她平时讲述所有事情的方式如出一辙。
迪娜当时是一位实习心理治疗师，她认为梦境治疗是心理治疗的重中之重，并借此封
锁了自己的脆弱。当我试图引导她探索更深层次的潜在体验时，经常会激起她愤怒的战反
应。可惜我当时经验还不够丰富，无法帮助她认识到，这是她小时候为了自我保护，让自
己避免受到极具侵犯性的母亲的伤害，而构建的一种解离性防御。可悲的是，她不满地终
止了治疗，并继续陷于自我孤立中，因为她依旧通过那些疏离抽象且缺乏互动的长篇大论
来疏远他人。
左脑解离即强迫思维。其严重程度从轻到重通常表现为：短时、单一的忧虑，到反
复、循环的一连串担忧，再到惊慌失措的极端化和灾难化思维。这种与内在痛苦的解离使
幸存者陷入一些无益的思考中，而其思考的问题与其痛苦的真正本质并无关系，或关系不
大。
下面让我们来看一个例子。你的朋友不停地抱怨恶劣的天气，或一些不打转向灯的
人。他无法停止抱怨，因为抱怨无论如何都不能释放出真正的痛苦，而这种痛苦才是让他
不停抱怨的原因。如果他能更深入地了解真正困扰他的是什么，他就会意识到，他妻子提
出建设性意见的情景，其实使他闪回到了遭受母亲辱骂时的情形，并激发了他的恐惧和羞
愧。
左脑解离也可以表现为轻视（Trivialization）：幸存者过度聚焦于肤浅的外在关注
点，以此来转移自己对不安的内在体验的注意力。一个常见的例子是，过度专注于体育赛
事统计数据或好莱坞名人的生活。当然，这并不是说不能适度追求这类兴趣。
最后，左脑解离也会体现为理智化（Intellectualization）。这就是小说家伊恩·麦克尤
恩（Ian McEwan）所说的“专注思考的高墙堡垒”（High-Walled Fortress of Focused
Thinking）。一些幸存者会过度依赖逻辑和高深的对话，以使自己远离混乱而痛苦的感觉
世界。即使是最具创造性的思维，在过度使用时也会恶化成一种强迫性的防御。
</tw-passagedata><tw-passagedata pid="99" name="口头宣泄能治愈被遗弃的创伤" tags="" position="34650,3375" size="100,100">@口头宣泄能治愈被遗弃的创伤
在分享重要的情绪体验时，我们能够学会以一种有意义且疗愈的方式与他人联结。这
包括分享令我们兴奋和高兴的话题，以及那些令我们感到恐惧或沮丧的事。我们童年被遗
弃的经历导致的最有害的后果，或许就是被迫习惯性地隐藏真实的自我。我们中的许多人
在长大后认为，别人就像我们的父母一样，对我们所说的话毫无兴趣。
我们必须摒弃这种来自过往的破坏性影响。口头宣泄是人们交朋友的关键方式。这类
似于能够帮助婴幼儿建立联结和依恋的温柔的抚摸、舒缓的声音，以及友好的面部表情。
当我们在一个安全的环境中练习以情绪为基础的口头宣泄时，我们就能修复童年时因未能
满足这种需求而造成的伤害。这同时又创造了最终获得一种良好亲密关系的可能性。在这
种亲密关系中，我们既能用语言表达情绪，又能体会他人语言中的情绪，而这种亲密关系
是所有人终生的基本需要。
投入这类练习通常需要勇气和毅力。真挚的分享可能会触发闪回，有时会使幸存者闪
回到因脆弱而受到惩罚或拒绝的情境。个人或团体治疗可以极大地帮助幸存者克服和解决
这些障碍，使其自我表达充满活力。
</tw-passagedata><tw-passagedata pid="100" name="口头宣泄和亲密关系" tags="" position="34775,3375" size="100,100">@口头宣泄和亲密关系
在成人关系中，相互的言语宣泄是通向真正亲密关系的高速公路。与一个足够安全的
对象进行充分的练习，可以让人体验到真正抚慰心灵且有助于疗愈的联结。对我和我的许
多来访者来说，这种体验对孤独感的缓解，远超我们的预期。
最能体现这一点的莫过于相互怜悯。相互怜悯是指两个亲密的人同情、理解对方的
麻烦和困难的过程。它是建立亲密关系过程中的更深层的渠道，比性还要深刻。相互怜悯
通常也会让我们自然而然地打开心房，在许多层面上建立轻松自然的联结。
随着与他人之间有深度而有意义的联结变得更多且更频繁，幸存者会愈发体验到遗弃
抑郁的减弱。
在此，我必须重申，一些流行的治疗创伤的躯体疗法贬低了谈话疗法的作用。虽然躯
体疗法是疗愈的重要工具，但单单依靠它并不能缩减毒性内在批判者或恢复自我表达。认
知疗法，尤其是采用口头宣泄的认知疗法，才是CPTSD疗愈的基础。
接下来我们将继续讨论“感受”，也就是第四种哀悼方式，它是一个身体疗愈的过程。
感受是一种专注于身体体验的方式，能够使我们重新获得能力，去体验我们身体的完整、
放松和生机。
</tw-passagedata><tw-passagedata pid="101" name="感受：被动地化解悲伤" tags="" position="35225,3500" size="100,100">@感受：被动地化解悲伤
“感受是痛苦的对立面……一个人感受的痛苦越多，他所忍受的痛苦就越少。”
——亚瑟·亚诺夫（Arthur Janov）
持续进行愤怒、哭泣和口头宣泄等积极的哀悼活动，可以帮助我们发现第四种哀悼方
式：感受。
感受是一个比表达情绪更微妙、更被动的过程。最好的说明方式是将情绪和感受两
个概念进行对比。表达情绪是指我们用哭泣、发怒或言语发泄内心情绪体验的能量，而感
受是一种不活跃的过程，即对内在情绪体验保持觉察而不做出反应。因此，在疗愈中，感
受意味着臣服于我们内在的痛苦体验，而不对它们进行判断或对抗，也不将它们表达出
来。
感受是一种动觉（Kinesthetic）体验，而不是认知性体验。其过程是将你的意识焦点
从思考转移到感情、能量和知觉。这就是俗话说的“移出脑海”和“进入身体”。
作为一种哀悼方式，感受需要有意识地扭转一种我们已习得的生存机制：压制痛苦，
并将其从意识中驱逐出去。当我们把注意力转向情绪或身体层面的痛苦，并毫无抵抗地臣
服于这种体验时，感受就会“发生”。当我们放松地接受痛苦时，我们可以学着温和地把它
吸收到我们的体验中。感受发挥作用的方式，就好像将我们的意识变为一种溶剂，去溶解
和代谢我们情绪中的感情、能量和知觉。
[[感受可以治疗消化问题]]
[[情绪与身体的联结]]
[[平衡感受和情绪]]
[[学习感受]]
[[一个关于感受的练习]]</tw-passagedata><tw-passagedata pid="102" name="感受可以治疗消化问题" tags="" position="34975,3375" size="100,100">@感受可以治疗消化问题
感受类似于健康的消化过程，放松的消化道能帮我们有效地吸收营养。但如果我们压
制或压抑自身的感受，我们的身体通常会“武装”起来，并变得紧张，特别是消化道。
我认为消化道紧张与我们的心理状态密切相关。例如，腹泻有时是情绪引发的、对强
烈危险产生的生理反应。在这种情况下，恐惧会触发交感神经系统的反应，进而引起肠道
立即排空的反应。恶心也具有类似的机制。再如，便秘有时是由于消化道收紧，阻碍了健
康排泄所需的肠道蠕动。
</tw-passagedata><tw-passagedata pid="103" name="情绪与身体的联结" tags="" position="35100,3375" size="100,100">@情绪与身体的联结
情绪和身体感觉之间往往有密切的关系，两者常常同时出现。此外，紧绷和紧张的感
觉会发展为一种对感受的防御。随着未被表达的感受越积越多，身体就需要更大程度地使
肌肉紧张，从而保持对它们的压制。
一个孩子如果因为自己的情绪而反复受到惩罚，就会害怕自己内心的情绪体验，并收
紧（盔甲化）身体的肌肉组织，努力把情感压制在内心，并将它们从意识中驱逐出去。
屏住呼吸是盔甲化的进一步表现。这是一种特别常见的压制感受的方式，因为呼吸会
自然地把意识带到感受的层面。
我有一位名叫凯莉的来访者，她在一次特别强烈的闪回中进行了自由联想，她痛苦地
回忆起了曾经的创伤——试图避免母亲因为她哭泣而惩罚她。她最糟糕的记忆是某天在超
市里，当她试图压制自己奔涌而出的哭泣冲动时，母亲对她的责骂便如暴雨倾泻而下。她
知道如果自己哭了就会受到最严重的惩罚，所以她屏住呼吸，忍住眼泪。她憋的时间太长
了，以致她因缺氧而晕倒在地，摔破了头。她的母亲认为这是对她的公开羞辱，感到很丢
脸，于是在回家后把她打得青一块紫一块。
我和凯莉花了两年的时间建立信任，才使她重新将这一事件带回意识层面。于是，她
在发生这件事30年以来第一次落泪。这也是她印象中第一次让她感到解脱的泪水。
将意识集中在身体感受上可以帮助你更熟练地进行“感受”练习。通过足够的练习，留
意脸部、喉咙、心脏或腹部的紧绷感，你可以将感受带入意识中，从而单纯地“感受”它
们。然而，当你刚开始关注自己的感受时，这些感受可能会非常强烈，因此如果你能用情
绪表达出这些感受，则会很有帮助。
</tw-passagedata><tw-passagedata pid="104" name="平衡感受和情绪" tags="" position="35225,3375" size="100,100">@平衡感受和情绪
当我们能更敏感地觉察微妙的感受，能通过感受来被动地化解创伤时，我们就可以使
主动与被动的哀悼过程相辅相成。当我们能通过情绪表达和感受两种方式来处理愤怒、
悲伤、恐惧、羞耻和抑郁，往往意味着我们已处于进阶的疗愈阶段。
此外，有些情绪需要通过积极、宣泄式的情绪表达来进行哀悼，而感受有助于我们将
这些情绪带入意识。因此，当我们能在感受和情绪表达之间流畅地转换时，哀悼就会特别
深刻。有些时候，我们只需要充分感受和接纳自己痛苦的感觉，而另一些时候，我们会想
向某人口头宣泄自己的痛苦，而这个人完全不介意我们在倾诉时饱含愤怒和泪水。
</tw-passagedata><tw-passagedata pid="105" name="学习感受" tags="" position="35350,3375" size="100,100">@学习感受
当幸存者变得更善于发怒和哭泣时，他感受到的恐惧便会减少，也会开始有机会学习
单纯地去感受。他可以把握这些机会，练习被动地顺应自己更微妙的愤怒和悲伤的感觉。
这种练习将渐渐培养幸存者的感受能力，使他能够被动地觉察到自己更深层次的感受
——恐惧、羞耻和抑郁。刚开始时，这种觉知往往会让他想要通过情绪表达（即主动哀
悼）来抒发这些感受，使自己摆脱“混杂的被遗弃感”。然而，当疗愈取得了一定的进展
后，即使他不这么做，这种“混杂的被遗弃感”最终也将被消化，单纯地被觉知意识的溶剂
所溶解。这也适用于焦虑，焦虑往往是一种潜意识的恐惧。通过充分的练习，被动地去感
受焦虑往往就能化解它。我们将在下一章中更深入地探讨这一过程。
</tw-passagedata><tw-passagedata pid="106" name="一个关于感受的练习" tags="" position="35475,3375" size="100,100">@一个关于感受的练习
这个练习可以帮助你提高通过感受来化解痛苦的能力。请想象自己穿越了时空，回到
了你觉得被遗弃感特别强烈的地方。想象成年的自己把幼时被遗弃的自己抱到腿上，在各
种痛苦的情绪状态或情境下安慰他。你可以用话语来安慰他：“你大多数时间都感到被遗
弃，并且非常孤独，这让我非常难过。当你陷入这种被遗弃的痛苦时，我更爱你，因为你
忍受了这么久，还得不到任何的安慰。这不应该发生在你身上，也不应该发生在任何孩子
身上。让我来安慰你、拥抱你。你不必急于摆脱这种痛苦，这不是你的错。这一切不是你
造成的，你不应该被责备。你不需要做任何事，就让我抱着你。慢慢来吧。我永远爱你，
无论如何都会关心你。”
我强烈建议幸存者进行这一练习，即使它让你感觉不真实，即使在练习时你需要花很
大力气抵御内在批判者。但如果你坚持练习，最终你会发自内心地对曾经受到创伤的自己
感到同情，这便意味着你的疗愈进程已经进入到一个更深的层次。
</tw-passagedata><tw-passagedata pid="107" name="使用并加强哀悼的技巧" tags="" position="35700,3500" size="100,100">@使用并加强哀悼的技巧
在我28岁的一次剧烈哭泣后，我就很少流泪了。我经常会渴望得到像那次流泪后获得
的那种极大的解脱，但与愤怒不同的是，我无法强迫自己哭泣。我逐渐了解到许多人都有
类似的情况。我的朋友马尔科姆也有同样的困扰，他非常想哭，甚至试过把柠檬汁挤进眼
睛里。他后来还能笑着谈论这件事，但郑重地警告我永远不要做这种尝试。
我们一直在讨论如何能让自己大哭一场，于是便有了下面这一系列方法。就像本书中
的所有建议一样，请尽管使用那些看起来适用于你的建议，并且按照你认为最好的顺序进
行。同时，不同的组合可能会在不同程度上加强哭泣或（和）愤怒的效果。此外，有时可
能所有方法都不起作用，但我仍鼓励你重复尝试那些直觉上看起来可能起作用的方法。
1. 找一个安全、舒适、不会有人听到你声音的地方。
2. 闭上眼睛，回忆一个你对某人产生同情心的时刻。这可以来自现实生活，也可
以来自读过的书籍，或是看过的电影或感人的新闻。
3. 回想某个对你友善的人，或想象一个可能会对你友善的人，从而唤起自我同
情。像是我，我就会友善地对待你。
4. 在日记中口头宣泄你的烦恼，或向一个真实或想象中的朋友，或对我，大声地
宣泄出来。
5. 想象自己被一种更强大的力量所安慰。想象自己躺在一个更强大力量的人或看
起来很和善的人的腿上（圣诞老人这一形象曾经对我的一位来访者很有效）。
6. 回想你因哭泣或愤怒而感到安慰的时刻，或是在现实或电影中看到别人哭泣而
感觉安慰的时刻。
7. 回想因为自己或别人的愤怒而免于受到伤害的时刻。
8. 想象你的愤怒在你周围形成了一个炙热的保护罩。
9. 想象你的眼泪或愤怒把所有恐惧、羞耻或抑郁带出你的身体。
10. 想象自己同情地抱住内在小孩。告诉他，在心情不好或受到伤害时感到悲伤或
生气是正常的，没有关系。
11. 告诉内在小孩，你会保护他不被批评。
12. 深深地、充分而缓慢地呼吸。
13. 放一些感人的或能唤起情绪的音乐。
14. 看一部凄美的电影。
15. 看一部刻画释放愤怒这一“令人羡慕”的过程的电影。
关于第15条的详细说明：一些来访者告诉我，在1976年的电影《电视台风云》
（Network）中，主角向窗外大喊“我们忍无可忍了”的场景帮助他们宣泄了愤怒。
最后，如果阅读本书还无法解开内在批判者对你哀悼能力的束缚，请考虑寻求治疗师
或支持小组的帮助，以便攻克内在批判者用来破坏你哀悼能力的羞耻感。
</tw-passagedata><tw-passagedata pid="108" name="第十二章 管理遗弃抑郁的地图" tags="" position="34575,2525" size="100,100">@第十二章 管理遗弃抑郁的地图
CPTSD会让我们痛苦的情绪闪回一触即发。而正如我在本书中所描述的，情绪闪回
是对遗弃抑郁的多层次的防御性反应，都是针对重新出现的童年被遗弃时的危险感和绝望
感。这些反应包括身体、行为、认知、情绪和关系的反应。
本章将提供一张地图，介绍这些对遗弃性痛苦的多层次的防御性反应。这张地图会告
诉你，在特定的时间最需要处理哪些反应，还告诉你有哪些减少不必要的有害反应的策
略。这种策略包括在陷入恐惧或抑郁时，用自我同情的态度安抚自己，以避免陷入剧烈的
恐惧、有毒的羞耻感、内在批判者的攻击，或自我伤害的4F反应中。

[[反应循环]]

[[父母的遗弃造成了自我遗弃]]
[[抑郁思维与抑郁感受]]

[[疗愈是渐进的]]
[[用全方位的疗愈工作来应对闪回]]</tw-passagedata><tw-passagedata pid="109" name="反应循环" tags="" position="33875,3775" size="100,100">反应循环
本节将介绍情绪闪回中的反应层次及循环。抑郁和被遗弃的经历触发了我们的恐惧和
羞耻感，然后恐惧和羞耻感会激活恐慌的内在批判者思维，这反过来又使我们陷入肾上腺
素升高的战、逃、僵或讨好的创伤性反应。
以下就是创伤性反应在闪回中出现的一个例子。一个幸存者在醒来时感到沮丧，因为
童年的经历至今束缚着她，使她觉得自己是没有价值且不可接受的，于是她感到焦虑和羞
耻。这反过来又触发了她的内在批判者，它会用完美主义式的抱怨来吓唬她：“难怪没有
人喜欢我。我这个懒鬼必须从床上爬起来，否则我就会变得像公园里那个无家可归的女人
一样！”
她被自己内心的声音再度伤害。于是又开始了她最习惯的4F反应。她要么霸道地对
身边的人发火（战），要么忙着焦虑地干活（逃），要么打开电视，迷迷糊糊或开始打瞌
睡（僵），要么自我放弃地将注意力转移到朋友身上，想办法帮朋友解决问题（讨好）。
这一切通常发生得非常迅速，以致我们感受不到恐惧和羞耻，或内在批判者的存在。
在疗愈早期，我们通常能注意到的第一件事，就是自己突然陷入了最典型的4F反应。随
着疗愈的进展，我们会开始意识到内在批判者的存在，然后这会促进我们对助长内在批判
者的恐惧和羞耻感的觉察。在疗愈后期，我们会开始意识到遗弃抑郁本身。
不幸的是，这一过程也常常反向运作。你可能会在疗愈初期突然注意到自己已经回到
了失调的4F反应行为中，而这触发了新的自我攻击式的批评，进而加剧了你的恐惧和羞
耻感。这反过来又加剧了你的遗弃抑郁，因为自我遗弃的症状开始肆意发作。
你急于摆脱遗弃抑郁那死亡般的感受，于是最初的循环又开始了。抑郁带来了恐惧和
羞耻，而这些又助长了恶毒的内在批判者的攻击，使你进入战、逃、僵或讨好的状态。
幸存者可能会在这些不同层次的反应中来回穿梭，形成激发内在创伤的永动循环。我
认为这个过程也解释了许多幸存者所描述的在强烈闪回中出现的逐渐下坠的感觉。
以下是关于这些过程的文字图示：遗弃抑郁↔恐惧和羞耻↔内在批判者↔4F反应
让我们透过下面这个案例，来看看闪回的触发是如何反向运作的。我的来访者马里奥
是一个超级完美主义的逃类型的人，有一次他来面谈时迟到了5分钟，而这是他在两年的
治疗中第一次迟到。
马里奥当时完全处于逃反应状态，他从一个街区外的停车位满头大汗地爬坡飞奔而
来。他告诉我，今天他不许自己坐在沙发上，问我能否让他在沙发前一边踱步一边面谈。
他说：“我讨厌迟到。你不知道我刚才在高速公路上开得多快！”
马里奥开始强迫性地踱步，但这种强迫行为的速度远跟不上他强迫思维的速度，在他
的陈述中，出现了第九章中列出的大部分内在批判者攻击“程序”的许多版本。对他来说，
迟到只是他自身缺陷的冰山一角。随着他对自己的咆哮加剧，他愈发地对自己进行言语恐
吓，并用父母对他的厌恶来羞辱自己。
最后，马里奥似乎筋疲力尽，倒在了沙发上，并产生了自杀意念，这是我第一次听他
提到自杀。他刚刚落入了“混杂的被遗弃感”的深渊（被恐惧和羞耻包裹着的抑郁），并陷
入了无助和无望的绝望抑郁中。这正是他童年时体验的无助和无望。
幸运的是，在过去的两年里，我一直努力地在他心里埋下种子，让他意识到自己需要
哀悼。自治疗以来，他第一次流下了眼泪，而这是我多年来目睹的最感人的泪水。他为曾
经那个被遗弃的小男孩而哭泣。他通过哀悼自己的痛苦回到了家，回到了童年的自己身
边。他经历了长期的自我遗弃，而这是他在记忆中第一次暂时结束了这种状态。
我们可以从这一案例中看到，反应循环在严重时可以变成“龙卷风”。堵车导致了迟到
这一“糟糕的危险”，CPTSD使他做出了逃反应，让他飞快地赶到我的办公室。逃反应又立
即触发了他的内在批判者，攻击他的迟到行为，并把后果灾难化。于是他在羞愧和恐惧中
越陷越深，最终陷入了遗弃抑郁本身。
但这一次马里奥用眼泪攻克了闪回，因为哭泣释放了他的恐惧和羞耻。这反过来又削
弱了内在批判者的力量，使他的身体开始释放由逃反应的过度觉醒所带来的负面情绪。
如果他未能用哭泣化解，他很可能会继续用由羞耻感驱动的完美主义和由恐惧感驱动
的极端化思维来攻击自己，在结束面谈之后，又会进入强迫状态，在无数待办事项的驱使
下忙碌一整天。
[[反应循环中的解离层次]]
</tw-passagedata><tw-passagedata pid="110" name="反应循环中的解离层次" tags="" position="33850,3650" size="100,100">@反应循环中的解离层次
在反应循环中所有层次的反应都是对遗弃抑郁的防御措施。同时，每层反应也是对下
一层次的防御。因此，每层反应都是一种解离。当我们被触发并迷失在4F反应中时，我
们会战、逃、僵或讨好，从而让自己与内在批判者那令人痛苦的声音解离。在更深的层次
上，内在批判者也在分散我们的注意力，使我们与自己的痛苦情绪解离。此外，恐惧和羞
耻使我们与最底层的反应（即可怕的遗弃抑郁本身）解离。所以，解离就是使这些层次变
得不那么有意识或完全无意识的过程。
随着疗愈的进展，我们会开始觉察并缩减内在批判者，我们会越发意识到内在批判者
背后潜藏的恐惧和羞耻感。随着充分感受恐惧和羞耻感，我们会注意到恐惧和羞耻感掩盖
了遗弃抑郁本身那种如死亡一般的感受。学会对这种抑郁的感受保持自我支持式的觉察，
是最深层、最底层的疗愈工作。当我们能够做到这一点时，说明我们的疗愈已经上升到了
一个更高的水平。
</tw-passagedata><tw-passagedata pid="111" name="父母的遗弃造成了自我遗弃" tags="" position="34125,3775" size="100,100">@父母的遗弃造成了自我遗弃
在年幼时，我们不得不用防御反应来解离，因为我们还没有发展出处理遗弃抑郁痛苦
的能力。我们难以忍受恐惧、羞耻感和随之而来的强烈痛苦。我们又无法用愤怒和泪水来
释放这种恐惧和羞耻感，也无法继续忍受总是充满被害妄想的内在批判者——我们对它无
能为力。所以我们只能战、逃、僵或讨好。久而久之，这种复杂的自我遗弃循环就成了习
惯。
长期的情感遗弃对孩子的打击很大，会使孩子感到并表现得麻木和抑郁。情感健全的
父母会对孩子的抑郁给予关切和安慰。而遗弃孩子的父母对孩子的反应是愤怒、厌恶，或
进一步的遗弃，而这又加剧了孩子的恐惧、羞耻和绝望，这些感受形成了“混杂的被遗弃
感”。

[[破除自我遗弃]]</tw-passagedata><tw-passagedata pid="112" name="破除自我遗弃" tags="" position="34125,3650" size="100,100">
破除自我遗弃
由于长期遭到了父母的拒绝，所以即使是最轻微的抑郁（无论看起来多么恰当或具有
功能性），都会让我们瞬间闪回到最初的遗弃抑郁中。而我们还没有培养出通过自我养育
来抵御抑郁体验的能力，无论这种抑郁多么轻微。我们最初被父母遗弃的经历已经演变为
习惯性的自我遗弃。这种自我遗弃的惯性迫使我们通过恐惧和羞耻、内在批判者的灾难化
和4F反应来应对抑郁。
但我们是可以逐步破除自我遗弃的习惯的。下面描述的正念过程唤醒了与生俱来的心
理能力，能够使我们以慈悲心去应对抑郁。正念也能帮助我们代谢对抑郁的恐惧和羞耻
感。
终止对抑郁的过度反应通常是一个漫长且艰难的过程。这是因为我们周遭的环境经常
羞辱我们对抑郁的表达，将我们病态化，好像如果我们没有投身于“追求幸福”，就是一种
大逆不道。
甚至教育机构都有关于抑郁的禁忌，有些学校不认同它是一种正当的情绪。对他们来
说，抑郁只不过是消极思维的产物。有些学派则把它简单地描述为一种失调的状态，认为
这种状态是因压抑那些不那么忌讳的情绪（如悲伤和愤怒）所造成的。我并不是想否认这
些因素可能会引起抑郁，而是想强调抑郁是一种正当的感受，它往往包含有益且重要的信
息（我将在后文展开讨论）。
</tw-passagedata><tw-passagedata pid="113" name="抑郁思维与抑郁感受" tags="" position="34650,3775" size="100,100">@抑郁思维与抑郁感受
当我们学会区分抑郁思维（我们需要将其消除）和抑郁感受（我们有时需要感受它）
时，疗愈就会取得进展。偶尔的精神萎靡和快感缺乏（无法享受平常的快乐）是正常且必
然的。适度的倦怠和不满是人生的代价之一。
此外，抑郁有时是一种宝贵的预兆，预示着我们需要放慢速度，进行休息和恢复。抑
郁有时非常有益，能让我们获得独特的直觉。例如，它告诉我们曾经重视的工作或关系已
经变得有害，而我们之所以感到抑郁，是因为一些不可弥补的变化已经使我们生活中的一
些核心事物变得对我们不利了。这种具有功能性的抑郁是在向我们发出信号，让我们远离
不健康的人和事，重新出发。
对抑郁的过度反应从本质上强化了习得的毒性羞耻感，强化了一种信念，即抑郁的自
己是没有价值的、有缺陷的、不值得被爱的。
可悲的是，这通常会使我们更深地陷入被遗弃的自我孤立中。
[[正念能够代谢抑郁]]
[[身体的正念]]
[[对身体的觉察可以疗愈性地触发痛苦的记忆]]
[[自省式的身体练习]]
[[通过充分感受来消解抑郁]]
[[饥饿是伪装的抑郁]]
[[假性环性心境障碍]]
[[区分必要的痛苦与不必要的痛苦]]</tw-passagedata><tw-passagedata pid="114" name="正念能够代谢抑郁" tags="" position="34275,3650" size="100,100">@正念能够代谢抑郁
想要从童年创伤中获得深度的疗愈，你就需要正常地看待抑郁，拒绝习惯性地对抑郁
做出过度的反射性反应。其核心就是培养自我同情式的正念，使“你”留在自己的身体里，
并对所有的内在体验保持觉察。
正念练习能够培养我们接纳自己的情绪、内部器官和身体体验的能力，而不会退回到
反应循环中。斯蒂芬·雷文（Steven Levine）优美的著作《生死之歌》（Who Dies）是一本
关于正念练习的指导书籍，这本书很具启发性，且没有术语，易于理解。
</tw-passagedata><tw-passagedata pid="115" name="身体的正念" tags="" position="34400,3650" size="100,100">身体的正念
由于CPTSD中的抑郁通常会立即演变为恐惧，所以早期的正念涉及对因恐惧而过度
觉醒的身体感觉保持觉察。这种方法也被称为感觉聚焦（Sensate Focusing），属于上一
章中探讨的感受练习。轻微的恐惧感体现为身体任何一处部位的肌肉紧绷或紧张，尤其是
消化道。下颌、喉咙、胸部、横膈膜或腹部的紧张也常常与恐惧有关。更强烈的恐惧感体
现为恶心、头痛、坐立不安、极度兴奋、呼吸短促、换气过度等。
正念还包括觉察自己是如何与这些不舒服的感觉解离的。解离可能是经典的右脑型分 心，即进入遐想或睡眠；也可能是左脑型分心，即担心和纠结。
幸存者需要一次又一次地把自己从解离中解救出来，并温和地把意识带回来，去完全
感受恐惧的感觉。尽管恐惧的感觉最初会让人难以忍受，但持续以非反应性的方式关注
它，就会将其攻克和化解，就好像意识本身在消化和整合它们。
</tw-passagedata><tw-passagedata pid="116" name="对身体的觉察可以疗愈性地触发痛苦的记忆" tags="" position="34525,3650" size="100,100">@对身体的觉察可以疗愈性地触发痛苦的记忆
对身体的觉察和感觉聚焦有时会打开记忆，让人想起童年的受虐经历和被忽视的悲伤
情绪。这种现象会提供宝贵的疗愈机会，让你得以更充分地哀悼童年的损失。但是如果浮
现的痛苦超过了你自己能消化的程度，请考虑寻求专业人士的帮助。
通过大量的练习，你将能从恐惧中唤醒对潜在抑郁的感知。这是一种低度觉醒的感
觉，刚开始的时候非常细微，几乎无法察觉，可能只是让你感到沉重、肿胀、疲惫、空
虚、饥饿、渴望、酸痛或毫无生气。
这些感觉最初与恐惧的感觉一样，让人难以关注当下的感受。然而，随着不断的练
习，聚焦的注意力在被整合到意识中的同时，也会消化这些感觉。对抑郁保持正念的最大
挑战之一是不要解离至睡眠状态。在一张舒适的椅子上坐直可以帮助你保持清醒，并专注
于充分感受和代谢抑郁。
随着练习完成度的逐渐提高，这些抑郁的感觉和感受会演变为一种平静、放松而自在
的感觉。在特殊情况下，它们有时会通向一个潜在的、与生俱来的核心情绪体验，即清
晰、康乐和归属感。</tw-passagedata><tw-passagedata pid="117" name="自省式的身体练习" tags="" position="34650,3650" size="100,100">
自省式的身体练习
我最初是通过每天用半小时去感受身体的恐惧，来开启学习如何感受的旅程的。
这对我来说非常困难，因为我的童年是在多动症似的忙乱中度过的。我每天都在进行
马拉松式的努力，让自己领先于我的恐惧和充满羞耻感的抑郁。成年后，我把原来的工作
量减少到半程马拉松的程度，但我仍然十分忙碌，即使我表面上看起来很放松。调整我的
紧张状态是一个让人气馁的过程。在我试图变得更具正念的过程中，我常常气恼于我的意
识频繁逃离我的身体，回到思考或白日梦中。
在最初的几个月里，我的注意力不断摇摆，时而感受到恐惧的紧张感觉，时而被内在
批判者的思维所干扰，我的内心充斥着大量灾难性的想法和想象。我的内在批判者反复曲
解我的恐惧，好像我仍然被困在危险的家庭中。它不停地怂恿我做出逃反应。我非常焦躁
不安，甚至忍不住幻想着打扫房间，这种幻想非常奇怪，因为大扫除通常是我最不喜欢做
的事情之一。在练习正念的第一年，我经常不得不紧紧抓住椅子的把手，来保持和身体的
感受同在，否则我就会用过度的活动来激发肾上腺素，并以此获得一种自我“治疗”的感
觉。
</tw-passagedata><tw-passagedata pid="118" name="通过充分感受来消解抑郁" tags="" position="34775,3650" size="100,100">@通过充分感受来消解抑郁
渐渐地，我的专注觉察开始代谢我的恐惧。数月后，我通常能在十分钟内消解由闪回
带来的紧张感和恐惧感。随着越来越顺利地消解恐惧，我体验到了自己遗弃抑郁本身的最
底层、最核心的感觉。
用正念融合抑郁的微妙情绪和身体感觉，是消除自我遗弃的终极武器。我一次次地专
注于自己的抑郁感觉。这些感觉偶尔很强烈，但更多时候非常细微。在这一过程中，我往
往很难抵制入睡的冲动，很多次都忍不住睡着了。
在另一些时候，我注意到抑郁会立即把我“吓”回恐惧中。同时，抑郁的感觉也会触发
我的毒性羞耻感。我常常发现自己在重复父母轻蔑的话语：“你真糟糕、懒惰、没有价
值、一无是处、故步自封……”
值得庆幸的是，通过不断的练习，我逐渐学会了拒绝内在批判者的有毒词汇，也学会
了在大部分时间内保持清醒。然后我发现自己能更准确地定义童年的感受了：渺小、无
助、孤独、无援、不被爱。渐渐地，这种认知让我对自己这个被遗弃的孩子产生了深刻的
同情。
此外，我还发现了一个奇妙的现象：一旦感觉聚焦得到了充分的练习和发展，它就能
成为一种思维阻断的终极武器。当内在批判者特别强势而顽固时，有一种回到安全之处的
有效方法，那就是将你的意识从思考转移到感受身体。一位幸存者将其描述为：“回到家
中，在你身体的母亲那里休息。（Coming home to rest in the mother of your body.）”
在我当下的疗愈工作中，我最常将这种正念技术应用于求生模式的抑郁体验。对我来
说，轻度的遗弃抑郁通常是由好几天没睡好所触发的，因为睡眠不佳会降低我的能量水
平，使我的注意力变得迟钝。大多数时候，这种感觉体验为我的内在批判者提供了丰富的
素材。但几年下来，越来越多的正念让我意识到，无论我感到多么疲惫或焦虑，我通常都
能表现得足够好。最近这段时间，我有时甚至能真诚地接纳这些疲惫、焦虑的体验，并把
它们当作一个机会，在不太重要的日常事务中休息一下。我已经学会了如何抵制内在批判
者极端的奋斗计划，并对没那么有效率的日子感到满意。
</tw-passagedata><tw-passagedata pid="119" name="饥饿是伪装的抑郁" tags="" position="34900,3650" size="100,100">@饥饿是伪装的抑郁
心理上的被遗弃感常常会伪装成生理上的饥饿感。吃完一顿大餐之后很快又感到饥
饿，很少真正与食物充饥有关，这通常是伪装的情绪饥饿，以及对安全与慈爱联结的渴
望。食物无法满足被遗弃的“饥饿感”，充满爱的支持才可以。
即使经过了10年的练习，我有时仍然觉得很难区分这种依恋式的饥饿感和生理性的饥
饿感。一个通常可靠的线索是，渴望得到依恋滋养的感觉通常来自小肠，而生理饥饿来源
于胃，后者在人体中的位置稍高一些。当我有时间对这种下腹部的感觉进行冥想时，我常
常能意识到自己正处于一次轻度闪回中。感受这种不舒服，通常可以消除闪回和虚假的饥
饿感。
我认为这种类型的情绪饥饿是大多数食物成瘾的核心。食物成瘾如此难以戒除的原因
之一，是因为食物是我们可以用来进行自我安慰的第一来源。在缺乏其他安慰时，我们无
疑会过度依赖食物来获得滋养。
事实上，如同加博尔·马特所说的，我相信依恋式的饥饿其实是大多数物质成瘾的核
心，也是行为成瘾的核心。后者的一个例子是：性成瘾者和爱情成瘾者会拼命追求高强度
的亲密关系。也许所有的成瘾行为都是一种迷途的尝试，为的是试图对更深层的遗弃痛苦
和未满足的依恋需求进行自我治疗。
</tw-passagedata><tw-passagedata pid="120" name="假性环性心境障碍" tags="" position="35025,3650" size="100,100">@假性环性心境障碍
与假性饥饿相似，疲劳感有时与睡眠不足无关，而是一种与遗弃抑郁有关的情绪表
现。我认为，如果人没有在与自己或他人的安全关系中得到足够的休息，就会产生情绪疲
劳。这种情绪上的耗竭往往会伪装成生理上的疲惫，久而久之，这两者会让人难以分清。
如果遗弃抑郁没有得到治愈，任何一种疲惫都会引发我们的恐惧，进而激活内在批判
者，然后将“疲惫”理解为“危险的不完美”，这反过来又会触发4F反应。
具有讽刺意味的是，对情绪疲劳的过度反应最终会造成真正的身体疲劳，我将这一过
程称为“环性心境两步舞”。这种舞蹈属于逃类型或其亚型的行为，表现为习惯性地疯狂工
作或忙个不停，以此对疲劳做出过度反应。他们用各种活动来激发体内的肾上腺素，以进
行自我治疗，通过“奔跑”来对抗未经处理的遗弃抑郁所带来的情绪疲劳。
然而，许多人的身体很快就会筋疲力尽，变得太过疲惫或生病，而无法继续“奔跑”。
这时他们就会崩溃，陷入一种极其痛苦的抑郁状态。但是一旦肾上腺素得到了补充，他们
就会立刻拼命地重新启动“奔跑”模式。具有这种行为模式的幸存者有时会被误诊为躁狂抑
郁症，因为他们会在肾上腺素高亢和被遗弃感的低潮之间突然转换。
另外值得注意的是，许多幸存者用基于生理学的方法来治疗情绪疲劳，而这种方式是
徒劳的，甚至还会增加他们的羞耻感：“我肯定有什么毛病。我已经改变了自己的整个饮
食、睡眠和运动习惯，能买到的营养品都吃了个遍，看了各种医生，但我睡醒时仍然感到
疲惫不堪。”
有一种健康的方法可以让人走出错误的死胡同。当你不可避免地感到饥饿、愤怒、孤
独、疲劳时，我建议你培养对自己的善意，关注自己的内在，看看自己是否已经闪回到了
遗弃抑郁中。如果答案是肯定的，你可以努力培养前文描述的那种内在的、自我同情式的
关注。有意思的是，饥饿（Hungry）、愤怒（Anger）、孤独（Lonely）、疲劳（Tired）
这几个词的首字母合起来，正好是停（HALT）。
</tw-passagedata><tw-passagedata pid="121" name="区分必要的痛苦与不必要的痛苦" tags="" position="35150,3650" size="100,100">@区分必要的痛苦与不必要的痛苦
要做到这一点非常困难，为了获得动力，有时你可以把抑郁情绪看作是内在小孩发出
的信息，因为他正像从前一样感到被遗弃。也许这一次，你可以来到他身边，用一种更具
安慰性、更能提供保护的方式，重新抚育自己。通过这样的练习，你可以逐渐实现佛教中
所说的一种疗愈，即能够区分必要的痛苦（正常的恐惧和抑郁）与不必要的痛苦（无意识
的自我遗弃和无助感、毒性羞耻感、CPTSD恐惧、让人重新受创的内在批判者思维，以
及过度的反应性的4F行为）。
</tw-passagedata><tw-passagedata pid="122" name="疗愈是渐进的" tags="" position="35275,3750" size="100,100">@疗愈是渐进的
在本节，我将以重复第四章的“疗愈的阶段”这一段作为开始。这一部分概述了疗愈的
整体过程。希望你阅读本书到现在，对CPTSD的理解已经大有增进。我也希望你在疗愈
过程中能感受到更多的自我同情和更强的方向感。
尽管我们常常同时在多个层面推进疗愈进程，但在某种程度上，疗愈是一个渐进的过
程。它始于认知层面，通过心理教育和正念疗法来帮助我们理解自己患有CPTSD。这种
认知层面的觉醒能使我们学着削弱CPTSD对生活的诸多破坏力。
认知层面疗愈的下一步是长期缩减批判者。一些幸存者需要在这一步做出很大的努
力，才能进入情绪层面的疗愈，即学习如何有效地哀悼。
对童年的损失进行深切哀悼的阶段可能会持续若干年。当哀悼取得足够的进展，幸存
者会自然地进入下一层面的疗愈，包括哀悼失去的安全感，并以此克服恐惧；哀悼失去的
自尊，从而消除毒性羞耻感。
当我们越来越善于进行这种深层次的哀悼时，就可以开始解决创伤的核心问题——遗
弃抑郁。在此阶段，我们将通过前文介绍的身体疗愈消除遗弃抑郁引发的身体盔甲化及生
理反应。在这一过程结束时，我们将学会怀着同情心支撑自己度过抑郁时期。
最后，我们要解构每一层旧有的、会加深痛苦的防御。这涉及一系列复杂的任务，而
许多幸存者需要关系型疗愈来完成这些任务。我们将在第十三章中进一步探讨。
</tw-passagedata><tw-passagedata pid="123" name="用全方位的疗愈工作来应对闪回" tags="" position="35400,3750" size="100,100">@用全方位的疗愈工作来应对闪回
下面这个例子，是关于在解决闪回问题时，如何处理所有层面的反应性行为。
当我在30多年前刚开始自我疗愈时，我吃得很差，不知道如何用健康的食物来抚慰和
滋养自己。
然而，经过数年的努力，我深深地、直觉地认识到，我需要多下厨，才能把自我养育
提升到一个新的水平。我之前之所以不常做饭是因为我觉得做饭很麻烦。幸运的是，我逐
渐能把做饭作为一种有爱的活动来接受。尽管如此，在很长一段时间里，烹饪对我来说依
然是一种非常费劲且不愉快的经历（事实上，这很像我多年来为了战胜内在批判者而进行
的斗争）。
烹饪成了我自我再抚育的核心。直到我对自己的逃反应有了更多的了解，我才意识到
自己在做饭时是多么急躁。随着正念的增强，我发现最小的意外都会让我的胸口有一种轻
微电击的感觉。这些意外包括东西打翻了、盖子太紧打不开、没有想到的额外步骤，或者
没法按时完成。在一瞬间，这些正常的意外事件中的任何一个都会让我在厨房里手忙脚
乱，陷入低级别的恐慌。每当这种情况发生时，我都会在做好饭菜后立即狼吞虎咽，只是
为了尽快结束这种折磨。
这就是我成年后常见的陷入闪回的例子。触发闪回的往往是一些日常的小挫折，而不
是再次经历童年时那种受到严重侮辱和折磨的事件。
随着疗愈工作的推进，我意识到任何与食物有关的事情都很容易让我闪回到曾经家中
餐桌上的场景——我那创伤性家庭的战场。许多有效的哀悼都由此产生，这些哀悼使我顿
悟到，做任何复杂的事情都会使我闪回到被父母挑剔的感觉。后来我发现，每当我因为做
一些复杂的事情而触发闪回时，对内化父母发怒能大大减少我的恐惧。
然而，我对食物的创伤仍然有很大一部分无法化解，直到我开始了本章所描述的身体
练习。多年来的身体正念练习大大减少了我在做饭时一触即发的焦虑，但这种焦虑还没有
被完全克服，我现在还在不断练习。至于反应循环，我被食物和做饭偶尔触发的闪回大致
是这样的：我在上班前有30分钟的时间做饭和吃早餐。我来到厨房，然后……
“哦不，水槽里都是我昨晚忘了洗的碗！”我立即注意到自己将要开始疯狂地洗碗，这
时闪回管理步骤的第一步出现在我的意识中：“我正在经历闪回。”
接着，我直接进入第七步，试图“慢慢回到身体里”。我坐在我最喜欢的毛绒椅子上，
闭上眼睛，把我的意识带到腹部，那里是我的焦虑对我造成的冲击最强烈的部位。我可以
感觉到横膈膜及其下方的紧绷感。我感到害怕，想象到了父亲的大手捏着我的小肠。
我开始疑病症式地担心腹部的这种紧张感可能会带来长期影响。但是我的正念立即提
醒我调用第八步的思维纠正。我开始慢慢地重复我此刻最喜欢的对抗危害设想的口
诀：“我很安全，我很放松。”
我放慢并加深呼吸，尽可能地感受腹部的肌肉。我感到这些肌肉随着我呼吸的起伏而
放松收缩，就这样缓慢循环。随着我对呼吸的关注，这个循环逐渐变得更加流畅。
大约50次呼吸后，我感觉到一种膨胀的疲惫感像墨水一样弥漫了全身。我的肠胃瞬间
重新收紧，以抵御遗弃抑郁那种可怕的死一般的感受。我向这种感觉投降了。因为我知道
这种紧绷的感觉是恐惧，它很快就会演变成大吼的内在批判者，指责我要迟到了。内在批
判者发出“如果你快点就能做到”的警告，并开始诱惑我做出逃反应，但我对内在批判者说
了“不”。
我保持着这种死一般、疲惫不堪、毫无生气的感觉，并试图更多地感受它、欢迎它。
我感觉到自己开始与这种抑郁的感觉融为一体。由于我长久以来的练习卓有成效，所以这
种抑郁感开始逐渐演变为一种不断扩大的放松感，并传遍我的全身，我的身体开始感觉像
坐在一张舒服的安乐椅上。
我看了看表，发现已经花了20分钟的“宝贵时间”。我意识到我的内在批判者正试图溜
回来，用“已经花了20分钟的宝贵时间”这句话来刺激我。但我不认同内在批判者，并切换
到重新自我父育（Refathering-self）的角色，对内在批判者进行思维纠正：“没关系的，
皮特，这都是小事。你并没有处于危险（第二步）中，而且这绝对不是什么紧急情况。”
然后，我花了一点时间来进行愤怒式的哀悼（第九步），并强化了与内化父母的界
限。“别再想伤害我了，海伦（妈妈）和查理（爸爸），你们让我害怕犯错，搞得我现在
稍有不完美就惊慌失措！”
“哦，我流泪了。这真是一种解脱。我有多少次陷在这种被驱使的紧迫感中而不知道
如何停止？”
我回到了思维矫正。“所以，就像我刚才说的，没关系的，皮特。反正你总是提前一
小时到达办公室。你完全可以抽出20分钟，在这种放松的状态下多待一会儿。你依然有时
间轻轻松松完成一切。”
这时我体验到一种胜利感，当我的来访者通过努力成功地管理和化解了闪回时，我有
时也会在他们身上见到这种胜利感。“成功了！”这一次，我打破了这个循环，被触发的逃
反应也只是一阵短暂的急躁感。
我阻止了反应循环，没有让它演变成内在批判者来谩骂我。我也没有放纵外在批判
者，没有任由它控制我，把没洗碗碟的过失归咎于妻子。我选择与抑郁同在。我绕过了羞
耻和恐惧，以前当我无法接受自己当下的状态时，曾无数次卡在它们之中。我以前觉得自
己就像一艘废弃的沉船，海伦和查理每时每刻都在遗弃我，但我现在拒绝把自己视作沉
船，并不再遗弃自己。
我也很高兴地告诉大家，我现在经常做饭，而且很少被触发闪回了。我甚至变得很喜
欢自己做饭，已经很少去饭店吃饭了。
</tw-passagedata><tw-passagedata pid="124" name="第十三章 通过关系来治愈遗弃创伤" tags="" position="34775,2525" size="100,100">@第十三章 通过关系来治愈遗弃创伤
我曾为指导CPTSD治疗师写过一篇专业文章，本章就改编自那篇文章。我在本章的
许多部分都保留了那篇文章的基本观点，希望能帮助你建立对治疗师的合理期望。
另外，本章中有一部分内容是关于如何寻找治疗师的。我希望这些信息能帮到你，让
你知道在找治疗师时应该注意哪些方面，问一些什么问题。
最后，如果你还没有准备好找治疗师，我在本章的最后介绍了如何与朋友建立相互咨
询的关系。如果这也无法实现的话，你还可以在一些网络论坛上与其他分享疗愈历程的人
交流。

[[心理治疗的关系维度]]
[[CPTSD中的关系型治疗]]
[[共情]]
[[真诚地展现脆弱：“真实的关系造就健康的关系”]]

[[对话性]]

[[合作型关系的修复]]

[[寻找治疗师]]
[[寻找线上或线下支持团体]]
[[互助咨询]]</tw-passagedata><tw-passagedata pid="125" name="心理治疗的关系维度" tags="" position="33525,4175" size="100,100">@心理治疗的关系维度
许多CPTSD幸存者从未拥有过“足够安全”的关系。若要治愈依恋障碍，通常需要与治
疗师、伴侣或值得信赖的朋友进行修复性的关系体验，而这些人需要有这样一种能力，即
怀着同情与自己的痛苦和不安感受共处。他们必须能够自如地感受和表达自己的悲伤、愤
怒、恐惧、羞耻和抑郁。
当治疗师具有这种水平的情绪智力时，他就可以引导来访者逐渐放下自动排斥自我感
受的习惯。这也有助于来访者避免迷失在上一章介绍的反应循环中。具有“足够高”情绪智
力的治疗师能够与来访者进行安全、富有同情心的眼神和声音联结，能够向来访者示范如
何以接纳的心态与自己的情感同在。
丹尼尔·西格尔（Daniel Siegel）将这种能力称为情感的共同调节（Coregulation of
Affect）。此外，苏珊·沃恩的研究表明，这种情感的共同调节能够促进大脑神经回路的发
展，而大脑神经回路是代谢剧烈痛苦所必需的大脑结构。
此外，越来越多的神经科学证据表明，这一过程在生理上是通过镜像神经元完成的。
在一个测量两只猴子的神经活动的实验中，一只猴子看着另一只猴子敲开坚果，最后观察
方的神经活动会与行动方的完全相同。也许来访者学会像治疗师一样不被痛苦感受触发反
应，就是镜像神经元在起作用。
</tw-passagedata><tw-passagedata pid="126" name="CPTSD中的关系型治疗" tags="" position="33650,4175" size="100,100">@CPTSD中的关系型治疗
许多创伤学家认为，依恋障碍是CPTSD的主要症状之一。在治疗创伤幸存者过程中
的心理教育阶段，我通常会将依恋障碍描述为“由成长过程中的主要照料者经常让幸存者
感到危险而导致的后果”。他们的危险在于轻蔑的语气、严厉的手段，或更隐性的疏远和
冷漠。反复发生的虐待和忽视会使儿童习惯于生活在恐惧和交感神经系统亢奋的状态中。
这使他们很容易陷入“混杂的被遗弃感”——强烈的恐惧、羞耻感与遗弃抑郁纠缠在一起的
感觉。
如果父母不能或不愿意向孩子提供足够安全的依恋，孩子就无法将发展中的自我全身
心地交付于人。没有人能为他提供反馈、认同和指导。在遇到困难的时候，他无法向使他
感到足够安全的人寻求安慰或帮助。他不能向任何人哭泣、抗议不公，在经历伤害、错
误、意外和背叛时，也无处寻求同情。没有足够安全的人与他一起绽放光芒，一起做展示
演讲[1]；也没有人为他骄傲；甚至没有人能与他一起交流——而交流是人与人之间建立亲
密关系的最重要的基础。
我遇到不止一个来访者曾这样描述这种状态：“与妈妈说话就像给敌人提供弹药，我
说的任何话都会被用来对付我。难怪人们总是说我话不多。”
那些因CPTSD而患上依恋障碍的人，从来没有学会获得亲近感和归属感所需的沟通
技巧。当涉及与人交往时，他们往往被累人的社交焦虑所困扰。当处于CPTSD的严重发
作期时，他们还会出现社交恐惧症。
许多来我这里咨询的来访者从未有过足够安全的关系。强迫性重复促使他们在成年后
不自觉地寻找不健康的关系，这些关系重演了他们在童年时遭受照顾者虐待或遗弃的经
历。
对于许多这样的来访者来说，治疗师是他们第一次正式建立安全与关爱关系的对象。
如果我们没有足够的技能来为他们提供所需要的安全，让他们踏实地重新建立对他人的信
任感，那我们可能就是他们的最后一次尝试。
另外，在安全的关系中教来访者管理情绪闪回的方法会更有效。来访者需要对治疗师
产生足够的安全感，才能描述自己的屈辱和压抑。同时，治疗师需要有足够的关爱，才能
向来访者提供同情和平静的支持，这些是他们早年经历中所缺失的。
还有一点也很重要，治疗师需要能够接受信任突然消失的情况，并继续对这种情况进
行有效的处理，因为这是CPTSD的典型特征。创伤幸存者没有一个自主的信任“开启”挡，
而他们的信任“关闭”挡却经常在闪回中自动触发。在治疗中，治疗师必须能够反复安抚并
恢复来访者的信任。我听来访者讲过太多失望的经历，都是关于曾经的治疗师因他们无法
做到单纯的信任而对他们发火的故事。
随着我对这一点的理解越来越深刻，我越来越倾向于主体间性取向的治疗[2]，或关系
取向的治疗。也就是说，我认为来访者与我之间的高质量关系可以提供一种纠正性的情感
体验，使他们不至于一生都处于肤浅的联结中，或更糟糕的自我孤立和疏离中。
此外，我注意到，如果来访者没有与我建立起适度的信任，那么他们对我的指导的接
受度就会受到严重影响，而我的共情所起到的改善作用也会大打折扣。
因此，后文将描述建立关系的四个关键品质，我相信这些品质对于培养信任及随后的
关系型疗愈是必不可少的。这四个关键品质是共情、真诚地展现脆弱、对话性，以及合作
型关系修复。
</tw-passagedata><tw-passagedata pid="127" name="共情" tags="" position="33775,4175" size="100,100">共情
关于共情的定义，我特别喜欢海因茨·科胡特（Heinz Kohut）[3]的说法：“共情是进入
另一个人的内在体验，去思考和感觉自己的能力。”我曾经认为共情是理所当然的，但我
很遗憾地听到了太多关于在治疗中缺乏共情的故事。在这方面，我只想说，如果我们对来
访者态度生硬、缺乏共情，就会触发他们的危险感和被遗弃感，就像他们在父母那里经历
的那样。
当我足够深入地了解了来访者的经历时，无论这一经历最初看起来多么令人困惑或过
分，我都能从中找到心理上的合理之处，特别是当我认识到其中的闪回成分时。事实上，
我可以坦率地说，我从来没见过一种感觉或行为，从移情或创伤学的视角来看是不合理
的。当然，通过仔细倾听和充分引导来访者讲出自己的经验，以及使用镜像模仿和转述技
术，向来访者展示我们对他的理解，都能够加深共情。
留意自己主观的自由联想常常会增强我的共情能力，以及给予来访者情绪上准确而有
效的反馈的能力。在适当的时候，我有时会与来访者分享我的“自传式”自由联想。这样做
是为了让他知道，我对他分享的内容能够真正地感同身受。
在此分享一个例子。有一次，我的一位来访者非常尴尬地告诉我，她整个周末都待在
家里，因为她的鼻子上有一个痘痘。她为这个痘痘和她的“虚荣心”而感到羞耻。她抱怨
道：“我怎么会这么蠢，居然为这样的小事而困扰？”听到这里，我突然想起我有一次因为
嘴角起疱而取消了一个约会。当时，我也陷入了毒性羞耻感。我与她分享了这件事，告诉
她我当时的痛苦，但现在已经不会因这样的事感到羞耻了。她眼角泛泪，然后大笑起来，
她的羞耻感因为我的共情而化解了，她感到解脱。几个月后，她告诉我，她对我的信任在
那一刻迅速增强。后文我将介绍如何恰当地使用这种自我披露。
在共情的众多益处中，最大的益处可能是它能示范和教导自我同情，也被称为“自我
接纳”。在我们产生共情并接纳患者的所有经历时，来访者也能同样学会接纳自己的经
历。
</tw-passagedata><tw-passagedata pid="128" name="真诚地展现脆弱：“真实的关系造就健康的关系”" tags="" position="33900,4175" size="100,100">@真诚地展现脆弱：“真实的关系造就健康的关系”
真诚地展现脆弱是亲密关系的第二个特质。真诚地展现脆弱往往始于对来访者的情感
回应。我发现，若要促进信任并建立真正的亲密关系，对来访者的感受进行情感反馈是无
可取代的。
情感反馈要求治疗师自己能真诚地展现脆弱，并透露自己有时也会生气、悲伤、难过
和害怕。就像共情一样，示范性地展现脆弱是向来访者展示了脆弱的价值，是对他大胆展
现自己的脆弱的鼓励。
我是自己在接受治疗时吃了苦头，才意识到了治疗性的情绪表露的价值。我以前的一
位治疗师属于老派的“空白屏幕”学派。她疏远、冷淡、讳莫如深，坚守“恰到好处的挫
折”这一精神分析原则。她的治疗实际上起到了反作用，使我感到羞耻，因为我们重演了
有缺陷的孩子与完美父母的关系。
[[治疗性的情绪表露]]
[[自我表露的准则]]
[[自我情绪表露与分享类似的创伤史]]</tw-passagedata><tw-passagedata pid="129" name="治疗性的情绪表露" tags="" position="33775,4050" size="100,100">治疗性的情绪表露
值得庆幸的是，我最终意识到自己有未被解决的依恋问题，并找到了一位关系取向的
治疗师，她非常重视使用自己的脆弱和真诚的情绪，并将它们作为一种治疗工具。
她适度而适时的情绪表露帮助我瓦解了幼时为掩盖痛苦而建立的无敌外表。她说的话
对我特别有帮助，比如，“天啊，逢年过节总是很糟糕。”“我讲课的时候也会害怕。”“很
抱歉，我刚才没听到你说了什么。因为今天下午要看牙医，我感到很焦虑，所以有点分心
了。”“你母亲对你如此刻薄，我感到很难过。”“你被父母如此霸凌，这让我很生气。”
我的治疗师用实际行动示范了愤怒、悲伤、恐惧和抑郁是能够被健康表达的情绪，这
帮助我摆脱了压抑痛苦的情绪完美主义。在她的帮助下，我学会了不再为得到爱而把自己
的情绪掩埋起来。我放弃了那套“别想了”的人生哲学，拥抱了脆弱这一最终能与人亲近的
情绪。
我和许多幸存者都需要这样的示范，以便从恐惧（害怕因为感觉难过和烦躁而被攻
击、羞辱或遗弃）中走出来。为了放下获得永恒幸福的西西弗斯[4]式救赎幻想，我需要体
会到自己身上所有不光鲜的部分都能被他人接纳。看到我的治疗师对自己的不快乐感到自
在并能欣然接受，最终使我相信，她真的不会厌恶我的不快乐。
治疗师审慎地使用自我情绪表露，有助于来访者走出情绪完美主义这个滑坡谬误般
的、充满羞耻感的陷阱。为了鼓励来访者更加接纳自我情绪，我也会说一些自我表露的
话，比如，“我对发生在你身上的事情感到非常难过。”“我对你被困在这样一个糟糕的家
庭里感到非常生气。”“当我暂时感到困惑，不知道该说什么或做什么时，我会……”“当我
感到羞耻时，我会……”“当有东西引发我的恐惧时，我会……”“当我的内在批判者反应过
度时，我会提醒自己只需要做一个‘足够好的人’。”
自我情绪表露是我治疗工作的基本工具。当遇到被教导“要恨自己”的来访者时，我会
反复表达自己真心的愤慨。久而久之，这往往能唤醒来访者的本能，让他也对这种悲剧感
到愤怒。这让他开始有能力对抗内在批判者，并把情绪投入到进行健康的自我拥护上。
此外，我还会反复用共情和慈悲去回应来访者的痛苦。一段时间后，这通常会唤醒来
访者的自我同情能力。当他处于闪回或其他痛苦的生活境况时，他会逐渐学会自我安慰，
并越来越少地屈服于自我憎恶、自我失望和自我遗弃的内心折磨。
我从过去的来访者那里得到的一致反馈是，我这样的反应（特别是那些将恐惧和抑郁
正常化的反应）极大地帮助他们破除了完美主义，并重启了他们自我同情和自我接纳的能
力。
</tw-passagedata><tw-passagedata pid="130" name="自我表露的准则" tags="" position="33900,4050" size="100,100">@自我表露的准则
我们可以依据什么准则来确保自我表露是审慎而具有治疗性的？以下五个原则帮我以
治疗为目的进行自我表露，并避免了无意识地分享自己自恋的满足。
第一，我很少进行自我表露。
第二，我的表露主要是为了促进建立关系中的安全感和信任感。因此，我表露脆弱是
为了正常化、去羞耻化那些在人类生活中不可避免的、必然的不完美。例如，我们都会犯
错，都会遭受痛苦、经历困惑等。
第三，我不分享那些还处于原始状态、未被整合的脆弱。
第四，我从不会为了解决自己的问题而自我表露，也不会为了满足自己的口头宣泄或
自恋需求而进行表露。
第五，虽然当来访者试图关注或安抚我的脆弱时，我可能会表示感激或感动，但我从
不会接受这份给予。我会温柔地感谢他们的关心，提醒他们治疗是以来访者为中心的，并
让他们知道我有自己的外部支持网络。
</tw-passagedata><tw-passagedata pid="131" name="自我情绪表露与分享类似的创伤史" tags="" position="34025,4050" size="100,100">@自我情绪表露与分享类似的创伤史
许多来访者之所以来找我咨询，是因为读了我那本带有自传性质的、从不健全家庭中
康复的书，所以有时我无须再披露我过去的创伤。但这也让我认识到这种披露在治愈羞耻
感和培养希望方面是多么有力。来访者们总是说，是我那脆弱又实在的故事（我如何疗愈
父母的虐待和忽视带来的创伤）使他们有勇气投身于漫长而艰难的疗愈之旅。
现在，不管来访者是否读过我的书，我都会对适合的人审慎并有节制地分享我自己的
经验，讲述我是如何处理他们所提到的问题的。我这样做既是为了对他们进行心理教育，
也是为了示范解决问题的方法。比如我通常会说：“我也讨厌闪回。尽管我现在的闪回比
刚开始时少了很多，但回到以前那种恐惧和羞耻感中实在太可怕了。”
我有时也会说：“我真的能感受到你对内在批判者的无望和无力感。我刚开始接受治
疗时，也经常感到这种沮丧难以承受，好像越是想缩减它，却让它变得越糟。但是现在，
经过无数次重复的思维阻断和思维纠正，我的内在批判者就只剩它以前的影子而已了。”
我还会进行纯粹情绪化的自我表露。当来访者口头宣泄悲伤的经历时，我有时会允许
自己眼含泪水，对他们的痛苦表示真诚的同情。对我最有帮助的治疗师第一次对我这样做
的时候，我对她的信任有了质的飞跃。
</tw-passagedata><tw-passagedata pid="132" name="对话性" tags="" position="34400,4175" size="100,100">对话性
对话性（Dialogicality）是指两个对话者在倾诉（一种健康的自恋）和倾听（一种健
康的关系依赖）之间流畅地切换。这种对等的互动能防止任何一方趋于极端，陷入失调的
自恋或关系依赖型关系中。
对话性使对话的两者都充满活力。对话性关系与单一的能量窃取型关系形成了鲜明的
对比，后者指的是在互动中，自恋者病态地利用关系依赖者的倾听性防御来窃取能量。许
多人都十分认同我的观察，觉得倾听自恋者的独白是在耗费他们的能量。
我现在很擅长察觉这种状态，当我在一个新的社交场合突然感到疲倦时，就会意识到
自己正在与一个自恋者交谈。这种感觉与真正的互惠交流完全不同，在互惠交流中，我在
自己和同伴身上都能感受到提升——我再次怀疑这里面是否有镜像神经元的参与。
有一天，我在翻阅一本家具购物广告时，非常震惊地看到一套咖啡杯上印着“指定说
话者”（Designated Talker）和“指定倾听者”（Designated Listener）的字样。我和妻子思考
了几分钟，认为设计这套杯子的人一定是个自恋狂。我们甚至可以想象到订购这套杯子的
自恋者会把它们作为圣诞礼物送给他们最喜欢的倾听者。
在治疗过程中，对话性来源于一种团队合作方法，即治疗师与来访者共同就后者的问
题和顾虑进行头脑风暴。这种方法有助于充分探索来访者在生活中的矛盾、冲突和其他人
生难题。
当治疗师以“随便你接不接受”的立场提供反馈时，对话性会得到加强。对话性也意味
着相互尊重的关系。它与传统精神分析疗法那种“空白屏幕”的中立和克制形成鲜明对
比，后者经常重演来访者童年时经历的言语忽视或情感忽视。
我认为克制通常会使来访者闪回到被遗弃的感觉中，从而引发他们退缩到“安全”的肤
浅表露，变得日益沉默，或过早地逃离治疗。
[[满足健康的自恋需求]]
[[对话性中的心理教育]]
[[对话性与4F反应类型]]</tw-passagedata><tw-passagedata pid="133" name="满足健康的自恋需求" tags="" position="34250,4025" size="100,100">@满足健康的自恋需求
尽管如此，在治疗的早期阶段，大量应用对话性往往并不合适。尤其是当来访者的正
常自恋需求从未得到满足，并且仍处于发展停滞状态时。在这种情况下，来访者需要被大
量倾听。他们需要通过自发的自我表达，去发现自己感受、需求、偏好和观点的本质。
有些来访者的自我表达能力遭到了照料者的严重摧毁，所以他们需要花大量时间，将
重心放在关注自我的言语探索上。不然的话，未形成的健康自我就没有空间成长和摆脱内
在批判者，而其健康的自我意识会继续被禁锢在过强的超我霸权之下。
然而，这并不意味着治疗师退至极端的倾听中会对来访者有益。大多数来访者若能从
治疗师那里听到真实或“私人”的对话，哪怕是第一次面谈，也能从中受益。这有助于帮助
来访者克服在“来访者在明（被看），治疗师在暗（隐形）”这一状态中可能产生的羞耻
感：当一方展现出脆弱而另一方没有时，非常容易让自我表露的那一方产生羞耻感。这也
可能会使来访者困在闪回中，重现童年时的情景——脆弱的孩子被看似毫不脆弱的父母一
再地拒绝。因此，我的许多同事认为团体治疗对治愈羞耻感特别有效，因为它通过创造
出“不只是一个人在冒险展现脆弱”的环境，来纠正这种不平衡。
在这方面，值得一提的是大约15年前针对加州治疗师的一项大型调查。该调查是关于
这些治疗师的治疗偏好的，超过90%的人强调，他们不想成为一个“空白屏幕”式的治疗
师，而是想要做一个偶尔提供观点和建议的治疗师。
25年来，我会在第一次面谈时例行询问来访者：“根据你以前接受治疗的经验，你希
望我们在治疗过程中做些什么、不做什么？”来访者的回答常常与治疗师在调查中的回答
一致。
此外，来访者还经常给出的答案是“我不想要一直说个不停的治疗师”。许多人的原话
是：“我完全插不上话！”有许多已经取得治疗师资格的自恋者，把已经患有关系依赖症的
来访者变成了自己的倾听接收器。我多么希望我们的资格测试能够识别出这些人，并取消
他们的执照。这些人是“空白屏幕”治疗师阴暗的极端对立面。
</tw-passagedata><tw-passagedata pid="134" name="对话性中的心理教育" tags="" position="34375,4025" size="100,100">@对话性中的心理教育
经验告诉我，遭受童年创伤的幸存者通常会从有关CPTSD的心理教育中受益。当幸
存者了解了CPTSD疗愈过程的全貌，他们会更积极地参与到疗愈的自助实践中。这也在
总体上增强了他们的希望，使他们全面地投入到治疗过程中。我有时会想，教练指导
（Coaching）变得越来越流行，是否是为了应对各种传统形式的“治疗性忽视”？
最糟糕的“治疗性忽视”类型之一，是治疗师未能注意到，或未能挑战来访者对自己持
续的、憎恨式的谩骂。我认为，这相当于默许了这种谩骂，默默地与来访者的内在批判者
串通一气。
也许治疗时有所保留和节制的习惯来源于西方家庭常见的“父亲缺席”现象。可能传统
的心理治疗过分强调倾听和无条件的爱这些母爱原则，而忽视了鼓励和指导这些父爱原
则，而这些恰是教练所擅长的。
当然，过度的教练指导就和过多的倾听一样，会起到反作用，造成治疗关系的不平
衡。它会干扰来访者的自我探索和自我发现过程，甚至可能诱使治疗师陷入自恋的陷阱，
爱上自说自话。
如果使用得当的话，教练般的指导就会是一种不可或缺的治疗工具。就像养育一个平
衡发展的孩子同时需要父爱和母爱一样，要满足依恋缺失来访者的发展需求，也同时需要
父爱原则和母爱原则。
成熟的治疗师懂得重视这两方面，并根据来访者当下的发展需要，凭直觉在这两者之
间切换。有时候，我们会用心理教育、治疗性的自我表露，以及主动的积极关注来引导来
访者，而大多数时候，我们会用接纳的态度培养来访者逐渐学会自发的自我表达和口头宣
泄。
再次强调，我认为在早期治疗和许多后续治疗阶段，倾听通常需要占主导地位。在我
进行的大多数治疗中，我大约有90%的时间是在倾听。
最后，我常常发现，治疗的最后阶段往往会显现出越来越高的对话性，即倾诉和倾听
之间更具有一种平衡的流动性。这种对话的互惠是健康亲密关系的关键特征。此外，成功
的治疗会提高来访者的互动能力，帮助来访者在外部世界建立更健康的关系。
</tw-passagedata><tw-passagedata pid="135" name="对话性与4F反应类型" tags="" position="34500,4025" size="100,100">@对话性与4F反应类型
由于童年被遗弃的经历和后来在关系中的强迫性重复，许多幸存者都极度渴望被倾
听。然而，不同4F反应类型的人在治疗过程中的对话性需求区别很大。
讨好（关系依赖）类型的人在童年时的求生方式是成为父母倾诉时的垃圾桶或哭泣
时的肩膀。在治疗过程中，他们可能会使用倾听性防御来鼓励治疗师说很多话，甚至可能
让粗心大意的治疗师开启自恋的独白。
僵（解离）类型的人很早就学会了在沉默的伪装中寻求安全，他们往往需要大量的
鼓励来发掘和谈论自己的内在经验。心理教育可以帮他们了解到，自己健康的自恋表达需
求从未在家庭中得到满足。
此外，僵类型的人在努力学习如何谈论自己的过程中，很容易迷失在肤浅的、几乎无
关的自由联想中。刚开始时这当然需要被接纳，但最终我们必须帮他意识到，通过阐述无
尽的幻想和梦境来逃离当下的真实感受，是解离性防御的主要表现。
僵类型的人需要了解，情感疏离的谈话是一种始于童年的旧习惯，培养这种习惯是为
了能够使自己悬浮在未被处理的痛苦之上。正因为如此，我们必须反复引导他们感受自己
的内心，学会表达最重要的困扰。
战（自恋）类型的人在开始治疗时往往习惯于占据舞台的中心，通常会用谈话性防
御来回避真正的亲密关系。对于这类人来说，谈话治疗实际上是适得其反的，因为在谈话
治疗中滔滔不绝会加剧他们的特权感。如果治疗师一直配合扮演倾听者的角色，就会加强
他们过度控制谈话的防御机制，而这种防御会破坏亲密关系。作为治疗师，我们或早或晚
都必须把自己置入这段关系中，帮助他们学会倾听。
写到这里，我想起了自己在实习时遇到的一位来访者哈里。我在谈话治疗中长达50分 钟的不间断倾听成了他在关系中的新标准和新期望。于是，他本来对妻子仅存的些许倾听
能力都消失了。后来我从他妻子的语音留言中得知，治疗让他变得更加恶劣，让她更加难
以忍受，我为此感到很内疚。然而，几年后另一位来访者告诉我，哈里的妻子最终对这
种“治疗性”的变化感到高兴，这使我感到了一些宽慰。原来，她的丈夫越来越以自我为中
心，而这对她来说是最后一根稻草，让她终于如释重负地甩掉了他。
如果治疗师自己属于讨好类型的人，那他可能会躲在倾听或引导对方说话的防御中，
以避免一项可怕的工作，即逐渐深入到关系中并促使其发展出对话性。如果我们不推动来
访者进行互动，来访者就不会康复。关于如何处理这个问题，请看下一节。
逃（强迫）类型的人有时会表现得比其他类型更具对话性。然而，就像僵类型的人
一样，他们可能会执着于“安全”的抽象问题，而与自己深层次的问题相去甚远。因此，治
疗师要引导他们进入更深层次的、基于情绪的问题，以帮助他们学习进行更能增进亲密关
系的对话。否则，逃类型的人可能会一直受困并挣扎于对表面忧虑的纠结中，而这些忧虑
不过是一种左脑解离，想要远离自身被压抑的痛苦。
需要注意的是，所有4F反应类型的人都使用左脑解离或右脑解离来避免感受自己内
心的情绪和哀悼他们的童年损失。建立对话性可以帮他们发现自己未被哀悼的伤痛，并进
行口头和情绪宣泄。
</tw-passagedata><tw-passagedata pid="136" name="合作型关系的修复" tags="" position="34900,4175" size="100,100">合作型关系的修复
合作型关系的修复是通过成功解决冲突，使关系恢复并变得更加紧密的过程。每一
段实质的关系都必然会出现不和谐和不满意的时期。当分歧暂时破坏了安全联结的感觉
时，我们需要学习如何恢复亲密关系。
我相信大多数人仔细想一想，都会意识到他们最好的朋友是那些与他们发生过冲突并
找到方法化解的人。一旦友谊经受住了伤人的不和谐，通常就意味着它已经度过了“酒肉
朋友”的关系阶段。
在我写这一章时，我儿子一反常态地在学校发生了冲突。在三年级的课间休息时，他
的两个好朋友一反常态地开始取笑他，我儿子在他们说个没完时推了他俩。最后他们三个
都被带到了校长办公室。校长是一位严格但特别睿智、和善的女士。我儿子通过武力解决
冲突的违纪行为，被判定为严重违反学校纪律，但他的朋友们也要为自己的行为负责，并
接受了不能取笑他人的教育。
我儿子之前很少被惩罚，因此大哭了一场。后来他认同了处罚的公平性，利用一天的
课间休息时间，给他的朋友们写了道歉信。两天后，我问他现在和那两个朋友之间的关系
怎么样了。他带着惊讶和喜悦的表情告诉我：“爸爸，这真的很好笑。现在我们的关系比
以前更好了。”
关系修复可能是治疗师所能示范的最具改变性、最有助于建立亲密关系的过程。我指
导这一过程所采取的视角是，认识到任何误解或冲突通常都是双方共同造成的。因此，修
复关系通常需要一个相互尊重的对话过程。但也有例外情况，包括霸凌型自恋者挑起的不
愉快，及其寻找替罪羊的行为。在这些情况下，自恋者是完全的过错方。有些关系依赖型
来访者会向霸凌的父母道歉，好像是他们让父母虐待了自己一样，我经常为他们感到非常
难过。
在较为常见的矛盾中，我经常通过两个连续的干预措施来启动修复过程。首先，我会
指出矛盾（比如我会说“我觉得我可能误解你了”）。其次，我会描述我认为自己对于这次
误解的责任，以此来示范如何展示自己的脆弱。
一个简短的例子是：“我觉得我刚才可能有些说教、累了、不专心、不耐烦或被我自
己的移情触发了闪回。”承担起自己在冲突中的责任，能表明关系中出现失望是正常现
象，还有助于解构外在批判者的一种观念，即关系必须是完美的。同时，这也示范了一个
建设性的冲突解决方法，渐渐地会使大多数来访者有兴趣探索自己在冲突中的责任。这是
一项宝贵的技能，他们之后可以把这一技能运用到治疗以外的关系中。
不难预料，战类型的人是4F反应类型中最难以合作的，也是最不可能在冲突中承担
责任的人群。基于这一原因，极端的战类型（如被诊断为自恋型人格障碍）的人长期以来
在传统精神分析中被认为是无法治愈的。
至于那些不那么极端的战类型，我有时能成功地对他们进行心理教育，使他们了解自
己是如何习得控制性防御的。然后我会试图帮助他们看到自己为控制欲付出了多少代价。
最重要的代价是亲密关系饥渴（Intimacy-Starvation）。无论他们是否能意识到，他们都
渴望得到他人的温暖，但他们无法从被他们控制的人那里得到这种温暖。这是因为战类型
的受害者们太害怕他们，因而无法放松地给战类型的人带去真正温暖的感觉。
最后，我认为来访者过早终止治疗的一个最常见原因，是他们在治疗中逐渐积累了很
多不满情绪，但没有足够的安全感来提出或谈论这些不满。由于个人或伴侣双方无法安全
地解决分歧和冲突，致使各种有前景的关系枯萎和死亡，这是多么遗憾的事情啊。如果你
确有此类困扰，请参阅第十六章的四号工具箱，其中列出了许多实用的化解冲突的工具。
[[从遗弃到亲密：一个案例研究]]
[[赢得的安全型依恋]]
[[将患者从内在批判者手中拯救出来]]</tw-passagedata><tw-passagedata pid="137" name="从遗弃到亲密：一个案例研究" tags="" position="34775,4050" size="100,100">@从遗弃到亲密：一个案例研究
我遇到过一位可爱的僵-讨好类型的来访者，名叫弗兰克。他在童年时遭受了严重的
情感遗弃。他的父母都是工作狂，在家庭中极其缺位。作为五个孩子中最小的一个，弗兰
克在和兄弟姐妹竞争父母仅有的些许照顾时，总是居于末位。不幸的是，他的成年生活重
演了他童年时的关系贫乏。
童年的创伤使弗兰克极易被触发至退缩或自我孤立的状态。他从来没有体验过长久的
关系。然而，由于我们在治疗过程中的长期合作，他变得更有动力去寻求一段关系，最后
成功地交往了一位健康且能够陪伴他的伴侣。在他们关系的头六个月，我的指导和伴侣的
善良天性使他能更多地展示自己，而他在与和她的关系中越来越多地感到放松和舒适。然
而，当他接受她的同居要求后，他又开始焦虑，并且难以隐藏自己反复出现的情绪闪回。
他比从前更加确信，他的恐惧、羞耻和抑郁的感觉是他众多缺陷中最致命的。
当我们在治疗中处理他的这个认知时，他回想起小时候有很多次，他最微小的低落都
会引发他母亲躲到书房里。他发现，他母亲少有的陪他的时间，是他偶尔能让母亲高兴的
时候。于是他坚信，只有他能让别人愉快时，他才能被社会接纳。他伤感又尴尬地承
认：“皮特，这对我来说很难，我不是一个有意思的人。”
他的内心深处被灌输了一种关系依赖型的防御，即永远保持愉快和可亲。他无法摆脱
这种恐惧，即如果他不够积极向上，他的新伴侣就会厌恶并抛弃他。他说他在家中的闪回
次数增加了。有时他感到亟须隔离和躲藏。他的僵反应常常被激活，以致他越来越多地对
伴侣有所保留，陷入沉默。他知道自己太过逃避，沉溺于玩电脑、过度睡眠，以及看电视
体育节目，但他停不下来。
在闪回最为强烈的时期，他的恐惧和自我厌恶变得非常强烈，以致他找了各种借口来
离开家。他被困在再次单身的想法和幻想中，他的内在批判者正在赢得这场战斗。弗兰克
确信伴侣会像母亲一样对他的情绪感到厌恶。他几乎真的要逃跑了。他准备搬出去，就像
他在前几段关系的短暂热恋期结束时开始疏远对方一样。
我们通过了很多次的面谈来处理这些让他回到最初遗弃经历的情绪闪回。他更深刻地
理解到，沉默和保留是正在经历闪回的迹象。于是他决定在这些时刻重读并使用闪回管理
的十三个步骤。
在我的鼓励和温和的推动下，他比以往任何时候都更深刻地哀悼了自己最初的被遗弃
经历。他一次又一次地对抗着内在批判者，不让它把母亲的影子投射到伴侣身上。
同时，我鼓励弗兰克更多地向伴侣展现脆弱，并在与我进行的角色扮演中加以练习。
在所有这些治疗的鼓励下，他开始与伴侣谈论自己的CPTSD。她是一个心地善良的人，
以同情和支持回应了他。这最终促使他表露了自己的情绪，他觉得展现脆弱的谈话使他感
到更加恐惧和羞耻。但令他感到释然的是，她不仅能与他共情，而且很感谢他向自己展现
了脆弱。她告诉他，他的脆弱使她更有安全感去分享她自己更深层的脆弱。他告诉我这些
进展时，流下了感恩的泪水，我也同情地眼含欣慰的泪水。
弗兰克在几个月后取得了疗愈过程中的最大成就，他终于鼓足勇气告诉伴侣自己在抑
郁时的体验。这一突破进一步增强了他们的亲密感，他们的爱发展成为更有深度的亲密关
系。只有当人们感到足够安全，可以无话不谈时，才能拥有这种亲密感。
随着弗兰克越来越善于展现脆弱，他成功与伴侣建立了不可替代的亲密关系，这种亲
密关系来自相互同情。在接下来的一年里，他和未来将成为他妻子的女友成了彼此可以口
头宣泄的可靠对象，弗兰克甚至不再需要我的治疗了。
</tw-passagedata><tw-passagedata pid="138" name="赢得的安全型依恋" tags="" position="34900,4050" size="100,100">赢得的安全型依恋
在治疗中，来访者若能学会在感到痛苦的同时进行交流，保持人际接触，那就能取得
更大的收获。这会逐渐让他明白，无论他感受或体验到了什么，他都是能被接纳且有价值
的。
随着幸存者更深刻地认识到闪回是对不健全童年的正常反应，他们的羞耻感就会开始
消解，而这会缓解他们担心自己被别人视为有缺陷的人的恐惧。同时，他们也会减少在闪
回时孤立自己或拒绝他人的习惯。
赢得的安全型依恋是一种近年才被认识到的健康依恋类别。许多依恋治疗师认为，有
效的治疗可以帮助患者“赢得”至少一段真正的亲密关系。赢得的安全型依恋属于本书中所
讨论的那种足够好且具有丰富亲密感的依恋。
我认为本章所论述的原则是构建赢得的安全型依恋的关键。良好的治疗可以成为一种
亲密关系的范本，促使我们在行动上倾向于采用能建立亲密关系的行为，并加以练习。来
访者与治疗师的联结可以成为一种过渡性的赢得的安全型依恋，而这会让来访者在治疗
之外与他人也能建立赢得的安全型依恋。我曾多次在康复的来访者身上看到这种效果，同
时我非常感恩地告诉大家，我自己的治疗最后也取得了这样的效果。
</tw-passagedata><tw-passagedata pid="139" name="将患者从内在批判者手中拯救出来" tags="" position="35025,4050" size="100,100">@将患者从内在批判者手中拯救出来
在许多心理治疗团体（如戒酒团体、关系依赖症团体、酗酒者成年子女康复协会）
中，“拯救”这个词及其所代表的内容已成为禁忌。“拯救”一词经常被非黑即白地使用，以
致任何类型的积极帮助都被病态化。但我认为，帮助幸存者走出情绪闪回的深渊是一种必
要的拯救。
实践健康拯救的关键在于对抗内在批判者。在我看来，当我把来访者从内在批判者
（内化的父母）那里“拯救”出来的时候，我是在帮来访者满足童年时未被满足的被拯救需
求。这是一个从没有人满足过的需求。这个孩子没能从伤害他的父亲（或母亲）那里被拯
救出来，这意味着他的母亲（或父亲）亲戚、邻居或老师的可怕忽视，他们忽视了这个孩
子被虐待至“枯萎”的迹象。
几十年的创伤治疗工作，使我的内心无法在别人遭到内在批判者攻击时保持沉默。在
我看来，沉默就等同于默许。当来访者用内化的父母的声音虐待自己时，我无法静静地坐
着而不进行干预。
由于我自己第一次接受长期精神分析治疗的经历非常失败，所以我更有动力去挑战来
访者的内在批判者。我的“空白屏幕”式治疗师任由我不断用自我憎恨和自我厌恶来攻击自
己，从未指出我可以而且应该挑战这种“反自我”的行为。加州大学旧金山分校的创伤专家
哈维·佩斯金（Harvey Peskin）称这是对儿童创伤的失败见证。
我现在会大声挑战内在批判者的谎言和诽谤，并试图帮助来访者走出被内在批判者推
入的恐惧和羞耻的深渊。
我花了一段时间才突破了早期训练灌输给我的关于“拯救”的不健康的内疚感。不过，
现在的我有时仍会感到内疚，但这是因为我的退缩让内在批判者偶尔占据了上风，虐待了
我的朋友或患者。这种内疚感实际上是健康的情绪智力，它来自我的同理心，是挑战内在
批判者的正确判断。在这种时候，如果我不提醒对方注意他在用父母的霸凌伤害自己，我
就会觉得自己是一个失职的人和治疗师。
许多成年人在孩子的成长过程中没有意识到自己在与孩子内化的批判性父母共谋，而
值得庆幸的是，我不会再那样了。如果一个成年人在目睹孩子受到破坏性的批评时不提出
抗议，他就成了沉默的帮凶。孩子会被迫认为蔑视是正常的、是可以接受的。而目睹这一
切的成年人放弃了自己的社会责任，未能保护孩子不受父母虐待。
我指出幸存者父母的伤害行为其实是在唤醒他发展停滞的自我保护需求。我向他示
范，他应该受到保护，而且他现在可以拒绝在心理层面效仿父母的虐待。这最终鼓励了大
多数患者摆脱内在批判者，并削弱了将攻击性的父母内化为内在批判者的过程。
我还注意到，如果童年时有人帮助幸存者意识到遭受创伤不是他们的错，那么情况会
大有不同。如果有一个成年见证者充分谴责幸存者所经历的伤害，大多数人就不会发展出
如此严重的、自我毁灭性的内在批判者。通常这样的人物是父母温柔的那一方、开明的兄
长或姐姐、亲戚、老师或和善的邻居。
而我自己的情况是，小时候祖母住在我家，我能感受到她对我的爱，但她未能使我明
白，错的是我那刻薄愤怒的父母，而不是我。这样的情况持续了将近20年。现在回想起
来，她的忽视让我相信自己活该受到虐待，并将父母的蔑视演变成了自我厌恶。
</tw-passagedata><tw-passagedata pid="140" name="寻找治疗师" tags="" position="35400,4175" size="100,100">寻找治疗师
在寻找治疗师之前，请先阅读以下关于面试治疗师的建议。
与治疗师面谈的目的，是确认备选的治疗师是否接受过规范化训练，并且愿意在你描
述的层面上开展治疗工作。如果可能的话，我建议至少与三位治疗师进行试谈，以确定他
们的治疗取向是否与我之前描述的方法足够兼容。
一个合适的治疗师会非常乐意回答你关于他们治疗取向的问题，并通常愿意在安排会
面之前与你在电话中大致交谈至少5分钟。如果治疗师以冷漠、批评或羞辱的方式回应
你，我建议你立即把他从名单上划掉，接着寻找其他治疗师。
最后需要注意的是，虽然有许多治疗师有心理治疗的执业证书，但自己没有接受过治
疗（或督导），而我的经验是，这类治疗师很少能指导来访者进行深度的CPTSD康复。
我认为询问备选的治疗师自己是否接受过治疗（或督导）是合适的。我希望他至少能回
答“接受过”，并且认为有帮助。最理想的情况是，治疗师愿意透露他们也曾处理过自己的
原生家庭问题。
如果你居住的城市不算特别小，并且你坚持寻找，那么我想你找到一位“足够好”的治
疗师的机会是很大的。祝你成功找到合适的治疗师。
</tw-passagedata><tw-passagedata pid="141" name="寻找线上或线下支持团体" tags="" position="35525,4175" size="100,100">@寻找线上或线下支持团体
负担不起或找不到足够有帮助的心理治疗师也没关系，有许多类型的自助团体是免费
的，而且也具有良好的治疗效果。此外，如果你正在接受治疗，参加相关的团体治疗活动
可能也会加强你的疗愈效果。
找到一个足够安全的线上或线下团体的重要准则是：如果你发现有领导者或成员通过
自恋的行为过度主导团体（如滔滔不绝的自言自语、用大量私人信息占据时间、用他人不
需要的建议压迫他人或以任何方式羞辱他人），请离开并尝试寻找其他团体。
</tw-passagedata><tw-passagedata pid="142" name="互助咨询" tags="" position="35650,4175" size="100,100">互助咨询
如果你找不到或负担不起一位“足够好”的治疗师，或想要补充现有的治疗（我和妻子
就经常互相帮助），你可以寻找一位让你有安全感的、愿意与你合作的伙伴，一起发展互
助咨询关系。
互助咨询的形式多种多样。我和妻子约定了一个简单的模式，用以建立安全和治愈的
互助咨询关系。我们已经使用这种模式很多年了，并从中受益匪浅。在此之前，我也与两
个好朋友尝试过互助咨询，并受益颇多。当然，请随意调整这个模式，以适应你们自己的
共同需求和协议。以下模式可供参考。
· 每周见面，相互提供30～60分钟的咨询。
· 先由被咨询者谈论自己的所有困扰，咨询者除了积极倾听（Active Listening）外，
不进行任何干预。
积极倾听有助于被咨询者进行充分的口头宣泄，它是基于一种无条件积极关注的态
度。咨询者可以使用非直接、非侵入性的言语反馈，让被咨询者知道你在关注他。
积极倾听包括使用诸如“嗯”“是”等回应，以及镜像模仿的方法。初级的镜像模仿是指
重复对方所说的关键词或短语，让他们知道我们在专注地倾听。而进阶的镜像模仿是指用
自己的话复述所听到的内容。不过，这只有在复述准确的情况下才有帮助。
· 最后，提出开放式的问题也是一种积极倾听的技巧，例如，“你能再进一步谈一谈
吗？”“还发生了什么？”“你对此还有其他想法和感受吗？”这类问题可能非常有帮助。
开放式的问题与有指向性的问题截然相反，后者会限制或塑造被咨询者的回答方
式。“你对此有什么想法或感觉？”比起“你对此感到不安吗？”能让人有更大的内在探索空
间，因为后者可能会被认为是一种陈述，而不是一个问题，听起来像是你在告诉对方应该
有什么感觉。
此外，不同的人需要不同程度的积极倾听。请以开放的心态给予并接受反馈，彼此了
解需要多少积极倾听。
为了建立安全感和信任感，除了做到积极倾听外，咨询者还要承诺不提供建议、批评
或任何形式的主动反馈。如果被咨询者渴望得到反馈，最好让他来决定反馈的时机、类型
和数量。反馈最好的给予方式是由对方自由决定接受与否。
除非被咨询者有明确要求，否则不要给予任何反馈。被咨询者往往会明确说明所希望
得到的反馈类型，或希望不要有任何反馈，例如，被咨询者可能会说：“我只想要口头宣
泄一下我的关系问题，但除了积极倾听之外，我不希望得到任何反馈。”而在另一个时
刻，被咨询者可能会说：“关于这件事我想得到一些反馈。我想知道我是否清楚地理解了
老板的意思。”
当有了足够的感恩之心、运气、尊重、练习和同情心，咨询者和被咨询者最终会对彼
此产生足够的信任，以致双方都同意改变模式，允许在咨询过程中的某些时刻自发地给予
反馈。但双方不要急于达到这种程度，并且应该始终保留权利，要求对方在咨询中随时或
就特定议题开启无反馈模式。比如，我和妻子可能会对对方说：“我今天只希望你积极倾
听。我想自由倾诉，探索我心中的这种焦虑感，而不需要得到任何有关它的意见。”
最后，咨询双方必须对治疗进行保密，不向他人透露咨询面谈中所说的内容。
我还建议双方在开启互助咨询关系之前，了解第十六章的四号工具箱，以及前文所介
绍的关系型疗愈的四个关键品质。
[1]展示演讲（Show and Tell）是一些国家中小学的常见活动，学生带物品，如自己
的手工作业，到学校向同学展示并介绍该物品。——编者注
[2]主体间性取向的治疗是以关系为背景来探索来访者与他人互动的特有“模式”，
而这些模式还是形成人们产生当下感受的基础，也是新的组织方式的原型。在治疗过程
中，治疗师和来访者共同营造了一个互相融合的心理系统。——编者注
[3]美国精神分析协会前会长，国际精神分析协会前副会长，西格蒙德·弗洛伊德档
案馆前副馆长。他提出并创立了精神分析自体心理学派，著有《自体的分析》（The
Analysis of The Self）等书。——编者注
[4]西西弗斯（Sisyphus）是希腊神话中的人物，因为触怒了众神而被放逐至地狱。
他被判将一块巨石推至山顶，然而巨石太沉了，总是滚回山脚。因此，他只能每天重
复“推石上山，看石滚落”这一件事，日复一日，永无止境。——编者注
</tw-passagedata><tw-passagedata pid="143" name="第十四章 原谅：从自己开始" tags="" position="34975,2525" size="100,100">@第十四章 原谅：从自己开始
本章内容改写自我于1991年11月发表在《康复》（Recovering）杂志上的一篇文章。
我之所以写这篇文章，是因为震惊于来访者们受到“要原谅并忘记”这一观念的巨大压力。
他们中的许多人会因此再度否认自己所承受的创伤，或将其“最小化”。于是，他们的内在
批判者继而也再度诋毁他们是如此不宽容，而他们的疗愈之旅则戛然而止。
在疗愈社群和许多疗愈学说中，有很多具有羞辱性、危险性而且不准确的关于原谅
的“指导”，它们教导人们必须做到彻底而永久的原谅才能康复。许多创伤性家庭的幸存者
就被这种简单化的、非黑即白的建议伤害了。
不幸的是，有些人接受了这一建议，去原谅那些他们还没有充分哀悼的虐待行为、那
些仍在发生的虐待行为，以及那些永远不该被原谅的令人发指的虐待行为，这些人往往会
发现自己的疗愈工作毫无进展。
事实上，当人过早地在认知层面决定原谅时，通常就无法实现真正的原谅。因为过早
的原谅是在模仿否认和“最小化”的防御机制，让人意识不到这是对未被处理的创伤的愤怒和痛苦。

[[真正的原谅]]
[[原谅是一种爱的感觉]]</tw-passagedata><tw-passagedata pid="144" name="真正的原谅" tags="" position="34925,2750" size="100,100">真正的原谅
真正的原谅与过早的原谅全然不同。真正的原谅大多是有效哀悼的结果，如果不进行
大量的情绪疗愈工作，再多的想法、再强的意图或信念都不能实现真正的原谅。另外，那
些不相信原谅的信念系统有时会阻碍我们获得原谅的感觉，即便在这种感觉出现时也是如
此。
关于原谅，最健康的认知态度可能是：一边进行大量的哀悼，一边允许原谅自然地出
现。这种态度若要发挥出最佳的效果，必须符合一个条件：不强迫或假借原谅的感觉，来
掩盖未被解决的伤害或愤怒。
同时，我们需要明白，某些虐待行为非常极端，对受害者造成了严重的伤害，因此根
本不应得到原谅。例如：反社会行为、有意的残害，以及以多种形式寻找替罪羊的行为。
真实的原谅会在心里产生清晰的感觉，而且通常是同情的延展。虽然同情并不总是与
原谅相同，但是同情通常产生与原谅相似的体验。当我们在充分哀悼了童年的损失之后，
偶尔会思考那些导致父母忽视或虐待我们的情有可原之处，此时我们心中会产生与同情相
似的原谅的感觉。
最常见的情有可原之处体现在以下两方面。
其一，我们的父母往往会盲目地复制他们自己被养育的方式，并用这样的方式养育我
们；
其二，他们病态的养育方式往往受到他们那个时代的社会规范和价值观的影响。
然而需要再次强调的至关重要的一点是：在充分消除由父母的虐待和遗弃造成的创伤
性影响之前，我们不要急于替他们辩解。
在考虑父母情有可原之处时，我们有时会“明白”父母在很大程度上也是受害者，因此
我们可能会为他们感到难过。当这种对父母的同情变得足够深刻时，我们会理解他们的童
年也和我们的一样糟糕和不公。这种对父母基于感受的理解有时会演变为对他们的原谅。
然而，这种对父母的原谅如果不是以自我同情为基础的，那么它就只是一种空洞的思
维运动，甚至更糟的是，它可能会极大地阻碍疗愈所需的基本愤怒训练。
过早的原谅会使我们无法告诉自己的内在小孩，他有权利为父母无情的遗弃感到愤
怒，还会阻止我们帮助内在小孩表达和释放那些旧时的愤怒情绪。
过早的原谅也会阻碍我们与自我保护本能的重新联结。幸存者可能永远不会知道，在
必要的情况下，现在的自己可以利用愤怒来阻止当下的不公。
真正的原谅是一种感受，它和其他所有感觉一样，都是短暂的。原谅的感觉从来不是
完整的，也不是永恒的，更不是一成不变的。
原谅是由人类感受的动态性决定的。我们的情绪体验是一个经常变化、无法选择且
不可预测的心理过程，没有一种情绪状态可以永久持续。尽管这很可悲，尽管我们很想否
认这一点，尽管这一直让我们感到沮丧，尽管我们受到外界的压力想要控制并选择自己的
情绪，但动态性仍然是一种人性的必然，不以我们的意志为转移。
</tw-passagedata><tw-passagedata pid="145" name="原谅是一种爱的感觉" tags="" position="35050,2750" size="100,100">@原谅是一种爱的感觉
原谅就像爱一样，是一种暂时的感觉体验。然而，当我们彻底宣泄出对过去的愤怒
时，我们就更容易感受到原谅。当我们学会通过哀悼把自己带离被遗弃的闪回时，我们就
会重新获得对世界的归属感和对世界的爱。随着我们的情绪弹性变得更成熟，失去的爱和
原谅的感觉便会踏踏实实地回归，成为我们自主选择的价值观。
因此，当我偶尔感到被亲密的对象伤害时，我可能无法立即唤起对他们的爱或原谅，
但我知道，只要经过充分的沟通和非虐待性的宣泄，我最终会重新欣赏他们。
我能原谅自己多少，就能原谅别人多少。我对别人的原谅之处，就是我自己以前感到
的痛苦之处。多年来，我因自我憎恶而感到脆弱，但现在我爱它、接纳它，对待它像对待
一只折翼的鸟。羞耻感和自我憎恶不是因我开始的，但我由衷地希望它们终结于此。我希
望别人如何对待我，我就先如何对待自己。
卡罗尔·露丝·诺克斯（Carol Ruth Knox）写过一首诗来描述爱的感受，以及它与我们
玩的捉迷藏游戏。
它来了又走，不是吗？
有时与人们有关，
与人们对待我们的方式有关，
而有时又与之无关；
有时
与月亮有关，
与个人财务有关，
与人生的问题有关，
与虚无有关，
与一切有关，
与季节、时间有关，
与我们所吃的食物有关，
与……
爱的艺术似乎不在于你爱与否（我们都以自己当下的方式去爱），而在于你是否相
信，爱的离开是有原因的，而且它会重新回来。
总是如此。
我们人类天生是爱的乐器。
（整个宇宙也是如此！）
当爱的风吹拂过我们时，
我们自然会唱起情歌。
而当没有爱的风吹来时，
虽然它让我们感到陌生
如同柳树，
爱已经到了一个空旷的地方，
再次吹满了它的风帆
它就会回来，
再一次吹过我们这些渴望已久的乐器。
我们在等待时应该做什么？
我们当然应该哭泣，
哭泣和爱一样可爱，
离开后会留下一个空洞。
我们要把爱记在心里，
当我们在疑问和怀疑中徘徊时，
我们要温柔地、慈悲地等待，
直到我们记住，
“爱总会回来。”
</tw-passagedata><tw-passagedata pid="146" name="第十六章 自助工具" tags="" position="35350,2525" size="100,100">@第十六章 自助工具
本章包含六个工具箱，每个工具箱中都有一套针对不同疗愈问题的工具。我至今仍然
非常重视这些工具，并把它们视为我自己疗愈过程中不可或缺的辅助。我经常在来访者的
疗愈之旅中适时地把这些工具列表发给他们，还会把它们分享给参加我课程的学生。我收
到了大量的正向反馈，大家都认为这些工具对疗愈有很大的帮助。
我那些疗愈进展较快的朋友和来访者都会通过自助活动来进行补充治疗。有些人会把
这些工具列表打印出来，随身携带或张贴在显眼的地方，直到牢记于心，这些人似乎在疗
愈方面有了质的飞跃。
我希望你能够充分地使用这些工具，也希望你能像我所见的许多其他人一样，从中获
得疗愈的支持。
下面是一首我在某面涂鸦墙上发现的诗。它的署名是“汉克”，也就是查尔斯·布考斯
基（Charles Bukowski）的昵称。
你的人生就是你的人生，
不要让它陷入困境。
留心注意。
总会有出路。
某处，总会有一道光。
也许，它没有太多的光亮，但是
它足以打败黑暗。
留心注意。
诸神会给你许多机会。
了解它们，抓住它们。
你无法战胜死亡，但是
有时，你却能战胜生命中的绝望。
你越是不断尝试
就有越多的光明到来。
你的人生就是你的人生。
当你拥有，你才会明白。
你是如此了不起，
诸神也等待着
为你欢欣。
总结
总而言之，在处于以下情况时，就意味着你应当已经逐渐取得了疗愈进展，治愈了部
分来自CPTSD的多重伤害：1. 正念增加了，无意识的反应性4F行为减少了；
2. 内在批判者缩减了；
3. 大脑对自我更加友好；
4. 能够在哀悼童年的损伤的同时，培养情绪智力；5. 身体放松，心理变得更加平和
了；
6. 健康的自我（Ego）成长为了健康的自我意识；
7. 人生叙事中变得具有自我怜悯和自我肯定了；
8. 用情绪脆弱面建立起了真诚的亲密体验；
9. 获得了“足够好”的安全关系。
再次强调，康复不是一个“全或无”的状态，这条路并非一帆风顺。它是一个循序渐进
的过程，体现为在上述方面不断获得成长，尤其是闪回频率、强度的降低和持续时间的减
少。
我希望你很快就能看到第四章所描述的“黑暗中的曙光”。我希望你能感觉到自己的发
展停滞问题正在得到解决。我希望你会注意到你对自己越来越友善，并为自己美丽的独特
性而感到自豪。我希望你能如自己所需要的那样对自己忠诚，以感到自己安全地归属于这
个世界。我还希望情绪智力的提高能给你带来至少一段亲密关系，让你可以从中不断发现
安全且多维度的关系的益处。


[[一号工具箱：康复意图建议]]
[[二号工具箱：公平与亲密的指导原则]]
[[三号工具箱：针对内在批判者常见攻击的内在反击建议]]
[[四号工具箱：有爱地化解冲突]]

[[五号工具箱：感恩]]

[[六号工具箱：CPTSD疗愈最基本的原则]]</tw-passagedata><tw-passagedata pid="147" name="一号工具箱：康复意图建议" tags="" position="34475,4825" size="100,100">@一号工具箱：康复意图建议
这里列举了一些正常和安全的愿望和需求，它们是用来提升精神、心灵、情绪和身体
能量的。请关注最吸引你的那些方面，跳过那些对你来说不合适或者你还没有准备好的方
面。
1. 我想与自己建立一种更加持续的、充满爱和接纳的关系；我想增强自我接纳能
力。
2. 我想学着做自己最好的朋友。
3. 我想在生活中建立基于爱、尊重、公平和相互支持的关系。
4. 我想实现完全的、不受约束的自我表达。
5. 我想尽可能保持身体健康。
6. 我想实现热情与平静的平衡。
7. 我想吸引有爱的朋友和社群。
8. 我想逐渐摆脱毒性羞耻感。
9. 我想摆脱不必要的恐惧。
10. 我想做有回报且充实的工作。
11. 我想要思想、精神、灵魂和身体获得充分的平静。
12. 我想提升玩乐和享受的能力。
13. 我想在生活中为欣赏美和自然留出足够的空间。
14. 我希望有足够的物质和金钱。
15. 我希望得到足够的帮助（来自自己或他人），以获得我需要的东西。
16. 我希望感受到来自大自然的爱、馈赠和祝福。
17. 我希望在工作、休息和娱乐之间取得平衡。
18. 我希望在稳定和变化之间取得平衡。
19. 我希望在有爱的互动和健康的自给自足之间取得平衡。
20. 我想要笑与泪平衡的、完整的情感表达。
21. 我想获得意义感和成就感。
22. 我想通过有效且非虐待性的方式来处理愤怒。
23. 我希望所有人都能获得这一切。
</tw-passagedata><tw-passagedata pid="148" name="二号工具箱：公平与亲密的指导原则" tags="" position="34600,4825" size="100,100">@二号工具箱：公平与亲密的指导原则
1. 我有权受到尊重。
2. 我有权说不。
3. 我有权犯错。
4. 我有权拒绝不请自来的忠告或反馈。
5. 我有权为寻求改变而协商。
6. 我有权改变我的想法或计划。
7. 我有权改变我的状况或行动方案。
8. 我有权拥有自己的感受、信仰、观点、喜好等。
9. 我有权反抗讽刺、破坏性的批评或不公平的待遇。
10. 我有权感到愤怒，并以非虐待性的方式来表达愤怒。
11. 我有权拒绝为别人的问题承担责任。
12. 我有权拒绝为任何人的不良行为承担责任。
13. 我有权感到矛盾，并且偶尔表现得不一致。
14. 我有权玩耍、浪费时间，不总是追求高效。
15. 我有权偶尔像个孩子，表现得不成熟。
16. 我有权抱怨生活中的不公平和不公正。
17. 我有权偶尔在安全的前提下不理智。
18. 我有权寻求健康和相互支持的关系。
19. 我有权向朋友寻求适度的帮助和情感支持。
20. 我有权适度地抱怨和口头宣泄。
21. 我有权成长、进步和成功。
</tw-passagedata><tw-passagedata pid="149" name="三号工具箱：针对内在批判者常见攻击的内在反击建议" tags="" position="34725,4825" size="100,100">@三号工具箱：针对内在批判者常见攻击的内在反击建议
内在批判者的攻击往往无法被自我意识察觉。我们必须学会识别它们，否则就会受它
们的摆布，无法进一步缩减内在批判者。一旦我们学会识别内在批判者的攻击，简单的思
维阻断或思维替换就能成为反击内在批判者的有力工具。
内在批判者的攻击分为两类。一类是完美主义型攻击，这种攻击由毒性耻辱感推波
助澜，会导致长期的自我憎恶和自我鞭笞。第二类是设想危害型攻击，由恐惧推波助
澜，导致长期的过度警觉和焦虑。
完美主义型攻击
1. 完美主义
【思维纠正】我追求完美主义是为了在危险的家庭中获得安全和支持。完美是一
种自我迫害的幻想。我现在不需要完美就能获得安全和爱。我会放弃那些要求我做到
完美的关系。我有权犯错。犯错并不会使我成为一个“错误”。每个错误或意外都是一个
机会，让我在未得到爱的方面练习爱自己。
2. “全或无”和非黑即白思维
【思维纠正】我拒绝极端化或过于笼统的描述、判断或批评。一个意外的负面事
件并不意味着我会永远失败。用“总是”或“从不”这类语言描述我通常都有失偏颇。
3. 自我憎恨、自我厌恶和毒性羞耻感
【思维纠正】我会忠于自己，站在自己这一边。我是一个足够好的人。我拒绝谩
骂自己。我会把羞耻感转变为责备和厌恶，回击给那些羞辱我正常情感和缺点的人。
只要我没有伤害任何人，就要拒绝因正常的情绪反应（如愤怒、悲伤、恐惧和抑郁）
而受羞辱。此外，我尤其拒绝因难以完全消除自我憎恨的习惯而攻击自己。
4. 微观管理、担忧、执念、循环、过度忧虑未来
【思维纠正】我不会一遍遍地重复检查细节，不会直接下负面的结论，也不会无
休止地怀疑自己。我无法改变过去，所以我原谅自己过去犯下的所有错误。我无法保
证未来完全安全，所以我不再担忧未来可能会犯错。我不会试图控制无法控制的事
情。我不会对自己或他人进行微观管理。我会以一种“足够好”的方式工作，并接受“努
力未必总有成效”这一现实。
“请赐予我平静，去接受我无法改变的；给予我勇气，去改变我能改变的；赐予我
智慧，分辨这两者的区别。”——尼布尔的祈祷文
5. 与他人或自己最完美的时刻进行不公平或贬低性的比较
【思维纠正】我拒绝将自己与他人无端进行比较。我不会将“我的内在与他们的外
在”进行比较。我不会因为自己没有一直处于最佳状态而批判自己。在这个迫使我们一
直表现出快乐的社会中，我不会因为心情不好而对自己失望。
6. 内疚
【思维纠正】感到内疚并不意味着我有过错。我拒绝出于内疚而做出决定和选
择。有时我需要在感到内疚的同时依然照常行事。当我不可避免地无意伤害了某人
时，我会道歉、做出补偿，并停止内疚。我不会一次又一次地道歉。我不再是一个受
害者。我不会接受不公平的指责。内疚有时是伪装的恐惧，请对自己说：“我感到内疚
和害怕，但我并没有错，也没有危险。”
7. “应该”
【思维纠正】我会用“想要”这个词来代替“应该”，并且只在我觉得想要这样做时才
遵循这一点，除非我有法律、伦理或道德上的义务。
8. 精力过于旺盛、停不下来、工作狂
【思维纠正】人不是为了工作而存在的。我不需要永远保持高效。从长远来看，
当我在工作与休闲娱乐之间实现平衡时，我的效率会更高。我不会试图一直保持全力
工作的状态。我认为效率有高低波动是正常的。
9. 对自己或他人进行苛刻评判、人身攻击
【思维纠正】我不会认同童年时的霸凌者和内在批判者，我不会让他们得逞。我
拒绝攻击自己或虐待他人。应该受到批评和指责的是我那糟糕的父母，我不会把这些
批评和指责转嫁给我自己或身边的人。
“我关爱自己。我越是孤独，越是没有朋友，越是没有支持，我就得越尊重我自
己。”——《简·爱》
设想危害型攻击
10. 极端化、灾难化、疑病症
【思维纠正】我虽然感到害怕，但身边其实并不存在危险。父母并没有要惩罚
我。我不会把事情夸大。我拒绝用生活会每况愈下的设想来吓唬自己。我不会再自己
构想恐怖电影场景和灾难片情节。我不会把每一次疼痛都想象成自己快要死了。我一
切安好。
11. 负面关注
【思维纠正】我不会再过度注意和纠结于自己的缺点或生活中可能出现的问题。
我不会轻视或忽视自己的品性。现在我会关注、设想和列举自己的成就、才能和品
质，以及珍视生活给予我的许多礼物，例如自然、音乐、电影、美食、色彩、朋友、
宠物等。
12. 时间紧迫感
【思维纠正】我没有危险，不需要赶时间。除非是真正紧急的情况，否则我不会
着急。我正在学习享受以轻松的节奏进行日常活动。
13. 让人失能的表现焦虑
【思维纠正】我会提醒自己不接受任何人不公正的批评或完美主义式的期望。我
不会因为害怕批评或失败而拖延时间。我不会让恐惧左右自己的决定。
14. 总觉得自己要被攻击
【思维纠正】除非有明显的危险迹象，否则我将使用思维阻断，停止将过去的霸
凌者或内在批判者投射到别人身上。生活中的大部分人都是平和友善的。如果被少数
有敌意的人威胁，法律会保护我们。我会想起朋友的爱和支持。
</tw-passagedata><tw-passagedata pid="150" name="四号工具箱：有爱地化解冲突" tags="" position="34850,4825" size="100,100">@四号工具箱：有爱地化解冲突
以下列举的是我多年来收集的技巧和观点，以帮助伴侣们尽可能有爱地化解冲突。我
把这个工具列表分享给前来咨询的伴侣们，要求他们在家里花时间一起大声朗读，并尽可
能多地对每一项进行讨论，看看是否能将其作为处理冲突的准则。
11年前，当我刚和妻子在一起时，我们在周末旅行中花了相当多的时间逐一讨论这些
准则。我们提出了关于使用这些准则的担忧、热情、注意事项和保留意见。在随后的几年
里，我们对使用方法进行了改进，并发展出了一种针对冲突的沟通方式，帮助我们保持亲
密关系的健康和不断增进。
1. 将不可避免的冲突正常化，并为其建立一个安全的讨论平台。尽可能多地讨论
和同意这些指导准则中有用的部分。
2. 目标是为了传达信息和协商改变，而非惩罚。惩罚会破坏信任。爱可以打开彼
此的心灵。
3. 想象一下如何表达不满才最容易让对方听得进去，并用这种方式表达。
4. 在抱怨之前，先肯定对方的优点和你们之间的关系。
5. 不要指责、挖苦和人身攻击。
6. 不分析对方或读心。
7. 不打断或阻碍对方发言。
8. 要有对话性。进行短小精悍的陈述，让对方能够给予反应并转述关键点，确认
自己的观点已被对方准确听取。
9. 不剥夺对方在上述二号工具箱中所列的权利。
10. 分歧往往不是对与错的问题：两个人都可能是对的，只是意见不同而已。能接
受有时的“和而不同”。
11. 避免说“你如何如何”，而要说“我如何如何”，表达出你在遭遇不公时的感受和
体验。
12. 用具体的行为，一次解决一个问题。问问自己什么让你最受伤，从而尝试找到
最主要的不满。
13. 坚持只讨论一个议题，直到两人都觉得自己的意见被充分听取。之后再轮流提
出议题。
14. 尽可能用有爱且平静的方式提出抱怨。
15. 暂停。如果讨论变得激烈，任何一方都可以要求暂停（1分钟到24小时），只
要这一方能指定一个时间继续（具体见后文）。
16. 及时、尽可能地释放不满，不将它们积压在心中。
17. 对因没有及时探讨而累积的愤怒负责。
18. 对因其他伤害而累积的不满负责（具体见后文）。
19. 努力理解自己的不满多大程度上来自童年的虐待和忽视。
20. 努力通过有效地识别、哀悼和追回童年的损失来促进疗愈。
21. 不带有羞耻感地道歉，并尽可能地补偿。表明日后改正的意愿，解释自己的情
有可原之处（但不是找借口），证明自己并不想伤害对方。
[[关于“暂停”（第15条）]]
[[关于移情（第18、19条）]]</tw-passagedata><tw-passagedata pid="151" name="关于“暂停”（第15条）" tags="" position="34775,4700" size="100,100">@关于“暂停”（第15条）
关系破裂的两个最常见的原因是不可调和的分歧和不可弥补的伤害。如果伴侣双方知
道如何明智地使用“暂停”，就可以在很多情况下避免伤害对方。
这一点尤其适用于战类型的幸存者，他们在闪回时很容易对外在批判者失去控制，说
出破坏亲密关系的话。幸存者有必要学会识别过度反应的迹象，从而采取暂停措施，停止
批判者们的疯狂伤害。
在闪回中所说的话可能会深深地伤害对方，并削弱对方内心的信任感。如果伴侣双方
都同意，那么每当他们觉得自己的情绪被激发到无法带着爱进行交流，或者感受到对方在
闪回中具有过度的攻击性时，他们中的任何一方都可以要求暂停，这样就可以避免不必要
的对亲密关系的破坏。
暂停时间可以从1分钟到24小时不等，这取决于任何一方或双方需要多长时间才能实
现足够好的闪回管理。若要达到最佳效果，要求暂停的人应指定暂停结束的时间，这样暂
停就不会成为躲避问题的借口。
暂停也可以用来让自己独自释放累积的不满情绪。
</tw-passagedata><tw-passagedata pid="152" name="关于移情（第18、19条）" tags="" position="34900,4700" size="100,100">@关于移情（第18、19条）
在使用这个工具列表帮助伴侣们的时候，我注意到那些在解决冲突方面特别熟练的
人，是那些精于第18、19条的人。这两条与学习如何处理移情有关。
对于创伤幸存者来说，移情往往是一种闪回，我们会对伴侣做出无意识的反应，好像
他们就是我们童年时期糟糕的照料者一样。当这种情况发生时，我们会将大量未解决的童
年痛苦转移到他们身上。
一个常见的例子是，伴侣中一方轻微且合理的抱怨会引发另一方剧烈的愤怒、恐惧或
羞耻，这些情绪其实源自几十年来父母大量的拒绝和批评。另一个例子是，当一方没有说
出另一方希望听到的话时，就会激起后者的痛苦，这种痛苦来自其父母几十年的冷漠与疏
远。
我在治疗过程中见到的大多数冲突，其中90%是重新经历了过去的痛苦，10%是实际
的当前的痛苦。哈维尔·亨德里克斯（Harville Hendrix）的书籍《获得你想要的爱》
（Getting The Love You Want）是一本很好的指南，可以帮助读者治愈童年创伤，解决生
活中的冲突，同时增强亲密关系。
根据我的经验，在绝大多数成年人之间的冲突中，双方都对爱的联结的中断负有责
任。真正有疗愈效果的冲突解决方案，通常需要双方承担起各自的责任并道歉。而更深层
次的解决方案通常还需要幸存者为自己的移情而道歉。一个好的道歉大致是这样的：“我
很抱歉，我在表达不满时说了这么多指责你的话。虽然我认为我有理由不满，但我表达得
太激烈了。我很抱歉，我与你说话的时候把你当成了我那总是拒绝我的母亲。”
</tw-passagedata><tw-passagedata pid="153" name="五号工具箱：感恩" tags="" position="35125,4825" size="100,100">@五号工具箱：感恩
[[感激自己]]
[[感激他人]]</tw-passagedata><tw-passagedata pid="154" name="感激自己" tags="" position="35050,4700" size="100,100">@感激自己
以下表格是一项建立自尊的练习，幸存者最好能反复练习。试着为每个类别想出12个
答案以抵制内在批判者的“全或无”思维。如果某个答案大致上是真实的，那就把它列出
来。不过，不要在情绪闪回时做这项练习。请找一个你信任的人协助你完成这项练习。
成就
特点
善行
巅峰体验
人生中的享受
目标打算
好习惯
完成的工作
学习过的科目
克服过的困难
感恩的事
温暖的回忆
</tw-passagedata><tw-passagedata pid="155" name="感激他人" tags="" position="35175,4700" size="100,100">@感激他人
以下表格是一项破解外在批判者的练习，拒绝笼统地把所有人都想象成伤害过我们的
危险的照料者。以下表格的使用方法与上面的表格相同。
朋友（过去的和当下的）
有启发性的人
有启发性的作者
学生时代的朋友（无论现在是否还有联系）
朋友圈（过去的和当下的）
童年朋友（无论现在是否还有联系）
老师
陌生人的善意
宠物和动物
职场的朋友（过去的和当下的）
参与过的团体（过去的和当下的）
温暖的回忆
</tw-passagedata><tw-passagedata pid="156" name="六号工具箱：CPTSD疗愈最基本的原则" tags="" position="35325,4825" size="100,100">@六号工具箱：CPTSD疗愈最基本的原则
作为本书的结尾，我将再一次列出CPTSD疗愈最基本的原则，即管理情绪闪回的13
个实用步骤。请重读这些步骤，让它们深植于内心。试着体会一下，现在读到它们是否比
在第八章中第一次读到它们时更能引起你的回响？
以下列举的13个实用步骤可以帮你管理情绪闪回。（在陷入情绪闪回时请专注于加
粗部分）
1. 告诉自己：“我正在经历闪回。”闪回会把你带入一种超越时间的心理感受，使
你重新感受到童年时的无助、无望与危险。这时你要提醒自己，你所经历的感受和体
验只是过去的记忆，它们现在已经无法伤害你了。
2. 提醒自己：“虽然感到害怕，但我身边没有危险。此时此刻我很安全。”记住你
现在很安全，已经远离了过去的危险。
3. 你需要，并且有权利设定界限。提醒自己不必容忍他人的虐待。你可以自由地
离开危险的环境，并抗议不公平的行为。
4. 安慰你的内在小孩。你的内在小孩需要知道你是无条件地爱着他的，当他感到
失落和恐惧时，可以寻求你的安慰和保护。
5. 破除“闪回无休无止”的观念。你会在闪回中体验到童年时期的恐惧和遗弃感，
会觉得永无宁日，根本想象不出一个更安全的未来。但是请记住，闪回总会过去的。
6. 提醒自己现在已经拥有了成年人的身体，还有童年时不曾拥有的盟友、技能和
资源，能够保护自己（感觉渺小和脆弱是闪回的迹象）。
7. 慢慢回到身体里。恐惧会使你产生“上头”的忧虑、麻木和放空的感觉，你需要
温和地重新回到自己的身体里。
①柔和地引导身体放松：感受身体的每一个主要肌肉群，柔和地使它们放松下来
（紧张的肌肉会向大脑发送错误的危险信号）。
②慢慢地深呼吸：屏住呼吸也会向大脑传送危险信号。
③放慢速度：冲动与急躁会按下大脑的逃跑反应按钮。
④找一个安全的地方放松并舒缓自己：裹着毯子，抱着枕头或毛绒玩具，躺在床
上或衣柜里，或者洗个澡，小憩一会。
⑤感受身体中的恐惧，但不做出反应：恐惧只是你身体中的一种能量。如果你不
逃避它，它就无法伤害你。
8. 抵制内在批判者极端化、灾难化的思维。
①运用思维阻断制止内在批判者，停止其无休止地夸大危险和试图控制不可控事
情的行为。拒绝羞辱、仇恨或遗弃自己。把自我攻击的愤怒转化为对不公平的自我批
判说“不”。
②运用思维替换和思维纠正的方法，记往自己的一系列优点和成就，用来替换消
极思维。
9. 允许自己哀悼。闪回是释放过去被压抑的恐惧、伤害和遗弃感的机会。请肯定
并抚慰你内在小孩曾经的那些无助无望的感受。健康的哀悼可以把你的眼泪变成自我
同情，把你的愤怒变成自我保护。
10. 培养安全的关系并寻求支持。想要独处时，可以给自己一些独处的时间，但不
要因为羞耻感而孤立自己。感觉羞耻并不意味着你是可耻的。让你的亲密对象了解什
么是闪回，并请他们通过交谈和分享感受来帮你度过闪回阶段。
11. 学会识别触发闪回的诱因。远离那些让你感到不安全的人、地方、活动，以及
可能触发闪回的心理过程。如果诱因无法避免，可以通过练习这些管理闪回的步骤进
行预防。
12. 弄清闪回的根源。闪回是一次机会，可以让你发现、验证和治愈你过往遭受的
虐待或遗弃所带来的伤害。闪回也表明了你仍未充分满足自己的发展需求，并为你提
供动力来满足这些需求。
13. 对缓慢的康复过程要有耐心。此刻你需要时间来代谢肾上腺素，之后也需要相
当长的时间来逐渐减少闪回的强度、持续时间和次数。真正的康复是一个循序渐进的
过程（往往是前进两步就又后退一步），而非一蹴而就的救赎幻想，所以不要因为出
现闪回而自责。
</tw-passagedata><tw-passagedata pid="157" name="第十五章 阅读疗法与图书社群" tags="" position="35150,2525" size="100,100">@第十五章 阅读疗法与图书社群
阅读疗法是一个术语，它指的是一个非常真实的过程，即从你阅读的内容中得到积极
的、治疗性的影响。如前所述，阅读疗法在效果最佳时也相当于一种关系型疗愈。它可以
将你从常见的CPTSD感受（绝望的自我孤立和疏离）中解救出来。
阅读疗法在促进CPTSD的康复方面可以发挥巨大的作用。我经常发现，那些取得较
大疗愈进展的来访者会通过阅读（自己选择书籍或由我推荐）来强化心理咨询治疗的效
果。那些记录自己对所读内容的认知和情绪反应，并以此进一步强化阅读效果的人，他们
的疗愈进展尤其明显。我认为，记录心境有助于建立新的大脑神经元回路——这是当我们
有效地满足了自己发展停滞的童年需求时就会出现的情况。
阅读疗法对在危险的社会环境中长大的人特别有帮助，这样的环境中充斥着只会批
评、恐吓和厌恶孩子的成年人。而对于那些在童年时缺乏成年人的安全支持和指导的人来
说，阅读疗法同样有效。
在我接受了几年团体和个人治疗后，我才意识到，我的疗愈之旅实际上在我接受正式
治疗前几十年就已经开始了，它始于我出于直觉进行的所有治疗性阅读和写作。我本能地
被许多灵性和心理自助书籍吸引，并不自觉地在其中寻求帮助。
虽然当时没有真正读懂这些书，但我获得了许多宝贵的洞见，了解了如何改善对待自
己和他人的方式。同样重要的是，我从潜意识中觉察到，世上有许多善良、安全、智慧和
乐于助人的成年人，他们值得被信任，能给我许多智慧和友善的指导。
我记得第一次进入图书社群时的深刻情感体验。当时我在图书馆里不情愿地浏览诗
歌区的图书，想找一本用来辅助完成高中英语作业的书。但是，我一直查找到W排也没找
到让我有丝毫兴趣的书。这时，我看到了一本诗歌选集，书的封面上有一个看起来非常引
人注目的老人，沃尔特·惠特曼！他史诗般的《自己之歌》（Song of Myself）和《大路之
歌》，让我激动不已，并改变了我的生活。他成了我的英雄，也是第一个我视为榜样的成
年人，他教会了我一些有用并且重要的东西。他的思想成为我人生的支点，给了我一个充
满希望的计划，让我知道当我最终脱离家庭时，我想要做什么。
渐渐地，我的图书社群中的作者们就像一群长者，我想象着自己如果遇到他们，他们
一定会与我共情。最终，当这种意识到达某个临界点时，我迈出了巨大的一步：开始冒险
接受心理治疗。我很幸运地找到了一位足够好的治疗师，她帮助我进行了单凭自己无法开
展的疗愈。
下面列举了一些作者和他们的作品，这些作者对我的疗愈之旅特别有帮助。他们对我
来说就像智慧的长辈，扮演了我原生家庭中缺失的角色。

[[推荐阅读]]</tw-passagedata><tw-passagedata pid="158" name="推荐阅读" tags="" position="35200,2725" size="100,100"></tw-passagedata><tw-passagedata pid="159" name="推荐语" tags="" position="35225,2200" size="100,100">推荐语
皮特·沃克的书对所有经历过童年创伤的人来说都是一份宝贵而丰富的疗愈资源。不
论是来访者还是临床医生，都一定能从中受益良多。
——朱莉·沙因曼（Julie Scheinman，婚姻家庭咨询硕士）
我们希望将“管理闪回的13个步骤”纳入我们的资源手册。
——加拿大受虐幸存者康复协会（S.O.A.R.）
我在你的文字中找到了自己。你仿佛打开了我的心，走入了我饱受创伤的内心深处，
在其中漫步，又回到外面，然后写下了你在我内心发现的东西。我现在50多岁了，你的文
字让我生平第一次觉得自己没有缺陷，既不疯狂也不“怪异”，甚至开始由衷地认为自己
值得被爱。
——D.M.
我坐在旧金山圣何塞机场的卫生间里颤抖着、哭泣着读了你的书，并找到了继续下一
段旅程的勇气。单是知道你住在这个城市就给了我很大的鼓励。神奇的是，我甚至还没见
过你就有了这种感受！你的著作对我来说是无价之宝。
——A.R.
我要特别感谢你对我所有的帮助（我读了你的书，还将它推荐给了其他人，我也替他
们感谢你）。你对情绪闪回的解读深刻地影响了我，给我的生活带来了巨大的改变。以前
的我只会被情绪的巨浪击垮，但现在的我仿佛有了冲浪板，能在一些情绪的波涛上冲浪，
虽然有时还是会掉下来，但我知道不会一直如此。
——J.
感谢你提供的所有关于CPTSD
[1]和遗弃抑郁的心理教育信息。我终于找到了多年来自
己试图向心理治疗师解释的东西。你的每一句话都准确描述了我所体验到的CPTSD和遗弃
抑郁。
——A.
我从个人层面和职业层面都非常感激你。你关于治愈CPTSD的文章让我兴奋，也使我
的感受得到了验证。我会成为一名更好的心理治疗师，并在生活中进一步自我疗愈。
——D.
你的书将成为我例行发给来访者的资料之一。书中传达的信息对患者来说无疑是一剂
良药。
——L.P.
我曾被诊断出各种心理病症，也被贴上过各种标签：惊恐障碍、强迫障碍、依恋障
碍、双相情感障碍、广泛性焦虑障碍等等。后来我找到了一位治疗师，他说我患上
PTSD
[2]是因为长期受到了父母的情绪虐待。那一刻我觉得一切都明晰了起来。你的书就
像我在一直寻找的那最后一块拼图，给了我很多力量，让我得到了解脱。
——A.M.
我在疗愈之旅中已经走了很久，最近进入了想要回顾过往并庆祝已取得的康复成果的
阶段。你的文字正是我此时所需要的。我觉得自己真正被看见、被理解和被欣赏了。这是
一份多么美好的礼物啊。
——P.
尽管获得了心理学硕士学位、接受了心理咨询训练、经历了数十年的心理治疗，但这
是我第一次读到能够准确描述我内心状态的书！
——F.K.
大约五年前，我在网上购买了你的这本书。后来我在一位出色的治疗师的帮助下对抗
CPTSD，同时也反复看你的书。你的文字坚定、直接、富有同情心。如今我又觉得人生是
值得的。顺便要说的是，我的包里一直放着一份“管理闪回的13个步骤”。
——P.B.
我今天偶然读到了你的书，并感到这将是我人生中具有历史性意义的一天，过去十二
年的痛苦治疗真是一场巨大的浪费。你的文章太好了。我向来反感心理学家聒噪地给各种
症状冠以繁多的名目，但我现在改变了看法。“情绪闪回”这个词“正中要害”，能了解
这个概念实在是太棒了。
——M.
我把你的书读了很多很多遍，特别是其中关于遗弃抑郁的内容，它们给了我希望，让
我不至于走上绝路。感谢你花时间写下这本出色的书。我对你的感激之情难以言表。
——T.M.
我刚读完你的书，它是如此有力而温柔。我现在正在重读，并用荧光笔边读边做标
记。你的文字邀请我进入了一段温暖的治疗关系。真是一本非常美妙的书！谢谢你。
——A.R.
我要感谢你的作品。它正是我走出人生困局所需要的。你的作品很有洞见，其中的建
议都非常可行。最重要的是，它帮助我实现了一些温和的转变，这些转变对于改变我的人
生来说至关重要。
——L.K.
对于我这样一个饱受CPTSD之苦的人来说，你的书为我的自我疗愈提供了最多的洞见
和希望。我对此非常感激，并且想把这些知识分享给其他人。阅读你的文字让我感到拨云
见日。我意识到自己没有发疯、并不愚蠢，也不会永远崩溃下去。我只是经历了情绪闪
回，而这并不是我的错。
——M.L.
你的书让我获得了前所未有的自我洞察，让我对自己的生活体验有了清晰的认识。多
年来我咨询过各种治疗师和咨询师，但一直无法精准地描述出内心经历的到底是什么。在
阅读你的作品之前我从未明确地符合任何“框架”或诊断。读了你的文章，我意识到自己
的痛苦源自过往艰辛的人生（尤其是童年）经历，这一点让我松了一口气。当我了解到能
够通过一些方法来积极应对和处理这些问题时，我感到更加宽慰了。
——R.T.
我刚重读完这本书，几乎将全文都划成了重点。我之前从你的网站受益良多，现在又
从这本书中收获满满。我虽然已经接受了三年多的心理治疗，并对自己的改变感到惊讶，
但是在读到关于讨好类型人格的内容时，仍然会感到非常震撼，尽管我意识到自己已经不
再是那样的了。
——A.
我在大学进行心理咨询教学已经超过十二年了，可以坦率地说，你书中提供的信息和
理论几乎是前所未有的。
——C.M.
我想要感谢你提供的所有关于CPTSD的信息。它们无疑是最好的自助疗愈资源。
——J.C.
对于我，和千千万万像我一样努力寻找着痛苦根源、渴求获得心灵成长的人来说，你
的作品就像一份礼物。我正在重建自己，并重新抚育自己。
——L.K.
[1]CPTSD全称为Complex Post-Traumatic Stress Disorder，即复杂性创伤后应激障
碍。
[2]PTSD全称为Post-Traumatic Stress Disorder，即创伤后应激障碍。
献给我的妻子莎拉·温伯格（Sara Weinberg）和儿子杰登·迈克尔·沃克（Jaden
Michael Walker）。
你们的存在每天都提醒着我，自己已经逃离了父母的蔑视，远离了过往的伤害，并且
有能力用爱和善意滋养我们的家庭。我每天都沐浴在你们慷慨的爱和善意里，并从中得到
了治愈。
我还要将本书献给那些经常在饭桌上遭受言语和情绪虐待的人们。希望这本书能帮助
你们治愈所有伤痛，并修复你们与食物的关系。
这一天到来了：躲在紧闭的花蕾里
远比尽情绽放
更加痛苦。
——阿娜伊斯·宁（Anaïs Nin）
当内心的柔软
找到那隐秘的伤痛，
痛苦自己会击碎岩石
然后，啊！让灵魂浮现。
——鲁米（Rumi）
我们都是极为复杂的物种，认清自己的复杂性对我们是有益的，否则我们就会活在一
个虚幻的“梦境”中。“梦”里那些简单且非黑即白的观念并不适用于我们的人生。
——西奥多·鲁宾（Theodore Rubin）</tw-passagedata><tw-passagedata pid="160" name="一部关于复杂性创伤后应激障碍（CPTSD）识别与治疗的图谱" tags="" position="35350,2200" size="100,100">
一部关于复杂性创伤后应激障碍（CPTSD）识别与治疗的图谱
当出版社将这本有关如何疗愈复杂性创伤后应激障碍的大众读物寄给我时，我真是很
惊讶！直到2018年，世界卫生组织（WHO）才在《国际疾病分类第十一次修订本（ICD-
11）》中将CPTSD作为一种新的精神疾病首次纳入了国际精神疾病诊断系统。尽管在中
国，学习精神分析式心理治疗以及其他心理疗法的专业人员对这个疾病并不陌生，相关的
专业人员也在对这个最新版本的精神疾病诊断标准做更深入的研究，但是关于CPTSD的
诊断和治疗，实际上还未正式应用于临床。也就是说，中国尚有众多精神科医生对此病缺
乏足够的了解，在具体的诊断和治疗中，也就更缺乏足够的实践经验了。
因此，我惊讶于出版社这么敏锐地组织翻译了这本通俗地讲解这种新的心理疾病、并
提供切实可行的疗愈方法的书。特别是在经历了近三年的新冠疫情创伤的当下，这本书该
是多么的重要。它的出版体现出大众读者对心理健康问题的关注度在逐日攀升，我相信在
全社会共同的努力下，大众心理健康水平将进一步提升。
回到源头，让我们来看看CPTSD在ICD-11中是如何被定义的。要说清楚CPTSD，我
们还是需要先谈谈创伤后应激障碍（PTSD）。
ICD-11定义如下：创伤后应激障碍（Post-Traumatic Stress Disorder，PTSD）：创伤后应激障碍是一种暴
露于单个或一系列极端威胁或恐怖的事件后可能发生的障碍。表现为以下特征：①创伤经
历的再体验，即创伤事件以栩栩如生的侵入性记忆、闪回或梦魇等形式在当下再现，通常
伴有强烈的、压倒性的情感，多为恐惧或恐怖，以及强烈的躯体感觉；②回避行为，回避
对创伤事件的想法或记忆，或回避使人想起创伤事件的活动、情境或人物；③对目前威胁
的持续性高水平觉察，如可表现为高度警觉，或在遇到刺激（如突发的响声）时出现强烈
的惊跳反应。这些症状至少持续数周，并在个人、家庭、社会、教育、职业或其他重要功
能领域造成严重损害。
PTSD包括：创伤性神经症（Traumatic Neurosis）。
复杂性创伤后应激障碍（Complex Post-Traumatic Stress Disorder，CPTSD）：复杂性
创伤后应激障碍是一种暴露于单个或一系列极端威胁或恐怖的事件后可能发生的障碍。这
些创伤性应激事件通常是长期或反复的，从这些事件中逃脱是极其困难或不可能的（例如
奴役、种族灭绝活动、长期的家庭暴力、儿童的反复性虐待或躯体虐待）。必须首先满足
PTSD的所有诊断需求，同时存在以下特征：①情绪调节上的异常；②存在一些信念，认
为自己是渺小的、失败的、无价值的，对创伤性事件有愧疚感、自责自罪或失败感；③难
以与他人保持亲密的人际关系。这些症状在个人、家庭、社会、教育、职业或其他重要功
能领域造成严重损害。
CPTSD不包括：创伤后应激障碍。
我们可以清楚地看出，CPTSD不仅必须包括PTSD的核心特征，即创伤的再体验、回
避行为和高激惹，还包括CPTSD特有的情绪调节障碍、自我贬低、人际交往困难。这些
症状会明显损害个人在几乎所有人生重要领域的功能。此外，我想要强调的是，绝大多数
的CPTSD患者所经历的创伤是自童年时代起就反复遭遇的创伤。
医学诊断往往非常严格，只有当所有特征性症状缺一不可时，患者才能够被确诊。本
书所介绍的CPTSD案例，其症状都十分复杂，但有些案例的患者可能缺乏某个精神科诊
断所必需的特征性症状，因此，书中描述的某些CPTSD案例，依据其症状，在精神科临
床上只能被诊断为有部分CPTSD特征的创伤性障碍。即便如此，我也完全同意作者将其
当作CPTSD来理解和处理。我在这里写下这段话是希望我们的精神卫生同行也能读读这
本书，既理解临床诊断CPTSD的严谨，也理解在处理CPTSD时我们所需要考察的症状背
后的心理社会因素，不完全物化患者，而是尊重人性。
本书的作者开宗明义地告知读者他是一名“经过多年的治疗，症状已经大幅减轻的
CPTSD患者”，这本书也是他从自身经历的角度来写的。这其实是作者的自谦。作者除了
是CPTSD患者以外，同时也是一名训练有素的心理创伤治疗师。作者的这两个特点让本
书更加能够引起读者深刻的共鸣。作者承认自己曾经是名CPTSD患者，这极大地降低了
这类患者特征性的羞耻感，也无疑激励了这些被形形色色的创伤侵害了的人们。
客观地讲，作者对CPTSD的认识也是非常深刻的。书中明确地表明了CPTSD是由心
理社会性的成因（即各种虐待）造成的，而不是先天基因的问题。近来学界的共识是
CPTSD与创伤在代际的传递高度相关，但实际上，这种相关所指的不是基因的DNA有问
题，而是创伤经历导致基因的表达出现了问题，不是与我们通常说的遗传相关，而是与表
观遗传有关。
作者还对CPTSD的特征性症状做了详细的解析。让我印象深刻的是作者提到的
CPTSD最明显、最典型的症状——情绪闪回，这种情绪闪回与PTSD中的闪回不同，通常
不会涉及视觉上的重现。我非常同意作者的这种细致的观察，或者说包含了他自己体验的
观察。我在此想强调的是，这种情绪闪回通常由患者熟悉的一个具有创伤特征的事件引
起，比如书中提到的作者的第一任伴侣的突然的怒吼，这种怒吼像极了作者童年时父母对
其无缘无故的怒骂，这种怒吼就作为一个扳机激活了作者早年的各种恐惧、愤怒、羞耻等
情绪，这就是作者提到的情绪闪回。精神科医生对创伤的扳机作用是熟悉的，但是如果与
诊断标准对号入座的话，只会套用视觉上的闪回而忽视情绪闪回，而对于CPTSD患者来
说，负性情绪的激活再现，或者如作者所说的情绪闪回是非常常见的。
作者在书中提到的毒性羞耻感、被动自杀意念等概念无疑都是具有创造性和启发性
的。作者认为被动自杀意念往往意味着闪回到了幼年时期的感受，患者再次沉浸在深刻的
被遗弃感中……训练有素的精神卫生从业人员能够区分主动和被动自杀意念，因此在遇到
被动自杀意念时不会惊慌失措。希望每个读到这本书的读者也可以学习区分这两种意念，
从而实现自助。
这本书还提到CPTSD会被误诊为各种精神障碍，作者并不认为被误诊的人没有与之
相似或相关的症状，问题的关键是，对于这些创伤后幸存者的实际困扰而言，这些标签式
的诊断是片面的，而且会增加他们的羞耻感。更重要的是，误诊在患者的心理上增加了一
种暗示：你之所以患病与你遭受的那些不公没有关系或者关系不大，主要是因为你的先天
素质出了问题。这可能会与患者内心深处的那些诸如“就是因为我不好，我才被虐待”的全
能幻想相遇，增加患者的羞耻感。
新冠肺炎在全世界大流行已经三年，这种大型的持续经年的社会性创伤会激活许多社
会性、个人性的创伤。尽管CPTSD患者在人群中是少数，但是我们每个人都是有缺口
的，因而这本书对大众而言是有帮助的。本书呈现的各种自助方法都可以给大众读者提供
帮助。
我个人认为，如果你真的符合书中所描述的CPTSD的诊断，那么这本书就可以作为
一部很好的指南，不仅可以用于自助，更重要的是，还可以指导你去寻求专业人员的帮
助，去学习建立一种你从早年就缺失的、有建设性的人际关系。就像作者本人一样，与专
业人员建立一段良好的关系，将对你大有裨益。
对精神卫生从业者来说，毋庸置疑，这也是一本很好的参考书。
华中科技大学同济医学院附属武汉精神卫生中心教授、主任医师，
国际精神分析协会（IPA）中国学组首任主席
童俊
2022年10月于湖北武汉</tw-passagedata><tw-passagedata pid="161" name="创伤不是你的错，但复原是你自己的责任" tags="" position="35475,2200" size="100,100">
创伤不是你的错，但复原是你自己的责任
在我的心理咨询工作中，来访者通常都经历过童年创伤：躯体虐待、情绪虐待与忽
视、性侵害、自恋型父母，或父母有药物、酒精成瘾问题，等等。在与来访者进行咨询
时，我也理解到提供与创伤相关的心理教育非常重要——我一直相信知识就是力量，当我
们可以了解创伤（尤其是那些童年时期不断重复的受创事件）如何影响人，就能够理解
到：“这不是我有问题！”
所以，我非常兴奋地看到皮特·沃克这本谈论复杂性创伤后应激障碍（CPTSD）的书
被翻译成中文，让更多的人可以接受这些创伤心理教育。
我常常会跟来访者说，你现在很多的“问题行为”，其实都是过去的你为了在受创环境
下求生存而发展出的“生存机制”。这本书中提到的CPTSD症状，像是内在批判、毒性羞耻
感等，其实也都是“为了保护你”。譬如，小时候的你需要这个内在批判者不断批判你，让
你时时警醒自己把事情做好，这样才不会因为又做错了事情被妈妈羞辱；又或者，羞耻这
种情绪会使你全身缩起来，使你保持安静，不反抗暴怒的父亲，其实是要保护你，让你更
安全（如果反抗，你可能会被打得更惨）。这些“症状”，其实都是过去的你为了求生存所
发展出来的保卫机制，是一个人所展现的复原力和韧性。
我相信，你受到的创伤都不是你的错，但复原是你自己的责任。这本书可以带着你去
好好理解创伤，陪伴你走上疗愈之路。
心理学博士、美国执业心理咨询师
留佩萱</tw-passagedata><tw-passagedata pid="162" name="译者序" tags="" position="35600,2200" size="100,100">
译者序
创伤这个心理学概念如今已经为人们所熟知，PTSD这一词汇甚至常见于人们的日常
交流之中。但相较而言，CPTSD（复杂性的PTSD）这一概念对中文读者而言还相对陌
生。我在接触到本书之前，也只偶然听几位具有较多心理咨询经验的朋友提到过。当我与
周围人聊起PTSD时，大家通常想到的是由战争或重大灾难所引起的创伤，而不太能意识
到在更宽泛和日常的范畴中，创伤会以一种更不为人所觉察、却更普遍的方式存在着。如
皮特在书中所说，这正是复杂性创伤的复杂之处。
皮特的这本书是少数专门针对CPTSD的心理学著作之一，更是一本将普通大众作为
目标受众的自助类图书。它对CPTSD的讲述非常详尽，从定义、症状、类型到疗愈的方
法和疗愈的不同阶段都有所涉及，并且建构了一个清晰简明的4F反应模型帮助读者进行
自我评估，甚至提供了一系列非常实用的自我救助步骤和工具。
在初读这本书时，我的第一个感受就是，皮特将自己的这本书称作“地图”实在是再贴
切不过了。它虽然含有很多专业信息和讲解，但它并不是艰深的理论著作，而真的宛若一
份文字地图，循序渐进地指引着读者去了解、探索、疗愈创伤。而最令我感动的是，这份
文字地图在提供指引的同时，还囊括了皮特本人及大量读者或来访者的真挚分享。书中提
到的CPTSD的源头有很多种，包括原生家庭中的虐待和忽视、亲密关系中的暴力、邪教
和种种其他长期迫害，而这本书主要着墨于原生家庭所造成的创伤，我认为原因之一便是
皮特自身的经历。在书中，皮特亲自示范，摆脱了高高在上的权威说教姿态（这类姿态往
往会再次伤害到创伤幸存者），也让这种讲述和分享显得更为诚挚、更能与读者共情。
在皮特引述的诸多案例和分享中，时常闪耀着非常动人的治愈瞬间。令我印象非常深
刻的，是一位读者给皮特的信中描绘的被自然治愈的一刻。那种自然之美与感官及精神世
界之间的联结，就和那段文字一样平静又充满力量，使得未曾有过类似灵性体验的读者仿
佛置身其中，同时也见证了一种治愈的可能。这种体验的分享本身就是一种莫大的安慰。
这本书不乏这样的时刻——无论是在面谈时经历的剧烈闪回，还是在口头宣泄后流下的治
愈泪水，无不能够成为读者对自身感受和疗愈历程的启发和验证。
翻译这本书的过程对我而言也是一趟奇妙的旅程。我本人虽然没有CPTSD的困扰，
但也像很多人一样，持续面对着许多自己心理上的困境，也尝试过各种求索，包括修习一
些心理学的课程，并尝试过许多正念和冥想练习。非常巧的是，在翻译这本书的过程中，
我自己也在接受心理咨询。因此，我在阅读和翻译的同时，也将这本书当作自助手册来学
习和实践，其中的很多概念和工具与我当时的自身体验形成了呼应和对照。比如，我虽然
没有严重的情绪闪回，但当我陷入自身的心理泥潭时，我会尝试着使用皮特列举的步骤来
进行“思维纠正”，练习对抗“内在批判者”的极端化和灾难化思维，学着更多地自我关怀。
随着全书章节一点点推进，我也感受到了自己的一些细微转化。这样的阅读体验让我意识
到，这本书不仅对许多CPTSD患者而言是一份宝贵的资源，也有着心理学层面的普世意
义，能为更广大的读者提供支持和帮助。而这也正是我在翻译这本书时的忐忑之余所感受
到的巨大动力和召唤。
从翻译层面来说，这本书对我而言是一个不小的挑战。其中的一些心理学术语和概念
很难找到完全对应或公认的中文译法，需要查阅相关资料和书籍，以求不偏离专业的同
时，在中文语境中做到清晰合理。我在翻译时的优先原则是尽量真实准确地还原作者的原
意，在此基础上使得语句通顺自然，让读者更容易理解。皮特的原文中有不少刻意的重
复，旨在强调和重申一些重点内容，我也有意保留了这样的语言风格。当然，在斟词酌句
的过程中总免不了感受到自己语言和知识的局限，充满了自我怀疑和批判，如果不限时
间，我甚至想无休止地修改下去。而有意思的是，每当我的“内在批判者”冒头时，我就会
想起皮特在书中所说的“足够好”的概念，提醒自己放下自我批评，接受有缺失但还过得去
的自己——这恐怕是对书中的内容最即时、最直接的实践了吧。
最后希望拙译能帮助读者跨越语言的障碍，让这本书像帮助我一样，帮助更多的读
者。当然也非常欢迎和感谢大家批评指正。
严菲菲
2022年夏于美国加利福尼亚州湾区</tw-passagedata><tw-passagedata pid="163" name="中文版序" tags="" position="35725,2200" size="100,100">
中文版序
亲爱的读者，感谢你购买、阅读这本书。很抱歉，或许你和我一样，在生命早期遭受
过创伤。
复杂性创伤后应激障碍（CPTSD）在美国是很普遍的问题，我相信它在世界的其他
地方也很常见，因为我时常会收到来自世界各地（几乎每个国家）的深受CPTSD困扰的
人的电子邮件。这个情况令人难过，尤其是想到CPTSD可以对一个人的一辈子产生那么
多种残害幸福的影响时。
我很庆幸自己能有机会与中国读者分享我关于CPTSD的知识、经验和疗愈旅途。我
或许对中国的文化不甚熟悉，但我相信，我们人类都有相同的心理发展。有毒的东西，不
会因为不同文化有不同的诠释，而变得无害。文化差异或许是需要被考察的重要变量，但
疗愈未化解的创伤无论在哪里都是重要的。
编辑告诉我，CPTSD也许在中国不太被知晓，甚至很少有人听说过。能够通过出版
这本书，在中文社会中唤起对CPTSD的觉知，是我的荣幸。这本书已经被翻译成了40多
种语言，如果它也能帮助疗愈使用中文的CPTSD幸存者，那会是我特别的荣光。
如果你成长的环境使你觉得自己不重要、不被爱、没价值、不安全或不被倾听，让你
深深地觉得自己“不够好”，那么你便有很大的可能性有CPTSD。在不安全的环境中成长，
你可能会发展出持续的草木皆兵心态，这些深刻的感受会发展出各种不健康的补偿策略，
而你可能不知道，你自己或许一辈子都在用不健康的方式去应对。你有时候会怀疑人生为
何如此疲惫、孤单、令人失望或没有意义，甚至可能怀疑这人生到底值不值得活下去。
我希望这本书能帮助你发现人生中不尽如人意的根源，并且带领你踏上更幸福、“足
够好”的人生之旅。我们无法改变过往的历史，但我们可以通过疗愈获得更好的未来。你
受过伤，但你不必继续痛！
我诚挚地希望你通过阅读这本书，能够渐渐化解不必要的焦虑、羞耻和忧郁。我希
望、也祈祷你的自尊会成长，你会在人生中找到有爱且支持你的人，而且你终将从求生模
式蜕变为茁壮模式。
皮特·沃克</tw-passagedata><tw-passagedata pid="164" name="前言" tags="" position="35850,2200" size="100,100">
前言
如果你此刻正陷于痛苦中，请翻到第八章，阅读减轻CPTSD恐惧感和应激的13个步
骤。
40年前，我坐着印度的一列火车，从德里前往加尔各答。当时，我在印度为期一年的
精神求索之旅已接近尾声。这次旅程以失败告终：我并没有从任何精神启迪中完成自己
的“救赎梦想”，反而更绝望了，甚至还患上了阿米巴肠病——这让我的体重掉了将近15千
克，使我看起来像个瘦弱的和尚。
更糟的是，我在阅读沃尔特·惠特曼（Walt Whitman）的《大路之歌》（Song of The
Open Road）时燃起的希望，在当时已消失殆尽——那种希望曾在我被无情地逐出家门后
支撑我度过了5年的全球游历生活。
说回火车上。我同贫民、鸡和羊一起，挤在逼仄的二等座上，读着一份英文版的印度
报纸。报纸上说，我的目的地加尔各答涌入了大约10万名孟加拉国难民，这些人刚刚逃离
被洪水淹没的家乡，都露宿于加尔各答市中心的街头，睡在沿街骑楼的底层。
深夜抵达加尔各答后，我果然看到人们身裹被单，一个个肩并着肩，睡满了整条街
道。我入住了一位旅友介绍的20美分一晚的旅店。那晚我睡得很不踏实，担忧着自己的境
遇，以及第二天一早将要看到的悲惨景象。（我本想着去澳大利亚或许能赚点钱，但现在
恐怕连去那儿的钱都不够了。）我在什么忙都帮不上的时候，该如何面对街头上那么多绝
望的人？
第二天一早，我好不容易催促自己下了楼，而眼前街道上的变化让我惊呆了：人们把
被单像野餐垫一样摊开，每张垫子上都围坐着一个幸福的家庭；便携式的小炉子中烹煮着
餐食和茶饮，人们带着惊人的活力和热情有说有笑……让我印象最为深刻的是那些孩子
们，他们亲密地在父母身上乱爬、玩闹，特别是在父亲身上，而这些父亲看起来和孩子们
一样享受。
那一刻，一种从未体验过的复杂感受向我涌来，那是一种融合了释怀、愉悦和焦虑的
奇妙感受。直到10年之后，我才理解了自己当时的那种焦虑：原来那是从我潜意识中渗透
出的嫉妒。
我深深地嫉妒着那份幸福洋溢的亲情，那是一种我从未体验过，甚至从未目睹过的感
情。在我成长过程中看过的那些甜蜜的家庭情景喜剧中都没有如此真挚动人的关系联结和
情感依恋。
多年后，作为一名人类学和社会工作专业的学生，我理解了这种感情。我回想起在其
他非工业化国家或地区，也曾目睹过类似的场景（虽然规模没有这么大）：摩洛哥、泰
国、印度尼西亚的巴厘岛，以及澳大利亚的一个原住民保留地。
这些回忆让我由衷地了解了一种我在自己和朋友的家庭中从未见过的关系之爱。多年
来，我回味着这些经历，用它来克服我对自己童年缺失的否定，并开始了长达数十年的探
索——正是这种探索指引我写下了本书。
我希望本书能成为一张“地图”，让读者可以跟随它的指引来治愈由童年缺爱造成的伤
痛。我有时会重复谈及缩减批判者和哀悼童年损失这类话题，这是因为我想通过多种方式
反复强调这些主题在疗愈旅程中的重要性。如果你发现自己迷失了方向，不知道如何回到
地图中，这些主题将是重新进入地图的关键入口。
你会发现本书的目录非常详细，可以指引你深入了解每章的主题。
我有时会建议读者先浏览目录，然后从最有共鸣的章节开始阅读。虽然本书总体是以
线性方式编排的，但每个人的疗愈之旅都是不同的，开启旅程的方式也可能多种多样。
疗愈的旅程可能始于许多不同的情境：可能是由死亡或重大损失引起的情感风暴打开
了潜藏于你记忆中的童年痛苦之匣；也可能是某个朋友分享的疗愈过程引发了你的共鸣；
或是某本书、某个电视节目诱发你认真地思考童年究竟发生了什么；或是你在一次心理咨
询中打开了心扉；或是你经历了惊恐发作或精神崩溃这类危机，需要外界的帮助；又或是
你当时治疗抑郁和焦虑的药物治疗方案开始失控，从而需要外界的帮助。
本书会对疗愈过程中所需完成的各项关键（Key）任务进行深入的分析。你可以将本
书看作一个钥匙串（Key），其中串着各种视角和方法，助你打开心理学家爱丽丝·米勒
（Alice Miller）所说的“童年的牢笼”。
我希望读者能将本书作为疗愈教材，并反复阅读某些章节，因为随着时间的推移和治
疗工作的有效推进，某些主题会体现出越来越深刻的含义。
此外，本书提供的并不是一个放之四海而皆准的疗愈公式。有些建议可能不太适用于
某些特定的童年创伤模式，甚至会完全失效。如果你遇到这种情况，那么请选择性地采纳
那些对你适用且对你有帮助的建议。
我还希望这张“地图”在指引你疗愈自己的同时，能够坚定地为你带来善意和同情，也
希望在这段疗愈之旅中，你能至少找到一个人，用同样的方式好好爱你。
本书描述了很多真实的生活案例。为了保护当事人的隐私，我对所有人名和身份信息
都做了处理。
PART ONE
</tw-passagedata><tw-passagedata pid="165" name="第一部分 疗愈概述" tags="" position="35975,2200" size="100,100">[[第一章 CPTSD的疗愈之旅]]

[[第二章 康复的各个层面]]

[[第三章 改善关系]]

[[第四章 疗愈的进程]]</tw-passagedata><tw-passagedata pid="166" name="第二部分 疗愈的细节" tags="" position="36100,2200" size="100,100">[[第五章 如果我不曾被打呢？]]

[[第六章 我属于何种创伤类型]]

[[第七章 从基于创伤的关系依赖中康复]]
</tw-passagedata><tw-passagedata pid="167" name="第三部分 疗愈的方法" tags="" position="36225,2200" size="100,100">[[第八章 管理情绪闪回]]

[[第九章 缩减内在批判者]]

[[第十章 缩减外在批判者]]

[[第十一章 哀悼]]

[[第十二章 管理遗弃抑郁的地图]]

[[第十三章 通过关系来治愈遗弃创伤]]

[[第十四章 原谅：从自己开始]]

[[第十五章 阅读疗法与图书社群]]

[[第十六章 自助工具]]</tw-passagedata><tw-passagedata pid="168" name="致谢" tags="" position="36350,2200" size="100,100">@致谢
感谢我所有可爱的来访者们。在过去的30年中，他们勇敢地向我展露了自己的脆弱和
真诚，我倍感荣幸。他们的故事表明，糟糕的养育方式是普遍存在的；而他们鼓舞人心的
努力也证明，那些不良影响在很大程度上是能够被克服的。
我还要感谢在我网站上留言的人，他们宽容的反馈在很大程度上帮助我缓解了表现焦
虑，让我有勇气写一本书，将我的文字置于更广泛公众的视野中。我曾担心我的文字会成
为别人攻击我的武器，因为我童年时就常有这样的经历，而读者们盛情的支持帮我减少了
这种恐惧。
感谢我的好朋友比尔·奥布莱恩（Bill O&#39;Brien），他在本书英文版本的文字编辑润色
方面给了我极大的帮助。
感谢在文献书目中列出的以及那些没有列出的作者，他们的理念启发了我，帮助我写
出了这本书。
感谢那些在疗愈过程中与我互相慰藉的朋友们，我们在疗愈的旅程中给予了彼此巨大
的帮助。
</tw-passagedata><tw-passagedata pid="169" name="参考文献" tags="" position="36475,2200" size="100,100">@参考文献
Abrams, Jeremiah (ed). Reclaiming The Inner Child, Los Angeles: Jeremy P. Tarcher, Inc.,
1990.
Anderson, Susan. The Journey from Abandonment to Healing, New York: Berkley Books, 2000.
Bach, George and Goldberg, Herb. Creative Aggression, New York: Avon, 1975.
Bass, E.&amp; Davis, L. The Courage to Heal, New York: Harper&amp;Row, 1988.
Beaver, Daniel. Beyond The Marriage Fantasy, New York: Harper &amp; Row, 1982.
Bender, Sheila. Love from The Coastal Route, Seattle: Puckabush Press, 1991.
Bettelheim, Bruno. A Good Enough Parent, New York: A. Knopf, 1987.
Boon, Suzette. Coping with Trauma-related Dissociation, New York: W. W. Norton, 2011.
Bradshaw, John. Healing The Shame That Binds You, Deerfield Beach, Florida: Health
Communications, Inc., 1988.
_____. Bradshaw On: The Family, Deerfield Beach, Fla: Health Communications, 1988.
Branden, Nathaniel. How to Raise Your Self-Esteem, New York: Bantam, 1987.
Briggs, Dorothy Corkville. Your Child&#39;s Self-Esteem, New York: Dolphin, 1975.
Brooks, C. The Secret Everyone Knows, San Diego: Kroc Foundation, 1980.
Brown, Brene. The Gifts of Imperfection, Minnesota: Hazelden, 2010.
Brown, Byron. Soul without Shame, Boston: Shambala, 1999.
Cameron, Julia. The Artist&#39;s Way, New York: Putnam&#39;s, 1992.
Campbell, Susan. The Couple&#39;s Journey, San Luis Obispo, California: Impact Publishers, 1981.
Covitz, Joel. Emotional Child Abuse: The Family Curse, Boston: Sigo Press, 1986.
Engel, Beverly. Healing Your Emotional Self, New Jersey: Wiley, 2006.
Faber, Adelle and Mazlish, Elaine. How to Talk So Kids Will Listen &amp; Listen
So Kids Will Talk, New York: Rawson, Wade Publishers, 1980.
Forward, Susan. Betrayal of Innocence, New York: Penguin, 1970.
Frey, William H., II, Ph.D., Crying: The Mystery of Tears, New York: Harper &amp; Row, 1987.
Fromm, Erich. The Art of Loving, New York: Bantam, 1962.
Fromm-Reichmann, F. Principles of Intensive Psychotherapy, Chicago: University of Chicago
Press, 1950.
Glendenning, Chellis. My Name Is Chellis &amp; I&#39;m Recovering from Western Civilization, Boston:
Shambala, 1994
Golomb, Elan. Trapped in The Mirror, New York: Quill, 1992
Gottman, John. The Seven Principles of Making Marriage Work, New York: Three Rivers Press,
1999.
Gravitz, Herbert and Bowden, Julie. Recovery: A Guide for Adult Children of Alcoholics, New
York: Simon &amp; Schuster, 1985.
Guntrip, H. Psychoanalytic Theory, Therapy, and The Self, New York: Basic Books, 1971.
Hazelden. Hazelden&#39;s Meditations, San Francisco: Hazelden, 1985.
Hazelton, Lesley. The Right to Feel Bad, Garden City, New York: The Dial Press, 1984
Hendrix, Gay. Learning to Love Yourself, New York: Prentice Hall Press, 1987.
Herman, Judith. Trauma and Recovery, New York: Basic Books,1997.
Hoffman, Bob. Getting Divorced from Mother &amp; Dad, New York: E.P. Dutton, 1976.
Huber, Cheri. There Is Nothing Wrong with You, Chicago: Keep It Simple Books, 2000.
Jeffers, Susan. Feel The Fear and Do It Anyway, San Diego: Harcourt Brace Jovanovich, 1987.
Jung, Carl. Memories, Dreams, and Reflections, Edited by Aniela Jaffe. New York: Random
House, 1961.
Kabat-Zinn, Jon. Mindfulness for Beginners, Boulder: Sounds True, 2012.
Kalsched, Donald. The Inner World of Trauma, New York: Routledge, 1999.
Katherine, Anne. Where to Draw The Line, New York: Simon &amp; Schuster, 2000.
Kopp, Sheldon. If You Meet The Buddha On The Road, Kill Him, New York: Bantam, 1981.
Kornfield, Jack. A Path with Heart, New York: Bantam, 1993.
Kubler-Ross, Elizabeth. On Death and Dying, London: Collier-Macmillan, 1969.
Laing, R. D. The Voice of Experience, New York: Pantheon Books, 1982.
Lawson, Christine. Understanding The Borderline Mother, Oxford: Jason Aronson, 2000.
Leech, Peter and Singer, Zeva. Acknowledgement: Opening to The Grief of Unacceptable Loss,
Missoula, Montana: Zeva Singer, 1988.
Levine, Stephen. Who Dies, Garden City, New York: Anchor Press, 1982.
_____. Meetings at The Edge, Garden City, New York: Anchor Press, 1984.
Lewis, T., Amini, F., Lannon, R. A General Theory of Love, New York: Vintage, 2000.
Love, Patricia. The Emotional Incest Syndrome, New York: Bantam, 1990.
Lowen, Alexander. Bioenergetics, New York: Coward, McCann, 1970.
Marris, Peter. Loss and Change, Garden City, New York: Anchor, 1975.
May, Rollo. Love and Will, New York: W.W. Norton, 1969.
McClelland, W. Robert. God Our Loving Enemy, Nashville: Abingdon, 1982
Meade, Michael, Robert Bly and James Hillman. The Rag and Bone Shop of The Heart, New
York: Harper, 1992.
Middleton-Moz, Jane. After The Tears: Reclaiming The Personal Losses of Childhood, Deerfield
Beach, Florida: Health Communications, Inc., 1986.
Miller, Alice. For Your Own Good, Toronto: Collins Publishers, 1984.
_____. Thou Shalt Not Be Aware: Society&#39;s Betrayal of The Child, New York: Farrar, Strauss, &amp;
Giroux, 1984.
_____. The Drama of The Gifted Child （Original Title Prisoners of Childhood）, New York:
Basic Books, 1981.
Mitchell, Stephen. The Enlightened Heart, New York: Harper, 1989.
Missildine, W. Hugh. Your Inner Child of The Past, New York: Simon and Schuster, 1963.
Monroe, Herbie. Wisdoms of a Dog Scholar, Sydney: Unpublished, 1982.
Moore, Thomas. Care of The Soul, New York: Harper Collins, 1992.
Norwood, Robin. Women Who Love Too Much, New York: Pocket Books, 1985.
Peck, M. Scott. The Road Less Traveled, New York: Simon and Schuster, Touchstone, 1978.
Real, Terrence. I Don&#39;t Want to Talk About It, New York: Fireside, 1997.
Roth, Geneen. Breaking Free of Compulsive Eating, London: Grafton, 1986.
Roth, S. Psychotherapy: The Art of Wooing Nature, Northvale, New Jersey: Jason Aronson,
1987.
Rubin, Theodore. Compassion and Self-Hate, New York: Macmillan, Collier, 1975.
_____. The Angry Book, New York: Macmillan, Collier, 1976.
Rubin, Theodore. Compassion &amp; Self-Hate, New York: Ballantine, 1975.
Satir, Virginia. Conjoint Family Therapy, Palo Alto, California: Science and Behavior Books,
1983.
Schatzman, M. Soul Murder: Persecution in The Family, New York: Jason Aronson, 1973.
Schaef, Anne Wilson. When Society Becomes An Addict, San Francisco: Harper &amp; Row, 1987.
Schutz, Will. Profound Simplicity, New York: Bantam, 1979.
Semrad, E. Semrad, The Heart of A Therapist, ed. S. Rako and H. Mazer. New York: Jason
Aronson, 1980.
Shain, M. Hearts That We Broke A Long Time Ago, New York: Bantam, 1982.
Smalley, Stuart. I&#39;m Good Enough, I&#39;m Smart Enough, and Doggone It, People Like Me, New
York: Dell, 1992.
Smith, Manuel. When I Say No, I Feel Guilty, New York: Bantam, 1975.
Short, Susanne. “Understanding Our Childhood: The Hidden Secret.” Psychological
Perspectives, Fall, 1989.
Stein, Robert M. Incest and Human Love: The Betrayal of The Soul, Dallas: Spring Publications,
1973.
Stone, Hal and Sidra. Embracing Your Inner Critic, San Francisco: Harper, 1991.
Vachss, Andrew. “You Carry The Cure in Your Heart”, Parade, Aug. 28, 1994.
Viorst, Judith. Necessary Losses, New York: Fawcett Gold Medal, 1986.
Walker, Alice. Her Blue Body Everything We Know, New York: Harcourt Brace Jovanovich,
1991.
Walker, Pete. The Tao of Fully Feeling, Lafayette, California: Azure Coyote, 1995.
Walker, Pete. The Tao of Existential-Transpersonal Psychology, Oakland: Unpublished Thesis,
1985.
Watts, Alan. In My Own Way, New York: Random House, 1972.
Whitman, Walt. Leaves of Grass, New York: Signet, 1958.
Woodman, Marion. The Pregnant Virgin: A Process of Psychological Transformation, Toronto:
Inner City Books, 1985.
Yalom, Irvin. Existential Psychotherapy, New York: Basic Books, 1980.
</tw-passagedata><tw-passagedata pid="170" name="缩减批判者" tags="" position="30600,900" size="100,100">缩减批判者
早年的虐待或遗弃经历会迫使孩子将自己的身份认同[3]与超我[4]（Superego）融合。
在孩子大脑中，超我负责学习家长订立的规则，以求获得并维持他人的接纳。然而，由于
孩子在创伤性家庭中无法获得接纳，超我只能“加班加点”地工作，试图完成这项不可能完
成的任务。超我不屈不挠地想要找到讨好父母的方式，最终会选择完美主义策略，试图以
此使父母变得更可亲一些，而不再那么可怕。孩子唯一的希望是，如果自己变得足够聪
明、有用、漂亮和完美无瑕，父母最终可能就会在乎他。
可悲的是，一直无法得到父母的关爱会迫使孩子相信自己是有致命缺陷的。他会认
为，自己之所以得不到爱，不是因为他犯了错误，而是因为他本身就是个错误。他在自己
身上只能看到错误或缺陷。他所做、所说、所思考、所想象或所感受到的一切，都有可能
将他卷入充满恐惧和毒性羞耻感的抑郁深渊。随着时间的推移，他的超我会逐渐演变为彻
底的、尖刻的、导致创伤的内在批判者。
从此，孩子会不停地进行自我批判，极力规避任何错误，以免遭到否定。同时，灾难
化的想象成为他的一种强迫行为，因为这有助于他预见后果，从而避免受到惩罚和更严重
的遗弃。他的脑海中会持续充斥着灾难性的情节和画面。
幸存者仿佛被一个事事都要求完美的狱卒关进了牢笼。在人生的每个岔路口，他又仿
佛被一个满眼都是危险的疯狂司机拉着走。在第九章和第十章我会详细介绍一些缩减批判
者的实用工具。</tw-passagedata><tw-passagedata pid="171" name="发展停滞的健康自我" tags="" position="30725,900" size="100,100">@发展停滞的健康自我
这里所说的自我（Ego）[5]有别于日常普遍的用法，并非形容一个人自私，它并不是
一个贬义词。在心理学中，自我（Ego）一词代表“自我意识”或“我的身份认同”。健康的
自我（Ego）是一个对自身友好的心灵管理者。不幸的是，导致孩子患上CPTSD的父母会
破坏孩子自我同情和自我保护意识的形成过程，而这些关键的自我过程[6]若无法正常发
展，则会阻碍自我（Ego）的成长。
每当孩子自然而然地想要同情自己或为自己挺身而出时，那些病态的父母便会对孩子
进行羞辱和恐吓。于是，孩子照顾自己和保护自己免遭不公的天性就会被迫休眠。久而久
之，孩子会愈发认同自己内在批判的声音，其超我则会蜕变成一个专横的内在批判者，凌
驾于健康自我（Ego）之上。
</tw-passagedata><tw-passagedata pid="172" name="心理教育与认知疗愈" tags="" position="30850,900" size="100,100">@心理教育与认知疗愈
若要消除那些被父母灌输的不利于自我（Ego）健康发展的毒性思想，第一步就是接
受关于CPTSD的心理教育。在你准确理解了父母对你的健康自我（Ego）所造成的伤害
后，你就更有动力帮助自己修复这些伤害。你能识别出的伤害越多，就越能知道需要修复
的内容。
这一点至关重要，因为如果自我（Ego）没有正常发展，你就没有做出健康选择和决
定的主心骨。很多时候，你的决定都是基于对陷入困境或遭到抛弃的恐惧，而非基于与世
界进行有意义且合理的互动。
作为一名成年人，你可以学着逐渐用一种自我支持的视角来取代内在批判者的毒性视
角，以停止不必要的自我伤害。你可以自由地培养内心的宁静，与自己建立友善的关系，
以自我支持的姿态从生存的挣扎中解脱出来，并逐渐走向茁壮发展。你还可以即刻唤醒自
我同情和自我保护的天性，让它们在你的人生中尽情绽放。
你的认知疗愈可能在阅读前文时就已经开始了。希望在读到此处时，你已经对引发自
己痛苦的核心原因有所顿悟。
有些读者可能多年来一直想在认知层面寻找答案，并且已经通过阅读和治疗建立了扎
实的基础。但有些仅尝试过认知行为疗法（Cognitive-Behavioral Therapy，CBT）来治疗
创伤的人，在听到认知层面的治疗很重要时，可能会感到非常抗拒。这或许是因为他们之
前在接触这种疗法时，被允诺会收到超出实际作用的效果。认知行为疗法在治疗认知问题
时确实具有难以替代的价值，但它们也的确不能解决所有层面的创伤——在解决情绪层面
的问题时它们的效果尤其有限（后文我会再分析）。
在疗愈过程的早期，心理教育通常来自他人，如老师、作家、朋友或咨询师的智慧，
因为他们比我们更了解这一主题。而当心理教育达到最大效果时，它就会开始升华为正
念。
</tw-passagedata><tw-passagedata pid="173" name="正念" tags="" position="30975,900" size="100,100">
正念
在心理学中，正念指用一段专注的时间，充分觉察自己的想法和感受，不做任何判
断、分析和反应，从而训练自己用更多、更从容的方式来应对它们：我是真的赞成这种想
法，还是迫于压力才相信它的？我要如何应对这种感觉——是分散自己的注意力，还是压
制它，或者只是继续体会它，直到它有所变化？
正念结合了自我观察与自我同情，可以让你从客观和自我接纳的视角观察自己。它是
健康的自我所具有的重要功能，有时会被描述为观察性自我（Observing Ego）或见证性
自我（Witnessing Self）。
正念是对自己内在体验的良性好奇心，是一种内省。培养这种有益的内省，会极大地
增强疗愈效果。随着正念的发展，它可以被用来识别和摆脱那些从创伤性家庭中习得的不
健康的观念和观点。
觉察内心的自我评估非常重要，其重要性再怎么强调也不为过。通过充分练习，正念
最终会使你能够准确评估自己，并唤醒你的斗志，去突破童年虐待经历带给你的束缚，并
将其替换为自我支持的积极想法。正念还能帮你培养一种洞察力，引导你努力地疗愈自
己。
第十二章包含关于加强正念的详细方法。关于这一话题还可参见史蒂芬·拉维
（Steven Levine）、杰克·康菲尔德（Jack Kornfield）和乔·卡巴金（Jon Kabat-Zinn）的著
作。最后，我还要强调，正念会以一种渐进的方式发展，并扩张至体验、认知、情绪、身
体和人际关系的所有层面。它可以在康复的各个层面中指引我们，并具有至关重要的作
用，我们会在后文更具体地讨论这一点。</tw-passagedata><tw-passagedata pid="174" name="情绪层面的康复" tags="" position="31100,875" size="100,100">情绪层面的康复
创伤幸存者在试图与自身情绪建立良好关系时，会努力接受这样一个客观事实：人类
的感受往往自相矛盾，并经常在两种相反的极端情感之间摇摆。因此，情绪在各种极端情
感之间发生不可预知的变化是非常正常的。也就是说，人的情绪会在快乐与悲伤、热情与
沮丧、爱与恨、信任与怀疑、勇敢与恐惧、宽容与责备等极端情感之间变化，这是非常正
常的，也是非常健康的。
不幸的是，在我们的社会文化中，只有“积极”的情绪体验才会被认可和允许。然而，
如果人们只接受积极的情绪，就会出现至少以下两种令人痛苦的情况。
第一种情况：人会强迫性地试图避免那些被否定的情绪。这实际上既会伤害自己又会
让自己精疲力竭，还会使人更加沉溺其中。这就像一个小丑在表演，他疯狂地想要从一张
捕蝇纸中挣脱出来，结果反而更加动弹不得、纠缠不清。
第二种情况：压制情绪光谱的某一端，往往也会导致对所有情绪的压制，于是人就会
变得麻木。我们可以把积极的情绪能量比作一个在泡澡的婴儿，而泡澡水就相当于那些不
被接受的情绪。当人倒掉泡澡水时，婴儿也会随着水流被倒掉。
排斥人类的基本情绪会导致很多不必要的损失，就好像没有黑夜就没有白昼，没有工
作就没有玩乐，没有饥饿就没有饱足，没有恐惧就没有勇气，没有泪水就没有欢愉，没有
恨就没有真正的爱一样。那些主动或被迫选择只认同积极情绪的人通常会变得死气沉沉、
乏味、麻木，犹如在没有情感的“无人之境”离群索居。此外，当一个人试图过度地保持一
种他偏好的情绪时，他通常会表现得造作而不自然，就像塑料花一般。而如果一个人学会
心甘情愿地接受人类自然的情绪，理解情绪总会潮起潮落，那他最终将获得成长的能力，
在情绪灵活性这一重要领域中提升自己。
对所谓消极情绪的压制会导致很多不必要的痛苦，也会让人丧失很多必要的情绪天
性。事实上，困扰现代社会人类的孤独、疏离、分心成瘾（Addictive Distraction），很大
程度上是因为人们被迫学会了去拒绝、去病态化，甚至因许多正常的情绪状态而惩罚自己
与他人。无论是在自我内心的最深处，还是在最亲近的朋友面前，人们都不被允许探索和
拥有正常的消极情绪。愤怒、抑郁、嫉妒、悲伤、恐惧等情绪都是正常生活的组成部分，
就像面包、鲜花和街道的存在一样自然，然而，它们现在却成了人们避之不及的“可耻
的”人性体验。
人们对消极情绪的排斥和压制导致了情绪的贫瘠。情绪的贫瘠是一种普遍的病症，它
对健康的影响通常被委婉地称为“压力”。而就像情绪一样，压力也常常被当作某种必须被
清除的无用废品。这是何等的悲哀，因为在一个完整健全的心智中，所有的情绪及与之相
关的感受都具有极其重要的功能，尤其是在健康的自我保护方面。我们如果无法体会不自
在或痛苦的感受，就是被剥夺了一种最基本的能力，无法注意到周遭的不公、虐待和忽
视。那些无法感到悲伤的人通常无法意识到自己遭到了不公的排挤，而那些无法对虐待感
到愤怒和恐惧的人，往往会不加抗议地忍受，并不断将自己置于危险之中。也许人类在过
往的时间里从来没有像在21世纪这样，与这么多正常的情绪状态如此疏离，也从未有这么
多人在情绪上如此麻木和贫乏。
人只有无差别地接受（这里的“接受”并非指不负责任或胡乱地倾泻情绪）所有的情
绪，才会有完整健全的心智，才能拥有坚定的自尊并享受真正的幸福。因此，尽管在出现
爱意、幸福和宁静这样的感觉时，人很容易喜欢自己，但只有当你在生活中遭遇了不可避
免的失落、孤独和困惑，无法控制的不公和意外的错误，并因此受到了情绪伤害时还能保
持自爱和自尊，才表明你的心理在更深的层面上是健康的。
人类的情绪就像天气，总是变化多端，难以预测。不管认知行为疗法如何指导我们，
都无法激发一种可以永远持续下去的积极情绪。尽管这听起来让我们颇为失望，尽管我们
可能很想否认这一点，尽管这给我们带来了持续的人生挫败感，尽管这让我们在成长过程
中对控制、选择自己情绪的欲望愈发强烈，但这就是事实——产生情绪总归是一种人类的
天性，大多数情况下不受我们意志的支配。</tw-passagedata><tw-passagedata pid="175" name="情绪智力" tags="" position="31225,875" size="100,100">情绪智力
丹尼尔·戈尔曼（Daniel Goleman）将情绪智力（Emotional Intelligance）定义为“成功
地识别和管理自身情绪并恰当地回应他人情绪的能力”。如前文所述，我认为情绪智力的
高低体现在我们接纳所有情绪（而不是自动脱离它们，或以一种伤害自己或他人的方式表
达它们）的程度上。当我们的情绪智力足够高时，这种接纳将延伸至我们的亲密对象。我
的一个来访者将其视为“高品质关系”的特点。
换言之，情绪智力高意味着一个人有足够强大的自尊，这足以支持他在所有情绪状态
下都能对自己敞开心扉。而且当他和朋友为彼此提供这种情绪接纳时，双方都会获得亲密
感。再次强调，这并不包括破坏式的泄愤，这种表达情绪的行为对建立、维护信任和亲密
关系来说显然会起到负面作用。
导致孩子患上CPTSD的父母通常会虚伪地以双重模式来损害孩子的情绪智力。他们
会因孩子表达了情绪而虐待孩子，同时又会用自己毒性的情绪表达方式来虐待孩子。他们
对孩子表达出的痛苦情绪特别蔑视，这种蔑视会使孩子的一种非常重要的能力——恰当地
表达悲痛的能力陷入发展停滞。
一个典型的例子是，父母的伤害使孩子痛哭流涕，而这时父母居然还说：“别哭了，
再哭我就让你好看！”有一个来访者告诉我，他经常幻想自己愤怒地回答父亲：“你在说什
么？不就是你让我哭成这样的吗？”但他却没有说出口，因为他早就知道愤怒的反击是一
项“禁忌”，只会招致更凶残的“报复”，父母会杀气腾腾地说：“看我不打死你！”
在上述例子中，父母对孩子情绪智力的“屠戮”是非常明显而露骨的，而同样常见的还
有对情绪智力的阴险的被动型攻击。这类攻击表现为父母在孩子表达情绪时的逃避行为。
在情感上遗弃孩子的父母会在孩子哭泣时采取隔离惩罚，或习惯性地躲开哭泣的孩子，比
如回到自己的房间。
以上两种对情绪智力的攻击都属于情绪虐待。还有一种特别令人难以忍受的情绪虐待
是在制造创伤的家庭中，孩子甚至会因为显露出愉快的情绪而遭到攻击。写到这里，我闪
回到了童年时的一个场景——我的母亲对着我的妹妹冷笑并吼叫道：“你在开心什么！”而
我的父亲经常说：“你在笑什么？快把你那副笑脸收起来！”
最糟糕、最具伤害性的是，这些情绪攻击还会被用在不会说话、只能用情绪来表达自
己的婴幼儿身上。要知道，他们还太过幼小，根本无法完成2～3岁的发展任务，即用语言
来表达需求和感受。
情绪虐待几乎总是伴随着情感遗弃。情感遗弃，简单来说，就是父母持续无情地缺乏
温暖和爱意。对此最令人心酸的描述就是“不被父母喜欢”，这种说法戳穿了很多父母的谎
言。因为很多制造创伤的父母都声称爱自己的孩子，但是实际上却通过无数的方式体现出
他们根本不喜欢孩子。在我的成长过程中，“看到你就恶心”是我的父母很爱说的话。
直到现在，我回想起以下一幕时还会流泪。我那遭到情感遗弃的妹妹躲在房子的角落
里求我们家的狗：“喜欢我吧，金杰，喜欢我吧！”</tw-passagedata><tw-passagedata pid="176" name="毒性羞耻感与“灵魂谋杀”" tags="" position="31350,875" size="100,100">@毒性羞耻感与“灵魂谋杀”
父母在我们表达情绪时做出的排斥性回应会使我们与自己的感受疏离，让我们在害怕
自己情绪的同时也对他人的情绪感到恐惧。约翰·布雷萧将这种对孩子情绪天性的破坏描
述为“灵魂谋杀”。他将其解释为这样的过程：孩子的情绪表达（也是孩子自我表达的第一
种语言）遭到了父母强烈的厌恶性攻击，以致孩子所有的情绪体验都立刻转化为了毒性羞
耻感。
我认为毒性羞耻感是内在批判者的情感，而内在批判者的思维是对羞耻感的认知——
我们最初的被遗弃经历导致了这个糟糕的阴阳过程[8]。
家庭和社会对我们的“情绪天性”打出了一套致命的组合拳，因此我们需要恢复自己与
生俱来的情绪智力。卡尔·荣格（Carl Jung）认为这一点非常重要，因为情绪能告诉我们
什么才是对自己真正重要的。当我们的情绪智力受到限制时，我们常常不知道自己真正想
要的是什么，所以即使是做很小的决定都会非常纠结、不断挣扎。
随着情绪智力的逐渐恢复，前文提到的正念便开始延伸至我们的情绪层面中，这有助
于我们不再自动地从自己的感觉中解离。然后，我们开始学会识别自己的感觉，并选择以
健康的方式来应对它们。这样的情绪发展会让我们发现自己内心真正的喜好，进而帮助我
们更轻松、更好地做决定。
一位男性来访者在他的长程治疗即将结束时对我说：“昨天，我在思考自己在这些年
的治疗中有什么收获时，惊喜地意识到，我的价值观已经在很大程度上摆脱了自己从小浸
淫其中的强调男子气概的家庭和社会文化的影响。我现在觉得自己更喜欢艺术而不是科
学，更喜欢小说而不是科普作品，更喜欢园艺而不是高尔夫，更喜欢和伴侣待在家里，而
不是去酒吧聚会。”
</tw-passagedata><tw-passagedata pid="177" name="哀悼是一种情绪智力" tags="" position="31475,875" size="100,100">@哀悼是一种情绪智力
哀悼是我们与被压抑的情绪智力重新联结的关键过程。哀悼会将我们与自己完整的情
感重新联结起来，这有助于我们释放由童年的可怕损失带来的痛苦。这些损失就如同我们
某些部分的“死亡”，而哀悼往往能让它们重生。
哀悼能帮助我们恢复十分关键却处于发展停滞的口头宣泄能力。第十一章会介绍四种
哀悼方式，口头宣泄是其中的倒数第二种，它以通过释放和化解情绪困扰的方式来抒发
情感。
我认为下面对一组六格漫画的描述能非常直观地展现口头宣泄的巨大力量：在第一格漫画中，一个女人头顶有一片乌云，她正在和一个头顶阳光灿烂的朋友说
话。在第二格漫画中，当女人做出抱怨的手势时，那片乌云遮住了她朋友的太阳。在第三
格漫画中，随着她发泄愤怒，头顶的乌云放出了一道闪电，她和朋友都气得满脸通红。在
第四格漫画中，乌云开始下雨，她们抱在一起，泪水交融，相互安慰。在第五格漫画中，
她们面容舒展，乌云已经不再遮蔽太阳。在第六格漫画中，阳光照耀着两人，她们微笑着
开始愉快地交谈。
这组漫画展示了口头宣泄的效果。这种哀悼方式对增进亲密关系非常关键，同时也是
CPTSD治疗中关键的疗愈过程。下面是口头宣泄在治疗中使用的一个实例。
一位来访者前来面谈时正处于情绪闪回状态，他退行到了受伤的童年，感觉非常糟
糕，既难过又愤怒，并再次迷失于最初被遗弃时的痛苦中。这种状态就像死亡一样，令他
非常痛苦，于是他开始对此进行口头宣泄。
他让自己的情绪随着话语倾泻而出，通过诉说、哭泣和发怒，将痛苦表达了出来。在
这种处理痛苦的过程中，他逐渐从闪回的情境里走了出来，恢复到日常的正常状态，不再
陷于受到创伤的童年。这种解脱使他恢复了正常的应对能力。并且，当他将悲伤表达得足
够彻底时，他更觉得生活充满希望，也更轻松。他的幽默感也会常常重现，即使是在口头
宣泄时也伴随着爽朗的笑声。这种笑声与他在刚开始接受治疗时的“幽默”大不相同——那
时的“幽默”是源于内在批判者的讽刺和霸凌。
内在批判者有时对哀悼充满敌意，因此缩减内在批判者可能是疗愈过程中的首要任
务。不过，在内在批判者被充分“驯服”之前，哀悼可能会让闪回恶化，从而无法发挥原本
的复原功效。
我治疗过的许多来访者受伤至深，以致我们必须花上好几个月的时间在认知层面进行
治疗，才能让他们在哀悼时能够摆脱恶毒的内在批判者的破坏性影响。本书第十一章提供
了很多关于恢复哀悼能力的实用指导。
</tw-passagedata><tw-passagedata pid="178" name="通过更高层次的归属感来缓解被遗弃的痛苦" tags="" position="31625,875" size="100,100">@通过更高层次的归属感来缓解被遗弃的痛苦
由CPTSD引发的遗弃抑郁有一个重要的表现，那就是幸存者缺乏对人类群体、生
活、任何个体或事物的归属感。我遇到的许多幸存者，他们的第一丝“归属感”都萌生于灵
性探索。他们在人世间只能看到背叛，于是转为向灵性层面求助。
灵性追求有时是被寻找归属感的无意识期待推动的。对一个孩子来说，最糟糕的事情
莫过于在原生家庭中不被喜爱，永远无法融入其中。此外，许多幸存者几乎没有或完全没
有体验过让他们感到安全和受欢迎的人际关系。
很多幸存者也无法在传统的宗教组织中找到归属感。他们觉得传统宗教和自己不健全
家庭太过相似，因此会寻找更多遗世的灵性疗愈方法。他们有时会通过阅读灵修书籍或参
加冥想练习找到归属感，觉得自己归属于一个更广阔且更能慰藉人心的事物，这也让他们
避免了直接与人接触的风险。
还有一些幸存者则通过置身于自然、聆听音乐或欣赏艺术获得了归属于某种更宏大、
更有价值事物的灵性体验。曾经有一本书给我留下了很深的印象，但书的名字我已经记不
清了，那是一本名人语录，其中的一些名人通过直接感受自然之美而获得了神性
（Numinous）体验。
神性体验是一种有力而动人的精神感受，它能让人感到在宇宙背后和自己内心之中都
存在着一股积极、正面的力量。这股感受有时会让人体会到恩典，并深深地感到自己是有
价值的，生活可期，生命可贵。

</tw-passagedata><tw-passagedata pid="179" name="感恩" tags="" position="31750,875" size="100,100">感恩
不管灵性或神性体验源于何处，它们都能为幸存者提供归属感，使其感觉自己归属于
某种更宏大、本质上更美好的事物。这种体验可能会指引幸存者找到与自己有同样感受的
作者、演讲者或其他的人生旅途中的旅伴，然后为其打开一扇新的大门，让幸存者从其他
人身上找到安慰。最终，幸存者甚至能感受到，这世上还有足够美好、安全，并值得与之
交往的人。
有一位读者曾在我的网站上留言，讲述了她的一段感恩体验。她名叫玛丽·奎因
（Mary Quinn），来自爱尔兰。我询问她是否可以转载她所写的内容，她说：“可以，就
当是为了纪念我心中的那个小孩，和那些她的声音不被听到的岁月。”下面的内容转自她
的讲述。
“几天前的一个清晨，我去海边看日出。忽然，我有了难以置信的体验，感到了纯粹
的通透。我坐在海滩上，看着鸟儿在海面上低空飞翔，月亮还依稀可见，太阳正在升起。
我意识到自己正凝视着三颗星球，而周围空无一人。
“那一刻美得令人窒息，那种深刻的感受使我的泪水顺着脸颊滑落。在此之前的很长
一段时间里，我一直处于麻木的状态。但现在，我环抱住自己，强烈地感受到心中那个小
孩的存在，这种感受几近痛苦，但很治愈。我意识到，是我之前的所有生命体验带我来到
了这一刻，并使我有了能够欣赏这份感动的深度。一种平静的感觉像温柔的海浪一样洗透
了我。我体会到一种联结，感到万事万物都是生命的一部分，它们的美丽令人叹为观止。
我感觉自己正在用所有的感官体验这一刻，我从未意识到自己的情感能如此丰富。
“我感受到一种深刻的感恩之情，那种感觉就好像在最深的层次上与生命本身有了联
结。所有的生活际遇和我认为的问题在那一刻都显得苍白与无足轻重，我的心中只留下了
最纯粹的爱。那种感觉真像是一种恩典，尽管转瞬即逝，但它给予了我足够的养分和希
望，让我可以继续前行。”</tw-passagedata><tw-passagedata pid="180" name="足够好的抚育" tags="" position="31875,875" size="100,100">足够好的抚育
若孩子在发展阶段得到了足够好的抚育，他们便会觉得人生是一份礼物，尽管生活中
他们偶尔也会有艰难和痛苦。
足够好的抚育一词源于著名的成人与儿童心理学家唐纳德·温尼科特（Donald
Winnicott）。他创造了“足够好的母亲”一词来描述他所观察到的现象，即孩子不需要完美
的父母也能健康成长。他在漫长的职业生涯中注意到，只要父母的行为具有合理的一致
性，并且给予的爱和支持较为稳定，孩子就会在成长过程中具备获得强大自尊和建立亲密
关系的能力。
如今许多治疗师会将“足够好”一词用于形容朋友、伴侣、父母等。这通常是为了解构
人们对关系的完美期望，这样的期望非常不切实际，甚至会破坏本质上有价值的关系。当
将“足够好”这一概念应用在人身上时，一般指一个人本质上心地善良，努力做到公正，并
且大多数时候都能履行自己的承诺。我还喜欢把“足够好”应用到更多的事物上，如“足够
好的工作”“足够好的尝试”“足够好的旅行”“足够好的一天”或“足够好的生活”。我广泛地运
用这一概念来对抗非黑即白（Black and White）、“全或无”（All or None）的内在批判者
思维，这种思维习惯性地将所有不完美的人和事都判定为有缺陷的。
足够好的父母会给予孩子充分的支持、保护和宽慰。他们还会引导孩子建设性地应对
反复出现的生活难题，诸如损失、真正的恶人、糟糕的时事，以及对家人和朋友正常的失
望。最重要的是，他们会示范如何修复亲密关系中的失望，关键方式就是愿意原谅孩子正
常的错误和缺点。
孩子在一个足够安全和充满爱的家庭中长大，会自然而然地加强注意并享受生活馈赠
的能力，他们会懂得生活中的美好大大超过了那些必然的损失和艰辛。因此，孩子若能得
到足够好的抚育，便能轻松识别霸凌和剥削行为，并保护自己不受伤害，因为他们认为自
己本就值得被善待，不必适应那些不公平的对待。
然而，在一个创伤性家庭中，几乎或完全没有什么是足够好的，因此也没有什么可感
恩的。孩子的内在批判者在一次次的伤害中被过度开发，并开始过度关注自己和他人的不
完美之处。这有时能帮助孩子隐藏那些会招致惩罚的特质，也会帮助他们进一步避开那些
可能会惩罚他们的人。
不幸的是，长期下来，孩子会习惯于只用消极的眼光看待自己、他人和生活。因
此，当他们长大成人并脱离了真正有害的家庭后，他们也看不到生活给予自己的很多新的
可能性。他们的发展停滞导致他们无法看见自己美好的一面，也无法看见其他那些足够安
全的人。</tw-passagedata><tw-passagedata pid="181" name="自助躯体疗法" tags="" position="32050,900" size="100,100">@自助躯体疗法
好消息是，当我们通过更有效的闪回管理来减轻生理压力时，身体会在一定程度上自
行修复。例如，在练习哀悼时，我们就可以通过自我同情的哭泣和自我保护性地表达愤怒
来放松盔甲化的身体，促进具身化（Embodiment）[11]、改善睡眠、减少过度警觉，并激
发更深、更有节奏的呼吸。
然而，要想完全放松身体，我们就需要进一步的躯体治疗。有一些自助方式就可用于
治疗CPTSD造成的生理伤害，瑜伽、按摩、冥想和放松训练都可以帮助身体放松，缓解
不必要的紧张。本书第八章“管理情绪闪回”第七步包含的五种自助躯体练习方法，可以用
来缓解闪回中身体的过度觉醒；第十二章的“身体的正念”和“自省式的身体练习”两节介绍
的一些方法能帮助我们减少肾上腺素的分泌，进行深度放松，并改善消化系统功能。
拉伸也是一种非常有效的躯体治疗方法。定期对身体的主要肌群进行系统化的拉伸，
可以帮助身体缓解由于长期进行4F反应而引起的盔甲化。身体盔甲化的成因是，当4F反
应被激活时，身体会收紧或收缩，以应对预期中必须进行的反击、逃跑、使自己不被注意
或讨好他人。
学习拉伸对于我来说是一种很大的折磨，因为我的身体处于极度盔甲化的状态。我非
常抵触这种自我滋养的任务，因此我花了很长的时间才把拉伸培养为一种习惯。雪上加霜
的是，我总是练习小组中柔韧性最差的那一个，为此我不得不经受许多毒性羞耻感的打
击。此外，当大家谈论拉伸的感觉有多好时，我既感到困惑，又觉得羞耻，因为我从拉伸
中感受不到丝毫的愉悦。
不过值得庆幸的是，我在阅读相关文献后意识到了拉伸的重要性，通过坚持不懈的练
习，我终于取得了明显的效果，解决了持续数十年的背痛问题。尽管我现在还是不太喜欢
拉伸，但我坚信，我之所以在60多岁时还能跑步、游泳和打篮球，拉伸练习功不可没。对
我来说，拉伸练习已成为爱和自我滋养的活动。
僵类型及其亚型的幸存者也能受益于不同类型的运动疗法和有氧训练方案。此外，自
信训练（Assertiveness Training）和愤怒释放练习（Anger Release Work），对于缺乏自信
果敢或自我保护意识的幸存者来说特别有帮助。
</tw-passagedata><tw-passagedata pid="182" name="CPTSD和躯体疗法" tags="" position="32175,900" size="100,100">@CPTSD和躯体疗法
很多躯体疗法都可以用于身体层面的疗愈。不过，如前文在介绍认知行为疗法时提到
的，如果有一种躯体疗法声称可以跨过认知和情绪层面的治疗，直接治愈CPTSD，那
么，我建议大家对其保持谨慎。事实上，有些躯体疗法全盘否定认知疗法，并去除了缩减
内在批判者这个关键过程。有些躯体疗法还否认其他方法的重要意义，认为没有必要哀悼
童年的损伤，也无须了解父母的虐待与忽视是问题的根源所在。虽然如此，如果一些躯体
疗法治疗师不主动否定或阻碍幸存者在认知和情绪层面的治疗，那么他们依然可以帮助幸
存者有效地治疗生理创伤。
比如，我认为眼动疗法（Eye Movement Desensitization Reprocessing，简称为
EMDR）和躯体经验创伤疗法（Somatic Experiencing）是非常有效的减压方法。它们对治
疗单纯型的PTSD尤为有效。然而，在治疗CPTSD时，它们所包含的措施却不全面，除非
治疗师能够兼收并蓄，将针对缩减内在批判者和哀悼童年损伤的疗法也纳入治疗方案。
其他躯体治疗方法，如罗森疗法（Rosen Work）、罗尔夫按摩疗法（Rolfing）、再
生疗法（Rebirthing）和赖希式疗法（Reichian）也都有助于幸存者恢复哀悼和表达愤怒的
能力。
我认为罗森疗法对治疗躯体虐待或性虐待的幸存者格外有效。这种疗法强调轻柔地触
摸，可以帮助幸存者平息由身体触碰和靠近带来的惊吓反应（Startle Response）和焦虑反
应。惊吓反应指幸存者在听到巨大的声音或遇到意料之外的身体接触时突发的全身闪躲反
应。这通常是一种回到过去虐待经历的躯体性闪回。以我为例，我的惊吓反应是由于父母
在我小时候频繁地扇我耳光导致的。我喜欢在公共泳池游泳，可是周围人挥动手臂却常常
会触发我的惊吓反应，我花了很长的时间才将其克服。
我寻觅了很久，才找到一位愿意接受我在治疗过程中加入口头宣泄的罗森派治疗师。
一些治疗师更喜欢安静地治疗，而对大部分幸存者来说，这可能会影响他们的治疗效果。
另外，有一些幸存者能在特别温柔、安全的伴侣的帮助下减轻躯体的症状，而无须治疗师
的介入。
</tw-passagedata><tw-passagedata pid="183" name="自我药疗" tags="" position="32300,900" size="100,100">自我药疗
作为一名心理治疗师，我没有资格提供用药建议，但我观察到SSRI（5-羟色胺选择性
重摄取抑制剂）类抗抑郁药物似乎对那些需要服用药物的幸存者帮助很大。只要服用的剂
量适当，SSRI类药物通常不会使情绪钝化、阻碍悲伤的表达。此外，如果你持续努力地
缩减内在批判者却收效甚微，SSRI类药物通常能帮助你减少内在批判者的出现次数并减
轻其刻薄程度，使你可以更有效地缩减内在批判者。一旦内在批判者得到了足够的缩减，
你就可以停止用药了。但需要注意的是，如果你没有做大量的缩减内在批判者的工作，停
药之后，它又会变得和之前一样强烈。
加博尔·马泰（Gabor Mate）[12]关于减少药物伤害的研究可能会对那些一直无法停止
或减少使用非治疗性药物和物质的幸存者有所帮助。但如何解决药物和酒精的滥用问题超
出了本书的讨论范围，如果你无法摆脱自我药疗的习惯，而它又妨碍了你的CPTSD疗愈
进程的话，我建议你寻求相关戒瘾机构的帮助。
</tw-passagedata><tw-passagedata pid="184" name="解决饮食问题" tags="" position="32425,900" size="100,100">@解决饮食问题
让我们来谈谈身体疗愈的最后一个方面：关于饮食问题的自我治疗。我同意约翰·布
雷萧的观点：几乎所有在不健全家庭中长大的人，都患有进食障碍（Eating
Disorders）[13]。进食障碍是导致消化道问题的关键因素，而消化道问题是CPTSD幸存者
的常见症状。
改变饮食习惯是极其困难的。一位来访者在我的候诊室布告栏上留下了这样一句
话：“治疗酒精和药物成瘾就像对付笼中的老虎，而治疗食物成瘾却如同每天把这只老虎
从笼子里放出来三次，然后带着它散步。”
克服食物成瘾是一项艰巨的任务，你需要循序渐进，还需对自己怀有同情之心。这是
因为，遭到创伤性遗弃的孩子会自然地向食物寻求安慰。食物为人类提供了第一份来自外
部的慰藉，当一个孩子渴望爱时，他往往会把食物作为他爱的对象。长此以往，他很可能
会将食物“升级”为药物。此外，越来越多的科学证据表明，含有大量糖、盐和脂肪的加工
食品特别容易使人上瘾。
食物成瘾在我们学会说话之前就开始了。那时食物能有效地帮助我们挺过难熬的“混
杂的被遗弃感”。不幸的是，我们往往不得不长期依赖食物的抚慰，因此这种过度依赖很
难被克服。我不建议任何处于疗愈初期的人将食物成瘾作为主要关注点，除非进食问题威
胁到了生命安全。如果你想缓解食物成瘾的情况，我更推荐加博尔·马泰提出的“减少伤
害”（Harm Reduction）的取向。此外，吉宁·罗斯（Geneen Roth）的著作《摆脱强迫性饮
食》（Breaking Free from Compulsive Eating）也提供了一种适度、合理的饮食改善方法。
有不少创伤幸存者可能没有意识到自己的进食习惯有害，但也有很多人走向了另一个
极端：他们着魔般地过度关注饮食问题，以为找到完美的饮食方案就能摆脱所有的痛苦，
而我也曾经是这些人中的一员。许多人为了这个目标，会对所有被过度吹捧的新型营养补
充剂趋之若鹜，还有一些人在运动健身时也有这样的执念。
这些举动虽然可以理解，却都是一种过于简化的治愈幻想，而且有这类行为的幸存者
通常忽略了疗愈过程中更为核心的问题。几乎每个人对健康饮食和运动都有自己的想法，
我的建议是，尽可能在一个适度、可行的范围内尝试调整饮食。
[1]该句出自大卫·米切尔的长篇小说《绿野黑天鹅》（Black Swan Green）。——
编者注
[2]冒充者综合征又称“自我能力否定倾向”，指个体按照客观标准评价已经获得了
成功或取得了成就，但是其主观上却否定自己的成功或成就，认为自己没有能力取得成
功，感觉是在欺骗他人，并且害怕被他人发现自己的不足。——编者注
[3]身份认同指人对自身的认知，表现在与他人的互动中。——编者注
[4]超我由弗洛伊德提出，他将人的精神分为三个部分：本我、自我和超我。本我代
表潜意识中的思想；自我代表自己的意识；超我则代表道德判断。——编者注
[5]英文Self和Ego在中文中都翻译为“自我”，可是两者在心理学中各有不同的意
义。在本书中，若作者所述是Ego，文中便会特别标明原文；若是Self，则不另做说明。
Self通常指“自己”，即有别于他人的个人自我。Ego根据不同的理论学说有不同的意
义，但通常与自尊、自重、自我价值、自我认同相关。——编者注
[6]自我过程是指影响自我意识的形成、方向或目标的心理加工过程。——编者注
[7]心理教育指根据人的生理、心理发展特点，运用心理学的方法对人施加积极的影
响，以促进人的心理发展，维护人的心理健康。——编者注
[8]作者借阴阳的概念来表达毒性羞耻感和内在批判二者的关系，二者相辅相成，互
为因果，近似一体。——编者注
[9]灵性疗愈指通过鼓励患者主动注意身心状况、深入探索内在的精神生活，进而发
现自己积极的潜力，以恢复精神健康的疗愈方式。——编者注
[10]自我药疗是指在没有医生或其他医务人员的指导下，个体使用某种物质来试图治
疗自己身体或心理上的疾病。物质不限于药物，食物、酒精或其他物质都可能是自我药疗
的“药”。这种治疗不一定有效，而且使用不当会对身体造成损伤。有人指出自我药疗可
能是一种暂时的逃避或麻痹。——编者注
[11]具身化指生理体验与心理状态之间的强烈联系，人体可以通过生理体验来激活心
理状态，反之亦然。——编者注
[12]加拿大心理医生，研究领域包括压力与疾病、成瘾研究，著有《饥饿幽灵的王
国》（In The Realm of Hungry Ghosts）等书。——编者注
[13]进食障碍是指以进食行为异常，对食物、体重、体形过度关注为特征的一组疾
病，包括神经性厌食和神经性贪食。——编者注
</tw-passagedata><tw-passagedata pid="185" name="当自己的父母" tags="" position="32025,450" size="100,100">@当自己的父母
再抚育需要幸存者平衡地做自己的母亲（Self-mothering，即自我母育）和自己的父
亲（Self-fathering，即自我父育）。当孩子对母爱的需求得到充分满足时，他就会发自内
心地建立起自我同情；而当孩子得到充足的父爱时，自我保护意识就会深植于心中。
自我同情与自我保护协同共生，如果自我同情是康复的归宿，自我保护就是这一归宿
的基础。而当自我同情作为一个可供避难的“大本营”被建造起来时，自我保护的冲动也会
应运而生。如果无法获得这两种原始的生存本能，那么生活在这个世界上真的非常可怕。
当我们致力于重新做自己的父母时，我们的疗愈过程就会快速取得进展。我想鼓励各
位读者现在就下定决心，成为你自己不可动摇的同情与保护的来源。
</tw-passagedata><tw-passagedata pid="186" name="自我母育与“无条件的爱”" tags="" position="32150,450" size="100,100">@自我母育与“无条件的爱”
自我母育最根本的任务是在内心建立一种“我们可爱且值得被爱”的深刻感受。自我母
育意味着要在精神、情绪和身体等所有层面去接受和爱自己的内在小孩（Inner Child，如
果你难以理解“爱自己的内在小孩子”的含义，那么可以将其理解为培养自己发展停滞的部
分）。
自我母育基于一个基本原则：获得无条件的爱是每个孩子与生俱来的权利。如果失去
了无条件的爱，要从这种失去中康复是很困难的。在童年未能得到足够的爱是我们最大的
损失，更遗憾的是，这种损失永远无法完全弥补，因为孩子只有在出生后的前两年左右享
有无条件的爱，才有助于他们的发展。
两岁以后，孩子必须开始学习理解人类的爱是有条件的。虽然孩子此时仍需要充足的
爱，但父母必须温和地告诉孩子，打人、咬人和砸东西等行为是不被接受的，有条件的爱
始于这一时期。通过循序渐进地学习必要、健康的界限和规则，孩子可以被成功地引导，
并理解有条件的爱。孩子若得到了足够好的抚育，便能够相对容易地适应无条件的爱逐渐
减少的过程。在这期间，孩子会逐渐了解到其他人也有权利和需求，他的绝对权利即将结
束，而父母不会总是放弃自己的需求来满足他的需求。然而，如果孩子没能学会理解自己
原先的特权是有限度的，就会产生严重的问题。如果不加限制的时间太长，那么孩子就会
开始走向成人式的自恋。与此相反，孩子如果过早地受到太多限制，就会形成创伤。
再次重申，心理健康的基础是在两岁以前享有不容置疑的无条件的爱。这是正常且健
康的自恋，弗洛伊德将其描述为“婴儿陛下”。CPTSD正是因缺乏无条件的爱而引起的综合
征，或者按卡尔·罗杰斯的话说，CPTSD是因为缺乏“无条件的积极关注”而引起的综合疾
病。另外，如果在童年早期，无条件的爱骤然消失，也可能引发CPTSD。有些父母对婴
儿时期的孩子充满爱意，但一旦孩子开始蹒跚学步，并开始表达自己的意愿，他们就会变
得极为严厉并开始排斥孩子。
明智的父母会缓慢而坚定地引入限制。按照理想的速度，孩子在进入青春期时，将能
够在满足自身需求和帮助亲密的人满足他们的需求之间取得平衡。孩子将学会分享和互
惠，这项成长任务对维持亲密关系至关重要。
</tw-passagedata><tw-passagedata pid="187" name="“无条件的爱”的界限" tags="" position="32275,450" size="100,100">@“无条件的爱”的界限
爱的缺失或爱的突然过早消失会使人极其痛苦，而这种损失是非常难弥补的。我们会
情不自禁地渴望得到那被无端剥夺的无条件的爱，但作为成年人，我们无法指望他人来弥
补我们未被满足的童年需求。
唯一的例外是心理治疗，当然，这通常只有每周一到两小时而已。但我见证了许多心
理治疗的奇迹般的效果，治疗师给予的无条件的积极关注足以显著地修复父母之爱匮乏对
幸存者的伤害。这种充分而持续的关怀还有助于唤醒那些停滞的发展需求，使幸存者能够
用充足的无条件之爱来拥抱自己。
幸存者常常需要努力压制自己无可厚非但不切实际的渴望——从朋友或伴侣那里获得
永久的无条件的爱。但就像童年时期一样，我们最终不得不接受成人之爱的限制。尤其是
在恋爱关系中，无条件的爱很少能持续一年以上。当恋爱持续一年左右时，由于情侣之间
个人需求的差异，他们会不可避免地开始对彼此感到失望。
尽管如此，爱情仍然是疗愈性的近似无条件之爱的重要来源之一，特别是在它撑过那
些不可避免的失望之后。苏珊·坎贝尔（Susan M. Campbell）的《伴侣的旅程》（A
Couples&#39; Journey）以研究为基础，告诉了读者如何从正常的失望中获得更多的亲密感，这
是一本非常实用的著作。
</tw-passagedata><tw-passagedata pid="188" name="养育你的内在小孩" tags="" position="32400,450" size="100,100">@养育你的内在小孩
让我们再来谈谈自我母育。做自己的母亲，我们要致力于增强自我同情和对自己无条
件的积极关注，要坚决拒绝沉溺于自我憎恨和自我遗弃之中，并认识到自我惩罚只会让情
况更坏，要努力强化以下信念：比起自我评判和自我否定，耐心和自我鼓励对疗愈更为有
效。
要想做好自己的母亲，你可以想象在心中开辟一片安全区域，在那里，你的内在小孩
和当下的自己永远会被接纳。对自己真切的温柔会让那个内在小孩进入你现在的成年躯
体，并让他知道，现在这里是一个受到温暖而强大的成人保护的滋养之地。
若要强化自我母育效果，可以用疗愈性的话语对内在批判者的负面想法进行纠正，而
这些话语很可能是你的内在小孩从未从父母那里听过的。我的一位来访者曾经与我分享过
一句非常有智慧的话：“想法，仅仅是想法，就能充满威力，它既可以像阳光一样有益，
也可以像毒物一样有害。”
下面列举的一些话语可以培养你的自我同情心和自尊心。建议你想象着对你的内在小
孩说这些话，尤其是当你陷入情绪闪回的时候。
我很高兴你能来到这个世界上。
你是个好人。
我爱你本来的样子，并会尽我所能永远站在你这边。
每当你感到受伤或难过的时候，都可以来找我。
你不需要完美，我一样爱你并保护你。
你的所有感受我都愿意接受。
我总是很高兴见到你。
你可以生气，我不会让你在生气时伤害自己或他人。
你可以犯错，错误是你的老师。
你可以知道自己需要什么并寻求帮助。
你可以有自己的喜好和品味。
你的样子真让人赏心悦目。
你可以选择自己的价值观。
你可以选择自己的朋友，并且不必喜欢所有人。
你可以时不时地感到困惑和矛盾，也可以没有答案。
你让我感到非常骄傲。
</tw-passagedata><tw-passagedata pid="189" name="自我父育与“时光机营救行动”" tags="" position="32525,450" size="100,100">@自我父育与“时光机营救行动”
许多被遗弃的儿童在成年后会觉得世界非常危险，而他们没有足够的能力来保护自
己。自我母育主要聚焦在疗愈忽视所造成的创伤，而自我父育则着重疗愈无力保护自己免
受虐待而造成的创伤，这些虐待主要来自父母，也可能来自其他权威人物。
自我父育旨在建立自信，并培养为自己说话和自我保护的能力。这包括学习如何有效
地对抗外部或内部的虐待，并维护自身的权利，这一点我将在第十六章的二号工具箱中进
行讲解。许多幸存者也从自信训练的课程和书籍中受益良多。
我最喜欢的自我父育练习之一是“时光机营救行动”。我曾用它帮助过自己和许多来访
者。在针对来访者使用时，我会借助它来模拟一个过程，让来访者学习抵御经常伴随情绪
闪回而来的强烈无助感。
以下是我对自己及来访者使用过的一个“时光机营救行动”版本。我会告诉自己的内在
小孩，如果时间旅行是可能的，我将回到过去，制止我父母的虐待行为。在这个过程中，
我会这样说：“我会打110，会联络儿童保护机构。如果他们要打你，我会抓住他们的手臂
并将其扭到他们背后。我会塞住他们的嘴，使他们不能对你大喊大叫，甚至不能小声嘀咕
着批评你。我会在他们的头上套上袋子，这样他们就不能对你皱眉或瞪眼。我会不给他们
吃甜点就把他们赶去睡觉。为了保护你，无论什么事我都可以做到。”
这样的想象为我提供了一个逃离恐惧和羞耻感的出口，有时甚至还会让我的内在小孩
高兴地笑起来。我经常会在这个练习的最后告诉我的内在小孩，我会向有关部门举报我的
父母，使他们被送去接受培训，学习如何成为更好的父母。
或者我还会这样对我的内在小孩说：如果可以的话，我会在所有那些可怕的事情发生
前，就把你带到未来和我一起生活。我会提醒他，他现在其实和我一起生活在当下，而我
会永远竭尽全力保护他。我们现在有了强大的躯体，有了更强的自我保护能力，也有了能
够保护我们的伙伴和法律体系。
当幸存者从各个方面持续接纳他的内在小孩后，这个小孩会感到越来越安全，变得愈
发有活力，也会更喜欢自我表达。当内在小孩感受到他的“成人自我”一直在为他提供保护
时，他会感到足够安全，并开始释放与生俱来的活力、兴致、好奇心和自发性。
</tw-passagedata><tw-passagedata pid="190" name="代表团的再抚育" tags="" position="32650,450" size="100,100">代表团的再抚育
最好的再抚育是一种平衡的动态活动，它讲求平衡他人再抚育和自我再抚育这两个
相互促进的过程。再抚育有时需要他人（治疗师、慈爱的老师、和善的朋友或其他支持性
团体）发起并作出示范，向我们展示该如何抚育自己。
另外，许多幸存者还会通过阅读在潜移默化中接受他人再抚育，我的一位来访者将
其描述为“图书社区”。那些图书的作者会在字里行间鼓励幸存者重视和支持自己，从而使
他们获得再抚育。
爱丽丝就是这样一位幸存者。她的家庭在她的童年时期给她带来了非常严重的创伤，
所以她从小就认为，在别人面前表现出脆弱是非常危险和愚蠢的，她绝不会也不能这么
做。然而，在她的内心深处依然强烈渴望得到那些被无端剥夺的支持和帮助，这使她被心
理自助类图书强烈地吸引。通过阅读大量的心理学图书，她最终获得了足够的帮助，开始
相信世上存在善良、安全、能够提供帮助的人，并得到了一些非常有效的疗愈（在第十五
章“阅读疗法”中我列举了一些推荐的心理自助书籍）。
我自己也经历了一个漫长渐进的阅读和听讲座的过程，才克服了恐惧和尴尬，开始接
受系统的治疗。如前文所述，我很幸运找到了一位足够好的治疗师，这将我的关系型疗愈
推向了一个新阶段。
心理治疗使我内化并模仿我的治疗师，像他那样为我自己提供始终如一且可靠的支
持。这使我被更安全且真正亲密的友谊所吸引。我在许多来访者和朋友身上也见证了同样
的效果。最终，我建立了第一段治疗关系以外的赢得的安全型依恋关系。于是，我不再把
心理治疗当作获得深刻而有意义联结的唯一方式。
我相信从他人处获得母亲式和父亲式的支持是一种终生的需求，而不仅仅限于童年。
幸运的是，我在多年后体验到了多层次的他人再抚育，我将其称为代表团的再抚育。这
个概念中的代表团，指的是由不同亲密层次和程度的朋友组成的圈子。我的再抚育代表团
的核心圈子包括我最亲密的五个朋友。
我选入这个核心圈子中的人是我无话不谈的朋友。在他们面前我可以放心地暴露自己
的脆弱。其中包括我的妻子、一位治疗师、一位长期共同运动的伙伴，以及我长期参加的
一个社会团体中的两位成员。还有一些“编外”人员，如果我有机会与他们更常会面的话，
他们也会被纳入核心圈子。
在这个核心圈子之外，是一层层没那么亲密，但仍然有意义的关系圈。与核心圈子紧
挨着的一圈，是过去与我非常亲密，但现在不能经常见面的人，我通过想象他们在当下依
然关怀着我而使自己得到安慰。这个圈子中有我已故的祖母，还有我以前的三位治疗师、
几个在服役时期结识的伙伴、高中和大学的老友，以及我在澳大利亚生活的十年间结交的
四个最好的朋友。
在这之外的一圈有我的护理师、我偶尔见面的身体治疗师、一些同事，以及一位年
迈、睿智的图书管理员，他经常帮我儿子挑选合适的图书。
再往外的一圈是和我一起运动的朋友、我儿子朋友的父母，以及社区中的邻居。我在
和他们接触时并不会暴露自己的脆弱，但和他们在一起会感到舒服自在，这让我多了一份
归属感。
最外面的一圈是一些偶尔出现的陌生人，我很感恩能与他们不时有一些轻松的互动。
我知道一些幸存者通过有效的疗愈措施，同样从不同的人那里获得了足够多的爱，从
而使他们在童年时对帮助和支持的渴盼得到了极大的满足。和我一样，他们的“代表团的
再抚育”也是从与第一个足够亲密的人建立关系开始的。算上幸存者自己，这就形成一个
两人小团体了，然后这个小团体可以再慢慢建立起一段又一段具有支持性的关系。
</tw-passagedata><tw-passagedata pid="191" name="自我关系与他人关系之道" tags="" position="32775,450" size="100,100">@自我关系与他人关系之道
实现深层次的康复，以及成为健康的“人”，通常都需要结合自我帮助和他人帮助，即
结合自我疗愈与关系型疗愈，自我疗愈能减少因模仿父母的行为而产生的自我遗弃，关系
型疗愈则有助于愈合家庭遗弃造成的初始创伤。然而需要重申的是，曾经遭受过严重背叛
的幸存者可能需要先在除关系之外的层面做大量的努力，才能敢于冒着暴露脆弱的风险接
受关系型疗愈。
在进阶的疗愈过程中，自我疗愈和关系型疗愈融合成了至关重要的“道”。道是相反且
互补的力量的调和。“关系型疗愈之道”需要平衡健康的独立与对他人健康的依赖之间的关
系。
对幸存者来说，疗愈会发生在我们增强了自我支持能力，进而能够选择、接受对自己
有益的人际关系时。与此同时，与他人建立安全、支持性的关系也会反过来增强自我支持
能力，从而弱化自我遗弃的倾向。此外，这还会促进我们朋友圈的发展——这是幸存者在
童年时被不公平地剥夺了的重要人生资源。
我们越能做到自我支持，就越能得到他人的支持；反过来，我们得到他人的支持越
多，就越能支持自己。我们进入这个动态之“道”，有时是因为自己的努力，有时则是因为
有幸找到了支持我们的朋友或专业帮助者。
对许多幸存者来说，在尚未获得足够的辨别力来选择真正安全有益的支持前，必须先
进行大量的自我疗愈，才能接受他人关系型的支持。本书提到了许多不同的自我关怀技
巧，我们练习这些技巧的时间越多，自我遗弃的时间就越少。只要有足够的毅力，我们就
可以把自我关怀变为一种宝贵的、无可替代的习惯。
[1]依恋需求是指个体寻求并力图保持与特定对象的情感与身体联系的基本社会性需
要。——编者注
[2]美国心理学家，人本主义心理学的主要代表人物之一。——编者注
[3]结构化的社交情境指有硬性或柔性制度的情境，如上班、上学、在超市购物等情
境，人们有规则可循，知道自己和别人该如何扮演角色。而作者所提到的派对、朋友聚会
等情境——没有明确规则、人们可以自由发挥、实现与他人互动，就属于非结构化的社会
情境。——编者注
[4]相互咨询又被称为“互助咨询”，它是一种同伴之间轮流担任患者和咨询师的咨
询形式。——译者注
[5]阿斯伯格综合征属于孤独症谱系障碍，具有与孤独症同样的社会交往障碍，局限
的兴趣和重复、刻板的活动方式，但不同于孤独症的是，此病没有明显的语言和智力障
碍。——编者注
[6]Adult Children of Alcoholics，酗酒者成年子女康复协会。——译者注
</tw-passagedata><tw-passagedata pid="192" name="社交焦虑的成因" tags="" position="31325,425" size="100,100">@社交焦虑的成因
若在成长过程中没有可靠的人给予爱、支持和保护，孩子通常会对社交活动感到非常
不安。他自然而然地变得不愿意向任何人寻求支持，并且不得不把“靠自己”当作生存的策
略。
幸存者会觉得对别人有需求是特别危险的。从关系中获得安慰和支持是人与生俱来的
能力，但幸存者的这种能力受到了很大的限制，甚至完全丧失。许多高功能的幸存者尽管
有足够的社交能力，但仍会对社交感到焦虑。
在结构化的社交情境[3]中，大家的预期很明确，共同的目标使人们不再关注对话，而
聚焦任务的完成情况。然而，在非结构化的社交情境中，如派对或朋友小聚，则更有可能
触发社交焦虑。在后面这些场合中，幸存者不得不进行随性的自我表达，他会感觉仿佛闪
回到了童年时的灾难场景。
无论是结构化的还是非结构化的社交情境，幸存者在建立人际关系时往往都需要隐藏
很多焦虑和不适。我的一位来访者是位非常成功的商人，他告诉我：“我在会议上非常冷
静、沉着和镇定，是名副其实的语言艺术家，像迈克尔·凯恩（Michael Caine）一样临危
不乱。我表现得像个国王，但内心却非常纠结抓狂，我对自己说过的每一句话、做过的每
一件事都感到怀疑和羞耻，这让我痛苦不堪。”
大量的童年虐待经历会给幸存者的大脑植入一种“他人即危险”的强大“程序”。在长时
间的闪回中，幸存者严重的社交焦虑可能会演变为社交恐惧症。
在我状态最低迷的阶段，处于情绪闪回中的我甚至无法出门倒垃圾。我担心我的邻居
（她很友善，总是肯定我）会从窗户往外看，发现我是多么地可悲可怜。更糟糕的是，我
害怕她会出来与我交谈。
尽管如此，这几十年来，不管内在批判者对我的评价多么不堪，我还是参加了必要的
社交活动，而且似乎还表现得相当不错。当我没有处在闪回状态时，我甚至还感觉到有很
多人真的喜欢我。
然而不幸的是，我几乎无法从这种体验中得到任何满足或安慰，因为在我伪装的平静
外表下，我的内心涌动着不安，我常常在盘算的，就是什么时候才能以最不引人注意的方
式逃离社交场合。
</tw-passagedata><tw-passagedata pid="193" name="我的关系型疗愈之旅" tags="" position="31450,425" size="100,100">@我的关系型疗愈之旅
我经历了漫长而渐进的疗愈之旅，才逐渐敞开心扉接纳了真正的亲密关系。接下来的
故事是我在这段旅程中迈出一大步的重要标志。
我曾经有一条名叫“乔治”的狗，它是唯一能让我真正放松的存在。有一天，我和它一
起坐在我家的门廊上。突然间，乔治挣脱了缰绳，冲向了马路对面，去追赶一只猫。猫还
没追到，一辆飞驰而来的车就把它撞倒了，车的前后轮先后从它身上碾过。那是我成年以
来经历过的最悲痛的事。当冲击（解离）消退后，我就被“混杂的被遗弃感”淹没了。
悲痛之余，我还感到惊慌失措、紧张不安。就像我在童年感到不知所措时一样，我在
房间里躲了36个小时，害怕与我那些酒肉之交的室友接触。我当时28岁，仍然极其害怕展
现自己脆弱的一面。我所有的人际关系都建立在我讨好他人的行为以及伪装出来的幽默感
之上，而在当时的状态下，我什么笑话也想不出来。所以，我绝不会让别人看到我这种令
人反感的状态。
我无法入睡，睡眠状况的不断恶化让我不得不担忧自己真的快要疯了。就在这
时，“奇迹”装扮成以往我厌恶的形式飘然而至，那是一种深深地臣服于哭泣中的奇迹——
由漫长的抽泣带来的释放，给了我从未体验过的抚慰。
那是我贯穿全书所谈及的释放。当眼泪倾泻而出时，我知道自己会好起来的，也知道
自己不会疯掉，我可以用最真实的（也许是我第一次感受到的）自尊感来面对我的室友。
从那一刻起，我知道自己还需要更多这种治愈的眼泪。
</tw-passagedata><tw-passagedata pid="194" name="疗愈消解了孤独的羞耻感" tags="" position="31575,425" size="100,100">@疗愈消解了孤独的羞耻感
然而，我很快发现自己的眼泪被卡住了，就像以前一样，或者说至少从六岁开始就是
那样——那是我印象中童年时期的最后一次哭泣。进一步的阅读和研究引导我开始寻求帮
助，于是我接受了心理治疗。幸运的是，我在第一次治疗时就遇到了一位足够好的治疗
师。
这对我来说是一项里程碑式的成就，它开启了一段漫长而曲折的疗愈之旅。旅途中的
我与治疗师、治疗团体建立了深刻的友谊。在这段旅途中，有些体验对我非常有帮助，有
些体验却对治疗起了反作用，但随着时间的推移，它们都变得越发有益。
真正有效的关系型疗愈的核心是约翰·布雷萧所说的“治愈束缚你的羞耻感”。在那种
毒性羞耻感的束缚下，我只要无法做出完美的伪装，就会选择躲起来。我认为，如果没有
疗愈型关系的帮助，毒性羞耻感是无法被治愈的。治疗师和治疗团体给了我极大的帮助，
让我能够摆脱毒性羞耻感的束缚。同时我了解到，真正的亲密关系取决于我分享了多少自
己的脆弱。随着我越来越多地练习表达真实情绪，困扰我前半生的孤独感像冰川融化般一
点点消失了。
需要注意的是，对于毒性羞耻感的治疗，团体治疗比个人治疗更为有效。这是因为与
个人治疗相比，团体治疗通常更能让幸存者体会到更多人共同的脆弱。此外，我们会对与
我们有类似遭遇的人产生同情，这种同情有时会自然地延伸为对自己的同情。于我而言，
疗愈型的关系体验强化了我的自我同情，其效果远超仅靠我自己所能取得的效果。
就像前文所说的那样，我认为，缺乏自我同情是最糟糕的发展停滞，而恢复自我同情
的能力是一切有效治疗的关键。回顾治疗历程，我可以清楚地看到，随着自我同情的增
强，我的毒性羞耻感在减少。神经科学的研究表明，我们与生俱来的情绪调节和自我抚慰
能力是有限的，而越来越多的其他研究显示，与那些让自己感到足够安全的人交流能够增
强我们化解痛苦情绪的能力。
</tw-passagedata><tw-passagedata pid="195" name="切断与父母的联系" tags="" position="31750,475" size="100,100">切断与父母的联系
我的许多来访者在开始接受治疗时，仍然被致其受创的父母过度控制，包括控制其外
在行为和内心世界。有时他们的父母仅仅通过每周一通电话就能实施这种控制。同时，这
些来访者也常常处于虐待性和/或忽视性伴侣关系中，被压制或被遗弃——这种关系和他
们与父母的关系如出一辙。这是最具破坏性的强迫性重复，它迫使幸存者经历了两种最糟
糕的关系。
通过深入探索童年创伤，许多来访者终于摆脱了父母的过度控制，平生第一次实现了
心理自由。他们尽管已经独自生活了几十年，却并没有真正获得过这样的自由。这些来访
者自我抚育能力的提升，往往和大幅减少或完全断绝与父母的关系有关。
我的来访者乔之前遭遇过各种误诊：精神分裂症、阿斯伯格综合征[5]、妄想症。在开
始接受我的治疗时，他过着独居生活。他极为封闭，在生活中自给自足，但通过阅读我网
站上的文章，他意识到自己属于僵类型。
刚开始治疗时，让他开口说话就像拔牙一样困难，过了一段时间后，我发现他每天都
会与他那自恋、爱打击人的母亲通电话。通过治疗并随着他个人勇气的逐渐增强，他慢慢
减少了与母亲的通话：起初是每周一次，然后是每月一次，再后来只在重大节日才联系，
几年后他就几乎不再与她联络了。
随着逐渐摆脱令人窒息的母爱而持续地获得外部自由，乔也得到了越来越多的内心自
由。就在这时，他在一个ACA[6]团体（这个团体多年来为他提供了大量积极的陪伴和关系
型疗愈）中第一次体验到了生命中有意义的关系。乔与团体中的一位成员建立了健康的亲
密关系，在这段关系建立后的第二年，他结束了在我这里的治疗。
如果父母无情地释放“毒素”，那么即使是父母的只言片语也会触发幸存者强烈的情绪
闪回。我的许多来访者在与他们有毒的父母保持联系时，康复便进展得非常缓慢，因此他
们通常需要切断与父母的联系才能取得一定的康复进展。罗伯特·霍夫曼（Robert
Hoffman）有一本关于这一主题的经典著作，名为《脱离父母》（Getting Divorced from
Mother &amp; Dad）。
</tw-passagedata><tw-passagedata pid="196" name="学会处理关系中的冲突" tags="" position="31875,475" size="100,100">@学会处理关系中的冲突
若要恢复真实做自己的能力，有一点需要注意：不能期待别人在你肆意表达愤怒或蔑
视时也能够接受你，这样的期待是不合理、不公平的。一些创伤幸存者会在情绪闪回时肆
意地、不停地对外界事物或他人进行批判。你如果也会如此，可以参考第十章的内容来避
免这种破坏亲密关系的行为。
我们需要注意，亲密关系并不意味着无条件的爱。约翰·戈特曼（John Gottman）的学
术研究表明，产生一定程度的分歧、不满和失望是亲密关系中的正常现象。成功伴侣关系
的关键特征是，双方能够以建设性的方式文明地处理愤怒和应对伤害。戈特曼的研究发
现，在一起超过10年还仍然真心喜欢彼此的情侣都具有这一关键特征。
第十六章的四号工具箱“有爱地化解冲突”列举了一些实用的技巧和视角，它们可以帮
助情侣解决相互磨合过程中的冲突。此外，戈特曼夫妇和苏·约翰逊（Sue Johnson）的著
作也提供了大量实用的方法，丹尼尔·比弗（Daniel Beaver）的《超越婚姻幻想》
（Beyond The Marriage Fantasy）则对男性解决与伴侣的冲突特别有帮助。

</tw-passagedata><tw-passagedata pid="197" name="在循序渐进的疗愈中培养耐心" tags="" position="32200,50" size="100,100">@在循序渐进的疗愈中培养耐心
如前文所说，CPTSD的疗愈是一个复杂的过程。有时这种复杂性会让我们感到绝
望，以致于让我们想要完全放弃治疗、并长时间地陷于惰性中。所以，理解疗愈是一个循
序渐进、时进时退的过程是非常有必要的。
想要进行有效的疗愈最好每次只在一两个层面开展工作。心浮气躁、急于求成只会适
得其反。作为一个逃类型的人，我在疗愈中期的很多年间，一直像个工作狂似的逼迫自己
尽快康复，试图一次性解决和改变所有事情，但结果始终不尽如人意。
在疗愈初期，我们通常需要从简单、易上手的自我疗愈工作开始。如果你不确定如何
进行，我建议你首先尝试缩减内在批判者（参见第九章）。
随着内在批判者的缩减，你的大脑对自己友好的时间会越来越长，你自然而然就会产
生帮助和关怀自己的冲动。与此同时，你会更容易分辨出你是在用爱还是用鞭子引导自
己。如果你意识到是鞭子，请试着解除内在批判者的武装，并用善意——对挣扎受苦的孩
子的那种善意——来对待自己。
在应对内在批判者时，对自己有耐心是最为重要的。内在批判者几乎无处不在，我们
无法做到在它每次发作时都立即加以应对，否则我们将无瑕处理其他事情。但我们如果循
序渐进地练习缩减内在批判者，便可以更长久地从对它的消极关注中脱离出来，并转换到
更能进行自我支持的视角。最终，拯救自己脱离羞耻和自我憎恨将成为一种积极的新习
惯。就我自己而言，我现在仍然需要应对情绪闪回，但我已很少与自己有毒的内在批判者
沆瀣一气了。
任何形式的自我帮助都是这样形成的，我们应试图将其发展为第二本能。只要我们勤
于练习，自我帮助就会成为习惯。当我们的身体与精神的这种自我支持日益契合时，自我
帮助就会成为我们行为的内在准则，并逐渐拥有自己的“生命节拍”。
还有一种方法有助于我们康复，那就是每当内在批判者指责我们不够完美时，我们就
要去挑战这种“全或无”的思维。“追求进步而非完美”这个强有力的目标可以指引我们通过
自我帮助来实现疗愈。
随着疗愈的进行，特别是随着内在批判者的缩减、我们开始能本着爱与善的态度对待
自己时，帮助和关怀自己的愿望会更具自发性。此时我们也能这样对待自己的内在小孩
——那个被无端剥夺爱的孩子。我们之所以能做到这一点，是因为我们相信每个孩子都毫
无例外地值得被爱。
最后，各位读者如果像我过去一样，对自己的痛苦没有全面性理解的话，可能就会觉
得自己像在一条冰路上一般，始终打滑无法前进。几十年间，我尝试了各种方法，却越发
感到徒劳和失败。值得庆幸的是，我最终到达了一个无形的疗愈进程的临界点，并意识到
自己实际上已经取得了很大的进展。在疗愈的拼图中，我已经获得了足够的图块，接下来
只需要把它们整理成一张地图，就可以更进一步了。因此，我设计了一份图纸，可以帮助
我自己和幸存者了解自身的痛苦，并学习如何有效地减少痛苦。我希望本书提供的这张地
图也能为你带来解脱。
</tw-passagedata><tw-passagedata pid="198" name="接受“疗愈将持续终身”的事实" tags="" position="32325,50" size="100,100">@接受“疗愈将持续终身”的事实
我们很难接受这样一个观点和事实，即“疗愈永远不会彻底完成”。尽管闪回的次数已
经随着时间大幅地减少了，我们还是很难放弃“完全摆脱闪回”的救赎幻想。
但如果不放下对救赎幻想的执念，我们就很有可能在每次闪回时依旧责怪自己。了解
这一点至关重要，因为疗愈过程中通常会有许多次暂时性的倒退。此外，大多数疗愈过程
中的人常常会有一种不幸的主观体验，觉得这种暂时性的倒退坚若磐石，而没完没了的闪
回尤其会加重这种体验。闪回时，我们退回到童年的心智，觉得当下的被遗弃感是永恒
的，并且看不到未来的希望。
那么，我们如何才能接受“糟糕的童年已经造成了一些永久性的伤害”这一事实呢？对
我自己而言，一种有效的方式是把CPTSD看作糖尿病，也就是一种需要终身控制的慢性
病。这个坏消息当然会让人感到不适，但好消息是，就像糖尿病一样，随着我们越来越善
于闪回管理，CPTSD也会逐渐变得不那么令人困扰。更重要的是，我们真的能够逐渐变
得更好，并过上越来越丰富而有价值的生活。
更好的消息是，若能得到有效的管理，CPTSD最终会给我们带来一份礼物，就像黑
暗中的曙光那样。那些没怎么受过伤的人是体会不到这种感受的。本章的后文中对此会有
所详述。
</tw-passagedata><tw-passagedata pid="199" name="有疗愈意义的闪回与成长之痛" tags="" position="32800,75" size="100,100">@有疗愈意义的闪回与成长之痛
治愈童年的创伤是一个漫长而渐进的过程，因为恢复充分的自我表达需要大量的练
习。“做自己”可能会令人畏惧，并引发闪回——在许多创伤性家庭中，健康的自我主张会
遭到严厉的惩罚。因此，用父母曾禁止的方式来表达自我，一开始通常会引发强烈的闪
回。这可能导致人们很难相信，这项练习能够逐渐减少由于强迫自己“保持隐形”而造成的
慢性痛苦。
我们可以把这些情况看作是有疗愈意义的闪回，以此来鼓励自己面对这些成长之痛。
然后我们可以选择接受这些闪回，从而挣脱过往经历对我们的束缚，重新夺回被父母剥夺
的基本权利，并最终拥有我们应得的东西。
为了进一步帮助自己挺过这些必要的闪回，我们可以把“勇于表达”比作牙疼时去看牙
医。如果不接受看牙过程中的疼痛，我们将长期遭受牙疼的折磨。如果我们不勇于表达自
己，沉默带来的孤独感将永远禁锢着我们。
从极端痛苦的童年中恢复之所以如此困难，是因为我们会本能地想要避免更多的痛
苦。有时，我们甚至能够在理智上认同冒着闪回的风险来练习自我表达的必要性，但是当
可以用沉默来轻易避免闪回时，我们还是会忍不住想要放弃表达，保持缄默。
可是如果想要恢复自己真正的声音，我们就必须唤起勇气，表达心声。在我看来，勇
气是通过恐惧来定义的，它意味着即使害怕也要采取正确的行动。做不让自己恐惧的事并
不算真正的勇敢。
第十一章中介绍的表达愤怒的练习可以极大地帮助我们解决这个问题。有了足够强烈
的意图，我们可以把偶然被唤起的“虽惧犹战”的勇气作为起点，敦促自己将内在小孩从隐
形无声的孤独中拯救出来。在这一练习中，我们最终会了解到，恐惧并不意味着丧失了所
有能力。我们虽然感到恐惧，但仍然能够有力地采取行动。我们可以拒绝隐忍，勇于表
达，争取发言权，说出自己的喜好，并学会说不，从而设立边界。
经过足够多的练习，疗愈性的闪回不仅会减少，它还会被一种健康的自豪感所取代，
这种自豪感源于我们勇敢的自我支持。我们会越来越多地从这个世界获得安全感、归属
感。
对于更深层次的康复来说，理解这一点至关重要，即恐惧、羞愧和内疚的感受，有时
标志着我们的所言所行是正确的。这些感受是一种情绪闪回，源自我们过去试图要求正当
权利时遭受过的创伤。
随着疗愈的进展，我们需要学会忍耐这些感受，并且学会重新解释这些感受的深层含
义。一般来说，我们需要这样的领悟：“我感到害怕，但我已不像小时候那样处于危险之中。”
“我感到内疚，不是因为我有错，而是因为我曾因表达意见、需要和喜好而被迫感到
内疚。”
“我感到羞耻，是因为我的父母对于我做自己充满了厌恶。如今我明白了他们是怎样
谋杀我的灵魂的，我要拒绝父母有毒的诅咒。我要用厌恶回应他们对我的羞辱，任何健康
的成年人在看到家长轻蔑地欺负孩子或无情地忽视痛苦的孩子时，都会产生这种厌恶。”

</tw-passagedata><tw-passagedata pid="200" name="最佳压力" tags="" position="32925,75" size="100,100">最佳压力
我记得有一句名言，“人不是忙着生，就是忙着死”。这句话鼓励我不断追求成长和进
步，走出童年的创伤。事实上，神经科学领域的一些最新研究表明，我们在生活中确实需
要少量的压力，这种压力被称为最佳压力（Optimal Stress）。
最佳压力是一种平衡、适度的压力，这种压力对于新神经元及神经元连接的生长是必
需的，而这些神经元及神经元连接与大脑健康息息相关。研究表明，压力太大会催生损害
大脑神经元的生化条件，而压力太小会导致神经元的萎缩、死亡，并影响新旧更替。这就
是为什么终身学习被广泛认为是预防阿尔茨海默病的重要手段之一。
在疗愈之路上，追求长期发展的幸存者一般会比普通人取得更大的整体性进步。而对
于许多未受创伤的人来说，他们对学习的追求往往仅止于最高学历（高中或大学）。
在我看来，终身疗愈就是一种重要的终身学习。例如，阅读自助书籍、参加自我改善
的研讨会、写日记来加深自我理解，或者在治疗过程中和不断发展的关系中努力展现更多
的脆弱和真诚。我认为，在我们为治疗发展停滞而进行各项练习时，经常会处于最佳压力
状态。此外，轻微的闪回有时也能带来最佳压力。我确实发现一些长期进行疗愈的人一直
在不断进步，并且在晚年时变得更加敏锐。</tw-passagedata><tw-passagedata pid="201" name="黑暗中的曙光" tags="" position="33050,75" size="100,100">
黑暗中的曙光
那些在长期疗愈过程中坚持下来的人，往往会得到远超常人的情绪智力回报。这在某
种程度上看起来有些矛盾，因为童年创伤的幸存者最初在情绪天性上受到的伤害比一般人
严重。
然而，这黑暗中的曙光就是，由于受到的伤害非常严重，我们中的许多人迫使自己有
意识地去应对痛苦。那些得到有效疗愈的人，不仅从情绪损伤中明显恢复过来了，还能比
一般大众的情绪更敏锐。我的一位来访者称他“比‘正常人’的情绪智力高得多”。
也许提升情绪智力的最大回报就是具备更好的能力去获得更深刻的亲密关系。情绪智
力是关系智力的基本组成部分，而一般大众的关系智力也在普遍减退。
如前所述，当两个人坦诚相见时，亲密关系会得到极大的增进，尤其是当他们打破了
充分情感交流的禁忌时。当我们对等地全面展示自我（自信或恐惧、爱意或疏远、骄傲或
窘态）时，就会自然地强化爱、欣赏和感激的感受。两个人若能建立起如此真挚而相互支
持的关系，该是多么令人惊叹的成就啊！而只有双方都做出巨大努力，将自己从成长过程
的消极影响中解放出来，才有可能建立起最亲密的关系。
</tw-passagedata><tw-passagedata pid="202" name="“未经审视的人生不值得过”" tags="" position="33175,75" size="100,100">“未经审视的人生不值得过”
疗愈中的另一线曙光是获得更丰富的内心世界。内省的过程对于有效的疗愈非常重
要，它最终还会让幸存者的心理世界变得更加深刻而丰富。持续有意识地探索自己各方面
的经历，能让幸存者体会到苏格拉底所说的“未经审视的人生不值得过”这句话中的智慧。
遵循内省式发展这条“少有人走的路”的幸存者，会逐渐摆脱对家庭、宗教和社会价值
观的强迫性、无意识的忠诚，那是幸存者在易受影响的年龄被灌输的愚忠。现在他可以选
择自己的价值观，并拒绝那些不符合自身利益的价值观。他会发展出一种更深层、更坚定
的自尊，而不是随波逐流，紧跟流行趋势。按照心理学的说法，就是变得足够自由、勇敢
和独立，并且能够发展自己的全部潜力。
用约瑟夫·坎贝尔（Joseph Campbell）的话说，幸存者学会了“追求自己的幸福”。他
可以更自由地追求自己感兴趣的活动和爱好，并逐渐形成自己的风格。他甚至敢于不按主
流时尚标准来着装和打扮自己。他还会将这种自由延伸到家居装潢中。因此，许多幸存者
发现了自己独特的审美，并且总体来说对美更具欣赏力。与之形成鲜明对比的是，许多和
我一起运动的“正常人”，他们的家居往往缺乏装饰，似乎是因为担心自己的品位不够潮流
而不敢增添摆设。
当幸存者重新获得了自由选择的权利后，他会变得更愿意尝试新事物——那些主流社
会认为不好甚至视为禁忌的健康事物。以下是我认为对疗愈与健康的日常生活有益的一些
行为或事物：自愿的简单生活、改善饮食、冥想、替代医学（Alternative Medicine）[2]、
广泛的同情心、环保主义、更深入的情感交流，以及更广泛地运用哀悼。
内省式发展会使疗愈中的幸存者在面对重要的生活抉择时具备更多的视角和智慧，同
时也会改善他们日常的本能选择，例如在面临真正的危险时应该选择战斗、逃跑、僵住还
是讨好。
最后，在疗愈后期往往还会出现另一线曙光，那就是幸存者更有能力通过最健康、最
不会再次受创的方式来应对正常的痛苦。我所说的正常的痛苦指所有人时不时都会遭遇的
反复出现的存在性痛苦，如损失、疾病、财务困难、时间压力等。这些痛苦的遭遇会带来
愤怒、悲伤、恐惧和抑郁等情绪反应。一般人如果没有学会口头宣泄并消化对这些事件的
感受，就会过久地陷入痛苦情绪中，特别是抑郁情绪。</tw-passagedata><tw-passagedata pid="203" name="“别担心，要开心”的情绪霸权" tags="" position="33300,75" size="100,100">@“别担心，要开心”的情绪霸权
康复中的幸存者之所以有更高的情绪智力，原因之一在于他们终于看穿了主流媒体灌
输的“人应该一直开心”的理念。
然而，许多普通人一直在焦虑地努力“改善”自己的情绪，因而变得与自己的真实情绪
体验日益疏离。他们努力地追求快乐，仿佛这是一项义不容辞的责任，并且越来越多地采
用社会接受的成瘾行为来实现这一目标——贪吃零食、乱花钱、自我药疗、沉迷网络……
这些普遍的成瘾行为似乎一直在呈上升趋势。
另一个特别猖獗而不健康的情绪调节方式是色情成瘾。对色情制品的成瘾导致很多沉
迷其中的男性出现了糟糕的意识狭窄现象，而这往往会损害他们享受真正亲密关系的能
力。可悲的是，使用色情制品越来越“正常化”，甚至在许多心理学圈子中也是如此。
随着情绪智力的提升，我们能够将自己从令人疲惫不堪的“一定要开心”的压力中解救
出来，不再一直督促自己在生活中提升兴致。
请不要把这理解为反欢乐文化。拥有天然的欢笑和快乐是一种祝福。但我认为，抵
制“快乐至上”这一日益强大的情绪霸权，也是一种祝福。我们每天都受到广告、充满笑声
的电视节目，以及各种“心灵导师”的攻击，他们通过羞耻感让我们相信，如果我们不能时
刻洋溢着迪斯尼乐园般的热情，我们就“不够好”。
几十年来，必须时刻积极向上的压力总是会触发我的羞耻感。可悲的是，我目睹了越
来越多的来访者和朋友因为不够快乐而在自我蔑视中挣扎。我们必须意识到，如果快乐不
够真挚，反而会演变为令人沮丧的悲哀，有时还会造成疏离感。在最糟糕的情况下，有控
制欲的自恋狂会对我们进行情绪勒索，让我们与他一起虚假地快乐，而我们这些关系依赖
者会强迫自己用笑声来掩盖恐惧或羞耻。
我也无意否认真挚快乐的感染力。快乐的感染力会积极地引导人去感同身受地分享他
人真挚的快乐，这无疑是一种美妙的体验（如果想体验一下这种快乐，可以上网搜索“四
胞胎的笑声”）。而真挚的快乐似乎在得到良好抚育的孩子身上更为常见。我不认为快乐
是成人生活中的主导情绪，除非通过药物或酒精进行人为诱导。不过，随着幸存者在努力
疗愈的过程中获得更多安全感，其快乐体验是可以变得越来越多的。
我遇到过许多这样的情况：随着情绪智力的提高，我们对快乐的期望也会变得更加合
理，这使我们能够放下“永久的快乐”这个不切实际的疗愈目标。在做到这一点之前，我们
的内在批判者仍会轻蔑地责备我们不够快乐。我的一位来访者最近开始注意到，他会因为
自己没有啤酒广告中的人们那么欢快而羞辱自己。
作为本章的总结，我必须强调一点：和生活中的大多数事物一样，CPTSD也有轻重
之分。CPTSD的轻重程度具有连续性，从轻度神经官能症到精神病，从高功能到无功
能，都包含其中。其严重程度可以涵盖从长时间不再闪回，到大部分时间完全处于可怕的
闪回之中。其功能状态也涵盖了从日益充满活力的成长状态，到勉强求生的失能状态。
因此，疗愈的进展体现为闪回变得更容易控制，以及更频繁地对生活感到满意。我的
一个朋友曾开玩笑说：“我已经康复了，已经比正常状态还要正常了，简直超乎寻常，正
常人跟我比起来倒像是患有CPTSD。”
本章关于疗愈的概述就此结束。下一章将解释不同的童年创伤史是如何导致CPTSD
的。我们会发现，单是言语和情绪虐待便可引发CPTSD，而且重度的情感遗弃通常是大
多数CPTSD的根源。
[1]塔纳托斯（Thanatos）是古希腊神话中的死神。弗洛伊德等人将这个词解释
为“死亡的愿望”。他们认为，在人的意识中存在着与求生本能相抗衡的求死本能。——
编者注
[2]替代医学也被称为“替代疗法”，是常规西医疗法的补充疗法，包括催眠、顺势
疗法、按摩疗法、针灸等。——编者注
PART TWO
</tw-passagedata><tw-passagedata pid="204" name="识别康复迹象的困难" tags="" position="32625,50" size="100,100">@识别康复迹象的困难
有些读者可能为了康复努力了很久，却错误、羞耻地认为自己没有取得任何进展——
这是因为CPTSD幸存者常会陷于“全或无”的思维方式。处于疗愈初期的幸存者往往未能发
现或认同自己取得的实际进展。
然而，如果我们意识不到自己的康复进展，就会面临放弃疗愈的巨大风险。非黑即白
的思维经常使我们落入陷阱，即不承认和不重视我们实际取得的成果。在疗愈初期的一种
常见现象是，只要没有获得100%的改进，幸存者就会用完美主义去否定它。以下是一些
常常被幸存者忽视的康复迹象。
1. 4F反应的程度有所减轻
2. 越来越能抵御内在批判者
3. 更善用正念来应对闪回或内在批判者的攻击
4. 认为自己足够好的频率更高了
5. 在第二章所列的发展停滞方面取得了进展
6. 暴饮暴食或药物使用有所减少
7. 体验到更多足够好的人际关系
8. 闪回的强度和痛苦程度有所减轻
针对上面的第3条，需要注意的是，即使正念没有立即终止闪回或内在批判者的攻
击，能意识到并识别出这些CPTSD的表现就比盲目地迷失其中有很大的进步了。此外，
如果能够持续地识别这些现象，我们便能更容易地采取有效的改善措施、有针对性地使用
第八章所列的闪回管理方法。
另外，同样重要的是，我们应该关注闪回感受（焦虑、羞愧和抑郁）强度的逐渐降
低。这一点体现在社交焦虑会沿着以下路径逐渐减少：恐慌性退缩→更易忍受的社交不适
感→对社交感到自在。你也可以关注抑郁程度的逐渐减轻：令人无力的绝望→快感缺失
（无法享受正常的生活乐趣）→疲惫状态→相对没有动力的平静状态。当然，这两种改善
的过程通常都是来回摇摆、进退反复的。
写到这里，我不禁对往日的经历感到悲伤，因为过去几十年间，我一直以一种“全或
无”的方式来判断我的情绪基调和心情的好坏。如果我的感觉不是非常好，我就会觉得一
切都很糟糕。由于“感觉非常好”对于大多数人而言都是相对稀少的体验，所以“很糟糕”的
感觉成了我的情绪主导，但这其实是完全没有必要的。事实上，哪怕只是出现了一些轻微
的不愉快，我都会因为“全或无”思维而迅速陷入糟糕的感觉。
每当有新的闪回发生时，不论其强度比从前减轻了多少，内在批判者都仍会驳斥进步
的迹象。羞耻、恐惧或抑郁的每一次复发，都会被内在批判者视为毫无改进的证据，即使
复发次数已经在不断减少了。
内在批判者使用的是一套非黑即白的评估标准：要么已经痊愈，要么就是仍然有无可
救药的缺陷。一旦你认同内在批判者，认为自己有缺陷，就会开启恶性循环，进入全面发
作的情绪闪回。这种感觉就像再次落入毒性羞耻感的冰层，被冻结在CPTSD的无助和无
望中。
我非常感恩自己能获得改变人生的顿悟——放弃了过往那种对“欢庆”的渴望，转而追
求“宁静”。
</tw-passagedata><tw-passagedata pid="205" name="内在批判者的神经生物学理论" tags="" position="33675,150" size="100,100">@内在批判者的神经生物学理论
无情的批评，特别是父母出于愤怒和蔑视而进行的批评，具有极大的伤害性，甚至会
改变孩子的大脑结构。
反复出现的轻蔑信息会被孩子内化和接受，最终孩子会在自己心中不断重复这些信
息。这样的不断重复会加强有关自我憎恨和自我厌恶的神经通路。日积月累，孩子在思
想、感情和行为上的自我厌恶程度会越来越高。
随着父母批评的持续性加强，有关自我憎恨和自我厌恶的神经通路会扩张为复杂的大
型神经网络，成为主导孩子心理活动的内在批判者。内在批判者的消极视角生成了许多关
于自我厌弃的完美主义“程序”，使孩子时时自危，不断地小题大做。最终，只要孩子想进
行真诚或脆弱的自我表达，就会激活自我厌恶的内在神经网络。孩子被迫生活在一种自我
攻击的不健康状态中，并最终彻底抛弃了自我，完全失去自我支持和自我保护能力。第九
章和第十章将对如何抑制和消除这些毁灭性“程序”展开讨论。在完成这一步之前，幸存者
通常大多数时间都生活在不同程度的情绪闪回状态中。
在虐待“洋葱”的言语层和情绪层之下，还有许多更细的“最小化”层，扭曲地否认虐
待。我曾听过许多来访者用玩笑的口吻一再重复类似以下的话：“我知道我对自己很苛
刻，但要不是我一直对自己这么狠，我肯定比现在还失败。说真的，如果我试图逃避，你
可一定要批评我！”一个充斥着言语虐待和情绪虐待的童年迫使孩子如此彻底地认同批
判，仿佛批判就是他全部的自我一样。
摒弃对批判的认同，循序渐进地将神经系统从批判者主导的状态中解放出来是一场持
续终生的斗争。在这场斗争没有取得一定的胜利之前，自我（Ego）很难得到健康有益的
发展。为了让自己不再认同有毒的内在批判者，你需要长期不断地与之交锋。斗争的过程
总是循序渐进且时进时退的。如果你能够在一次次重新陷入自我谴责的旧习惯时有意识地
原谅自己，那么你将获得更大的成功。讽刺的是，一种有害的自我憎恨会伴随着自我审
判：一个人连摒弃内在批判者都做不到，真是一无是处。这正是一种典型的、有毒的“全
或无”批评视角。更令人难过的是，许多幸存者在意识到内在批判者折磨他们的诸多微妙
方式之前就放弃了抗争。
现在让我们来看看，情感忽视本身是如何创造出支配人心理的内在批判者的。
</tw-passagedata><tw-passagedata pid="206" name="情感忽视：造成CPTSD的核心伤害" tags="" position="33800,150" size="100,100">@情感忽视：造成CPTSD的核心伤害
幸存者对CPTSD的否认，其核心是对大量情感忽视所造成伤害的“最小化”。当我们真
正感受并理解了在情感上被遗弃的巨大破坏性时，我们的疗愈就会取得质的飞跃。缺乏父
母的关爱和照顾（尤其是在人生的头几年）会使孩子产生巨大的空虚感，对生活感到痛
苦、恐惧。因为儿童在很长一段时间内是无助和无力的，当他们感到无人可依靠时，就会
感到害怕、痛苦和沮丧。成年幸存者感受到的持续性焦虑其实多是这种仍在持续作痛的恐
惧，而这种恐惧就源于曾经可怕的被遗弃经历。
许多幸存者从未发现并疗愈这一层面的创伤，因为他们把自己的痛苦过度归咎于显性
虐待，而从未触及情感遗弃这一核心问题。如前文所述，这种情况特别容易出现在那些随
意将自己的创伤与受到更明显、更戏剧化虐待的人相比较的幸存者身上。这一点颇为讽
刺，因为有些人遭受了严重的显性虐待，却没有发展为CPTSD。他们之所以“幸免于难”，
通常是因为有一位照料者没有在情感上忽视他们。
如果孩子在有需求或面临危险时找不到可以求援的照料者，就会造成情感忽视的创
伤；而如果没有其他成人（亲戚、兄姐、邻居或老师）可以提供安慰和保护，就会导致孩
子患上CPTSD。特别是在婴幼儿时期，如果遗弃行为每日每夜地持续，孩子就更有可能
患上CPTSD。
在情感忽视的环境中长大，就如同父母的温暖和关爱之泉外有一个坚硬的围栏，而孩
子只能在围栏外，几近脱水。情感忽视使孩子感到自己没有价值、不会被爱、充满了痛苦
的空虚感。这会使他们产生一种饥渴感，这种感觉深深地啃噬着他们的内心，使他们疯狂
地想要得到他人的温暖和安慰。
</tw-passagedata><tw-passagedata pid="207" name="情感饥渴与成瘾" tags="" position="33925,150" size="100,100">@情感饥渴与成瘾
由父母遗弃导致的情感饥渴通常会随着时间的推移演变为难以满足的物质或行为成
瘾。幸存者对早期遗弃经历的“最小化”，之后往往会演变为对物质和行为成瘾问题的“最
小化”，以此来合理化自己的成瘾行为。幸运的是，许多幸存者最终会意识到成瘾是有问
题的。但许多人仍会轻视成瘾的有害影响，并玩笑般地否认自己有必要停止或减少对物质
或行为的依赖。
如果幸存者没有意识到创伤对自己的影响，或者没有创伤记忆，那么成瘾行为往往是
可以理解的，因为这相当于是在用不得要领的方法来试图减轻痛苦的情绪闪回。但许多幸
存者现在已经长大，有能力发现成瘾是对自己有害的，也有能力学会更健康的自我慰藉方
式。
物质和行为成瘾如过度进食、消费、饮酒、使用药物、性行为、工作等都可以被看作
是转移内心痛苦的错误尝试。因此，我们可以将改变这种习惯的愿望作为一种动力，用于
学习更好的自我慰藉方式。例如，第十一章将会谈到，哀悼是消除内心痛苦不可替代的工
具，可以帮助我们避免以有害的方式分散对痛苦的注意力。
</tw-passagedata><tw-passagedata pid="208" name="依恋需求的进化基础" tags="" position="34100,150" size="100,100">@依恋需求的进化基础
人类大脑的进化开始于采集狩猎时期，这一时期占了人类自诞生以来99%的时间。那
时的孩子必须紧紧依靠成人才能躲避捕食者，即使是短暂地失去与父母的联系，也会引发
他们的恐慌，因为猛兽只需几秒就能抓走一个没人保护的孩子。
恐惧是孩子与提供保护的成人分离时产生的一种正常反应，这种反应根深蒂固。恐惧
还与战反应自动联系在一起，这样当孩子遭受遗弃或需要关注、帮助时，就会自动开始哭
嚎。然而在那些导致CPTSD的家庭中，父母非常厌恶孩子哭闹，打从孩子小时候起就警
告他们不许哭。（也有一些父母任由年幼的孩子自己“哭个够”，却不给孩子任何的关注与
关怀。）
在大多数不健全家庭中，父母会在孩子需要帮助或关注时不屑一顾。但即使是没有恶
意的父母，有时也有可能严重忽视孩子，因为他们认同了“孩子需要的是高质量的陪伴，
而陪伴多久并不重要”这一臭名昭著的20世纪“智慧名言”。
如果孩子长期无法与父母建立起必要的联结，就会变得越来越焦虑、不安和抑郁。在
创伤性家庭中，孩子极度缺乏关爱，并极需被照料。照料者却很少或从不提供支持、安慰
和保护。
如果你经历过这些，那么长大后你就会觉得没有人喜欢你，没有人愿意听你说话或想
要靠近你，没有人与你共情、给你温暖或表示亲近，没有人关心你的想法、感受、行为、
愿望或梦想。你从小就知道，无论你经受多么大的伤害、疏远和恐惧，求助于父母只会加
剧被拒绝的痛苦感受。
如果父母在孩子需要帮助和支持时对其置之不理，孩子的内心世界就会混杂着噩梦般
的恐惧、羞耻和抑郁。长此以往，痛苦就成了孩子自我体验中的主导感受，这种感受难以
控制，以致他们不得不通过解离、自我药疗、攻击自己或他人来转移注意力。由于长期缺
乏温暖和保护，被遗弃孩子的内在批判者开始恶性生长，导致其情况进一步恶化。孩子寄
希望于通过完善自己来获得他人的接纳。于是，孩子在开始自我反思时，会出现这样的认
知：“我真是卑劣、没有价值、不值得被爱、丑陋不堪；如果我能像电视上的孩子一样完
美，也许父母就会爱我了。”
这样一来，孩子就会过度注意自己的不完美之处，并努力使自己变得完美无缺，最后
他们会根除一项最根本的“缺陷”，即渴求父母的时间或精力这项“弥天大罪”。出现这种行
为的根源是，孩子越发警觉地注意到，每当他需要父母的关注、倾听、兴趣或感情时，父
母都不加理会，或者变得愤怒或厌恶。
仅情感忽视本身就会导致儿童自我遗弃，并放弃塑造自我。他们这样做是为了保持与
父母有联结的假象，保护自己免于失去这种脆弱的联结。但这通常需要自我放弃很多，例
如，放弃自尊、自信、自我关怀、自我利益和自我保护。
此外，当孩子明白无法指望父母来保护自己免受外界的危险和不公正待遇（更不用说
来自家里的危险）时，其内在批判者的自危“程序”就会加剧。他们唯一的应对方式就是对
可能出错的事情过度警惕。他们的内在批判者为他们罗列了许多可能发生的灾难，特别是
那些被媒体生动描绘过的灾难。
媒体给被遗弃孩子的内在批判者提供了许多素材。孩子可能每天都会看数小时的电视
节目，这些节目可能涉及嘲讽、诽谤和霸凌，这会给孩子留下了世界充满敌意和危险的印
象。更糟糕的是，对孩子进行情感忽视的父母通常会把孩子直接丢给他们最青睐的保姆
——电视机。
在这样的忽视下，孩子的意识最终会被极端化和灾难化的想象所淹没。这其实是内
在批判者的常用伎俩，但会导致孩子不断在脑内预演恐怖的场景，徒劳地为最坏的情况做
准备。在这一过程中，CPTSD症状伴随着过度的压力和毒性羞耻感开始出现，并且会被
许多平时无害的刺激因素触发。
这些刺激因素主要是除父母外的其他人，特别是陌生人，或者隐约让孩子想起父母的
人。久而久之，内在批判者会认为其他所有人都是危险的，只要有陌生人或不了解的人进
入视野，就会自动触发战、逃、僵或讨好反应。
这种“人很危险”的意识通常会演变为社交焦虑，而社交焦虑是CPTSD的常见症状，严
重时会发展为社交恐惧症或广场恐惧症。在我看来，广场恐惧症很少是出于对开放空间的
恐惧，相反，它其实是一种变相的社交恐惧症，其本质是因为怕遇到人而恐惧外出。
</tw-passagedata><tw-passagedata pid="209" name="情感遗弃会降低情绪智力和关系智力" tags="" position="34225,150" size="100,100">@情感遗弃会降低情绪智力和关系智力
如上所述，被情感遗弃的孩子往往会把所有人都视为危险的存在。无论是别人的善
良、慷慨，还是向他们投来的爱意，都会被他们在潜意识中视为威胁而予以排斥。他们会
不自觉地担心自己在暂时“骗得”他人的喜欢后，一旦社交完美主义不可避免地失败，并暴
露出自己其实毫无价值时，那本不应得的爱的奖励就会消失。而当这种情况真的出现时，
他们会陷入更深的“混杂的被遗弃感”中。
情绪智力和与其紧密相关的关系智力都会因父母的情感遗弃而陷入发展停滞。这些孩
子从来不知道与他人建立健康的关系可以带来抚慰和充实感，而他们接受爱与关怀并从中
受益的能力往往也处于休眠状态，未曾得到发展。
此外，在这些孩子的成长过程中，从来没有人为他们树立过榜样，并教他们如何在重
要的关系中适当地管理正常出现的情绪，这使他们在愤怒、悲伤和恐惧方面的功能性情绪
智力也陷入发展停滞状态。
</tw-passagedata><tw-passagedata pid="210" name="练习展现脆弱" tags="" position="34375,150" size="100,100">@练习展现脆弱
情感遗弃可以通过我在前文讨论的那种真正的亲密关系来治愈，而真正的亲密关系需
要我们展现出自己的脆弱。当我们处于恐惧、羞耻和抑郁感混杂的情绪闪回中时，如果能
够成功地与一个足够安全的人建立联结，就能实现深层次的康复。
因此，我多年来都在刻苦地练习展现自己的痛苦的能力。起初我只能偶尔做到，因为
我太习惯童年时默认的处理方式了：每当处于“混杂的被遗弃感”中时，我就会用物质或讨
好他人来掩饰或伪装。但后来，我日益反感这种由病态的关系依赖导致的社交完美主义，
这反而使我获得了加强练习的力量。现在我知道摆脱孤独的唯一方式，就是冒险看看那些
我信任的人是否能接受我的全部，而不只是闪光点。
当然，像大多数幸存者一样，当我一开始甚至不知道自己经历着“混杂的被遗弃感”的
痛苦时，又如何能正视这种感受呢？甚至在我正视了童年的虐待及忽视之后，我仍然确信
向治疗师以外的人分享闪回感受只会招致别人的厌恶。而且我对治疗师的信任一开始也并
不坚定，特别是在我闪回最严重的时期。
值得庆幸的是，治疗师带给我的足够积极的体验让我最终有勇气在其他我所选择的，
逐渐使我感到可靠的关系中展现真实的脆弱，并找到了以前不敢奢望的接纳、安全和支
持。
本章开篇关于洋葱的比喻其实具有一定的局限性。后期的疗愈通常需要在多个层面同
时进行，但正视情感遗弃和忽视是一个终身的过程。重新审视情感遗弃经历中的核心问题
对我们的影响，有时比当初发生的遗弃本身对我们的影响更为深远。
曾经的一次经历让我感觉挨打比被遗弃的感受还要好一些：当时患有抑郁症的母亲锁
着卧室门，把我遗弃在门外很长一段时间。尽管我知道拍打房门会让她爆发，但我还是这
么做了，因为我实在无法忍受这种被孤立的感觉。这件事已经过去了很久了，但把它写出
来时，我还是流下了苦甜参半的泪水。
在剥开“否认”洋葱的过程中，苦甜参半的泪水并不少见。泪水之所以苦，是因为我们
现在意识到的情感遗弃比之前理解的更具有破坏性。泪水之所以甜，是因为它们证实了回
忆的真实性，并且会把责任归于真正的责任方。之后，泪水可能又变得有些苦涩，因为可
怕的情感遗弃反复发生于我们年幼的时期，而那正是我们理应获得大量帮助的时候。最
后，泪水可能又有些甜蜜，因为其中也饱含了感激——在经历了如此深层次的疗愈后，我
们往往会对自己遭受的痛苦具有更多的同情，并为自己的幸存感到由衷的自豪。
在我最近一次类似的哀悼中，我意识到，我的泪水之所以甜蜜是因为现在的我能够经
常在关系中得到足够的爱和安全感。而我的泪水之所以苦涩是因为我仍然会在情绪闪回时
想起那种被遗弃的感觉，并且我无法得到他人的慰藉，甚至连我的妻儿都无法使我感到安
慰。不过，我的泪水最后又变得甜蜜起来，因为现在的我已经能够很容易地处理我的闪回
了，特别是当我越来越熟练地运用第八章中介绍的工具时。
</tw-passagedata><tw-passagedata pid="211" name="叙述的力量" tags="" position="34500,150" size="100,100">@叙述的力量
越来越多的证据表明，CPTSD的康复进展会体现在幸存者对自身生活的叙述中。康
复的程度体现在幸存者故事叙述的完整性、连贯性、情感的一致性，以及多大程度采用了
自我同情的叙述角度上。
根据我的经验，那些能够反映深层次康复的叙述，往往在描述所遭受的痛苦和需持续
处理的问题时，更强调情感忽视所扮演的角色。
我的一位来访者马特在母亲节前两天剥下了他的“否认”和“最小化”洋葱上的一大层
皮。他在那次面谈时正处于一次严重的闪回中。“生活糟透了，而我更糟糕。我连挑选母
亲节贺卡这样简单的事都做不好。”
幸运的是，自上一个母亲节以来，马特已经能在很大程度上正视母亲对他的忽视和遗
弃了。一年前的他还认为自己的母亲是位好母亲，因为她从未打过他。而当他在贺卡店逛
了一小时，却找不到一张可以寄给母亲的贺卡时，他的情绪闪回被严重触发。经过进一步
的分析，我们发现问题在于每张卡片上所写的祝福语都让他觉得自己背叛了他的内在小
孩。
“我跟你说，皮特，那些贺卡中的感激之辞全都不适合我。我记忆中的母亲从未对我
说过什么好话、做过什么好事！”接着，他开始深深哀悼自己缺失的母爱，因为母亲轻蔑
的眼神和讽刺的语气而愤怒和哭泣：“为什么我只能得到这样不堪的母爱呢！”在那次治疗
快结束时，他感到自己的闪回消退了，并再次恢复了自我支持的感觉，这正是健康哀悼的
效果。从闪回中解脱出来也使他恢复了健康的幽默感。最后，他侃侃而谈起来：“我要为
我这样的人开展一项贺卡业务，为那些有病态母亲的人制作一系列贺卡。贺卡上这样写怎
么样？‘感谢妈妈从不知道我在哪个年级’，或者‘感谢妈妈总是在我受伤时离开’，或者‘感
谢妈妈教我如何只注意自己的问题’，或者‘感谢妈妈教会我厌恶自己’。”
了解父母在养育和保护你的责任中有多么严重的失职，是疗愈过程中的重中之重。一
种非常有益的方法是，将情绪闪回看作童年的自己发来的一条信息，你需要做的就是从中
了解父母是如何拒绝你的。当你充分解构了自己对情绪虐待和情感遗弃的否认，你通常就
会对童年的自己产生真正的同情。这种自我同情会为你提供童年时不曾有过的体验，即在
痛苦的情绪中得到安抚，而非蔑视或忽视，从而缓解被情感遗弃的感觉，并帮助你纠正自
我遗弃这一童年生存习惯。这还可以进一步激励你去识别和解决各种虐待或忽视。
最后，真正了解在童年被情感遗弃具有深远影响，它是能让人获得力量的成就。在闪
回的当下意识到自己此时的困惑和无望的感受，是在情绪方面重新经历童年的创伤，这往
往就能驱散闪回。这一过程具有无可比拟的重要性，可以产生保护童年自我和当下自我的
冲动，并启动解决闪回问题的流程。
</tw-passagedata><tw-passagedata pid="212" name="迷人的霸凌者" tags="" position="33850,575" size="100,100">迷人的霸凌者
战类型的人恶劣到极致时可能会发展出反社会型人格，成为反社会者。反社会者的退
化程度各有不同，他或是腐败的政客，也可能是一名残忍的罪犯。有一种尤为可恶的反社
会者，我称之为“迷人的霸凌者”，这类人大概属于中等退化程度。迷人的霸凌者有时会表
现得非常友好，甚至偶尔会倾听他人，并给予一些小的帮助，但本质上，他们仍然会通过
蔑视来压迫和控制他人。
迷人的霸凌者通常会寻找替罪羊来倾泻他的尖刻。这些不幸的替罪羊通常比他弱小：他的下属、他的“有问题”的孩子或妻子等。一般来说，迷人的霸凌者不会伤害他最喜欢的
人，除非这些人做了越轨的事。
如果迷人的霸凌者魅力十足，那些接近他的人往往不会意识到他对待替罪羊的过分卑
劣行径。被霸凌者“偏爱”的人往往会否认对霸凌者的控诉，并为自己不是他的攻击目标而
感到宽慰。特别有魅力的霸凌者甚至可能受人钦佩，被视为伟人，而作为替罪羊的孩子或
配偶则会感到迷茫，因为他们很难让别人相信自己曾经或正在遭受虐待。
我记得曾在照片中看到希特勒对他的孩子非常温柔，因而感到十分困惑。当我写到这
里，我意识到许多备受推崇的亿万富翁大都经不起仔细审视。他们使用不合法的手段来积
累财富，例如恶意的收购、剥削性的劳工政策、有害健康的工作条件、破坏环境的行为，
以及其他各种形式的欺骗、撒谎和陷害。
某些大型工厂经常把新来的年轻工人安排在“创新性”生产线前端，而在生产线后端的
则是那些疲惫、精力被消耗殆尽的工人，这些工人一旦无法跟上进度，就会被毫不客气地
扫地出门。
而我们身边也有这样的人。我想起了我20多岁时最好的朋友。在将近两年的时间里，
我一直认为他是一个很好的人，直到有一天我和他在超市购物，我目睹了他单纯恶意地对
着一个无辜的收银员羞辱谩骂。</tw-passagedata><tw-passagedata pid="213" name="其他类型的自恋者" tags="" position="33975,575" size="100,100">@其他类型的自恋者
愤怒狂式的自恋者（Rageaholic Narcissist）因向他人倾泻愤怒而臭名昭著。他们沉迷
于这种宣泄的方式以释放情绪，但因为由此获得的安慰往往不会持续很久，所以他们会不
断寻找下一次发泄怒气的机会。这种类型的自恋是一种纯粹的霸凌，而霸凌本身就能引发
CPTSD。例如，如果孩子在不健全家庭中长期遭受父母的霸凌，就很有可能患上
CPTSD。
与另外一类自恋者的相处更接近本书的一个关键主题，我的许多来访者都遇到过这种
情况。他们遭到自恋父母的可怕虐待，而这些父母却被视为社会的栋梁。这其中就包括我
那文质彬彬、沉默寡言的父亲，他经常对我和我的姐妹们大发雷霆、大打出手，却在邻里
中备受敬仰。
最后一类是不一定有霸凌行为的迷人的自恋者。我把这类自恋者称为披着依赖外衣
的自恋者（The Narcissist in Codependent Clothing）。我朋友的父亲就是这种迷人的自恋
者。初见时，他会通过提问和探询来吸引你，让你觉得他对你很感兴趣。但在几分钟之后
（一旦你上钩），他就突然像个演说家一样开始滔滔不绝。这类自恋者往往非常擅长使用
连句，不给人任何插话的机会，甚至让你无法找借口溜走。于是，你成了被俘虏的听众，
无法轻易逃脱。
</tw-passagedata><tw-passagedata pid="214" name="从极端的战反应中康复" tags="" position="34100,575" size="100,100">@从极端的战反应中康复
我很认同一种广为认可的观点，即极端的自恋者和反社会者是无法被治愈的。他们通
常确信自己是完美的，而问题全都出在别人身上。
然而，有些出现战反应的人并非真正的自恋者，这些人通常能够得益于以下认知：用
恐吓、批评和讽刺来控制他人需要付出巨大的代价。我的一些来访者最终意识到自己的攻
击性行为会吓跑潜在的亲密对象。一位来访者还意识到，虽然她的伴侣没有离开她，但他
非常害怕和反感她诸多的要求和暴躁的脾气，以致无法给予她所渴望的温情或真正的喜
欢。
我也曾帮助过一些战类型的人理解这一点，过度控制会造成追求权力和增强疏远的恶
性循环。过度追求权力会使对方因恐惧而出现情感上的退缩，而这会加剧战类型人的被遗
弃感，使他变得更加愤怒和轻蔑，然后进一步破坏、阻碍或疏远亲密关系；这再次加剧了
战类型人的愤怒和厌恶，他们更加固执地拒绝表露温情，于是双方的距离越来越远，如此
循环往复。
糟糕的童年环境会导致战类型的人选择上述破坏亲密关系的防御行为。学着将愤怒转
移到童年的境遇，可以帮助他们破除将遗弃感立刻转化为愤怒和厌恶的习惯。此处，在疗
愈过程中，战类型的人还会越发体验到被遗弃感，所以，他们可以学着用眼泪来释放心中
的恐惧和羞耻。我曾经帮助过一些战类型的人，引导他们用哭泣来抚慰伤口，而不要总是
用极端的方式发泄。战类型的人需要意识到，当他们受到伤害时，虽然会感到悲伤，还会
感到愤怒，但无论如何，肆意泄愤都无法化解悲伤。
战类型的人需要意识到，他们居高临下的态度和站在道德制高点要求他人只会疏远他
人，并无法消除当下的被遗弃感。他们必须打破“自己很完美”的幻想，并改掉将完美主义
的内在批判者投射到他人身上的习惯。这就是缩减外在批判者的方法，我们将在第十章具
体介绍。
战类型的人若注意到自己的防御反应被触发并有过度批判的倾向，应学着自发地暂
停。暂停可以在很大程度上重新引导受伤的感觉，促使人哀悼并消除最初的遗弃感，而不
是破坏性地将其转移到现在的亲密对象上。
此外，像所有固着于一种4F反应的人一样，战类型的人需要更灵活、更具适应性地
运用其他4F反应。如果你是正在疗愈中的战类型的人，学习讨好类型的共情反应将会特
别有帮助。你可以先试着想象与你互动的对象的感受，尽可能地多加练习，然后培养正
念，觉察那些你想与之建立真正亲密关系的人的需求、权利和感受，再进一步深化你们的
关系。
在疗愈初期，你可以“先假装，后实现”，因为如果不试着去练习为他人着想，不建立
起互惠和对话（而非独白）关系的话，你所渴望的亲密关系将与你无缘。
</tw-passagedata><tw-passagedata pid="215" name="左脑解离" tags="" position="34325,575" size="100,100">
左脑解离
整体来说，强迫性逃类型的人不是在忙碌，就是在担心和计划将要忙碌的事。这种人
成了约翰·布雷萧所说的“行动的人”（Human Doing），而不是“存在的人”（Human
Being）。强迫观念属于左脑解离，不同于后文将要描述的僵类型所属的右脑解离。
左脑解离指通过不停的思考让自己不去注意潜在的遗弃痛苦。当思考变为了忧虑，
潜伏的恐惧便会升腾起来，影响思考的过程。如果说强迫行为是急于抢先一步超越被压抑
的痛苦，那么强迫观念就是通过过度思虑来克制潜藏的痛苦。
我自己就是一个逃类型的人。我有时会在讲课前强迫性地对课程大纲感到担心，这在
一定程度上是为了掩饰我的表现焦虑（遗弃恐惧的一部分）。在我教学生涯的早期，我还
会采用一种强迫性的防御：一边踱步，一边焦虑地在脑中搜寻一个想不起来的词，有时甚
至会为一个词而疯狂地翻遍字典。这种行为就像我不自觉地在严重的焦虑之外寻找一个安
全之所一样。
逃类型的人很容易对肾上腺素带来的快感上瘾。有些人经常轻率地从事冒险和高危活
动，以激发肾上腺素，产生快感。逃类型的人也很容易成为工作狂，对忙碌的行为上瘾。
由于长期处于这些流程中，为了维持兴奋状态，他们的行为成瘾可能会恶化为对刺激性物
质成瘾。
</tw-passagedata><tw-passagedata pid="216" name="从极端的逃反应中康复" tags="" position="34450,575" size="100,100">@从极端的逃反应中康复
我治疗的逃类型来访者在日常生活中都忙于抢先一步遏制痛苦，因此，每次治疗中的
内省倾诉是他们唯一能进行自我审视的时间。学习4F反应模式的知识往往有助于他们摆
脱内在批判者的完美主义要求。
逃类型的人会否认或“最小化”完美主义的代价，因此我在治疗过程中会温和而反复地
对抗这一点。这对工作狂尤其重要，因为他们往往承认自己的成瘾行为，却在心里将其视
作值得骄傲和产生优越感的标志，不愿放弃这种行为。
逃类型的人可能会因为过度分析而“困在自己的脑子里”。对这些人而言，一旦对
CPTSD的认知到达临界点，他们就非常有必要进入情绪层面的治疗，他们或早或晚都必
须通过哀悼童年的损伤来推进疗愈。
自我同情的哭泣是一种无可比拟的手段，用来缩减强迫性的、顽固的内在批判者，并
改善强迫性的急躁习惯。随着疗愈的推进，逃类型的人会获得一个“变速箱”，能以不同的
速度档位来生活，包括“空档”。逃类型的人尤其有必要培养自己使用“空档”的能力。
如果你属于逃类型，那么你可以利用大量的自助类图书、CD和课程来帮助自己学会
放松，减少习惯性忙碌行为。学会这些非常重要，因为你可能会在忙碌中迷失方向，只见
树木，不见森林。在这种情况下，你很容易分不清先后主次，并迷失在次要的事情中。我
被触发闪回时，经常不由自主地忙于最简单的琐事，反而忽略了主要任务。
在闪回中，逃类型的人的状况可能会恶化为无头苍蝇（Chicken-with-its-head-cut￾off）模式，恐惧和焦虑驱使他们忙于各种琐事。他们拼命加速，毫无头绪地忙碌，仿佛
忙碌本身才是最重要的事。
在这种情况下，逃类型的人若想将自己从慌乱的行为中解救出来，可以试着把一句老
话颠倒过来说：“别过来帮忙，快站着不动。”这里所说的“站着不动”是指停下来，花些时
间集中精力，重新确定轻重缓急。我推荐进行三分钟短暂的坐姿冥想。如果你是逃类型的
人，每天给自己一些冥想时间将大大促进康复。
进行坐姿冥想时，你可以先闭上双眼，然后轻柔地放松身体，感受自己的主要肌肉
群，并柔和地促进它们放松，同时深深地、慢慢地呼吸。
当肌肉得到放松，呼吸变得深沉而缓慢时，你再问问自己：“现在对我而言最重要的
事是什么？我接下来能做的最有益的事是什么？”
当你对这一方法运用得越来越熟练，并能长时间进行坐姿冥想时，可以试着问自己这
些问题：“我此刻在逃避什么伤害？我是否可以打开心扉，试着抚慰内心的痛苦？”
最后，有许多逃类型的人症状可能会被误诊为环性心境。我将在第十二章对这个问题
展开讨论。
</tw-passagedata><tw-passagedata pid="217" name="右脑解离" tags="" position="34600,550" size="100,100">右脑解离
那些被迫习惯使用僵反应的人往往是家中的替罪羊，或是遭到最严重遗弃的孩子，即
迷失的孩子。僵类型的人无法成功地做出战、逃或讨好反应，因此他们发展出典型解离
（或称右脑解离）作为防御措施。解离能够使僵类型的人脱离被遗弃的痛苦体验，并保护
他避免参与“有风险”的社交互动，因为任何社交互动都可能触发他受伤的感觉。
如果你是僵类型的人，你可能会通过在以下活动中解离，来寻求庇护和安慰：长时间
的睡眠、白日梦，以及一些由右脑主导的活动，如看电视、上网和玩电子游戏。
僵类型的人有时会患有（或看起来有）注意缺陷多动障碍。他们往往非常善于在内心
体验变得不舒服时切换内部频道。当他们感到特别受创或被触发时，可能会表现出类似精
神分裂症的症状，脱离于日常现实。情况最糟时，他们可能会像《我从未许诺你一座玫瑰
园》（I Never Promised You A Rose Garden）[2]一书中的主角一样，在混乱中陷入精神分 裂。</tw-passagedata><tw-passagedata pid="218" name="从极端的僵反应中康复" tags="" position="34725,550" size="100,100">@从极端的僵反应中康复
僵类型的人的康复面临三个方面的关键挑战。
首先，僵类型的人通常没有或很少有积极的人际关系。他们非常不愿意进入那种能够
改变他们的亲密关系，更不愿意寻求治疗。有些人即便能克服这种不情愿的心态，也很容
易因受到惊吓而很快停止尝试。
其次，僵类型的人与战类型的人有两个共同点。一是他们都缺乏动力去尝试理解童年
创伤的影响。许多人没有意识到自己有让人困扰的内在批判者，也不知道自己正处于痛苦
的情绪中。二是他们都倾向于把内在批判者的完美主义要求投射到别人身上，而不是自己
身上。这种生存机制帮助他们在儿童时期把别人的不完美作为自我孤立的正当理由。因为
在童年时，这种自我孤立是明智的行为，有助于他们寻求安全。
最后，僵类型的人否认他们单一的适应方式会使生活变得狭隘，其否认程度甚至比工
作狂这种逃类型的人更为严重。我治疗的一些僵类型来访者似乎长期满足于自己的孤立状
态。我认为他们也许能通过释放体内的阿片样物质（如脑啡肽）来自我麻醉。这类物质是
动物在极度危险、迫近死亡时由大脑释放的物质，能够缓解疼痛，让人体产生欣喜、快乐
的感觉。
僵类型的人更容易在体内释放阿片样物质，因为在僵反应的严重程度到达顶峰时人会
出现崩溃反应（Collapse Response）。崩溃反应意味着人完全放弃意识，它似乎是一种脱
离肉体的体验，是一种极致的解离，即将被猎杀的猎物身上有时会出现这种反应。我曾在
自然纪录片中看到，小动物在捕食者的口中似乎彻底放弃了挣扎，仿佛死亡是没有痛感
的。
然而，一些僵类型的人所分泌的阿片样物质，其镇痛效果并不能持续很久。于是，麻
木的满足感会演变为严重的抑郁。这反过来又会导致酒精、药品等物质成瘾。另外，僵类
型的人会倾向于加大剂量地服用抗抑郁药和抗焦虑药。我还怀疑有些精神分裂症患者属于
受到了极大创伤的僵类型的人，因为他们的解离得非常彻底，以致无法找到回归现实的方
法。
给我留言的几位僵类型读者都强烈推荐叙泽特·布恩（Suzette Boon）等人的一本自助
类图书，名为《处理与创伤有关的解离》（Coping with Trauma-Related Dissociation）。
这本书介绍了许多非常有用的练习，对于康复很有帮助。
与其他类型相比，僵类型的人通常更需要疗愈型关系，因为他们的自我孤立使他们无
法通过友谊来实现关系型疗愈。即便如此，我知道有一些人会通过宠物、图书和安全的远
距离人际关系进行治疗，并获得了较好的关系型疗愈成果。
我的来访者菲莉丝自称是个“沙发瘫”，她在开始接受治疗时心情非常矛盾。当时她使
用的第三种抗抑郁药已不再起效，她变得越来越偏执，对死亡的幻想也更为频繁和病态。
她告诉我：“我知道治疗不会有帮助，但我担心丈夫会离开我，他说我已经开始让他感到
害怕了。”菲莉丝的婚姻之所以能维持，是因为她的丈夫赚钱养家，还是个工作狂，很少
待在家里，即使在家时也总是在电脑前忙碌，而她则可以独自看电视、看科幻小说和上
网。
在治疗过程中建立信任是一个漫长而渐进的过程。这种情况对所有幸存者都很常见。
所幸菲莉丝具有的一种黑色幽默“帮助”她接受了我的心理治疗。当我试图将她目前的痛苦
与她可怕的童年联系起来时，她经常予以嘲讽和反驳。幸运的是，在纽约长大的我对讽刺
有一定的抵抗力。我愿意接受她的讽刺性幽默，因为我知道她并没有恶意。
我帮助她将讽刺中蕴含的愤怒导向了她有霸凌行为的家人。于是，心理教育终于开始
渗透一系列过往的事实。她逐渐开始愤怒地倾诉她父亲的性虐待、母亲的沉默共谋，以及
所有家人都把她当作靶子的行为。这种倾诉渐渐演变为哭泣，使她第一次体会到了自我同
情。
直到这一阶段（此时治疗已经开展了数年），菲莉丝才看清了有毒的内在批判者对她
的迫害。在此之前，她认为我关于内在批判者的“胡说八道”非常荒诞，拒不接受。但当治
疗取得充分进展后，我发现正如我设想的，她的内心其实潜藏着很多恐惧和焦虑，而正是
这些让她足不出户。她会讽刺地大笑说：“看看我，皮特！没有什么能让我害怕。我太放
松了，放松到在椅子上都坐不直。天啊！你知道吗？我总是在打瞌睡，所以我丈夫管我
叫‘软黄包’。”（菲莉丝有一头金发。）
突破性进展终于出现了。在那次面谈前，她在我办公室外的人行道上和一个男人擦肩
而过，这个男人让她想起了自己的父亲。她在那次面谈的治疗过程中差点喘不过气，并出
现了一次治疗性闪回。她想起了一段可怕的记忆：她的父亲在一个晚上偷偷潜入了她的卧
室。我帮助她放慢并加深呼吸，随后，她通过多次哀悼化解了这次关于性虐待的闪回。
在这次治疗中，菲莉丝的否认心理明显减弱了。她真正明白了是社交焦虑将她囚禁在
了沙发上。从那时起，深层次的疗愈随之展开。最终，菲莉丝获得了足够的勇气，回到了
学校继续读书，并在后来成了一名医疗助理。这一切为她打开了一扇门，让她在外部世界
找到了一个有意义的位置。她还成功地与一位同样处于疗愈中的同事建立起了健康的友
谊。
僵类型的人的康复通常需要经历以下过程：与治疗师逐渐建立信任，愿意接受心理教
育，并意识到是父母可怕的养育方式导致了他们的痛苦。这为缩减内在批判者铺平了道
路，同时也有利于对童年损伤的哀悼。练习用哀悼表达愤怒及有氧运动都对僵类型的人具
有特别的治疗意义，都有助于恢复他们沉睡的意志和动力。
</tw-passagedata><tw-passagedata pid="219" name="从极端的讨好反应中康复" tags="" position="34875,550" size="100,100">从极端的讨好反应中康复
关于4F反应的心理教育通常会使讨好类型的人感到非常宽慰。这最终能帮助他们认
识到自己的强迫性重复，即总是被剥削自己的自恋型的人所吸引。
我见过许多积习已深的关系依赖型的人，当他们意识到连说“不”的想法都会触发情绪
闪回时，就会努力提高自己自信果敢的能力。我的一位来访者在经过许多疗愈努力之后，
震惊地意识到，光是对于直面老板恶劣行径的想象，都会使自己产生严重的解离。这种震
惊随后演变为了一种顿悟，他意识到这一切都来源于自己曾经在家中抗议时所招致的危
险，并为此深感愤怒。这种顿悟帮助他有效克服了心理障碍，使他在今后的治疗中不再抗
拒自信训练，并学会了克服那些阻碍他自信果敢的批判声。之后这位来访者在长期的练习
中逐渐想起了自己在童年时被反复扼杀的个性。
关系依赖型的人需要明白，过度倾听会使人丧失自我。若要康复，他们则需要减少特
有的利用倾听进行防御的行为，并试着通过哀悼损失等方式，练习拓展语言及情感的自我
表达。在下一章中我将更广泛地探讨如何从讨好中康复。</tw-passagedata><tw-passagedata pid="220" name="战-讨好类型" tags="" position="35025,525" size="100,100">战-讨好类型
战-讨好类型的人对应前文描述的“迷人的霸凌者”。这种类型结合了两种截然相反的
人际关系类型——自恋型和关系依赖型。然而，战-讨好类型的核心往往是对特权感的自
恋。这种类型在极端情况下可能会演变为边缘型人格障碍，患者可能会频繁地、戏剧性地
在战和讨好反应之间摇摆（分裂）。战-讨好类型的人如果对某人感到不满，在单次互动
中便有可能在具有攻击性的谩骂和狂热的关切间不断地切换。
我治疗的几名来访者曾被自己或他人不公平地贴上了“边缘型人格”的标签。然而，我
可以从他们的心灵品质看出他们并不是那种人。他们本质上对他人怀着仁慈和善意，并且
在闪回过后总是会回归本质。当他们伤害他人后，也能够感受和表现出真正的悔恨，而我
们都难以避免偶尔伤害他人。与本质自恋的真正边缘型人格不同，他们会真诚地道歉，并
在适当的时候做出补偿。
战-讨好类型的另一个变体，是在某一种关系中表现为战类型，而在另一种关系中表
现为讨好类型。例如典型的“妻管严”，这类人在家中温柔，但是在工作中很有可能是个暴
君，而且他们往往会工作到最后一刻，因为他们非常享受自己的战斗状态。这种类型也可
能会反过来：在家中是魔鬼，在办公室却是老好人。
与下一章描述的讨好-战类型进行对比后，我们可以更深刻地理解战-讨好类型。虽然
讨好-战类型也会在情绪闪回时出现摇摆不定的情况，但通常不会那么尖刻和自以为是。
这两种类型的另一个区别是，战-讨好类型的“照顾”通常是胁迫式或操纵式的，它往
往是为了公然或隐蔽地达到个人目的。此外，战-讨好类型的人很少对人际关系中的问题
承担真正的责任。这类人通常采取典型的战立场，把不完美归咎于对方。这种本质为自恋
类型的人更有特权感，他们的讨好行为通常不怀有真正的同情心或怜悯心。
</tw-passagedata><tw-passagedata pid="221" name="逃-僵类型" tags="" position="35150,525" size="100,100">逃-僵类型
逃-僵类型是最缺乏人际关系、最分裂的类型。这类人偏爱自给自足的孤立所带来的
安全感。有时这种类型会被误诊为阿斯伯格综合征。
逃-僵类型的人通过强迫和解离的“双步骤”来避免在人际关系中再次受创：第一步是
工作到筋疲力尽；第二步是陷入极端的“消极怠工”，并等待能量重新积累以重启第一步。
为了没有必要的安全感，他们的生活方式不得不变得极其受限。
逃-僵类型更多见于男性，特别是那些在童年时因显露脆弱而受到创伤的男性。他们
的经历迫使他们在自我孤立或“轻度亲密”的关系中寻求安全感。一些不强势的男性幸存者
结合逃和僵类型防御，变成了典型的“技术宅男”。远程办公无疑是他们最爱的上班模式。
逃-僵类型的人往往对计算机上瘾，他们会长时间专注于工作，然后解离性地陷入一直玩
电脑游戏、滥用药物或嗜睡状态。
此外，逃-僵类型的人很容易对色情制品成瘾。处于逃模式时，他们会痴迷在网上寻
找幻想中的伴侣，并强迫性地手淫。而处于僵模式时，如果没有色情制品，他们就会陷入
右脑的性幻想世界。此外，如果他们处于轻度亲密的关系中，那么当他们进行性互动时，
通常更愿意与理想化的幻想伴侣接触，而非现实中的伴侣。</tw-passagedata><tw-passagedata pid="222" name="战-僵类型" tags="" position="35275,525" size="100,100">战-僵类型
战-僵类型的人是隐性或消极的自恋者。他们要求事情按照自己的方式发展，但对人
际交往没有兴趣。没有人可以在餐桌上说话，甚至他们自己也不行——当然，除非他们需
要管教某人。他们是那种约翰·韦恩（John Wayne）[3]式的“沙发瘫”，他们的家庭生活中
经常充斥着粗暴的情绪和抱怨咒骂。这类型的人通常像前文提到的极端战类型的人一样难
以治疗。我曾见过几个类似的战-僵类型的人，他们都是在收到伴侣离婚的威胁后被迫来
治疗的。他们每个人都像《早餐桌上的独裁者》（The Autocrat of The Breakfast Table）[4]
中的人物。
这类人很少主动寻求疗愈。我的一位同事告诉我，她遇到一位战-僵类型的来访者是
被他的妻子拉来治疗的。这位妻子抱怨说，她一周内能从丈夫嘴里撬出十个字就算幸运
了。她已经别无他法，如果治疗不能解决丈夫的问题，她就打算提出离婚。
这位丈夫是一名计算机工程师，在家远程办公，只有上厕所和吃饭时才离开房间，而
且他在吃饭时也是与妻子分开吃的。他会用电子邮件给妻子发送日程表，要求妻子按照日
程表给他送饭。
我的同事一开始向这位丈夫问好时，得到了他的怒视和抱怨。出于直觉，她尽可能地
不聚焦于他，但她每次小心地尝试与他建立联结时，都会遭到讽刺、轻蔑的回绝。他会
说：“你以为我会被你假惺惺的笑欺骗吗？你休想用你那些心理学呓语来唬我！”
这位同事是我认识的最有同情心、最不具有侵略性的人之一，但她也无法打破这个可
怜人带刺的战斗外壳，攻克他的极端社交回避。因此，这段治疗最终没能创造奇迹。我的
同事说，他居然坚持了20分钟才带着敌意和怨恨离开，现在回想起来都让她感到不可思
议。
</tw-passagedata><tw-passagedata pid="223" name="从积极到消极的4F反应变化路径" tags="" position="35425,550" size="100,100">@从积极到消极的4F反应变化路径
战类型：自信果敢↔霸凌
逃类型：效率↔过度驱动
僵类型：平静↔畸张症（Catatonia）
讨好类型：助人↔被奴役
如前文所述，康复的一个关键目标是我们能够轻松恰当地使用所有4F反应。还有另
外两条变化路径可以用来评估这一点，在这两种路径中的平衡程度能够反映我们的康复程
度。
·与他人的健康关系：战↔讨好路径
如果关系的双方能够轻松而互惠地在坚持自我和接纳对方之间保持平衡，就能够缔造
健康的关系。几个常见而重要的例子是：①在交谈和倾听之间轻松切换；②在帮助和被帮
助之间轻松切换；③在引领和跟随之间轻松切换。
当人处于这条路径的中点位置时，自恋和关系依赖的程度是正常、健康的。当人位于
自恋或战斗那一端时，会滔滔不绝地主导对话；而位于关系依赖或讨好那一端时，就会陷
入利用倾听来进行防御，拒绝表达自身想法和感受，从而隐藏自己的脆弱。
需要注意的是，人与人的对话不会总是刚好处于中点位置，否则就会成为打乒乓球似
的单调交流。真正的平衡更容易发生在长时间的交流中。例如，在一个小时的谈话中，双
方大约各说半小时的时间。
·与自我的健康关系：逃跑↔冻结路径
与自我的健康关系体现在以下几个方面的平衡：①行动和休息之间；②坚持和放弃之
间；③交感神经和副交感神经系统的激活之间；④高度专注和轻松的白日梦之间。
[1]心理学中的“自恋”不同于一般口语中形容虚荣或自以为美丽或了不起的自恋。
心理学中的自恋指病态地以自我为中心，缺乏同理心，以及其他自恋型人格障碍的诊断标
准。然而，作者在此并非指符合的自恋型人格障碍的症状，但实际上并不一定有自恋型人
格障碍。——编者注
[2]一本自传体小说，故事的主人公通过心理治疗治愈了自己的精神分裂症。——编
者注
[3]美国电影演员，饰演了许多硬汉形象。——编者注
[4]美国诗人奥利弗·温德尔·霍姆斯（Oliver Wendell Holmes）的随笔集。作者以
第一人称与不同的寄宿房客对话，对话讨论的主题包罗万象。——编者注
</tw-passagedata><tw-passagedata pid="224" name="讨好-僵类型：替罪羊" tags="" position="34425,900" size="100,100">@讨好-僵类型：替罪羊
讨好-僵类型通常是关系依赖最为严重的亚型。虽然并非所有的替罪羊都是讨好-僵类
型，但由于讨好类型和僵类型的人都非常被动，又倾向于极度自我否定，并且他们通常在
幼儿阶段就因坚持自己的主张而遭到了较多的惩罚或拒绝，所以他们中的许多人最终都会
沦为替罪羊。
最糟糕的是，讨好-僵类型的人很容易被战类型的人识别出来，并沦为其俘虏。于是
这一类型的人可能成为受气包，甚至遭受家庭暴力。大多数讨好-僵类型的人，如果无法
在童年时期摆脱替罪羊的角色，成年后同样会成为受害者。这些受害者有时甚至意识不到
自己正在遭受虐待，甚至还会责备自己（就像童年时那样）。许多讨好-僵类型即便愿意
努力疗愈，也只是做出象征性的努力。他们往往被迫彻底放弃了自我保护本能，从而陷入
心理学家所说的习得性无助（Learned Helplessness）。
关于暴力循环周期[2]的研究表明，许多自恋型施暴者懂得在合适的时间用合适的方
法，在受害者即将离开时给予些许的浪漫。这些施暴者往往是上一章中描述的“迷人的霸
凌者”。霸凌者偶尔的小恩小惠，比关系依赖症患者在原生家庭中获得的一切都更温暖，
所以受害者很快就会重新上钩，虐待的循环也会马上重新开始。值得注意的是，许多迷人
的霸凌者在求爱阶段也会短暂地大献殷勤，但一旦追求成功，这些殷勤也就消失了。
此外，在家庭中，被霸凌者不一定是女性。有越来越多的证据表明，相当多的男性也
在默默承受着家庭暴力。一位男性来访者曾经告诉我，无论他的妻子如何对他施暴，他都
忍不住会向她道歉。但这只会让她更生气，尤其是在他忍不住说出“对不起我说了‘对不
起’”时。每当他这么说的时候，妻子都会打他耳光。
果然，经过进一步的探询，我发现他有一个边缘型人格的母亲。直到现在，母亲只要
对他不满意，仍然会打他耳光。童年时，每当他被母亲打耳光时，都被要求放下双手老实
站好，然后为自己让母亲“不得不”惩罚自己而道歉。可惜的是，他只做了几次治疗就不再
继续了，因为他的妻子翻看了他的支票簿，并因为他“浪费了时间和她的钱”而对他不停地
施暴。
我曾多年从事心理危机电话咨询工作，那段时间我遇到了许多这种讨好-僵类型的
人。他们康复的希望在于理解童年的受虐经历是如何使他们现在仍受困于遭受虐待的情境
的。我曾无数次听到家暴受害者说：“我并不想表现得像一个受害者！”我常常试着帮助他
们认识到自己在童年时确实受到伤害。若非如此，他们通常无法将自己从当前的受害状态
中解救出来。然而，做到这一点通常是很困难的，因为作为替罪羊的讨好-僵类型的人经
常因为抱怨而受到更多的严酷惩罚。
</tw-passagedata><tw-passagedata pid="225" name="讨好-逃类型：超级护士" tags="" position="34550,900" size="100,100">@讨好-逃类型：超级护士
讨好-逃类型的人最常见于工作狂般的父母、护士或行政助理，这些人全天候地为家
庭、医院或公司的需要而工作。他们强迫性地满足其他人的需求，却对自己的需求置之不
理。
讨好-逃类型的人有时就像被误导的特蕾莎修女（Blessed Teresa of Calcutta），将自
己视为完美无私的照料者，并以此逃避自我遗弃的痛苦。他们强迫自己奔走于一个个需要
照顾的人之间，从而进一步远离自己的痛苦。
还有一些讨好-逃类型的人会变得有洁癖。我的一位实习生告诉我，有位讨好-逃类型
来访者有一系列按颜色分类的牙刷，用于清洁浴室和厨房的各种死角。
有些讨好-逃类型的人会把他们的完美主义投射到别人身上，充当别人的人生导师，
把自己的意志强加于人。然而，讨好-逃类型的人应该明白，关心他人有时并不意味着要
帮他人解决问题，特别是当我们试图帮助那些痛苦的人时。很多时候，人只是需要找到同
情、接纳和口头宣泄的出口，而且一些情绪状态确实需要时间来化解。当人心情不佳时，
对他的爱就是一种强有力的关怀。
这也意味着讨好-逃类型的人要接受他人的不完美。每个人都存在一些难以改变的局
限性和缺陷。我们不应该给所爱之人施加压力，让他们去解决无法解决的问题。我的做法
是，让对方自愿选择是否接受我的建议。因此，我会尽量避免反复唠叨。此外，我通常会
先确认一下对方是否真的想要一些反馈意见。
</tw-passagedata><tw-passagedata pid="226" name="讨好-战类型：令人窒息的母（父）亲" tags="" position="34675,900" size="100,100">@讨好-战类型：令人窒息的母（父）亲
以上两段建议也适用于许多讨好-战类型的幸存者。他们中的一些人在试图帮助别人
时可能非常具有攻击性。他们通常将帮助等同于改变，并坚持不懈地迫使别人接受他们的
建议，最终反而使对方疏远了自己。
讨好-战类型的人惯用的照顾方式充满了令人窒息的爱。他们过度关注被照顾的一
方，这有时是在重复扮演他们童年时的服务角色。此外，他们给予的帮助通常比上一章提
到的战-讨好类型的人更无私。尽管如此，他们过于热心的照顾有时真的会让对方感觉窒
息，正如他们所说的：“我爱你爱得要死。”
讨好-战类型的人在处于闪回时，可能会将对他人的照顾恶化为操纵甚至是胁迫。那
种令人窒息的爱可能会强迫对方去符合他的预期。当对方拒绝他的建议或回避强加的照顾
时，讨好-战类型的人可能会极为受挫，进而爆发。他们有时会觉得自己有权以“为了对方
好”的名义而惩罚对方，特别是当处于主要关系[3]中时。
讨好-战类型的人有时会被误诊为边缘型人格障碍，这是因为他们在闪回时情绪会非
常激烈。一旦被遗弃的恐慌感被触发，他们会极其渴望爱，可能时而奋力地争夺爱，时而
谄媚地乞求爱。然而，这种类型的人并不像上一章描述的真正的边缘型人格一样以自恋为
核心。
这两种类型的另一个区别是，讨好-战类型的人寻求的是真正的亲密关系。他们是所
有混合型中最乐于发展人际关系的，也最容易对爱上瘾。这与战-讨好类型的人形成鲜明
的对比，后者更沉迷于生理的宣泄，因此更容易对性上瘾。
</tw-passagedata><tw-passagedata pid="227" name="面对展现自我的恐惧" tags="" position="34825,900" size="100,100">@面对展现自我的恐惧
恐惧会触发自我牺牲式的讨好反应，为了克服关系依赖，幸存者必须学会觉察这种恐
惧，并与它共处。在面对恐惧时，他们必须尝试和练习一系列更有效的反应（见下一章的
闪回管理步骤）。
应对这一挑战的真正动力通常来自处理原生家庭问题的过程。我们需要找到最初让我
们失去健康的自我表达本能的创伤碎片，并凭借直觉拼凑出它的全貌。
我们一旦从情绪层面回忆起儿时受到的压迫，就能意识到自己当时是因为年幼弱小而
无力维护自己的立场，但现在我们已经有了成年人的身体，比童年时有力得多。尽管我们
在被触发时仍会暂时感到渺小和无助，但我们可以学会提醒自己“现在已经拥有了成年人
的身体和心智了”。成年人的身份为我们提供了更多的资源来支持自己，使我们能够有效
地对抗关系中的不公。
</tw-passagedata><tw-passagedata pid="228" name="用哀悼治愈关系依赖" tags="" position="34950,900" size="100,100">@用哀悼治愈关系依赖
解决关系依赖问题通常需要进行多次的哀悼。一般来说，幸存者需要为长期缺乏健康
的利己与自我保护行为流许多眼泪，因为他们积攒了太多的损失与痛苦。缺乏自我意识的
人生会让人感到愤怒，而哀悼能够释放出这种良性的愤怒。
这种释放愤怒的方式可以重塑健康的战反应。再次强调，拥有健康的战反应是培养以
下特质的基础：自我保护的本能、平衡的自我表达，以及建立平等互惠的关系所需的勇
气。
</tw-passagedata><tw-passagedata pid="229" name="“不认同我也没关系”" tags="" position="35275,925" size="100,100">@“不认同我也没关系”
在我的早期疗愈过程中，一位备受尊敬的导师教给我一句自信果敢的话：“不认同我
也没关系。”为了迎合他，我表面上热情地接受了他的建议，认为自己应该加以练习，尽
力做到这一点，但私下我却想：“开什么玩笑！”我人生的前30年都仿佛肩负着谐星的使命
而生存，想要证明自己喜欢所有的人。那时的我还没有意识到，自己不自觉地产生了“全
或无”的想法。因为我拼命试图让所有人都喜欢我，希望这样能让我感到安全。
当我进一步思考导师的这句话时，我觉得它无疑是荒谬且无法实现的。但就在一周
内，我心中有种东西被点燃了，我开始真心希望它能实现。
在那之后很久，我才意识到自己的关系依赖，所以我花了近20年时间才取得了一些进
展。我曾无数次意识到，学会处理和接受不被认可十分重要，却又无数次淡忘了它的重要
性。
但在30年后的今天，当我写下这些时，我觉得这是我所学到的最重要的东西之一。我
大部分时间都在享受来自亲朋好友的大量认可，所以通常很容易接受他们的建设性意见。
但我很少关注那些我不认识的人或不了解我的人对我的看法。
当然，我也不是完全不在乎。他人的不认同有时仍会触发我的闪回。但值得高兴的
是，如今我在面对他人的不认同时，往往能保持相对平和的心态，甚至偶尔会把一些人的
不认同当作一件好事，因为这证明我正在做正确的事情，并朝着正确的方向发展。最能证
明这一点的是，当我努力将来访者从被奴役状态中解救出来时，他们那些自恋型的父母或
伴侣往往会提出不认同。他们对我的不认同，实际上间接肯定了我确实在做正确的事。
大多数时候，不认同我也没关系。
[1]俄罗斯生理学家巴甫洛夫基于实验，将引起机体出现明显动作反应的刺激称
为“条件刺激”，将能引起先天反应的刺激称为“无条件刺激”。他提出，由无条件刺激
引发的反应为“无条件反应”，由无条件刺激和条件刺激多次、共同引发的动作反应
为“条件反应”。文中此处指条件反应。——编者注
[2]美国心理学家尼克·休斯（Nick Hughes）在研究了很多婚姻暴力的案件之后提出
了暴力循环理论（Cycle of Violence）：暴力在婚姻中会呈周期性的循环，分为愤怒的
继续期、暴力发生期、道歉和原谅期、蜜月期四个阶段。——编者注
[3]主要关系指与个体与在生活、经济、政治上有直接联系的亲属、朋友的关系。
——编者注
[4]大脑中用于识别和调节情绪的组织。——编者注
[5]镜像模仿指通过模仿对方的行为（有时也可能是情绪或想法），使对方觉得亲近
或站在同一阵线。人本能地具有这样的天性与能力，可以无意识地自然发生，但随着成
长，也可能有意识地故意使用这种行为。在婴幼儿发展的阶段，婴幼儿与主要照顾者的互
相镜像模仿是重要的发展过程。——编者注
PART THREE
</tw-passagedata><tw-passagedata pid="230" name="“那个表情”：情绪闪回的常见外在诱因" tags="" position="35650,875" size="100,100">@“那个表情”：情绪闪回的常见外在诱因
在使用这套闪回管理方法帮助来访者之初，我惊讶地发现，某些来访者在童年时遭受
虐待的程度相对较轻，却也被情绪闪回困扰。事实上，他们中的大多数人都非常肯定自己
从未被父母打过，但他们中的许多人都提到了非常讨厌父母对他们做出的“那个表情”。
在大多数情况下，来访者口中的“那个表情”通常伴随着蔑视。蔑视是一种强有力的惩
罚性表情，带有恐吓和厌恶的情绪力量。父母在做出这种表情时还会间歇性地提高音量，
以增强其效力。
父母对孩子做出这种表情，是在“告诉”孩子：你不仅大难临头，还是一个糟糕的人。
这种表情会使孩子陷入恐惧和羞耻的情绪闪回中。久而久之，孩子会非常害怕和厌恶这种
表情。
当父母用这种表情来控制一个年龄较大的孩子时，孩子的情绪通常会闪回到更小的时
候，甚至是记事之前，那时这种表情的力量是由创伤性的惩罚带来的。只有这种表情会带
来被打或其他可怕的后果时，才能吓得孩子听话。多年来在育儿压力服务机构的工作经历
使我相信，如果这种表情之前未伴有创伤性的惩罚，通常不会对孩子造成影响。
这种表情的效力往往来源于一种叫作条件反射的心理过程。一个厌恶条件反射
（Conversive Conditioning）[2]的经典例子是：技术人员在对笼子里的动物进行电击，同时
摇响铃铛。动物无疑会对电击产生恐惧和痛苦的反应。而技术人员只需将铃声和电击结合
若干次，单是摇铃声音就会引起动物同样的不安反应。
我认为孩子对父母的“那个表情”感到恐惧也是基于类似的原理。如果将表情与体罚、
极端的遗弃相结合的次数足够多，那么父母最终无须打孩子，仅仅通过表情即可达到同样
的效果。在童年早期，如果这种招数重复得足够多，就会对孩子的一生产生持续性影响，
于是父母就可以一直利用表情来控制孩子。我在做临终关怀工作时，曾见过几个垂死的瘦
弱母亲仍然能够利用表情使他们壮硕的儿子感到非常害怕。
于是，这种表情成了一个强有力的诱因，使成年幸存者闪回到童年的恐惧和羞辱中。
然而，大部分人对三四岁之前的事没有记忆，因此许多幸存者并不记得其父母表情和体罚
的结合，也不知在他们幼年时，这种结合只需持续几个月，就会成为永久的诱因。
更不幸的是，这种表情在父母去世后仍然发挥作用。这至少有两方面原因。首先，我
们会将父母内化。当我们稍有不完美时，内化的父母就会出现在我们的潜意识中，向我们
做出“那个表情”。这里所说的不完美，包括思想、感受和行为。可悲的是，我经常看到来
访者在闪回中模仿这种潜意识的表情，对自己做出蔑视的怒容。其次，当其他人不认同地
看着我们时，我们会一概认为他们像父母一样危险。
被童年时“那个表情”伤害的最糟糕结果是，一旦闪回被触发，我们会错误地将对表情
的记忆转移和投射到他人身上，特别是权威人物或与父母相似的人，即使他们没有做
出“那个表情”。
</tw-passagedata><tw-passagedata pid="231" name="不容忽视的内在诱因" tags="" position="35775,900" size="100,100">@不容忽视的内在诱因
疗愈初期过后，我们会发现内在诱因比外在诱因更常见。内在诱因通常是内在批判者
造成的恶果，是关于危险或必须完美的想法或可视化想象。幸存者可能会毫无理由地幻想
有人在虐待他们。此外，他们也可能突然想到自己没有完美地完成当下的任务，从而忧虑
地陷入闪回。他们还会设想种种搞砸任务的情境来吓唬自己。
内在诱因的影响最为严重时，一点小失误就会使他们彻底陷入情绪闪回，然后进入
只关注负面的极端视角，不断地关注缺陷和危险，执着于已经出错或可能出错的事情。
随着疗愈的进展，许多幸存者震惊地发现，他们的大部分闪回都是由这类内在批
判“程序”引发的。我将在后文中探讨如何避免被内在批判者触发闪回。
</tw-passagedata><tw-passagedata pid="232" name="逐渐增强对诱因的认知" tags="" position="35900,900" size="100,100">@逐渐增强对诱因的认知
随着疗愈工作的不断深入，我们会对触发闪回的诱因有更多的了解，并学着尽可能地
避免它们。识别诱因也有助于我们更快地进入闪回管理模式，进一步帮助我们应对不可避
免的触发情境。而未雨绸缪地进行预防性的闪回管理练习，则有助于避免触发闪回，例如
前文提到的我在面对表现焦虑时的做法。
此外，对闪回触发时刻的觉察甚至比识别诱因本身还要重要。这是因为闪回有时会先
隐隐出现，再逐渐变得强烈。因此，更早地意识到自己身处闪回有助于我们及时地运用闪
回管理步骤，减少闪回的强度和持续时间。
另外，解决闪回问题需要重新平衡大脑和身体的重大生化反应，而这一过程需要时
间。例如，过度分泌肾上腺素有时会让人急剧出现肾上腺素耗竭的相关症状，需要一段时
间的休息，肾上腺功能才能重新恢复正常。采取快速的救治措施以降低闪回的强度，可以
减少后续恢复生理功能所需的时间。</tw-passagedata><tw-passagedata pid="233" name="通过哀悼管理闪回（第9步）" tags="" position="36200,900" size="100,100">@通过哀悼管理闪回（第9步）
说回前文的故事。我大声地问那位来访者：“你觉得自己有没有可能正处于闪回
中？”由于我们之前曾多次将她的烦乱情绪识别为闪回，她立即意识到这确实是一次闪
回，于是开始泣不成声，并陷入了深深的哀悼中。她的哭泣包含了解脱的泪水和哀悼的泪
水。解脱是因为她再次回忆起了以前令人困惑的剧烈痛苦的来源，并且接收到了我的共
情，而哀悼是因为她释放出了悲惨童年的痛苦。
她继续哭泣着，释放了更多来自最初创伤的痛苦，而后又因为自己经常被困在闪回中
而流泪。从哭泣中平复后，她回忆起小时候有一次在圣诞节袜子里收到了一块煤。因为她
在晚餐时迟到了十分钟，严厉的母亲就以此来惩罚她。于是，她的眼泪又饱含了对这种虐
待的愤怒，并且让这种愤怒得到了健康的发泄，而她也感觉找回了充满力量的自我。哀悼
使她回到了现在，治好了闪回时的暂时失忆。
然后，她开始唤起自我保护的本能。我们之前一直通过角色扮演和自信果敢训练来逐
步恢复这种本能。她愤怒地诉说着她的父母不公平地剥夺了她保护自己免受虐待的权利。
她开始放肆地大喊：“这不公平！”似乎在告诉她的父母，他们已无法再因她的反抗而攻击
她。
接下来，她进一步重申了自己划定界限的权利。她嘲笑自己的父母是糟糕的父母，然
后把愤怒转向了内在批判者，铿锵有力地说“不”。“不，你不能再评判我了。不，你不能
再挑剔我了。不，你不能再用那些愚蠢的担忧来浪费我的时间！”
最后，我提醒她重新唤起她自己的安全感，因为她现在已经拥有了成年人的身体，摆
脱了父母的控制，还获得了许多资源：智慧、力量、适应力，以及不断增长的归属感。她
有了安全的居所，获得了治疗师和两个朋友的支持，并且还找到了一份能发现她的价值的
工作。
大约40分钟后，我观察到，她在管理闪回方面取得了进展，闪回发生的频率和强度都
明显降低，她从闪回中逐渐解脱了出来。
我已无数次见证了这种哀悼的治愈力量。第十一章我将对疗愈性哀悼的复杂性进行探
讨。
</tw-passagedata><tw-passagedata pid="234" name="管理内在批判者（第8步）" tags="" position="36325,900" size="100,100">@管理内在批判者（第8步）
CPTSD幸存者成年并离开创伤性家庭后，往往没有意识到自己的思想已经被内在批
判者支配。在帮助来访者管理闪回时，我最常提供的帮助就是鼓励他们质疑那个危言耸听
和完美主义的内在批判者。
在我为来访者治疗的过程中常常遇到这种情形：来访者正在讲述一个无关紧要的过
失，突然间他就开始描述灾难性的场景。在内在批判者噩梦般的幻想中，他讲述着自己的
生活正陷入一连串的灾难中。他闪回到了不断受到过度惩罚的童年。
有位来访者的极端化想象过程是这样的：“今天早上我上完厕所回来的时候，我的老
板看我的眼神很奇怪，他肯定认为我又懒又笨，想要解雇我。我知道自己如果被辞退，就
找不到其他工作，女朋友会认为我很没用而离开我。我会因为压力而生病，而且没钱付医
药费和房租，我很快就会过上无家可归的生活。”令人不安的是，许多内在批判者的极端
化想象最终都会落到无家可归的结局，而这完全是被遗弃的象征啊！
从创伤中康复需要来访者识别内在批判者的极端化想象，以便进行思维阻断和思维
纠正。在上述案例中，我提醒来访者，我们在治疗中曾多次发现，他的内在批判者常常
大惊小怪，觉得生活即将分崩离析。接着，我鼓励他不要任由这种思维发展，并在内在批
判者试图吓唬或贬低他时，愤怒地对它说“不”。最后，我帮他回想起了他和老板相处得不
错的经历（思维纠正），还帮他细数了他在工作、学习和生活中取得的许多成功经验。
内在批判者不仅会加剧闪回，甚至还会制造引发闪回的心理活动。下一章我将讨论如
何对抗内在批判者的破坏力。
进阶的闪回管理
</tw-passagedata><tw-passagedata pid="235" name="再谈自我药疗" tags="" position="36050,900" size="100,100">@再谈自我药疗
闪回的另一个迹象是更多地使用原始的自我安慰手段。许多幸存者在年轻时学会了通
过一些事物来控制痛苦的情绪，如食物、分散注意力的活动或情绪调节类药物。久而久
之，进行自我药疗可能成为习惯，并演变为物质或行为成瘾。
我认为进行自我药疗的严重程度是一个渐进的区间，从偶尔服用药物直至真正成瘾。
对于许多幸存者来说，问题的关键在于进行自我药疗的程度。闪回的一个明显迹象是：迫
切地想要使用比平时更多的物质。如果你通过练习，觉察到了突然高涨的服药欲望，就意
味着你需要采用闪回管理步骤了。此外，我见证了许多幸存者通过有效地实施这些步骤，
逐渐减少了进行自我药疗的次数。</tw-passagedata><tw-passagedata pid="236" name="在遗弃抑郁中醒来" tags="" position="36450,900" size="100,100">@在遗弃抑郁中醒来
随着疗愈逐渐取得进展，你会注意到闪回触发过程中的更多微妙之处，并更能觉察到
内在批判者那些隐秘的诱因。你还会发现，有些诱因是无法识别的，尤其是那些在睡眠出
现的。
因此，掌握进阶的闪回管理需要学会处理一种令人困惑不安的状况：入睡时感觉很
好，但却在闪回中醒来。这种情况下的闪回通常是由梦境引发的。如果你记得梦的内容，
或许就可以弄清楚它为什么会触发闪回。当你逐渐培养正念时，你甚至能推测出前一天的
哪些事件触发了这个梦。
最难处理的情况是你不记得梦的内容。这种类型的闪回会使人感觉到特别不公平和沮
丧。你的内在批判者可以借此宣称你的疗愈不仅没有进展，反而还有所倒退。
</tw-passagedata><tw-passagedata pid="237" name="闪回是内在小孩的求救信号" tags="" position="36575,900" size="100,100">@闪回是内在小孩的求救信号
对于无法察觉诱因的闪回，我认为最有效的方法是将其视作内在小孩的呼救。你的内
在小孩在提醒你，他曾无数次在醒来时感到孤寂凄凉，因为家中并没有温暖。他现在偶尔
还是会在醒来时感到恐惧，生怕再次回到那个有“毒”的家里。这个孩子现在请求你满足他
未被满足的需求，在醒来感到痛苦时获得安慰。他似乎在说：“看，我当时的感受就是这
么糟糕，充满了不知所措、羞愧和痛苦。”
疗愈过程中最艰难的长期挑战之一，就是控制从遗弃抑郁中醒来的痛苦。此时的睡眠
似乎是一种倒退的、由右脑主导的体验。我们常常在醒来时暂时丧失了左脑的认知功能，
而这种功能控制着我们对现实的复杂理解。如果没有这种认知和理解，我们往往会通过自
我批判和在童年早期做过的尝试来应对闪回。这为内在批判者创造了丰富的素材，使之爆
发出一套自我病理化的“程序”（下一章中将列举这些“程序”）。
几年前，当我从闪回中醒来时，我的习惯性反应是出现疑病症[3]的念头。“我怎么这
么没力气？我的身体肯定有很严重的问题。我感觉自己快死了。我的背之所以疼可能是因
为长了肿瘤。这个月我瘦了几千克，肯定是得了癌症！我希望快点死掉，了结这一切。”
这种剧烈的反应有时会持续几个小时，甚至几天。此外，它往往会制造大量的焦虑，
将我从遗弃抑郁中拉出来，迫使我立刻下床进入忙碌状态。然后我就会不自觉地匆忙度过
这一天，以使自己远离这种可怕的思维过程，以及潜藏在它之下的深层的遗弃痛苦。
经过大量的练习，我现在能很快意识到，出现疑病症的症状就意味着自己正处于闪回
状态。在这种时候，我就会努力转移思维重点，向我的内在小孩施以爱和善意。我这样做
是为了安抚童年时的自己，那个孩子生活在缺爱的原生家庭中，曾无数次在深夜中惊醒，
内心充满了被遗弃的可怕感受。对于我来说，我练习最多的闪回管理步骤是：拒绝认同内
在批判者，专注于关怀自己。
闪回还传递了另一条似乎来自内在小孩的信息——我又恢复了忽视他的旧习惯。在我
退行到过度使用逃反应而忽略内在小孩时也会发生闪回。这种闪回似乎是内在小孩在哭
闹，要求我证明自己对他的同情不只是空洞的说辞。而当我放慢脚步走入自己的内心时，
我常常会感到曾经那种熟悉的自我遗弃的痛苦，我现在认为这种痛苦是在为自己而孤独
（Being Lonely for Myself）。这种感受总是让我泪流满面，而哭泣常常能让我从闪回中解
脱出来。
</tw-passagedata><tw-passagedata pid="238" name="灵活运用闪回管理步骤" tags="" position="36700,900" size="100,100">@灵活运用闪回管理步骤
我的来访者海伦在一次治疗开始时处于深度的自我疏离状态：“我真是无药可救！我
昨天毫无征兆地陷入了可怕的闪回中。而且那不是你一直告诉我的那种原因不明的睡醒后
的闪回。我整个上午的状态都很好，但到了下午不知怎么的，突然一下就陷入了闪回中，
一直到现在，什么愚蠢的诱因都没有。没有东西触发它，单纯就是我的问题，我无可救药
了！我的精神有毛病！”
辨别闪回的诱因是一个滑坡谬误（Slippery Slope）[4]。找到诱因常常可以让我们免于
因闪回而责备、憎恨自己，但并不是每次闪回都能找到明确的诱因。在这种情况下，寻找
诱因反而会迅速恶化为自我病理化的“活体解剖”。当我们在闪回的深渊中越陷越深时，这
个滑坡会迅速变为悬崖。
解决问题的关键在于思考的视角。你是为了自己好而寻找诱因，还是为了挑自己的
错？如果是后者，那么你最好还是放弃寻找诱因，改为寻求自我接纳，因为总有一些诱因
是难以查明的。当控制闪回的努力夹杂了大量对自己的气恼和失望时，我们需要用自我接
纳来替代这种努力。自我接纳有时应该超越“把一切都弄清楚”的冲动。
就像前文所说的，对闪回的最佳理解，是完全地意识到自己内在小孩深深的被遗弃
感，他正因内在批判者的羞辱和攻击而畏缩不前，而他需要你转换思维，证明你无论如何
都会关爱他。
</tw-passagedata><tw-passagedata pid="239" name="存在性诱因" tags="" position="36825,900" size="100,100">@存在性诱因
许多心理学家用存在性（Existential）一词来描述这一事实：所有人都会不可避免地
遭遇痛苦的事件。这些事件所带来的痛苦是每个人都会时不时遭受的、正常的并且反复出
现的。存在性痛苦事件的常见例子包括：可怕的国际事件、困难的抉择、疾病和周期性的
孤独感。存在性的痛苦特别容易触发幸存者的闪回，使其再次体验创伤，因为他们通常在
原生家庭都经历过很多种苦难。
另一种特别容易触发闪回的存在性现象是，我们都会经历无形的、不可预测的情绪转
变。好心情有时会莫名其妙地转变为坏心情。正如小说家大卫·米切尔（David Mitchell）
所写的那样：“好心情像鸡蛋一样脆弱……而坏心情像砖头一样坚硬。”
不可预测的情绪变化通常会给CPTSD幸存者带来许多问题，可能会迅速触发其全面
的闪回。这通常是因为，幸存者曾因完全展现自己的情绪而遭到惩罚或遗弃。因此，现在
幸存者会按照旧习惯，在情绪变得恶劣时自动进入解离状态。
在康复前，当你因种种原因而无暇顾及自己的感受时，你的内在小孩往往会经历闪
回。这个孩子会觉得自己又一次被困在被无情遗弃的情景中，而产生闪回也许是能真正引
起你注意的唯一方法。因此，我尽量让自己关注自身和我的内在小孩，并尽可能地给予他
无条件的爱。
</tw-passagedata><tw-passagedata pid="240" name="帮助儿童管理情绪闪回" tags="" position="37125,925" size="100,100">@帮助儿童管理情绪闪回
以下列举的方法，适用于救助受创儿童的社会工作者、教师、亲戚、邻居和朋友。它
是根据本章开头的步骤改编的。根据孩子的年龄差异，每个步骤的适用性也有所不同。即
便你不打算救助其他儿童，也请为了你的内在小孩至少读一遍这些步骤。
1. 帮助孩子（从创伤中）意识到闪回。问问孩子：“你以前什么时候有过这样的感
觉？当有人对你很不好的时候，你是这种感觉吗？”
2. 示范“感觉到危险并不意味着真的身处危险之中”。教导孩子有些地方比其他地方
更安全。使用轻松柔和的语气告诉孩子：“或许我们可以一起放松一下。”“和我在一起
是安全的。”“这里没有人能伤害你。”
3. 身体力行地让孩子知道，有大人愿意照顾和保护他。争取与孩子建立他的第一
个安全关系。同时，让孩子与其他安全的成人、社团等建立联系。
4. 宽慰孩子，让他放心。平衡“爱与限制”：友善地设立限制，并且每设立一个限制
都要给予他五个激励。
5. 引导孩子的思绪回到身体上，从而减少过度警觉和过度反应。
①教孩子对主要肌肉群进行系统性放松。
②教孩子进行深而慢的横膈膜式呼吸[5]。
③鼓励孩子放慢速度，从而控制增加恐惧的急躁行为。
④教孩子一些有助于平静与专注的活动，如绘画、合气道、太极拳、瑜伽、伸展
运动等。
⑤帮孩子辨别安全的地方，并鼓励孩子到这些地方去。
6. 教孩子“说出自己的想法”。在一些家庭中，说话是危险的。口头宣泄可以释放痛
苦和恐惧，并恢复应对危险的技能。
7. 教孩子哀悼丧失的安全感。被虐待和忽视会导致悲伤、愤怒和恐惧，而哭泣可
以释放这些情绪。以不伤害自己或他人的方式发泄愤怒，能够营造出一种安全感。
8. 缩减内在批判者，让大脑对人更加友好。教孩子识别消极的自我对话和基于恐
惧的幻想。教给孩子“思维阻断”和“思维替换”的方法。帮助孩子记住自己的诸多优点、
价值、成就和资源。
9. 帮助孩子识别他的4F反应类型及其积极的一面。通过歌曲、动画或电影人物来
帮助孩子。例如，战类型：《恐龙战队》；逃类型：哔哔鸟、《巴布工程师》；僵类
型：阿凡达；讨好类型：《芝麻街》的格罗弗。
10. 教育孩子人有权利和必要去设定界限、说“不”、抗议不公、寻求负责任的成年
人的保护。
11. 识别并避免危险的人、地方和活动（就像超人会避开氪石，优秀的运动员避免
违规那样）。
12. 破除“闪回会永无止境地袭来”的想法。建构关于未来的生动画面，让孩子相信
那是可实现的，是更安全、更友好、更繁荣的，并以类似的成功故事举例。
[1]丹尼尔·戈尔曼（Daniel Goleman），心理学家，《情商》（Emotional
Intelligence）的作者，被誉为“情商之父”。
[2]厌恶条件反射指厌恶刺激与其诱发的不适应之间的联系，人做出避免或摆脱厌恶
刺激的反应。——编者注
[3]疑病症指以担心或相信自己患有某种躯体疾病或身体畸形的持久性优势观念为主
的神经症。——编者注
[4]滑坡谬误是一种逻辑谬论，指利用不合理的因果关系将“可能性”转化为“必然
性”，从而得出武断的错误结论。——编者注
[5]横膈膜式呼吸也被称为腹式呼吸，吸气时腹部膨胀，吐气时横膈膜将会比平常上
升，因而可以进行深度呼吸。——编者注
</tw-passagedata><tw-passagedata pid="241" name="视角替换" tags="" position="32950,2450" size="100,100">视角替换
最重要的思维纠正是替换我们思维的视角。视角替换意味着拓宽我们的总体视角，将
我们的视角从内在批判者那狭隘消极的关注点转移到观察性自我（也是正念自我）这种更
平衡、更准确的关注点上来。视角替换还能帮助我们推翻内在批判者的消极人生观。这就
像解雇一个糟糕的经理或无能的教练一样，因为他观念扭曲，太过纠结于错误，而看不到
任何正确的事，所以我们不能再聘用他。
练习视角替换的一个强效方法是：晚上躺到床上以后，列出一天中发生的至少10件好
事。这些事带给你的感受往往不是巅峰体验，而是基本而简单的快乐和感激。它们可能很
简单，比如一首动听的旋律、一种悦目的色彩、一种甜美的香味、一份可口的食物、花园
中一朵新开的花、一个好看的电视节目、邻居的一声问候、爬楼梯时身体强健的感觉、最
喜欢的作家的治愈性文字，或与宠物的美好邂逅。
如第一章所述，关于感恩的灵性疗愈有助于强化视角替换的作用。在这一层面上，感
恩也是一种正念，它在寻找生活中的实证，以证明生活虽然困难重重，但本质上仍是美好
的。
</tw-passagedata><tw-passagedata pid="242" name="视角替换与感恩" tags="" position="33075,2450" size="100,100">@视角替换与感恩
感恩是一个微妙的话题，因为许多幸存者都因“应该对你所拥有的一切心存感激”这一
忠告而感到被羞辱和伤害。许多幸存者因此完全拒绝感恩，并将它的益处也一并丢弃。再
次强调，如果你在童年时几乎没有值得感恩的事，那么你拒绝感恩也是情有可原，是完全
可以理解的。
此外，一些心理学家滥用“感恩”这一概念，来支持否认创伤的心理防御。他们将感恩
吹捧为一条可以绕过创伤性痛苦的快速通道。这一方法对于CPTSD幸存者而言极为荒
谬。事实上，这对幸存者而言甚至是一种可耻的虐待，因为若要治愈自己，首先就必须充
分理解和梳理深度、长期的创伤。
然而，感恩是一种美妙的自然体验，可以持续提高你的生活质量。你可以用它来培养
一种开放的视角，去留意值得感激的事物，但不要试图去保持永恒的感激状态。久而久
之，感恩的态度会逐渐增加真挚的感激之情。
“爱”是一个最好的例子。虽然爱朋友和爱伴侣无疑是健康的，但我们不可能每时每刻
都对他人释放或抱有爱意。如果你对自己有这样的期望，就会给内在批判者提供无尽的素
材，使它有机会攻击你不够有爱。同样地，如果你期望自己一直感恩，就会推动内在批判
者开启对自己失望的可怕“程序”。
尽管如此，爱和感恩的态度通常是具有治疗作用的。当我暂时被困在闪回中，对生活
感到疏离时，记起平时生活中令我感恩的事物有时能把我从极端的消极思维中拉出来。
唤起感恩之情有时特别困难，而且在一开始往往无法实现，因为闪回通常会使我们陷
入强烈的消极情绪中，让我们无法感受到生活中的美好。在练习感恩的早期阶段，提醒自
己记起生活中有价值的事物似乎收效甚微。然而，通过练习积极关注，我们有时可以通过
唤起关于感恩的回忆来舒缓闪回的强度。
当我在长时间闪回的末期体验到感恩时，积极关注有时会自发产生，并带来欢欣的满
含感恩的泪水。这种泪水通常也意味着解脱和获得归属感。
这些眼泪往往是在不经意间产生的，没有任何征兆。它们往往是由关于美和联结的正
向体验和积极情感所触发的。例如，当鲜花让我再次真挚地感受到美时；当我对音乐恢复
了欣赏力，灵魂深受触动时；当我突然全身心地感受到我是多么爱自己的妻子、儿子、朋
友或来访者时。
在经历了无法享受这些情感体验的痛苦时光后，这些感受的回归带来了充满感激的泪
水。我对生命重新充满真挚的感恩之情，使我在真正重要的场合笑中带泪。
根据我的经验，越常练习视角替换法，越关注感恩之事，那么在失去真挚的感恩之情
时，我就能越快地找回这种情感。
几十年来，这种练习极大地帮我摆脱了从父母那里继承的刻薄观念，为我提供了对生
活和他人更客观而准确的感知。
</tw-passagedata><tw-passagedata pid="243" name="大脑的神经可塑性" tags="" position="33200,2450" size="100,100">@大脑的神经可塑性
在神经科学研究中，不断有证据表明大脑神经具有可塑性，每每读到这些研究我都感
到很振奋。神经可塑性意味着大脑在我们一生中会不断成长和变化。旧的自我毁灭式的神
经通路可以被消除，而新的更健康的神经通路可以取而代之。托马斯·刘易斯（Thomas
Lewis）的《爱的起源》极富启发性地阐述了这一点。这一事实能帮助我们认识到，通过
长期、频繁而专注地使用思维阻断、思维替换和思维纠正，我们的内在批判者确实可以被
缩减。
随着疗愈的进行，你会更早察觉到内在批判者即将发动的全方位攻击，从而能够采取
更迅速的自我保护行动。此外，闪回可以让你意识到童年的创伤，并在后期的疗愈阶段将
其作为受到创伤的证明，因为闪回有力地证明了这样一个事实：父母的忽视和遗弃迫使你
养成了过度警觉和消极关注的习惯。
[1]出自美国著名神学家雷茵霍尔德·尼布尔（Reinhold Niebuhr）在1943年所写的
祷告词，后来这一祷告词被广泛应用于戒酒团体治疗和十二步骤疗法中。——编者注
[2]个体自我化指在心理上建立独立的、内在的“我”的过程，是一种自主性的发
展。——编者注
</tw-passagedata><tw-passagedata pid="244" name="羞耻感是对自己的不公指责" tags="" position="32500,2450" size="100,100">@羞耻感是对自己的不公指责
伟大的心理学家爱利克·埃里克森（Erik Erikson）认为：羞耻感是对自己的指责。童
年时，我们的父母太过强大，我们无法指责他们，因此只能责备自己。但如今我们已经摆
脱了父母，并且可以将不公平的自我责备重新指向父母，从而切断羞耻感的来源。
你可以将自我批判中的愤怒转向那些将内在批判者置于你心中的人，或者转向内在批
判者本身。你可以对父母霸凌你时的形象感到愤怒和厌恶，从而把羞耻感还给他们。你还
可以怒斥他们在你年幼弱小还无法自卫时用羞耻感来压迫你的行为。
然而，从童年时就开始控制着我们的内在批判者，不会轻易放弃对我们心理的统治。
它顽固地抵制这一新信息：成年后的我们会更有安全感，也会建立更健康的依恋关系。内
在批判者仿佛已在我们大脑中留下了一条巨型的闪回导火索。如今，前文列举的任何一种
思维模式都可能引发杏仁核劫持，使我们陷入“混杂的被遗弃感”。
因此，缩减内在批判者的进展最初往往极为缓慢且难以察觉。我们的大脑已经习惯于
只注意错误和危险。和大多数成瘾症状一样，打破这种根深蒂固的习惯可能需要终身的管
理。
在早期的疗愈过程中，我们需要竭尽所能，不断挑战内在批判者对消极面的单一关
注。通过练习，一部分自我最终将会对父母不公平的霸凌和冷漠感到愤怒，对长期被灌输
的自我虐待和自我遗弃的观念感到愤怒。我们还会因为事发时太过年幼而愤怒，那时的我
们无法抗议，甚至不知道自己身上发生了什么。我们可以逐渐培养自己说“不”和“闭嘴”的
能力，在内在批判者攻击我们时勇敢拒绝。
当有了足够、积极的内在自我保护能力时，我们将逐渐学会不再无意识地自我虐待和
自我遗弃。健康的自我保护意识将开始形成，并逐渐发展为一种强烈的意愿，想要阻止一
切不公平的批评，无论是来自内在还是外在。
从心理学的角度讲，这是破除强迫性重复的一个环节。破除强迫性重复包括内外两个
层面。在内部，我们通过坚定地对抗内在批判者，来克服重现父母虐待行为的习惯。这样
一来，我们也会在外部更加留意其他人（类似我们父母）的虐待行为，并且与他们对抗，
让他们停止虐待，或把他们驱逐出我们的生活。通过足够的练习，我们可以切断父母遗留
下来的可怕影响，不再认为爱是麻木地接受虐待和忽视。</tw-passagedata><tw-passagedata pid="245" name="拥抱内在批判者" tags="" position="32625,2450" size="100,100">
拥抱内在批判者
根据我的经验，在战反应基本恢复之前，认知疗法、心理动力学疗法或正念疗法这类
鼓励接纳内在批判者的方法对CPTSD幸存者的帮助不大。
而在后期的疗愈过程中，当幸存者拔除了内在批判者的毒刺后，这些方法则可能有相
当大的价值。只有到了那时，我们才能重新从健康的自我批评中获益。
有一个典型的迹象能够说明内在批判者已经变得柔和而有益，那就是它会以一种亲切
助人的声音对我们说话。当我们能够且应该做得更好时，它会冷静地提醒我们调整自己的
行为。然而，如果它因为我们的不完美而责备我们，就暴露了它其实仍然是父母置于我们
心中的毒性批判。
用左脑客观地拥抱内在批判者通常起不到帮助的效果，除非它与右脑主观的坚定自我
保护相平衡。这也许是因为内在批判者与高度感性的右脑共同支撑着情绪闪回，也许是因
为有毒的内心批判过程过于情绪化，以致理性和冷静的抵制太过微弱而无效。</tw-passagedata><tw-passagedata pid="246" name="想法也可能触发闪回" tags="" position="31875,2375" size="100,100">@想法也可能触发闪回
孩子如果得不到父母的认可，就会认为自己的观点和感受是不完美的，是危险的。在
最严重的情况下，单是产生说话的冲动就会引发孩子的恐惧和羞耻感，因为他会想到自己
一开口就将招致更强烈的责备和更严厉的惩罚。但是对于一个孩子来说，要说什么话自己
才不会被父母认为是愚蠢和无用的呢？
当持续的忽视或虐待反复强化了内在批判者后，即使是最无害的利己想法或思考也会
引发孩子强烈的情绪闪回。由于孩子心中还有赢得父母认可的虚幻愿望，他的完美主义追
求会不断升级，并可能发展为强迫症。在此时，即使是一个想象中的错误也会引发闪回。
</tw-passagedata><tw-passagedata pid="247" name="内在批判者是内化的父母" tags="" position="32000,2375" size="100,100">@内在批判者是内化的父母
常有来访者在面谈时羞愧地忏悔道：“我昨晚反复骂自己是个笨蛋。这一定说明我本
质上有问题，因为我母亲从没说过这个词。虽然她很坏，但她从来没有说过脏话，我怀疑
她甚至没有听说过这个词。”之所以会出现这种现象，是因为内在批判者的批判是一个不
断发展的过程，它会收编我们的创造力，并以一种“全新改进后”的方式模仿父母的蔑视。
父母的蔑视是造成情绪虐待的关键因素，会使你产生毒性羞耻感。毒性羞耻感使我们
无助地陷于闪回中，是导致遗弃抑郁的情绪基础，也是内在批判者的情绪基调。羞耻感会
在情绪上加剧前文的14种攻击，从而侵蚀我们的内心。
在主流心理学中，羞耻感通常被描述为一种社会情绪。正常的羞耻感是一种较为健康
的自律情绪反应。当我们被人目睹以不公平、具有攻击性或伤害性的方式行事时，我们就
会出现这种反应。毒性羞耻感却有所不同。许多CPTSD幸存者在疗愈过程中很快就能意
识到，自己不需要被人目睹就会突然遭到羞耻感的攻击。比如，当德米特里打翻了那杯水
的时候，他身边并无旁人。
但他真的是独自一人吗？毒性羞耻感是在一个无形的社会脉络中攻击我们的，它具有
社会性，并能在我们与父母的病态交流中发展出内在批判者。此外，当独自一人陷入闪回
的那一刻，我们感觉就像回到了父母面前一样。对我来说最有力的证据是，当我独自一人
试图做一些困难的事情时，如果我犯了错误或没有尽可能高效地完成任务，就会感到非常
焦虑，好像正在被监视并受到批评。
我认为出现这种现象是因为我们把父母内化到了自己的心中。父母在我们的成长过程
中是无比重要的存在，以至于我们在心理上对他们有强烈的代入感，包括他们对我们的看
法和批评。如果不能努力减少他们对我们的影响，内化的父母就会一直存在于我们心中，
并成为控制我们生活的关键力量。
</tw-passagedata><tw-passagedata pid="248" name="应对内在批判者的固执" tags="" position="32125,2375" size="100,100">@应对内在批判者的固执
缩减内在批判者是疗愈过程中最重要的环节之一，尽管其重要性在本书中已多次陈
述，但这个环节要比乍看起来更具挑战性。
父母将内在批判者的“程序”深深烙印在我们心中，我们自己也在不知不觉中模仿父母
并将其固化。成年后，我们继续沿袭了父母施加的有害影响，甚至还起到了关键的强化作
用。如果缺乏足够的正念，我们就会通过愤怒和自我厌恶来无数次地重复父母对我们的评
判，从而伤害自己。有效的疗愈需要你不再盲目服从于这种只关注自身消极方面的思维。
但转变自我否定的思维模式是一项艰巨的任务，通常需要我们终身的努力，我们往往前进
两步又会后退一步，而这后退的一步让人感觉像好多步，非常令人挫败。
然而，神经科学的近期成果显示，长期的重复性疗愈练习可以从生物学层面削弱根深
蒂固的心理模式，并以新的模式取代。我认为这类似于健身，运动可以帮助塑形，但这需
要大量的重复锻炼。
近二三十年间，我的大脑已经从自己的宿敌变为了颇为可靠的盟友，而我也在许多长
期坚持疗愈的来访者身上看到了类似的变化。
</tw-passagedata><tw-passagedata pid="249" name="完美主义和情感忽视" tags="" position="32250,2375" size="100,100">@完美主义和情感忽视
如前文所述，完美主义也是遭到情感遗弃儿童的一种本能防御反应。完美主义为弱小
无援的孩子带来了方向感和一定的意义感。追求完美让他获得了一丝控制感，而进行自我
控制也让他感到更安全，因为有遗弃行为的父母通常会用严厉的手段惩罚忍不住表达不满
的孩子。但是因为完美永远达不到，这些孩子便不知放弃地努力，直至失败迫使其退至解
离性的僵反应或反社会的战反应。
由于对完美的追求总是失败，且仍然难以获得父母的认可和关怀，所以孩子逐渐认
定“不完美”就等同于羞耻感和恐惧。孩子会认为自己“不完美”，引发对被遗弃的恐惧，进
而引发对“不完美”自我的厌恶，使父母的遗弃延伸为自我遗弃。这反过来又进一步增强了
恐惧，并加剧了自我厌恶，最终让孩子陷入恐惧和抑郁（包裹着羞耻感）的恶性循环。这
种情况可能持续数小时、数天甚至数周，对于那些患有严重CPTSD的人来说，这甚至可
能成为他们的常态。
</tw-passagedata><tw-passagedata pid="250" name="再谈危害设想" tags="" position="32375,2375" size="100,100">@再谈危害设想
内在批判者的危害设想会对幸存者产生深远的影响。我有许多进展良好的来访者，他
们已经相对克服了完美主义，但仍然忍不住预想潜在的危险，为此深受困扰。换言之，很
多幸存者在很大程度上消除了完美主义式的自我攻击思维，却没有意识到自己的脑海中仍
然充斥着令人恐惧的想法和画面。
永久的遗弃、公开的羞辱、致命的疾病、孤独的死亡、迫在眉睫的攻击、身无分文的
流浪，这些是许多幸存者设想的危险主题。我的一位来访者这样形容他的设想危险的内在
批判者的角色：“我的内在批判者是一位恐怖电影制片人。”
对我自己来说，我花了很长时间才学会不再执着于对痛苦和危险的想象，这远远超过
了摆脱完美主义所花的时间。事实上，我非常善于把这些想象幻化为一部关于自己即将死
亡的长片。
如果让我描述内在批判者两个最关键的运作过程，我会这样说：首先，这是一个极度
关注负面并且不断自我延续的过程；其次，这是一种持续的过度警觉，为了应对自认为随
时可能发生的灾难而全力防守。
</tw-passagedata><tw-passagedata pid="251" name="目录" tags="" position="35050,2200" size="100,100">目 录
推荐语
一部关于复杂性创伤后应激障碍（CPTSD）识别与治疗的图谱
创伤不是你的错，但复原是你自己的责任
译者序
中文版序
前言
第一部分 疗愈概述
第一章 CPTSD的疗愈之旅
CPTSD的主要症状
情绪闪回：CPTSD最典型的症状
毒性羞耻感：情绪闪回的表象
CPTSD的其他症状
自杀意念
CPTSD的成因
可能出现的误诊
更多关于创伤的信息
4F反应：战、逃、僵、讨好
诱发CPTSD的家庭中的4F反应类型
第二章 康复的各个层面
CPTSD中关键的发展停滞
认知疗愈
缩减批判者
发展停滞的健康自我
心理教育与认知疗愈
正念
情绪疗愈
情绪层面的康复
情绪智力
毒性羞耻感与“灵魂谋杀”
哀悼是一种情绪智力
灵性疗愈
通过更高层次的归属感来缓解被遗弃的痛苦
感恩
足够好的抚育
身体疗愈
自助躯体疗法
CPTSD和躯体疗法
自我药疗
解决饮食问题
第三章 改善关系
预先警告
CPTSD是一种依恋障碍
社交焦虑的成因
我的关系型疗愈之旅
疗愈消解了孤独的羞耻感
寻找足够好的关系型帮助
切断与父母的联系
学会处理关系中的冲突
再抚育
当自己的父母
自我母育与“无条件的爱”
“无条件的爱”的界限
养育你的内在小孩
自我父育与“时光机营救行动”
代表团的再抚育
自我关系与他人关系之道
第四章 疗愈的进程
疗愈的阶段
在循序渐进的疗愈中培养耐心
接受“疗愈将持续终身”的事实
康复的迹象
识别康复迹象的困难
从求生到茁壮
有疗愈意义的闪回与成长之痛
最佳压力
黑暗中的曙光
“未经审视的人生不值得过”
“别担心，要开心”的情绪霸权
第二部分 疗愈的细节
第五章 如果我不曾被打呢？
否认和“最小化”
内在批判者的神经生物学理论
情感忽视：造成CPTSD的核心伤害
情感饥渴与成瘾
生长迟滞综合征
依恋需求的进化基础
情感遗弃会降低情绪智力和关系智力
停止对情感遗弃的“最小化”
练习展现脆弱
叙述的力量
第六章 我属于何种创伤类型
恰当地使用4F反应
作为依恋障碍的CPTSD
战类型和自恋型防御
迷人的霸凌者
其他类型的自恋者
从极端的战反应中康复
逃类型和强迫型防御
左脑解离
从极端的逃反应中康复
僵类型和解离型防御
右脑解离
从极端的僵反应中康复
讨好类型和关系依赖型防御
从极端的讨好反应中康复
混合的创伤类型
战-讨好类型
逃-僵类型
战-僵类型
自我评估与康复
从积极到消极的4F反应变化路径
第七章 从基于创伤的关系依赖中康复
比较讨好类型的成因与战、逃和僵类型的成因
基于创伤的关系依赖症
关系依赖的亚型
讨好-僵类型：替罪羊
讨好-逃类型：超级护士
讨好-战类型：令人窒息的母（父）亲
再谈从极端的讨好反应中康复
面对展现自我的恐惧
用哀悼治愈关系依赖
后期的疗愈
“不认同我也没关系”
第三部分 疗愈的方法
第八章 管理情绪闪回
管理情绪闪回的13个实用步骤
诱因和情绪闪回
“那个表情”：情绪闪回的常见外在诱因
不容忽视的内在诱因
逐渐增强对诱因的认知
闪回的迹象
再谈自我药疗
治疗过程中的闪回
通过哀悼管理闪回（第9步）
管理内在批判者（第8步）
进阶的闪回管理
在遗弃抑郁中醒来
闪回是内在小孩的求救信号
灵活运用闪回管理步骤
存在性诱因
后期的疗愈
帮助儿童管理情绪闪回
第九章 缩减内在批判者
内在批判者的成因
应对14种常见的来自内在批判者的攻击
由内在批判者引发的闪回
想法也可能触发闪回
内在批判者是内化的父母
应对内在批判者的固执
完美主义和情感忽视
再谈危害设想
利用愤怒对内在批判者进行思维阻断
羞耻感是对自己的不公指责
拥抱内在批判者
思维替换和思维纠正
视角替换
视角替换与感恩
大脑的神经可塑性
第十章 缩减外在批判者
外在批判者：人际关系的敌人
4F反应类型和内在or外在批判者的比例
外在批判者与被动攻击
拒绝为批判者的观点发声
由外在批判者主导的闪回
外在批判者在媒体中的示范
批判者：潜意识中的B级片制片人
将新闻视为诱因
外在批判者与亲密关系
没有赢家的局面
吓跑他人
在外在和内在批判者之间切换
摇摆的批判者们
外在批判者：法官、陪审团和刽子手
寻找替罪羊
正念和缩减外在批判者
当正念加剧了外在批判者时
思维替换与思维纠正：挤走外在批判者
哀悼能够阻断外在批判者
通过消解移情来弱化外在批判者
通过外在批判者进行健康的发泄
路怒、移情和外在批判者
第十一章 哀悼
哀悼能够拓展洞察力和理解力
哀悼父母关爱的缺失
衰掉能够改善闪回
内在批判者会阻碍哀悼
通过哀悼缩减内在批判者
哀悼的四种方式
愤怒：减轻羞耻感和恐惧
愤怒有助于消解重复性强迫
哭泣：疏导情绪的有效方式
哭泣与自我同情
哭泣与愤怒的共舞
口头宣泄：通向亲密关系的最佳路径
口头宣泄的神经科学理论
思考和感受同步
独自进行口头宣泄
解离会阻碍口头宣泄
口头宣泄能治愈被遗弃的创伤
口头宣泄和亲密关系
感受：被动地化解悲伤
感受可以治疗消化问题
情绪与身体的联结
平衡感受和情绪
学习感受
一个关于感受的练习
使用并加强哀悼的技巧
第十二章 管理遗弃抑郁的地图
反应循环
反应循环中的解离层次
父母的遗弃造成了自我遗弃
破除自我遗弃
抑郁思维与抑郁感受
正念能够代谢抑郁
身体的正念
对身体的觉察可以疗愈性地触发痛苦的记忆
自省式的身体练习
通过充分感受来消解抑郁
饥饿是伪装的抑郁
假性环性心境障碍
区分必要的痛苦与不必要的痛苦
疗愈是渐进的
用全方位的疗愈工作来应对闪回
第十三章 通过关系来治愈遗弃创伤
心理治疗的关系维度
CPTSD中的关系型治疗
共情
真诚地展现脆弱：“真实的关系造就健康的关系”
治疗性的情绪表露
自我表露的准则
自我情绪表露与分享类似的创伤史
对话性
满足健康的自恋需求
对话性中的心理教育
对话性与4F反应类型
合作型关系的修复
从遗弃到亲密：一个案例研究
赢得的安全型依恋
将患者从内在批判者手中拯救出来
寻找治疗师
寻找线上或线下支持团体
互助咨询
第十四章 原谅：从自己开始
真正的原谅
原谅是一种爱的感觉
第十五章 阅读疗法与图书社群
推荐阅读
第十六章 自助工具
一号工具箱：康复意图建议
二号工具箱：公平与亲密的指导原则
三号工具箱：针对内在批判者常见攻击的内在反击建议
四号工具箱：有爱地化解冲突
关于“暂停”（第15条）
关于移情（第18、19条）
五号工具箱：感恩
感激自己
感激他人
六号工具箱：CPTSD疗愈最基本的原则
致谢
参考文献</tw-passagedata><tw-passagedata pid="252" name="闪回后期的疗愈" tags="" position="36950,900" size="100,100">后期的疗愈
当疗愈取得足够的进展时，你会意识到，闪回中的大部分痛苦情绪都是对童年受虐或
被忽视经历做出的恰当但延迟的反应。通过解决闪回问题会使你建立起越来越健康的自我
意识，这能让童年的痛苦不断减少。而这些痛苦的减少反过来又会使闪回变得不那么频
繁、强烈和持续。
最终，你学会了在意识到自己被触发闪回时立即唤起自我保护的本能。随着闪回次数
的减少，以及它变得越来越易于管理，围绕闪回建立的各种类型的防御（自恋、强迫、解
离或关系依赖）也更容易被破解。
在这一疗愈阶段每当摆脱一次闪回，你可能都会体验到一种具有讽刺意味的满足感。
渐渐地，你可能会在很多意识层面感受到，小时候在父母家的生活比你认为的还要糟糕。
同时，你还会相应地感受到一种解脱，因为现在的你比以前更容易摆脱父母对你生活的影
响了。
</tw-passagedata><tw-passagedata pid="253" name="读者须知" tags="" position="34925,2200" size="100,100">@读者须知
心理学与精神医学是随着人类的科研成果与经验积累不断发展的。本书中所有的建议都由
作者审慎提出。虽然如此，你在采纳之前还是应该考虑自身情况与专业人士的建议。如果
你的心理健康出现了严重问题，本书是不能代替药物或心理治疗的，请寻求专业的帮助。
因本书相关内容造成的直接或间接的不良影响，出版社和作者概不负责。
</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){(function(window,document,jQuery,undefined){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function mesg(where,error,isFatal,isUncaught){var mesg="Error",nice="A".concat(isFatal?" fatal":"n"," error has occurred.");nice+=isFatal?" Aborting.":" You may be able to continue, but some parts may not work properly.";var isObject=null!==error&&"object"===_typeof(error),what=(isObject&&"message"in error?String(error.message).replace(errorPrologRegExp,""):String(error)).trim()||"unknown error";null!=where&&(mesg+=" [".concat(where,"]")),mesg+=": ".concat(what,"."),isObject&&"stack"in error&&(mesg+="\n\nStack Trace:\n".concat(error.stack)),mesg&&(nice+="\n\n".concat(mesg)),isUncaught||console[isFatal?"error":"warn"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){"complete"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.freeze(Object.defineProperties({},{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))}(),Patterns=(wsMap=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),wsRe=/^\s$/,missing="",wsMap.forEach((function(pat,char){wsRe.test(char)||(missing+=pat)})),space=missing?"[\\s".concat(missing,"]"):"\\s",spaceNoTerminator="[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",notSpace="\\s"===space?"\\S":space.replace(/^\[/,"[^"),anyChar="(?:.|".concat("[\\n\\r\\u2028\\u2029]",")"),anyLetter="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",anyLetterStrict=anyLetter.replace("\\-",""),identifier="".concat("[$A-Z_a-z]").concat("[$0-9A-Z_a-z]","*"),variable="[$_]"+identifier,htmlTagName="[A-Za-z](?:".concat(cENChar="(?:[\\x2D.0-9A-Z_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])","*-").concat(cENChar,"*|[0-9A-Za-z]*)"),twStyle="(".concat(anyLetter,"+)\\(([^\\)\\|\\n]+)\\):"),cssStyle="".concat(spaceNoTerminator,"*(").concat(anyLetter,"+)").concat(spaceNoTerminator,"*:([^;\\|\\n]+);"),idOrClass="".concat(spaceNoTerminator,"*((?:").concat("[#.]").concat(anyLetter,"+").concat(spaceNoTerminator,"*)+);"),inlineCss="".concat(twStyle,"|").concat(cssStyle,"|").concat(idOrClass),Object.freeze({space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:notSpace,anyChar:anyChar,anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:identifier,variableSigil:"[$_]",variable:variable,macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",htmlTagName:htmlTagName,cssIdOrClassSigil:"[#.]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:inlineCss,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})),wsMap,wsRe,missing,cENChar,twStyle,cssStyle,idOrClass,space,spaceNoTerminator,notSpace,anyChar,anyLetter,anyLetterStrict,identifier,variable,htmlTagName,inlineCss;!function(){var startWSRe,endWSRe,_trimString=(startWSRe=new RegExp("^".concat(Patterns.space).concat(Patterns.space,"*")),endWSRe=new RegExp("".concat(Patterns.space).concat(Patterns.space,"*$")),function(str,where){var val=String(str);if(!val)return val;switch(where){case"start":return startWSRe.test(val)?val.replace(startWSRe,""):val;case"end":return endWSRe.test(val)?val.replace(endWSRe,""):val;default:throw new Error('_trimString called with incorrect where parameter value: "'.concat(where,'"'))}});function _createPadString(length,padding){var targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return"";var padString=void 0===padding?"":String(padding);for(""===padString&&(padString=" ");padString.length<targetLength;){var curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,(function(acc,cur){return cur instanceof Array?acc.push.apply(acc,_toConsumableArray(flat.call(cur,depth-1))):acc.push(cur),acc}),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var length=this.length>>>0;if(0===length)return!1;var needle=arguments[0],i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){var value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(obj).map((function(key){return[key,obj[key]]}))}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(iter){return Array.from(iter).reduce((function(acc,pair){if(Object(pair)!==pair)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(obj){if(null==obj)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var O=Object(obj);return Reflect.ownKeys(O).reduce((function(acc,key){var desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.values object parameter must be an object");return Object.keys(obj).map((function(key){return obj[key]}))}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return _trimString(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return _trimString(this,"end")}})}(),function(){var _nativeMathRandom=Math.random,_regExpMetaCharsRe,_hasRegExpMetaCharsRe,_formatRegExp,_hasFormatRegExp;function _random(){var min,max;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:min=0,max=arguments[0];break;default:min=arguments[0],max=arguments[1]}if(min>max){var _ref=[max,min];min=_ref[0],max=_ref[1]}return Math.floor(_nativeMathRandom()*(max-min+1))+min}function _randomIndex(length,boundsArgs){var min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min)<0&&(min=0),Number.isNaN(max)?max=0:(!Number.isFinite(max)||max>=length||max<0&&(max=length+max)<0)&&(max=length-1),_random(min,max)}function _getCodePointStartAndEnd(str,pos){var code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)throw new Error("high surrogate without trailing low surrogate");var nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error("high surrogate without trailing low surrogate");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error("low surrogate without leading high surrogate");var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error("low surrogate without leading high surrogate");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(array){if("object"!==_typeof(array)||null===array||!Object.prototype.hasOwnProperty.call(array,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var length=array.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments,1));return array[index]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var result=Array.from(this);if(0===arguments.length)return result;var items=Array.prototype.reduce.call(arguments,(function(prev,cur){return prev.concat(cur)}),[]),addSize=items.length;if(0===addSize)return result;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var indexOf=Array.prototype.indexOf,needle=arguments[0],pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,"countWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.countWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.countWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return 0;for(var count=0,i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[],i=0;i<length;++i)for(var value=this[i],j=0;j<needlesLength;++j){var needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}for(var result=[],_i=0,iend=indices.length;_i<iend;++_i)result[_i]=this[indices[_i]];for(var splice=Array.prototype.splice,_i2=indices.length-1;_i2>=0;--_i2)splice.call(this,indices[_i2],1);return result}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,cpyIndices=_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map((function(x){return x<0?Math.max(0,length+x):x}))).values()),delIndices=_toConsumableArray(cpyIndices).sort((function(a,b){return b-a})),result=[],i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(var _i3=0,_iend=delIndices.length;_i3<_iend;++_i3)splice.call(this,delIndices[_i3],1);return result}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,indices=[],result=[],i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(var _i4=indices.length-1;_i4>=0;--_i4)splice.call(this,indices[_i4],1);return result}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return Array.prototype.splice.call(this,index,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var splice=Array.prototype.splice,result=[],max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return this[index]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var picked=new Map,result=[],max=length-1;do{var i=void 0;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var length=this.length>>>0;if(0===length)return this;for(var i=length-1;i>0;--i){var j=Math.floor(_nativeMathRandom()*(i+1));if(i!==j){var swap=this[i];this[i]=this[j],this[j]=swap}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){for(var applied=[],argc=0,i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(num,min,max){var value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(num){return 1-(Math.cos(Number(num)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var min=Number(arguments[0]),max=Number(arguments[1]);if(min>max){var _ref2=[max,min];min=_ref2[0],max=_ref2[1]}return Math.min(Math.max(this,min),max)}}),RegExp.escape||(_regExpMetaCharsRe=/[\\^$*+?.()|[\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source),Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(str){var val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,"\\$&"):val}})),_formatRegExp=/{(\d+)(?:,([+-]?\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source),Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(format){function padString(str,align,pad){if(!align)return str;var plen=Math.abs(align)-str.length;if(plen<1)return str;var padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}if(arguments.length<2)return 0===arguments.length?"":format;var args=2===arguments.length&&Array.isArray(arguments[1])?_toConsumableArray(arguments[1]):Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,(function(match,index,align){var retval=args[index];if(null==retval)return"";for(;"function"==typeof retval;)retval=retval();switch(_typeof(retval)){case"string":break;case"object":retval=JSON.stringify(retval);break;default:retval=String(retval)}return padString(retval,align?Number.parseInt(align,10):0," ")}))):format}}),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var needle=String(arguments[0]||"");if(""===needle)return 0;for(var indexOf=String.prototype.indexOf,step=needle.length,pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var str=String(this);return _getCodePointStartAndEnd(str,str.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(startAt,delCount,replacement){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var length=this.length>>>0;if(0===length)return"";var start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length)<0&&(start=0):start=0,start>length&&(start=length);var count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);var res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd3=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd3.char,end=_getCodePointStartAnd3.end;return-1===end?"":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd4=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd4.char,end=_getCodePointStartAnd4.end;return-1===end?"":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","(".concat(this.toString(),")")]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",_toConsumableArray(this)]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",_toConsumableArray(this)]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(code,data){if("string"!=typeof code)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[code,data]]}}),Object.defineProperty(JSON,"_real_stringify",{value:JSON.stringify}),Object.defineProperty(JSON,"stringify",{configurable:!0,writable:!0,value:function(_value,replacer,space){return JSON._real_stringify(_value,(function(key,val){var value=val;if("function"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value&&(value=["(revive:eval)","undefined"]),value}),space)}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,(function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var match,re=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),names=[];null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})}();var Browser=(userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes("windows phone"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes("android"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&("object"===_typeof(window.operamini)||userAgent.includes("opera mini")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:function(){return isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes("gecko"),isIE=!userAgent.includes("opera")&&/msie|trident/.test(userAgent),ieVersion=isIE?(ver=/(?:msie\s+|rv:)(\d+\.\d)/.exec(userAgent))?Number(ver[1]):0:null,isOpera=userAgent.includes("opera")||userAgent.includes(" opr/"),operaVersion=isOpera?function(){var ver=new RegExp("".concat(/khtml|chrome/.test(userAgent)?"opr":"version","\\/(\\d+\\.\\d+)")).exec(userAgent);return ver?Number(ver[1]):0}():null,isVivaldi=userAgent.includes("vivaldi"),Object.freeze({userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi})),ver,userAgent,winPhone,isMobile,isGecko,isIE,ieVersion,isOpera,operaVersion,isVivaldi,Has=(hasAudioElement=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(ex){}return!1}(),hasFile=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1}(),hasGeolocation=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1}(),hasMutationObserver=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(ex){}return!1}(),hasPerformance=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(ex){}return!1}(),hasTouch=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1}(),hasTransitionEndEvent=function(){try{for(var teMap=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),teKeys=_toConsumableArray(teMap.keys()),el=document.createElement("div"),i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1}(),Object.freeze({audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent})),hasAudioElement,hasFile,hasGeolocation,hasMutationObserver,hasPerformance,hasTouch,hasTransitionEndEvent,Visibility=(vendor=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find((function(vnd){return vnd.hiddenProperty in document})))}catch(ex){}return undefined}(),Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||"visible"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))),vendor,Fullscreen=function(){var _hasPromise,vendor=function(){try{return Object.freeze([{isEnabled:"fullscreenEnabled",element:"fullscreenElement",requestFn:"requestFullscreen",exitFn:"exitFullscreen",changeEvent:"fullscreenchange",errorEvent:"fullscreenerror"},{isEnabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",requestFn:"webkitRequestFullscreen",exitFn:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange",errorEvent:"webkitfullscreenerror"},{isEnabled:"mozFullScreenEnabled",element:"mozFullScreenElement",requestFn:"mozRequestFullScreen",exitFn:"mozCancelFullScreen",changeEvent:"mozfullscreenchange",errorEvent:"mozfullscreenerror"},{isEnabled:"msFullscreenEnabled",element:"msFullscreenElement",requestFn:"msRequestFullscreen",exitFn:"msExitFullscreen",changeEvent:"MSFullscreenChange",errorEvent:"MSFullscreenError"}].find((function(vnd){return vnd.isEnabled in document})))}catch(ex){}return undefined}(),_returnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{var value=document.exitFullscreen();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise});function _selectElement(requestedEl){var selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&("msRequestFullscreen"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){var _this=this;if(!vendor)return Promise.reject(new Error("fullscreen not supported"));var element=_selectElement(requestedEl);if("function"!=typeof element[vendor.requestFn])return Promise.reject(new Error("fullscreen not supported"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);var namespace=".Fullscreen_requestFullscreen";return new Promise((function(resolve,reject){jQuery(element).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen request error")):resolve()})),element[vendor.requestFn](options)}))}function exitFullscreen(){var _this2=this;if(!vendor||"function"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError("fullscreen not supported"));if(!isFullscreen())return Promise.reject(new TypeError("fullscreen mode not active"));if(_returnsPromise())return document[vendor.exitFn]();var namespace=".Fullscreen_exitFullscreen";return new Promise((function(resolve,reject){jQuery(document).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this2).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen exit error")):resolve()})),document[vendor.exitFn]()}))}return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.changeEvent,handlerFn)}}},offChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.changeEvent,handlerFn):$(element).off(vendor.changeEvent)}}},onError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.errorEvent,handlerFn)}}},offError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.errorEvent,handlerFn):$(element).off(vendor.errorEvent)}}}}))}(),_ref3=Object.freeze(Object.defineProperties({},{clone:{value:function clone(orig){return"object"!==_typeof(orig)||null===orig?orig:orig instanceof String?String(orig):orig instanceof Number?Number(orig):orig instanceof Boolean?Boolean(orig):"function"==typeof orig.clone?orig.clone(!0):orig.nodeType&&"function"==typeof orig.cloneNode?orig.cloneNode(!0):(orig instanceof Array?copy=new Array(orig.length):orig instanceof Date?copy=new Date(orig.getTime()):orig instanceof Map?(copy=new Map,orig.forEach((function(val,key){return copy.set(key,clone(val))}))):orig instanceof RegExp?copy=new RegExp(orig):orig instanceof Set?(copy=new Set,orig.forEach((function(val){return copy.add(clone(val))}))):copy=Object.create(Object.getPrototypeOf(orig)),Object.keys(orig).forEach((function(name){return copy[name]=clone(orig[name])})),copy);var copy}},convertBreaks:{value:function(source){for(var node,output=document.createDocumentFragment(),para=document.createElement("p");null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement("p");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement("p")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}},safeActiveElement:{value:function(){try{return document.activeElement||null}catch(ex){return null}}},setDisplayTitle:{value:function(title){if("string"!=typeof title)throw new TypeError("story display title must be a string (received: ".concat(Util.getType(title),")"));var render=document.createDocumentFragment();new Wikifier(render,title);var text=function(source){for(var node,copy=source.cloneNode(!0),frag=document.createDocumentFragment();null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":case"DIV":case"P":frag.appendChild(document.createTextNode(" "))}frag.appendChild(node)}return frag.textContent}(render).trim();document.title=Config.passages.displayTitles&&""!==State.passage&&State.passage!==Config.passages.start?"".concat(State.passage," | ").concat(text):text;var storyTitle=document.getElementById("story-title");null!==storyTitle&&jQuery(storyTitle).empty().append(render)}},setPageElement:{value:function(idOrElement,titles,defaultText){var el="object"===_typeof(idOrElement)?idOrElement:document.getElementById(idOrElement);if(null==el)return null;var ids=Array.isArray(titles)?titles:[titles];jQuery(el).empty();for(var i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return new Wikifier(el,Story.get(ids[i]).processText().trim()),el;if(null!=defaultText){var text=String(defaultText).trim();""!==text&&new Wikifier(el,text)}return el}},throwError:{value:function(place,message,source){var $wrapper=jQuery(document.createElement("div")),$toggle=jQuery(document.createElement("button")),$source=jQuery(document.createElement("pre")),mesg="".concat(L10n.get("errorTitle"),": ").concat(message||"unknown error");return $toggle.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},(function(){$toggle.hasClass("enabled")?($toggle.removeClass("enabled"),$source.attr({"aria-hidden":!0,hidden:"hidden"})):($toggle.addClass("enabled"),$source.removeAttr("aria-hidden hidden"))})).appendTo($wrapper),jQuery(document.createElement("span")).addClass("error").text(mesg).appendTo($wrapper),jQuery(document.createElement("code")).text(source).appendTo($source),$source.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo($wrapper),$wrapper.addClass("error-view").appendTo(place),console.warn("".concat(mesg,"\n\t").concat(source.replace(/\n/g,"\n\t"))),!1}},stringFrom:{value:function stringFrom(value){switch(_typeof(value)){case"function":return"[function]";case"number":if(Number.isNaN(value))return"[number NaN]";break;case"object":if(null===value)return"[null]";if(value instanceof Array)return value.map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Set)return Array.from(value).map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Map){var result=Array.from(value).map((function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],val=_ref5[1];return"".concat(stringFrom(key)," → ").concat(stringFrom(val))}));return"{ ".concat(result.join(", ")," }")}if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error("illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed");return value.outerHTML}return value instanceof Node?value.textContent:"function"==typeof value.toString?value.toString():Object.prototype.toString.call(value);case"symbol":var desc=void 0!==value.description?' "'.concat(value.description,'"'):"";return"[symbol".concat(desc,"]");case"undefined":return"[undefined]"}return String(value)}}})),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setDisplayTitle=_ref3.setDisplayTitle,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,stringFrom=_ref3.stringFrom;!function(){function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function onClickFnWrapper(fn){return function(){var $this=jQuery(this);$this.ariaIsDisabled()||($this.is("[aria-pressed]")&&$this.attr("aria-pressed","true"===$this.attr("aria-pressed")?"false":"true"),fn.apply(this,arguments))}}function oneClickFnWrapper(fn){return onClickFnWrapper((function(){jQuery(this).off(".aria-clickable").removeAttr("role tabindex aria-controls aria-pressed").filter("button").prop("disabled",!0),fn.apply(this,arguments)}))}jQuery.fn.extend({ariaClick:function(options,handler){if(0===this.length||0===arguments.length)return this;var opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),"string"!=typeof(opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts)).namespace?opts.namespace="":"."!==opts.namespace[0]&&(opts.namespace=".".concat(opts.namespace)),"boolean"==typeof opts.pressed&&(opts.pressed=opts.pressed?"true":"false"),this.filter("button").prop("type","button"),null!=opts.role?this.attr("role",opts.role):this.not("[role]").filter("a,[data-passage]").attr("role","link").end().not("a").not("[data-passage]").attr("role","button").end().end().end(),this.attr("tabindex",0),null!=opts.controls&&this.attr("aria-controls",opts.controls),null!=opts.pressed&&this.attr("aria-pressed",opts.pressed),null!=opts.label&&this.attr({"aria-label":opts.label,title:opts.label}),this.not("button").on("keypress.aria-clickable".concat(opts.namespace),opts.selector,onKeypressFn),this.on("click.aria-clickable".concat(opts.namespace),opts.selector,opts.data,opts.one?oneClickFnWrapper(fn):onClickFnWrapper(fn)),this},ariaDisabled:function(disable){if(0===this.length||0===arguments.length)return this;var $nonDisableable=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),$disableable=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return disable?($nonDisableable.each((function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true")})),$disableable.each((function(){this.disabled=!0,this.setAttribute("aria-disabled","true")}))):($nonDisableable.each((function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute("aria-disabled")}))),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),jQuery.extend({wikiWithOptions:function(options){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(0!==sources.length){var frag=document.createDocumentFragment();sources.forEach((function(content){return new Wikifier(frag,content,options)}));var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "))}},wiki:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];this.wikiWithOptions.apply(this,[undefined].concat(sources))}}),jQuery.fn.extend({wikiWithOptions:function(options){for(var _len3=arguments.length,sources=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)sources[_key3-1]=arguments[_key3];if(0===this.length||0===sources.length)return this;var frag=document.createDocumentFragment();return sources.forEach((function(content){return new Wikifier(frag,content,options)})),this.append(frag),this},wiki:function(){for(var _len4=arguments.length,sources=new Array(_len4),_key4=0;_key4<_len4;_key4++)sources[_key4]=arguments[_key4];return this.wikiWithOptions.apply(this,[undefined].concat(sources))}});var Util=function(){var toString,utilGetType="[object Object]"===(toString=Object.prototype.toString).call(new Map)?function(O){if(null===O)return"null";if(O instanceof Map)return"Map";if(O instanceof Set)return"Set";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType}:function(O){if(null===O)return"null";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType};function utilToEnum(obj){var pEnum=Object.create(null);if(obj instanceof Array)obj.forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Set)Array.from(obj).forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Map)obj.forEach((function(val,key){return pEnum[String(key)]=val}));else{if("object"!==_typeof(obj)||null===obj||Object.getPrototypeOf(obj)!==Object.prototype)throw new TypeError("Util.toEnum obj parameter must be an Array, Map, Set, or generic object");Object.assign(pEnum,obj)}return Object.freeze(pEnum)}function utilToStringTag(obj){return Object.prototype.toString.call(obj).slice(8,-1)}var _illegalSlugCharsRe=/[\x00-\x20!-/:-@[-^`{-\x9f]+/g,_isInvalidSlugRe=/^-*$/;var _illegalFilenameCharsRE=/[\x00-\x1f"#$%&'*+,/:;<=>?\\^`|\x7f-\x9f]+/g;var _markupCharsRe=/[!"#$&'*\-/<=>?@[\\\]^_`{|}~]/g,_hasMarkupCharsRe=new RegExp(_markupCharsRe.source),_markupCharsMap=utilToEnum({"!":"&#33;",'"':"&quot;","#":"&#35;",$:"&#36;","&":"&amp;","'":"&#39;","*":"&#42;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","?":"&#63;","@":"&#64;","[":"&#91;","\\":"&#92;","]":"&#93;","^":"&#94;",_:"&#95;","`":"&#96;","{":"&#123;","|":"&#124;","}":"&#125;","~":"&#126;"});var _htmlCharsRe=/[&<>"'`]/g,_hasHtmlCharsRe=new RegExp(_htmlCharsRe.source),_htmlCharsMap=utilToEnum({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"});function utilEscape(str){if(null==str)return"";var val=String(str);return val&&_hasHtmlCharsRe.test(val)?val.replace(_htmlCharsRe,(function(ch){return _htmlCharsMap[ch]})):val}var _escapedHtmlRe=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,_hasEscapedHtmlRe=new RegExp(_escapedHtmlRe.source,"i"),_escapedHtmlMap=utilToEnum({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"});function utilUnescape(str){if(null==str)return"";var val=String(str);return val&&_hasEscapedHtmlRe.test(val)?val.replace(_escapedHtmlRe,(function(entity){return _escapedHtmlMap[entity.toLowerCase()]})):val}var _nowSource=Has.performance?performance:Date;var _cssTimeRe=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;var utilScrubEventKey=function(){var separatorKey,decimalKey;if("undefined"!=typeof Intl&&"function"==typeof Intl.NumberFormat){var match=(new Intl.NumberFormat).format(111111.5).match(/(\D*)\d+(\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=",",decimalKey="."),function(key){switch(key){case"Scroll":return"ScrollLock";case"Spacebar":return" ";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Del":return"Delete";case"Crsel":return"CrSel";case"Exsel":return"ExSel";case"Esc":return"Escape";case"Apps":return"ContextMenu";case"Nonconvert":return"NonConvert";case"MediaNextTrack":return"MediaTrackNext";case"MediaPreviousTrack":return"MediaTrackPrevious";case"VolumeUp":return"AudioVolumeUp";case"VolumeDown":return"AudioVolumeDown";case"VolumeMute":return"AudioVolumeMute";case"Zoom":return"ZoomToggle";case"SelectMedia":case"MediaSelect":return"LaunchMediaPlayer";case"Add":return"+";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Decimal":return decimalKey;case"Separator":return separatorKey}return key}}(),utilHasMediaQuery="function"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches};return Object.freeze(Object.defineProperties({},{getType:{value:utilGetType},isBoolean:{value:function(obj){return"boolean"==typeof obj||"string"==typeof obj&&("true"===obj||"false"===obj)}},isIterable:{value:function(obj){return null!=obj&&"function"==typeof obj[Symbol.iterator]}},isNumeric:{value:function(obj){var num;switch(_typeof(obj)){case"number":num=obj;break;case"string":num=Number(obj);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}},sameValueZero:{value:function(a,b){return a===b||a!=a&&b!=b}},toEnum:{value:utilToEnum},toStringTag:{value:utilToStringTag},slugify:{value:function(str){var base=String(str).trim(),_legacy=base.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return _isInvalidSlugRe.test(_legacy)?base.replace(_illegalSlugCharsRe,"").replace(/[_\s\u2013\u2014-]+/g,"-"):_legacy}},sanitizeFilename:{value:function(str){return String(str).trim().replace(_illegalFilenameCharsRE,"")}},escapeMarkup:{value:function(str){if(null==str)return"";var val=String(str);return val&&_hasMarkupCharsRe.test(val)?val.replace(_markupCharsRe,(function(ch){return _markupCharsMap[ch]})):val}},escape:{value:utilEscape},unescape:{value:utilUnescape},charAndPosAt:{value:function(text,position){var str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};var retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)return retval;var nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}},now:{value:function(){return _nowSource.now()}},fromCssTime:{value:function(cssTime){var match=_cssTimeRe.exec(String(cssTime));if(null===match)throw new SyntaxError('invalid time value syntax: "'.concat(cssTime,'"'));var msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError('invalid time value: "'.concat(cssTime,'"'));return msec}},toCssTime:{value:function(msec){if("number"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){var what;switch(_typeof(msec)){case"string":what='"'.concat(msec,'"');break;case"number":what=String(msec);break;default:what=utilToStringTag(msec)}throw new Error("invalid milliseconds: ".concat(what))}return"".concat(msec,"ms")}},fromCssProperty:{value:function(cssName){if(!cssName.includes("-"))switch(cssName){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return cssName}return("-ms-"===cssName.slice(0,4)?cssName.slice(1):cssName).split("-").map((function(part,i){return 0===i?part:part.toUpperFirst()})).join("")}},parseUrl:{value:function(url){var el=document.createElement("a"),queryObj=Object.create(null);el.href=url,el.search&&el.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((function(query){var _query$split2=_slicedToArray(query.split("="),2),key=_query$split2[0],value=_query$split2[1];queryObj[key]=value}));var pathname=el.host&&"/"!==el.pathname[0]?"/".concat(el.pathname):el.pathname;return{href:el.href,protocol:el.protocol,host:el.host,hostname:el.hostname,port:el.port,path:"".concat(pathname).concat(el.search),pathname:pathname,query:el.search,search:el.search,queries:queryObj,searches:queryObj,hash:el.hash}}},newExceptionFrom:{value:function(original,exceptionType,override){if("object"!==_typeof(original)||null===original)throw new Error("Util.newExceptionFrom original parameter must be an object");if("function"!=typeof exceptionType)throw new Error("Util.newExceptionFrom exceptionType parameter must be an error type constructor");var ex=new exceptionType(original.message);void 0!==original.name&&(ex.name=original.name),void 0!==original.code&&(ex.code=original.code),void 0!==original.columnNumber&&(ex.columnNumber=original.columnNumber),void 0!==original.description&&(ex.description=original.description),void 0!==original.fileName&&(ex.fileName=original.fileName),void 0!==original.lineNumber&&(ex.lineNumber=original.lineNumber),void 0!==original.number&&(ex.number=original.number),void 0!==original.stack&&(ex.stack=original.stack);var overrideType=_typeof(override);if("undefined"!==overrideType)if("object"===overrideType&&null!==override)Object.assign(ex,override);else{if("string"!==overrideType)throw new Error("Util.newExceptionFrom override parameter must be an object or string");ex.message=override}return ex}},scrubEventKey:{value:utilScrubEventKey},hasMediaQuery:{value:utilHasMediaQuery},random:{value:Math.random},entityEncode:{value:utilEscape},entityDecode:{value:utilUnescape},evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleStore=(_adapters=[],_initialized=null,Object.freeze(Object.defineProperties({},{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(var i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return(_initialized=_adapters[i]).create(storageId,persistent);throw new Error("no valid storage adapters found")}}}))),_adapters,_initialized,_ok,_WebStorageAdapter;SimpleStore.adapters.push((_ok=!1,_WebStorageAdapter=function(){function _WebStorageAdapter(storageId,persistent){_classCallCheck(this,_WebStorageAdapter);var prefix="".concat(storageId,"."),engine=null,name=null;persistent?(engine=window.localStorage,name="localStorage"):(engine=window.sessionStorage,name="sessionStorage"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_WebStorageAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var keys=[],i=0;i<this._engine.length;++i){var key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw Util.newExceptionFrom(ex,Error,"".concat(this.name," quota exceeded"));throw ex}return!0}},{key:"delete",value:function(key){return!("string"!=typeof key||!key||(this._engine.removeItem(this._prefix+key),0))}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_serialize",value:function(obj){return LZString.compressToUTF16(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromUTF16(str))}}]),_WebStorageAdapter}(),Object.freeze(Object.defineProperties({},{init:{value:function(){function hasWebStorage(storeId){try{var store=window[storeId],tid="_sc_".concat(String(Date.now()));store.setItem(tid,tid);var result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage("localStorage")&&hasWebStorage("sessionStorage")}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _WebStorageAdapter(storageId,persistent)}}})))),SimpleStore.adapters.push(function(){var _MAX_EXPIRY="Tue, 19 Jan 2038 03:14:07 GMT",_MIN_EXPIRY="Thu, 01 Jan 1970 00:00:00 GMT",_ok=!1,_CookieAdapter=function(){function _CookieAdapter(storageId,persistent){_classCallCheck(this,_CookieAdapter);var prefix="".concat(storageId).concat(persistent?"!":"*",".");Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:"cookie"},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_CookieAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var cookies=document.cookie.split(/;\s*/),keys=[],i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key))""!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?"Tue, 19 Jan 2038 03:14:07 GMT":undefined),!this.has(key))throw new Error("unknown validation error during set")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"delete",value:function(key){if("string"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error("unknown validation error during delete")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_getCookie",value:function(prefixedKey){if(!prefixedKey||""===document.cookie)return null;for(var cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("=");if(prefixedKey===decodeURIComponent(kvPair[0]))return decodeURIComponent(kvPair[1])||null}return null}},{key:"_setCookie",value:function(prefixedKey,value,expiry){if(prefixedKey){var payload="".concat(encodeURIComponent(prefixedKey),"=");null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+="; expires=".concat(expiry)),payload+="; path=/",document.cookie=payload}}},{key:"_serialize",value:function(obj){return LZString.compressToBase64(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromBase64(str))}}]),_CookieAdapter}();return Object.freeze(Object.defineProperties({},{init:{value:function(storageId){try{var tid="_sc_".concat(String(Date.now()));_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(""===document.cookie)return;for(var oldPrefix="".concat(storageId,"."),oldPrefixRe=new RegExp("^".concat(RegExp.escape(oldPrefix))),persistPrefix="".concat(storageId,"!."),sessionPrefix="".concat(storageId,"*."),sessionTestRe=/\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){var value=decodeURIComponent(kvPair[1]);""!==value&&function(){var persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(function(){return persist?persistPrefix:sessionPrefix})),value,persist?_MAX_EXPIRY:undefined)}()}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _CookieAdapter(storageId,persistent)}}}))}());var DebugView=function(){function DebugView(parent,type,name,title){_classCallCheck(this,DebugView),Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:title,"aria-label":title,"data-type":null!=type?type:"","data-name":null!=name?name:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(DebugView,[{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(type){this.view.setAttribute("data-type",null!=type?type:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(name){this.view.setAttribute("data-name",null!=name?name:"")}},{key:"title",get:function(){return this.view.title},set:function(title){this.view.title=title}},{key:"append",value:function(el){return jQuery(this.view).append(el),this}},{key:"modes",value:function(options){if(null==options){var current={};return this.view.className.splitOrEmpty(/\s+/).forEach((function(name){"debug"!==name&&(current[name]=!0)})),current}if("object"===_typeof(options))return Object.keys(options).forEach((function(name){this[options[name]?"addClass":"removeClass"](name)}),jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?DebugView.disable():DebugView.enable()}}]),DebugView}(),NodeTyper=function(){var NodeTyper=function(){function NodeTyper(config){if(_classCallCheck(this,NodeTyper),"object"!==_typeof(config)||null===config)throw new Error("config parameter must be an object (received: ".concat(Util.getType(config),")"));if(!(config.hasOwnProperty("targetNode")&&config.targetNode instanceof Node))throw new Error('config parameter object "targetNode" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:""},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});var childNode,node=this.node;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue="");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}return _createClass(NodeTyper,[{key:"finish",value:function(){for(;this.type(!0););return!1}},{key:"type",value:function(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||"none"===jQuery(this.node.parentNode).css("display"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue="";else{var _Util$charAndPosAt=Util.charAndPosAt(this.nodeValue,0),char=_Util$charAndPosAt.char,start=_Util$charAndPosAt.start,end=_Util$charAndPosAt.end;this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);for(var childNodes=this.childNodes;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}]),NodeTyper}();return NodeTyper}(),PRNGWrapper=function(){function PRNGWrapper(seed,useEntropy){_classCallCheck(this,PRNGWrapper),Object.defineProperties(this,new Math.seedrandom(seed,useEntropy,(function(prng,seed){return{_prng:{value:prng},seed:{writable:!0,value:seed},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}})))}return _createClass(PRNGWrapper,null,[{key:"marshal",value:function(prng){if(!prng||!prng.hasOwnProperty("seed")||!prng.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:prng.seed,pull:prng.pull}}},{key:"unmarshal",value:function(prngObj){if(!prngObj||!prngObj.hasOwnProperty("seed")||!prngObj.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var prng=new PRNGWrapper(prngObj.seed,!1),i=prngObj.pull;i>0;--i)prng.random();return prng}}]),PRNGWrapper}(),StyleWrapper=(_imageMarkupRe=new RegExp(Patterns.cssImage,"g"),_hasImageMarkupRe=new RegExp(Patterns.cssImage),function(){function StyleWrapper(style){if(_classCallCheck(this,StyleWrapper),null==style)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:style}})}return _createClass(StyleWrapper,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(rawCss){this.clear(),this.add(rawCss)}},{key:"add",value:function(rawCss){var css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text.trim())}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),StyleWrapper}()),_imageMarkupRe,_hasImageMarkupRe,Diff=(Op=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3}),Object.freeze(Object.defineProperties({},{Op:{value:Op},diff:{value:function diff(orig,dest){for(var aOpRef,objToString=Object.prototype.toString,origIsArray=orig instanceof Array,keys=[].concat(Object.keys(orig),Object.keys(dest)).sort().filter((function(val,i,arr){return 0===i||arr[i-1]!==val})),diffed={},keyIsAOpRef=function(key){return key===aOpRef},i=0,klen=keys.length;i<klen;++i){var key=keys[i],origP=orig[key],destP=dest[key];if(orig.hasOwnProperty(key))if(dest.hasOwnProperty(key)){if(origP===destP)continue;if(_typeof(origP)===_typeof(destP))if("function"==typeof origP)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,destP]);else if("object"!==_typeof(origP)||null===origP)diffed[key]=[Op.Copy,destP];else{var origPType=objToString.call(origP);if(origPType===objToString.call(destP))if(origP instanceof Date)Number(origP)!==Number(destP)&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Map)diffed[key]=[Op.Copy,clone(destP)];else if(origP instanceof RegExp)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Set)diffed[key]=[Op.Copy,clone(destP)];else if("[object Object]"!==origPType)diffed[key]=[Op.Copy,clone(destP)];else{var recurse=diff(origP,destP);null!==recurse&&(diffed[key]=recurse)}else diffed[key]=[Op.Copy,clone(destP)]}else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}else if(origIsArray&&Util.isNumeric(key)){var nKey=Number(key);if(!aOpRef){aOpRef="";do{aOpRef+="~"}while(keys.some(keyIsAOpRef));diffed[aOpRef]=[Op.SpliceArray,nKey,nKey]}nKey<diffed[aOpRef][1]&&(diffed[aOpRef][1]=nKey),nKey>diffed[aOpRef][2]&&(diffed[aOpRef][2]=nKey)}else diffed[key]=Op.Delete;else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}return Object.keys(diffed).length>0?diffed:null}},patch:{value:function patch(orig,diffed){for(var keys=Object.keys(diffed||{}),patched=clone(orig),i=0,klen=keys.length;i<klen;++i){var key=keys[i],diffedP=diffed[key];if(diffedP===Op.Delete)delete patched[key];else if(diffedP instanceof Array)switch(diffedP[0]){case Op.SpliceArray:patched.splice(diffedP[1],diffedP[2]-diffedP[1]+1);break;case Op.Copy:patched[key]=clone(diffedP[1]);break;case Op.CopyDate:patched[key]=new Date(diffedP[1])}else patched[key]=patch(patched[key],diffedP)}return patched}}}))),Op,L10n=(_patternRe=/\{\w+\}/g,_hasPatternRe=new RegExp(_patternRe.source),Object.freeze(Object.defineProperties({},{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((function(id){try{var value;switch(id){case"identity":value=strings.identity;break;case"aborting":value=strings.aborting;break;case"cancel":value=strings.cancel;break;case"close":value=strings.close;break;case"ok":value=strings.ok;break;case"errorTitle":value=strings.errors.title;break;case"errorNonexistentPassage":value=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":value=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":value=strings.errors.saveIdMismatch;break;case"warningDegraded":value=strings.warnings.degraded;break;case"debugViewTitle":value=strings.debugView.title;break;case"debugViewToggle":value=strings.debugView.toggle;break;case"uiBarToggle":value=strings.uiBar.toggle;break;case"uiBarBackward":value=strings.uiBar.backward;break;case"uiBarForward":value=strings.uiBar.forward;break;case"uiBarJumpto":value=strings.uiBar.jumpto;break;case"jumptoTitle":value=strings.jumpto.title;break;case"jumptoTurn":value=strings.jumpto.turn;break;case"jumptoUnavailable":value=strings.jumpto.unavailable;break;case"savesTitle":value=strings.saves.title;break;case"savesDisallowed":value=strings.saves.disallowed;break;case"savesIncapable":value=strings.saves.incapable;break;case"savesLabelAuto":value=strings.saves.labelAuto;break;case"savesLabelDelete":value=strings.saves.labelDelete;break;case"savesLabelExport":value=strings.saves.labelExport;break;case"savesLabelImport":value=strings.saves.labelImport;break;case"savesLabelLoad":value=strings.saves.labelLoad;break;case"savesLabelClear":value=strings.saves.labelClear;break;case"savesLabelSave":value=strings.saves.labelSave;break;case"savesLabelSlot":value=strings.saves.labelSlot;break;case"savesUnavailable":value=strings.saves.unavailable;break;case"savesUnknownDate":value=strings.saves.unknownDate;break;case"settingsTitle":value=strings.settings.title;break;case"settingsOff":value=strings.settings.off;break;case"settingsOn":value=strings.settings.on;break;case"settingsReset":value=strings.settings.reset;break;case"restartTitle":value=strings.restart.title;break;case"restartPrompt":value=strings.restart.prompt;break;case"shareTitle":value=strings.share.title;break;case"alertTitle":break;case"autoloadTitle":value=strings.autoload.title;break;case"autoloadCancel":value=strings.autoload.cancel;break;case"autoloadOk":value=strings.autoload.ok;break;case"autoloadPrompt":value=strings.autoload.prompt;break;case"macroBackText":value=strings.macros.back.text;break;case"macroReturnText":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\w+%/g,(function(pat){return"{".concat(pat.slice(1,-1),"}")})))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return"";var selectedId,id=((Array.isArray(ids)?ids:[ids]).some((function(id){return!!l10nStrings.hasOwnProperty(id)&&(selectedId=id,!0)})),selectedId);if(!id)return"";for(var processed=l10nStrings[id],iteration=0;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(function(pat){var subId=pat.slice(1,-1);return overrides&&overrides.hasOwnProperty(subId)?overrides[subId]:l10nStrings.hasOwnProperty(subId)?l10nStrings[subId]:void 0}))}return processed}}}))),_patternRe,_hasPatternRe,strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveDiskLoadFailed:"failed to load save file from disk",errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",alertTitle:"Alert",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=(_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=" ",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId="untitled-story",_savesSlots=8,_savesTryDiskOnMobile=!0,_uiStowBarInitially=800,_uiUpdateStoryElements=!0,_errHistoryModeDeprecated="Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code",Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError("Config.loadDelay must be a non-negative integer");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){var controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error("Config.history.controls must be false when Config.history.maxStates is 1");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.history.maxStates must be a positive integer");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")},set tracking(_){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.macros.maxLoopIterations must be a positive integer");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_navigationOverride=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"Object"!==valueType&&"function"!==valueType)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ".concat(valueType,")"))}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){var valueType=Util.getType(value);if("function"!==valueType)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: ".concat(valueType,")"))}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType)throw new TypeError("Config.passages.start must be a string or null/undefined (received: ".concat(valueType,")"))}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ".concat(valueType,")"))}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"string"!==valueType&&"function"!==valueType)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ".concat(valueType,")"))}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){var valueType=Util.getType(value);if("string"===valueType)return void(_savesAutosave=[value]);if("boolean"!==valueType&&("Array"!==valueType||!value.every((function(item){return"string"==typeof item})))&&"function"!==valueType)throw new TypeError("Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ".concat(valueType).concat("Array"===valueType?"<any>":"",")"))}_savesAutosave=value},get id(){return _savesId},set id(value){if("string"!=typeof value||""===value)throw new TypeError("Config.saves.id must be a non-empty string (received: ".concat(Util.getType(value),")"));_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError("Config.saves.slots must be a non-negative integer (received: ".concat(Util.getType(value),")"));_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get onLoad(){throw new Error("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead")},set onLoad(value){console.warn("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead"),Save.onLoad.add(value)},get onSave(){throw new Error("Config.saves.onSave has been deprecated, use the Save.onSave API instead")},set onSave(value){console.warn("Config.saves.onSave has been deprecated, use the Save.onSave API instead"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){var valueType=Util.getType(value);if("boolean"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ".concat(valueType,")"));_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})),_navigationOverride,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug,_addVisitedLinkClass,_cleanupWikifierOutput,_loadDelay,_audioPauseOnFadeToZero,_audioPreloadMetadata,_historyControls,_historyMaxStates,_macrosIfAssignmentError,_macrosMaxLoopIterations,_macrosTypeSkipKey,_macrosTypeVisitedPassages,_passagesDisplayTitles,_passagesNobr,_savesId,_savesSlots,_savesTryDiskOnMobile,_uiStowBarInitially,_uiUpdateStoryElements,_errHistoryModeDeprecated,SimpleAudio=function(){var _hasPromise,_gestureEventNames=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),_specialIds=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),_formatSpecRe=/^([\w-]+)\s*\|\s*(\S.*)$/,_badIdRe=/[:\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map,_masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1,_playReturnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{var audio=document.createElement("audio");audio.muted=!0;var value=audio.play();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}),AudioTrack=function(){function AudioTrack(obj){if(_classCallCheck(this,AudioTrack),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioTrack,[{key:"_create",value:function(sourceList){var dataUriRe=/^data:\s*audio\/(?:x-)?([^;,]+)\s*[;,]/i,extRe=/\.([^./\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement("audio");audio.preload="none",sourceList.forEach((function(src){var srcUri=null;switch(_typeof(src)){case"string":var match;if("data:"===src.slice(0,5)){if(null===(match=dataUriRe.exec(src)))throw new Error("source data URI missing media type")}else if(null===(match=extRe.exec(Util.parseUrl(src).pathname)))throw new Error("source URL missing file extension");formats[match[1]]&&(srcUri=src);break;case"object":if(null===src)throw new Error("source object cannot be null");if(!src.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!src.hasOwnProperty("format"))throw new Error('source object missing required "format" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error("invalid source value (type: ".concat(_typeof(src),")"))}if(null!==srcUri){var source=document.createElement("source");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload="metadata"),this._finalize(audio,usedSources,clone(sourceList))}},{key:"_copy",value:function(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}},{key:"_finalize",value:function(audio,sources,originals){var _this3=this;Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",(function(){return _this3._error=!1})).on("error.AudioTrack",(function(){return _this3._error=!0})).find("source:last-of-type").on("error.AudioTrack",(function(){return _this3._trigger("error")})),function(id,callback){if("function"!=typeof callback)throw new Error("callback parameter must be a function");_subscribers.set(id,callback)}(this,(function(mesg){if(_this3.audio)switch(mesg){case"loadwithscreen":if(_this3.hasSource()){var lockId=LoadScreen.lock();_this3.one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",(function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(lockId)})).load()}break;case"load":_this3.load();break;case"mute":_this3._updateAudioMute();break;case"rate":_this3._updateAudioRate();break;case"stop":_this3.stop();break;case"volume":_this3._updateAudioVolume();break;case"unload":_this3.unload()}else unsubscribe(_this3)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(eventName){jQuery(this.audio).triggerHandler(eventName)}},{key:"_destroy",value:function(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new AudioTrack(this)}},{key:"load",value:function(){var _this4=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((function(srcUri){var source=document.createElement("source");source.src=srcUri,_this4.audio.appendChild(source)}))}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var audio=this.audio;for(audio.preload="none";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}},{key:"play",value:function(){var _this5=this;if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));"auto"!==this.audio.preload&&(this.audio.preload="auto");var namespace=".AudioTrack_play";return _playReturnsPromise()?this.audio.play():new Promise((function(resolve,reject){_this5.isPlaying()?resolve():(jQuery(_this5.audio).off(namespace).one("error".concat(namespace," playing").concat(namespace," timeupdate").concat(namespace),(function(ev){jQuery(_this5).off(namespace),"error"===ev.type?reject(new Error("unknown audio play error")):resolve()})),_this5.audio.play())}))}},{key:"playWhenAllowed",value:function(){var _this6=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioTrack_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),_this6.audio.play()}))}))}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(duration,toVol,fromVol){var _this7=this;if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",(function(){var min,max;from<to?(min=from,max=to):(min=to,max=from);var time=Math.max(duration,1),delta=(to-from)/(time/.025);_this7._trigger(":fading"),_this7._faderId=setInterval((function(){_this7.isPlaying()?(_this7.volume(Math.clamp(_this7.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===_this7.volume()&&_this7.pause(),_this7.volume()===to&&(_this7.fadeStop(),_this7._trigger(":faded"))):_this7.fadeStop()}),25)})),this.play()):void 0}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(_loop){return null==_loop?this.audio.loop:(this.audio.loop=!!_loop,this)}},{key:"mute",value:function(_mute){return null==_mute?this._mute:(this._mute=!!_mute,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||_masterMute}},{key:"rate",value:function(_rate){if(null==_rate)return this._rate;if("number"!=typeof _rate)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}},{key:"time",value:function(_time){var _this8=this;if(null==_time)return this.audio.currentTime;if("number"!=typeof _time)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=_time:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",(function(){return _this8.audio.currentTime=_time})),this}},{key:"volume",value:function(_volume){if(null==_volume)return this._volume;if("number"!=typeof _volume)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return jQuery.fn.on.apply(jQuery(this.audio),args),this}},{key:"one",value:function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return jQuery.fn.one.apply(jQuery(this.audio),args),this}},{key:"off",value:function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return jQuery.fn.off.apply(jQuery(this.audio),args),this}}]),AudioTrack}();Object.defineProperties(AudioTrack,{formats:{value:function(){var audio=document.createElement("audio"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,""!==audio.canPlayType(mimeType).replace(/^no$/i,"")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay("audio/aac"),caf:canPlay("audio/x-caf")||canPlay("audio/caf"),flac:canPlay("audio/x-flac")||canPlay("audio/flac"),mp3:canPlay('audio/mpeg; codecs="mp3"')||canPlay("audio/mpeg")||canPlay("audio/mp3")||canPlay("audio/mpa"),mpeg:canPlay("audio/mpeg"),m4a:canPlay("audio/x-m4a")||canPlay("audio/m4a")||canPlay("audio/aac"),mp4:canPlay("audio/x-mp4")||canPlay("audio/mp4")||canPlay("audio/aac"),ogg:canPlay("audio/ogg"),oga:canPlay("audio/ogg"),opus:canPlay('audio/ogg; codecs="opus"')||canPlay("audio/opus"),wav:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),wave:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),weba:canPlay("audio/webm"),webm:canPlay("audio/webm")})}()}});var AudioList=function(){function AudioList(obj){if(_classCallCheck(this,AudioList),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioList,[{key:"_create",value:function(trackList){var _this9=this;this._finalize(trackList.map((function(trackObj){if("object"!==_typeof(trackObj))throw new Error("tracks parameter array members must be objects");var own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\'s "track" property must be an AudioTrack object');own=trackObj.hasOwnProperty("own")&&trackObj.own,rate=trackObj.hasOwnProperty("rate")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty("volume")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on("ended.AudioList",(function(){return _this9._onEnd()})),{own:own,track:track,volume:volume,rate:rate}})))}},{key:"_copy",value:function(obj){this._finalize(clone(obj.tracks))}},{key:"_finalize",value:function(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter((function(trackObj){return trackObj.own})).forEach((function(trackObj){return trackObj.track._destroy()})),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach((function(trackObj){return trackObj.track.load()}))}},{key:"unload",value:function(){this.stop(),this.tracks.forEach((function(trackObj){return trackObj.track.unload()}))}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var _this10=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioList_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioList_playWhenAllowed"),_this10.play()}))}))}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(duration,toVol,fromVol){if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var adjFromVol,adjToVol=Math.clamp(toVol,0,1)*this.current.volume;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(_loop2){return null==_loop2?this._loop:(this._loop=!!_loop2,this)}},{key:"mute",value:function(_mute2){return null==_mute2?this._mute:(this._mute=!!_mute2,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(_rate2){if(null==_rate2)return this._rate;if("number"!=typeof _rate2)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate2,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(_shuffle){var _this11=this;if(null==_shuffle)return this._shuffle;if(this._shuffle=!!_shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var _this$queue,firstIdx=this.queue.findIndex((function(trackObj){return trackObj===_this11.current}));if(-1!==firstIdx)(_this$queue=this.queue).push.apply(_this$queue,_toConsumableArray(this.queue.splice(0,firstIdx+1)))}return this}},{key:"volume",value:function(_volume2){if(null==_volume2)return this._volume;if("number"!=typeof _volume2)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume2,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var remainingTime=this.queue.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){var nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var _this$queue2;this._drainQueue(),(_this$queue2=this.queue).push.apply(_this$queue2,_toConsumableArray(this.tracks.filter((function(trackObj){return!trackObj.track.isUnavailable()})))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),AudioList}(),AudioRunner=function(){function AudioRunner(list){if(_classCallCheck(this,AudioRunner),!(list instanceof Set||list instanceof AudioRunner))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}return _createClass(AudioRunner,[{key:"load",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}},{key:"unload",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}},{key:"play",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}},{key:"playWhenAllowed",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}},{key:"pause",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}},{key:"stop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}},{key:"fade",value:function(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error("fade requires parameters");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}},{key:"fadeIn",value:function(duration,fromVol){if(null==duration)throw new Error("fadeIn requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){if(null==duration)throw new Error("fadeOut requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}},{key:"fadeStop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}},{key:"loop",value:function(_loop3){if(null==_loop3)throw new Error("loop requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,_loop3),this}},{key:"mute",value:function(_mute3){if(null==_mute3)throw new Error("mute requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,_mute3),this}},{key:"rate",value:function(_rate3){if(null==_rate3)throw new Error("rate requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,_rate3),this}},{key:"time",value:function(_time2){if(null==_time2)throw new Error("time requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,_time2),this}},{key:"volume",value:function(_volume3){if(null==_volume3)throw new Error("volume requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,_volume3),this}},{key:"on",value:function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.on].concat(args)),this}},{key:"one",value:function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.one].concat(args)),this}},{key:"off",value:function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.off].concat(args)),this}}],[{key:"_run",value:function(ids,fn){for(var _len11=arguments.length,args=new Array(_len11>2?_len11-2:0),_key11=2;_key11<_len11;_key11++)args[_key11-2]=arguments[_key11];ids.forEach((function(id){var track=_tracks.get(id);track&&fn.apply(track,args)}))}}]),AudioRunner}();var _runnerParseSelector=function(){var notWsRe=/\S/g,parenRe=/[()]/g;function processNegation(str,startPos){var match;if(notWsRe.lastIndex=startPos,null===(match=notWsRe.exec(str))||"("!==match[0])throw new Error('invalid ":not()" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;for(var start=notWsRe.lastIndex,result={str:"",nextMatch:-1},depth=1;null!==(match=parenRe.exec(str));)if("("===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){for(var match,ids=[],idRe=/:?[^\s:()]+/g;null!==(match=idRe.exec(idArg));){var id=match[0];if(":not"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded ":not()"');var parent=ids[ids.length-1];if(":"!==parent.id[0])throw new Error('invalid negation of track "'.concat(parent.id,'": only groups may be negated with ":not()"'));var negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing ":not()"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}}();function masterMute(mute){if(null==mute)return _masterMute;publish("mute",_masterMute=!!mute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((function(fn){return fn(mesg,data)}))}function _newTrack(sources){return new AudioTrack(sources.map((function(source){if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);if(passage.tags.includes("Twine.audio"))return passage.text.trim()}var match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("track ID"),arguments.length<2&&errors.push("sources"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='track ID "'.concat(id,'"');if(_badIdRe.test(id))throw new Error("invalid ".concat(what,": track IDs must not contain colons or whitespace"));var track,sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{track=_newTrack(sources)}catch(ex){throw new Error("".concat(what,": error during track initialization: ").concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("".concat(what,": no supported audio sources found"));_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((function(track){return track._destroy()})),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("group ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='group ID "'.concat(id,'"');if(":"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error("invalid ".concat(what,": group IDs must start with a colon and must not contain colons or whitespace"));if(_specialIds.includes(id))throw new Error("cannot clobber special ".concat(what));var group,trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{group=new Set(trackIds.map((function(trackId){if(!_tracks.has(trackId))throw new Error('track "'.concat(trackId,'" does not exist'));return trackId})))}catch(ex){throw new Error("".concat(what,": error during group initialization: ").concat(ex.message))}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("list ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='list ID "'.concat(id,'"');if(_badIdRe.test(id))return this.error("invalid ".concat(what,": list IDs must not contain colons or whitespace"));var list,descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{list=new AudioList(descriptors.map((function(desc){if(null===desc)throw new Error("track descriptor must be a string or object (type: null)");switch(_typeof(desc)){case"string":desc={id:desc};break;case"object":if(!desc.hasOwnProperty("id")&&!desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(desc.hasOwnProperty("id")&&desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: ".concat(_typeof(desc),")"))}var own,track,volume;if(desc.hasOwnProperty("id")){if("string"!=typeof desc.id)throw new Error('"id" property must be a string');if(!_tracks.has(desc.id))throw new Error('track "'.concat(desc.id,'" does not exist'));track=_tracks.get(desc.id)}else if(desc.hasOwnProperty("sources")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('"sources" property must be a non-empty array');if(desc.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error("error during track initialization: ".concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("no supported audio sources found")}if(desc.hasOwnProperty("own")){if("boolean"!=typeof desc.own)throw new Error('"own" property must be a boolean');(own=desc.own)&&(track=track.clone())}if(desc.hasOwnProperty("volume")){if("number"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('"volume" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error("".concat(what,": error during playlist initialization: ").concat(ex.message))}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((function(list){return list._destroy()})),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error("no track selector specified");var selector=String(arguments[0]).trim(),trackIds=new Set;try{var renderIds=function renderIds(idObj){var ids,id=idObj.id;switch(id){case":all":ids=allIds;break;case":looped":ids=allIds.filter((function(id){return _tracks.get(id).loop()}));break;case":muted":ids=allIds.filter((function(id){return _tracks.get(id).mute()}));break;case":paused":ids=allIds.filter((function(id){return _tracks.get(id).isPaused()}));break;case":playing":ids=allIds.filter((function(id){return _tracks.get(id).isPlaying()}));break;default:ids=":"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty("not")){var negated=idObj.not.map((function(idObj){return renderIds(idObj)})).flat(1/0);ids=ids.filter((function(id){return!negated.includes(id)}))}return ids},allIds=Array.from(_tracks.keys());_runnerParseSelector(selector).forEach((function(idObj){return renderIds(idObj).forEach((function(id){if(!_tracks.has(id))throw new Error('track "'.concat(id,'" does not exist'));trackIds.add(id)}))}))}catch(ex){throw new Error("error during runner initialization: ".concat(ex.message))}return new AudioRunner(trackIds)}},load:{value:function(){publish("load")}},loadWithScreen:{value:function(){publish("loadwithscreen")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;var namespace=".SimpleAudio_masterMuteOnHidden";if(_masterMuteOnHidden=!!mute){var visibilityChange="".concat(Visibility.changeEvent).concat(namespace);jQuery(document).off(namespace).on(visibilityChange,(function(){return masterMute(Visibility.isHidden())})),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if("number"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error("rate must be a finite number");publish("rate",_masterRate=Math.clamp(rate,.2,5))}},stop:{value:function(){publish("stop")}},unload:{value:function(){publish("unload")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if("number"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error("volume must be a finite number");publish("volume",_masterVolume=Math.clamp(volume,0,1))}}}))}(),State=function(){var _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function stateMarshal(noDelta){var stateObj={index:_activeIndex};return noDelta?stateObj.history=clone(_history):stateObj.delta=historyDeltaEncode(_history),_expired.length>0&&(stateObj.expired=_toConsumableArray(_expired)),null!==_prng&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDelta){if(null==stateObj)throw new Error("state object is null or undefined");if(!stateObj.hasOwnProperty(noDelta?"history":"delta")||0===stateObj[noDelta?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!stateObj.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==_prng&&!stateObj.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===_prng&&stateObj.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty("expired")?_toConsumableArray(stateObj.expired):[],stateObj.hasOwnProperty("seed")&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?"":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error("moment activation attempted with null or undefined");switch(_typeof(moment)){case"object":_active=clone(moment);break;case"number":if(historyIsEmpty())throw new Error("moment activation attempted with index on empty history");if(moment<0||moment>=historySize())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, ".concat(historySize()-1,"], got ").concat(moment));_active=clone(_history[moment]);break;default:throw new TypeError('moment activation attempted with a "'.concat(_typeof(moment),'"; must be an object or valid history stack index'))}return null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull})),session.set("state",stateMarshal()),jQuery.event.trigger(":historyupdate"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(momentActivate(_activeIndex=index),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];for(var delta=[historyArr[0]],i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];for(var historyArr=[clone(delta[0])],i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){var scriptSection;if(!historyIsEmpty())throw scriptSection="the Story JavaScript",new Error("State.prng.init must be called during initialization, within either ".concat(scriptSection," or the StoryInit special passage"));_prng=new PRNGWrapper(seed,useEntropy),_active.pull=_prng.pull}function metadataDelete(key){if("string"!=typeof key)throw new TypeError("State.metadata.delete key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");store&&store.hasOwnProperty(key)&&(1===Object.keys(store).length?storage.delete("metadata"):(delete store[key],storage.set("metadata",store)))}return Object.freeze(Object.defineProperties({},{reset:{value:function(){session.delete("state"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,!1)}},restore:{value:function(){if(session.has("state")){var stateObj=session.get("state");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}return!1}},marshalForSave:{value:function(){return stateMarshal(!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((function(moment){return moment.title})))}},hasPlayed:{value:function(title){return null!=title&&""!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((function(moment){return moment.title===title})))}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;var lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||""===title)return!1;for(var i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){for(0,historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng&&(historyTop().pull=_prng.pull);historySize()>Config.history.maxStates;)_expired.push(_history.shift().title);return momentActivate(_activeIndex=historySize()-1),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){TempVariables=_tempVariables={}}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript("".concat(varExpression," = evalTwineScript$Data$"),null,value),!0}catch(ex){}return!1}},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:function(){storage.delete("metadata")}},delete:{value:metadataDelete},entries:{value:function(){var store=storage.get("metadata");return store&&Object.entries(store)}},get:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.get key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)?store[key]:undefined}},has:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.has key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)}},keys:{value:function(){var store=storage.get("metadata");return store&&Object.keys(store)}},set:{value:function(key,value){if("string"!=typeof key)throw new TypeError("State.metadata.set key parameter must be a string (received: ".concat(_typeof(key),")"));if(void 0===value)metadataDelete(key);else{var store=storage.get("metadata")||{};store[key]=value,storage.set("metadata",store)}}},size:{get:function(){var store=storage.get("metadata");return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var fn,opts;if("function"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),"function"!=typeof fn)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){var $el=jQuery(document.createElement(type));return id&&$el.attr("id",id),classNames&&$el.addClass(classNames),title&&$el.attr("title",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){var current,intervalId,direction="in"===options.fade?1:-1,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter="alpha(opacity=".concat(Math.floor(100*opacity),")"),el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),"in"===options.fade?(current=0,proxy.style.visibility="visible"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility="in"===options.fade?"visible":"hidden",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){var increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);var intervalId,start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){var posTop=function(el){var curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if("string"!=typeof key)throw new TypeError("forget key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1,turns=State.turns,i=0,iend=needles.length;i<iend&&turns>-1;++i){var lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if("string"!=typeof key)throw new TypeError("memorize key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.set(key,value)}function passage(){return State.passage}function previous(){var passages=State.passages;if(arguments.length>0){var offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return passages.length>offset?passages[passages.length-1-offset]:""}for(var i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return""}function random(){var min,max;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error("random min parameter must be an integer");if(!Number.isInteger(max))throw new Error("random max parameter must be an integer");if(min>max){var _ref6=[max,min];min=_ref6[0],max=_ref6[1]}return Math.floor(State.random()*(max-min+1))+min}function randomFloat(){var min,max;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error("randomFloat max parameter must be a number");if(min>max){var _ref7=[max,min];min=_ref7[0],max=_ref7[1]}return State.random()*(max-min)+min}function recall(key,defaultValue){if("string"!=typeof key)throw new TypeError("recall key parameter must be a string (received: ".concat(Util.getType(key),")"));return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var passages=Array.prototype.concat.apply([],arguments),tags=[],i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages,count=State.turns,i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map,count=0,i=0,iend=played.length;i<iend;++i){var title=played[i];if(seen.has(title))seen.get(title)&&++count;else{var _tags2=Story.get(title).tags;if(_tags2.length>0){for(var found=0,j=0;j<nLength;++j)_tags2.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var _ref8=function(){function slugifyUrl(url){return Util.parseUrl(url).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function addScript(url){return new Promise((function(resolve,reject){jQuery(document.createElement("script")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script "'.concat(url,'".')))})).appendTo(document.head).attr({id:"script-imported-".concat(slugifyUrl(url)),type:"text/javascript",src:url})}))}function addStyle(url){return new Promise((function(resolve,reject){jQuery(document.createElement("link")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importStyles failed to load the stylesheet "'.concat(url,'".')))})).appendTo(document.head).attr({id:"style-imported-".concat(slugifyUrl(url)),rel:"stylesheet",href:url})}))}function sequence(callbacks){return callbacks.reduce((function(seq,fn){return seq.then(fn)}),Promise.resolve())}return{importScripts:function(){for(var _len12=arguments.length,urls=new Array(_len12),_key12=0;_key12<_len12;_key12++)urls[_key12]=arguments[_key12];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addScript(url)}}))):addScript(oneOrSeries)})))},importStyles:function(){for(var _len13=arguments.length,urls=new Array(_len13),_key13=0;_key13<_len13;_key13++)urls[_key13]=arguments[_key13];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addStyle(url)}}))):addStyle(oneOrSeries)})))}}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){var tokenTable=Util.toEnum({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),parseRe=new RegExp(["(?:\"\"|''|``)",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(`(?:\\\\.|[^`\\\\])+`)","(?:[=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),notSpaceRe=/\S/,varTest=new RegExp("^".concat(Patterns.variable)),withColonTestRe=/^\s*:/,withNotTestRe=/^\s+not\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var match,code=rawCodeString;null!==(match=parseRe.exec(code));)if(match[1]){var rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){var token=match[2];if("$"===token||"_"===token)continue;if(varTest.test(token))token=token[0];else if("is"===token){var start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token="isnot")}else{var _ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(_ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}var templateGroupStartRe=/\$\{/g,templateGroupParseRe=new RegExp(["(?:\"\"|'')",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(\\{)","(\\})"].join("|"),"g");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start of template literal");for(var startMatch,template=rawTemplateLiteral;null!==(startMatch=templateGroupStartRe.exec(template));){var startIdx=startMatch.index+2,endIdx=startIdx,depth=1,endMatch=void 0;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){var parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;var parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse}();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref9=function(){var Lexer=function(){function Lexer(source,initialState){if(_classCallCheck(this,Lexer),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(Lexer,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(num){this.pos-=num||1}},{key:"forward",value:function(num){this.pos+=num||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(valid){var ch=this.next();return-1!==ch&&(!!valid.includes(ch)||(this.backup(),!1))}},{key:"acceptRe",value:function(validRe){var ch=this.next();return-1!==ch&&(!!validRe.test(ch)||(this.backup(),!1))}},{key:"acceptRun",value:function(valid){for(;;){var ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}},{key:"acceptRunRe",value:function(validRe){for(;;){var ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}},{key:"emit",value:function(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(type,message){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(names){var obj=names.reduce((function(obj,name,i){return obj[name]=i,obj}),{});return Object.freeze(Object.assign(Object.create(null),obj))}}]),Lexer}();return{EOF:-1,Lexer:Lexer}}(),EOF=_ref9.EOF,Lexer=_ref9.Lexer,Wikifier=function(){var _optionsStack,lookaheadRe,idOrClassRe,_callDepth=0,Wikifier=function(){function Wikifier(destination,source,options){_classCallCheck(this,Wikifier),Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:"all"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}return _createClass(Wikifier,[{key:"subWikify",value:function(output,terminator,options){var newOptions,oldOptions,oldOutput=this.output;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&"object"===_typeof(options)&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));var terminatorMatch,parserMatch,parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp("(?:".concat(terminator,")"),this.options.ignoreTerminatorCase?"gim":"gm"):null;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),(terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null)&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(var matchingParser=void 0,i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}},{key:"outputText",value:function(destination,startPos,endPos){jQuery(destination).append(document.createTextNode(this.source.substring(startPos,endPos)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(text){var output=document.createDocumentFragment();new Wikifier(output,text);var errors=output.querySelector(".error");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,""));return output}},{key:"createInternalLink",value:function(destination,passage,text,callback){var $link=jQuery(document.createElement("a"));return null!=passage&&($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken"),$link.ariaClick({one:!0},(function(){"function"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}},{key:"createExternalLink",value:function(destination,url,text){var $link=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}},{key:"isExternalLink",value:function(link){return!Story.has(link)&&(new RegExp("^".concat(Patterns.url),"gim").test(link)||/[/.?#]/.test(link))}}]),Wikifier}();return Object.defineProperty(Wikifier,"Option",{value:(_optionsStack=[],Object.freeze(Object.defineProperties({},{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(_optionsStack)))}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if("object"!==_typeof(options)||null===options)throw new TypeError("Wikifier.Option.push options parameter must be an object (received: ".concat(Util.getType(options),")"));return _optionsStack.push(options)}}})))}),Object.defineProperty(Wikifier,"Parser",{value:function(){var _profiles,_parsers=[];function parsersHas(name){return!!_parsers.find((function(parser){return parser.name===name}))}return Object.freeze(Object.defineProperties({},{parsers:{get:function(){return _parsers}},add:{value:function(parser){if("object"!==_typeof(parser))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!parser.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof parser.name)throw new Error('parser object "name" property must be a string');if(!parser.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof parser.match)throw new Error('parser object "match" property must be a string');if(!parser.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof parser.handler)throw new Error('parser object "handler" property must be a function');if(parser.hasOwnProperty("profiles")&&!Array.isArray(parser.profiles))throw new Error('parser object "profiles" property must be an array');if(parsersHas(parser.name))throw new Error('cannot clobber existing parser "'.concat(parser.name,'"'));_parsers.push(parser)}},delete:{value:function(name){var parser=_parsers.find((function(parser){return parser.name===name}));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((function(parser){return parser.name===name}))||null}},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:function(){return _profiles}},compile:{value:function(){var all=_parsers,core=all.filter((function(parser){return!Array.isArray(parser.profiles)||parser.profiles.includes("core")}));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")},core:{parsers:core,parserRegExp:new RegExp(core.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")}})}},isEmpty:{value:function(){return"object"!==_typeof(_profiles)||0===Object.keys(_profiles).length}},has:{value:function(profile){return"object"===_typeof(_profiles)&&_profiles.hasOwnProperty(profile)}},get:{value:function(profile){if("object"!==_typeof(_profiles)||!_profiles.hasOwnProperty(profile))throw new Error('nonexistent parser profile "'.concat(profile,'"'));return _profiles[profile]}}}))}}))}()}),Object.defineProperties(Wikifier,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(lookaheadRe=new RegExp(Patterns.inlineCss,"gm"),idOrClassRe=new RegExp("(".concat(Patterns.cssIdOrClassSigil,")(").concat(Patterns.anyLetter,"+)"),"g"),function(w){var matched,css={classes:[],id:"",styles:{}};do{lookaheadRe.lastIndex=w.nextMatch;var match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch){if(match[1])css.styles[Util.fromCssProperty(match[1])]=match[2].trim();else if(match[3])css.styles[Util.fromCssProperty(match[3])]=match[4].trim();else if(match[5]){var subMatch=void 0;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)"."===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css})},evalText:{value:function(text){var result;try{switch(_typeof(result=Scripting.evalTwineScript(text))){case"string":""===result.trim()&&(result=text);break;case"number":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:function(passage){return null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)}},hasBlockContext:{value:function(nodes){for(var hasGCS="function"==typeof window.getComputedStyle,i=nodes.length-1;i>=0;--i){var node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.nodeName.toUpperCase();if("BR"===tagName)return!0;var styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if("none"===styles.display)continue;return"block"===styles.display}switch(tagName){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){var macroParser=null;function getMacroContextShadowView(){for(var macro=macroParser||function(){if(!macroParser&&!(macroParser=Wikifier.Parser.get("macro")))throw new Error('cannot find "macro" parser');return macroParser}(),view=new Set,context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((function(name){return view.add(name)}));return _toConsumableArray(view)}return function(code){var shadowStore={};return getMacroContextShadowView().forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){var shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}}()},parseSquareBracketedMarkup:{value:function(){var Item=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),Delim=Lexer.enumFromNames(["None","LTR","RTL"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept("["))return lexer.error(Item.Error,"malformed square-bracketed markup");if(lexer.accept("["))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept("<>"),!(lexer.accept("Ii")&&lexer.accept("Mm")&&lexer.accept("Gg")&&lexer.accept("[")))return lexer.error(Item.Error,"malformed square-bracketed markup");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){for(var what=lexer.data.isLink?"link":"image",delim=Delim.None;;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup"));break;case"|":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case"-":delim===Delim.None&&">"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case"<":delim===Delim.None&&"-"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case"]":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexImageLink(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup link component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case"]":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexSetter(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup setter component"));break;case"'":if(slurpQuote(lexer,"'")===EOF)return lexer.error(Item.Error,"unterminated single quoted string in ".concat(what," markup setter component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)return"]"!==lexer.peek()?lexer.error(Item.Error,"malformed ".concat(what," markup")):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){var lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;var markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((function(item){var text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,"<"===text[1]?markup.align="left":">"===text[1]&&(markup.align="right");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:"~"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}}()}}),Wikifier}();!function(){function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("blockquote")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,i,destStack=[w.output],curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement("blockquote")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);(matched=match&&match.index===w.nextMatch)&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?".concat(Patterns.macroName,")(?:\\s*)((?:(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/)|(?://.*\\n)|(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>"),"gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(w){var matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){var macro,nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;try{if(!(macro=Macro.get(name))){if(Macro.tags.has(name)){var tags=Macro.tags.get(name);return throwError(w.output,"child tag <<".concat(name,">> was found outside of a call to its parent macro").concat(1===tags.length?"":"s"," <<").concat(tags.join(">>, <<"),">>"),w.source.slice(matchStart,w.nextMatch))}return throwError(w.output,"macro <<".concat(name,">> does not exist"),w.source.slice(matchStart,w.nextMatch))}var payload=null;if(void 0!==macro.tags&&!(payload=this.parseBody(w,macro)))return w.nextMatch=nextMatch,throwError(w.output,"cannot find a closing tag for macro <<".concat(name,">>"),"".concat(w.source.slice(matchStart,w.nextMatch),"…"));if("function"!=typeof macro.handler)return throwError(w.output,"macro <<".concat(name,">> handler function ").concat(void 0===macro.handler?"does not exist":"is not a function"),w.source.slice(matchStart,w.nextMatch));var args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{this.context=this.context.parent}}else{var prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}catch(ex){return throwError(w.output,"cannot execute ".concat(macro&&macro.isWidget?"widget":"macro"," <<").concat(name,">>: ").concat(ex.message),w.source.slice(matchStart,w.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag:function(w){var match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody:function(w,macro){for(var openTag=this.working.name,closeTag="/".concat(openTag),closeAlt="end".concat(openTag),bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[],end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));)if(this.parseTag(w)){var tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=""!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error('malformed closing tag: "'.concat(tagSource,'"'));--opened;break;default:if(hasArgs&&(tagName.startsWith("/")||tagName.startsWith("end"))){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(var i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}else this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;return-1!==end?(w.nextMatch=end,payload):null},createArgs:function(rawArgsString,skipArgs){var args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs:function(macro,tagName){if(void 0!==macro.skipArgs){var sa=macro.skipArgs;return"boolean"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:function(){var Item=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp("^".concat(Patterns.variable));function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexSpace(lexer){var offset=lexer.source.slice(lexer.pos).search(notSpaceRe);if(offset===EOF)return null;switch(0!==offset&&(lexer.pos+=offset,lexer.ignore()),lexer.next()){case"`":return lexExpression;case'"':return lexDoubleQuote;case"'":return lexSingleQuote;case"[":return lexSquareBracket;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,"`")===EOF?lexer.error(Item.Error,"unterminated backquote expression"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'"')===EOF?lexer.error(Item.Error,"unterminated double quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,"'")===EOF?lexer.error(Item.Error,"unterminated single quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){var what;if(lexer.accept("<>IiMmGg")?(what="image",lexer.acceptRun("<>IiMmGg")):what="link",!lexer.accept("["))return lexer.error(Item.Error,"malformed ".concat(what," markup"));lexer.depth=2;loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case"[":++lexer.depth;break;case"]":if(--lexer.depth,lexer.depth<0)return lexer.error(Item.Error,"unexpected right square bracket ']'");if(1===lexer.depth){if("]"===lexer.next()){--lexer.depth;break loop}lexer.backup()}}return lexer.emit(Item.SquareBracket),lexSpace}function lexBareword(lexer){var offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){var lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((function(item){var arg=item.text;switch(item.type){case Item.Error:throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(item.message));case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(ex.message))}else if("null"===arg)arg=null;else if("undefined"===arg)arg=undefined;else if("true"===arg)arg=!0;else if("false"===arg)arg=!1;else if("NaN"===arg)arg=NaN;else{var argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(""===(arg=arg.slice(1,-1).trim()))arg=undefined;else try{arg=Scripting.evalTwineScript("(".concat(arg,")"))}catch(ex){throw new Error('unable to parse macro argument expression "'.concat(arg,'": ').concat(ex.message))}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error('unable to parse macro argument string "'.concat(arg,'": ').concat(ex.message))}break;case Item.SquareBracket:var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(markup.error));if(markup.pos<arg.length)throw new Error('unable to parse macro argument "'.concat(arg,'": unexpected character(s) "').concat(arg.slice(markup.pos),'" (pos: ').concat(markup.pos,")"));markup.isLink?((arg={isLink:!0}).count=markup.hasOwnProperty("text")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=function(source){var imgObj={source:source,isImage:!0};if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj}(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty("align")&&(arg.align=markup.align),markup.hasOwnProperty("text")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("link")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null)}args.push(arg)})),args}}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{w.nextMatch=markup.pos;var link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,"link-markup","[[link]]",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{var debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,"image-markup",markup.hasOwnProperty("link")?"[img[][link]]":"[img[]]",w.source.slice(w.matchStart,w.nextMatch))).modes({block:!0});var source,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty("link")){var link=Wikifier.helpers.evalPassageId(markup.link);(el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link)).classList.add("link-image")}if(el=jQuery(document.createElement("img")).appendTo(el).get(0),"data:"!==(source=Wikifier.helpers.evalPassageId(markup.source)).slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(el.setAttribute("data-passage",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty("text")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("align")&&(el.align=markup.align)}}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){var pre=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(w){switch(w.matchText){case"''":w.subWikify(jQuery(document.createElement("strong")).appendTo(w.output).get(0),"''");break;case"//":w.subWikify(jQuery(document.createElement("em")).appendTo(w.output).get(0),"//");break;case"__":w.subWikify(jQuery(document.createElement("u")).appendTo(w.output).get(0),"__");break;case"^^":w.subWikify(jQuery(document.createElement("sup")).appendTo(w.output).get(0),"\\^\\^");break;case"~~":w.subWikify(jQuery(document.createElement("sub")).appendTo(w.output).get(0),"~~");break;case"==":w.subWikify(jQuery(document.createElement("s")).appendTo(w.output).get(0),"==");break;case"{{{":var lookahead=/\{\{\{((?:.|\n)*?)\}\}\}/gm;lookahead.lastIndex=w.matchStart;var match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement("code")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(w){var css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;var blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?"div":"span")).appendTo(w.output);0===css.classes.length&&""===css.id&&0===Object.keys(css.styles).length?$el.addClass("marked"):(css.classes.forEach((function(className){return $el.addClass(className)})),""!==css.id&&$el.attr("id",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],"\\n?".concat(this.terminator))):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(w){jQuery(document.createElement("hr")).appendTo(w.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(w){jQuery(document.createTextNode("—")).appendTo(w.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(w){jQuery(document.createTextNode("$")).appendTo(w.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:"".concat(Patterns.variable,"(?:(?:\\.").concat(Patterns.identifier,")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\[").concat(Patterns.variable,"\\]))*"),handler:function(w){var result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"variable",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?".concat(Patterns.templateName),handler:function(w){var name=w.matchText.slice(1),template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),_typeof(template)){case"function":try{result=stringFrom(template.call({name:name}))}catch(ex){return throwError(w.output,"cannot execute function template ?".concat(name,": ").concat(ex.message),w.source.slice(w.matchStart,w.nextMatch))}break;case"string":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"template",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("h".concat(w.matchLength))).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,table=jQuery(document.createElement("table")).appendTo(w.output).get(0),prevColumns=[],curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var nextRowType=match[2];"k"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),"c"===curRowType?($rowContainer.css("caption-side",0===rowCount?"top":"bottom"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement("tr")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))},rowHandler:function(w,rowEl,prevColumns){var matched,_this12=this,cellRe=new RegExp(this.cellPattern,"gm"),col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;var cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch){if("~"===cellMatch[1]){var last=prevColumns[col];last&&(++last.rowCount,last.$element.attr("rowspan",last.rowCount).css("vertical-align","middle")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(">"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}!function(){++w.nextMatch;for(var css=Wikifier.helpers.inlineCss(w),spaceLeft=!1,spaceRight=!1,$cell=void 0;" "===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;"!"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement("th")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement("td")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr("colspan",curColCount),curColCount=1),w.subWikify($cell[0],_this12.cellTerminator)," "===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((function(className){return $cell.addClass(className)})),""!==css.id&&$cell.attr("id",css.id),spaceLeft&&spaceRight?css.styles["text-align"]="center":spaceLeft?css.styles["text-align"]="right":spaceRight&&(css.styles["text-align"]="left"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}()}++col}}while(matched)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){w.nextMatch=w.matchStart;var matched,i,destStack=[w.output],curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var newType=match[2]?"ol":"ul",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement("li")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\".concat(Patterns.spaceNoTerminator,"*\\n|\\n").concat(Patterns.spaceNoTerminator,"*\\\\|\\n?\\\\").concat(Patterns.spaceNoTerminator,"*$|^").concat(Patterns.spaceNoTerminator,"*\\\\\\n?"),handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(w){w.options.nobr||jQuery(document.createElement("br")).appendTo(w.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;var css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text)}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:"svgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/<(\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:"http://www.w3.org/2000/svg",handler:function(w){var _this13=this;this.lookahead.lastIndex=w.nextMatch;for(var match,depth=1;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+="/"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;var svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find("a[data-passage],image[data-passage]").each((function(_,el){var tagName=el.tagName.toLowerCase();try{_this13.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"svg|<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}el.hasAttribute("data-passage")&&_this13.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref10){var name=_ref10.name,value=_ref10.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if("image"===tagName)"data:"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage)).tags.includes("Twine.image")&&el.setAttribute("href",passage.text.trim());else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<".concat(Patterns.htmlTagName,"(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>"),tagRe:new RegExp("^<(".concat(Patterns.htmlTagName,")")),mediaTags:["audio","img","source","track","video"],nobrTags:["audio","colgroup","datalist","dl","figure","meter","ol","optgroup","picture","progress","ruby","select","table","tbody","tfoot","thead","tr","ul","video"],voidTags:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(w){var tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){var terminator,terminatorMatch,isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith("/>"),isNobr=this.nobrTags.includes(tagName);if(!isVoid){terminator="<\\/".concat(tagName,"\\s*>");var terminatorRe=new RegExp(terminator,"gim");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return throwError(w.output,"cannot find a closing tag for HTML <".concat(tag,">"),"".concat(w.matchText,"…"));var debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}if(el.hasAttribute("data-passage")&&(this.processDataAttributes(el,tagName),Config.debug&&((debugView=new DebugView(w.output,"html-".concat(tagName),tagName,w.matchText)).modes({block:"img"===tagName,nonvoid:terminatorMatch}),output=debugView.output)),terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(".debug.block").length>0&&debugView.modes({block:!0})}output.appendChild("track"===tagName?el.cloneNode(!0):el)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref11){var name=_ref11.name,value=_ref11.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if(this.mediaTags.includes(tagName)){if("data:"!==passage.slice(0,5)&&Story.has(passage)){var parentName,twineTag;switch(passage=Story.get(passage),tagName){case"audio":case"video":twineTag="Twine.".concat(tagName);break;case"img":twineTag="Twine.image";break;case"track":twineTag="Twine.vtt";break;case"source":var $parent=$(el).closest("audio,picture,video");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag="Twine.".concat("picture"===parentName?"image":parentName))}passage.tags.includes(twineTag)&&(el["picture"===parentName?"srcset":"src"]=passage.text.trim())}}else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}})}();var Template=(_templates=new Map,_validNameRe=new RegExp("^(?:".concat(Patterns.templateName,")$")),_validType=function(template){var templateType=_typeof(template);return"function"===templateType||"string"===templateType},Object.freeze(Object.defineProperties({},{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError("invalid template type (".concat(name,"); templates must be: functions, strings, or an array of either"));(name instanceof Array?name:[name]).forEach((function(name){if(!_validNameRe.test(name))throw new Error('invalid template name "'.concat(name,'"'));if(_templates.has(name))throw new Error("cannot clobber existing template ?".concat(name));_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((function(name){return _templates.delete(name)}))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))),_templates,_validNameRe,_validType,Macro=function(){var _macros={},_tags={},_validNameRe=new RegExp("^(?:".concat(Patterns.macroName,")$"));function macrosHas(name){return _macros.hasOwnProperty(name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error("no parent specified");for(var endTags=["/".concat(parent),"end".concat(parent)],allTags=[].concat(endTags,Array.isArray(bodyTags)?bodyTags:[]),i=0;i<allTags.length;++i){var tag=allTags[i];if(macrosHas(tag))throw new Error("cannot register tag for an existing macro");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error("no parent specified");Object.keys(_tags).forEach((function(tag){var i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return _tags.hasOwnProperty(name)}return Object.freeze(Object.defineProperties({},{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((function(name){return macrosAdd(name,def)}));else{if(!_validNameRe.test(name))throw new Error('invalid macro name "'.concat(name,'"'));if(macrosHas(name))throw new Error("cannot clobber existing macro <<".concat(name,">>"));if(tagsHas(name))throw new Error("cannot clobber child tag <<".concat(name,">> of parent macro").concat(1===_tags[name].length?"":"s"," <<").concat(_tags[name].join(">>, <<"),">>"));try{if("object"===_typeof(def))_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error("cannot create alias of nonexistent macro <<".concat(def,">>"));_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw"TypeError"===ex.name?new Error("cannot clobber protected macro <<".concat(name,">>")):new Error("unknown error when attempting to add macro <<".concat(name,">>: [").concat(ex.name,"] ").concat(ex.message))}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error('bad value for "tags" property of macro <<'.concat(name,">>"));tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((function(name){return macrosDelete(name)}));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error("unknown error removing macro <<".concat(name,">>: ").concat(ex.message))}}else if(tagsHas(name))throw new Error("cannot remove child tag <<".concat(name,">> of parent macro <<").concat(_tags[name],">>"))}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){var macro=null;return macrosHas(name)&&"function"==typeof _macros[name].handler?macro=_macros[name]:macros.hasOwnProperty(name)&&"function"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(_macros).forEach((function(name){"function"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((function(name){"function"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){var MacroContext=function(){function MacroContext(contextData){_classCallCheck(this,MacroContext);var context=Object.assign({parent:null,macro:null,name:"",displayName:"",args:null,payload:null,parser:null,source:""},contextData);if(null===context.macro||""===context.name||null===context.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(MacroContext,[{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return _toConsumableArray(this._shadows)}},{key:"shadowView",get:function(){var view=new Set;return this.contextSelectAll((function(ctx){return ctx._shadows})).forEach((function(ctx){return ctx._shadows.forEach((function(name){return view.add(name)}))})),_toConsumableArray(view)}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}},{key:"contextHas",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return!0;return!1}},{key:"contextSelect",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return context;return null}},{key:"contextSelectAll",value:function(filter){for(var result=[],context=this;null!==(context=context.parent);)filter(context)&&result.push(context);return result}},{key:"addShadow",value:function(){var _this14=this;this._shadows||(this._shadows=new Set);for(var varRe=new RegExp("^".concat(Patterns.variable,"$")),_len14=arguments.length,names=new Array(_len14),_key14=0;_key14<_len14;_key14++)names[_key14]=arguments[_key14];names.flat(1/0).forEach((function(name){if("string"!=typeof name)throw new TypeError("variable name must be a string; type: ".concat(_typeof(name)));if(!varRe.test(name))throw new Error('invalid variable name "'.concat(name,'"'));_this14._shadows.add(name)}))}},{key:"createShadowWrapper",value:function(callback,doneCallback,startCallback){var shadowStore,shadowContext=this;return"function"==typeof callback&&(shadowStore={},this.shadowView.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(){for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];if("function"==typeof startCallback&&startCallback.apply(this,args),"function"==typeof callback){var contextCache,shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get("macro");try{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}"function"==typeof doneCallback&&doneCallback.apply(this,args)}}},{key:"createDebugView",value:function(name,title){return this._debugView=new DebugView(this._output,"macro",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(message,source){return throwError(this._output,"<<".concat(this.displayName,">>: ").concat(message),source||this.source)}}]),MacroContext}();return MacroContext}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,tsVarRe:new RegExp("(".concat(Patterns.variable,")"),"g"),handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var valueCache={};try{for(var match,tsVarRe=this.self.tsVarRe;null!==(match=tsVarRe.exec(this.args.raw));){var varName=match[1],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,jsVarRe:new RegExp("State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var match,jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var store=State[match[1]],name=match[2];store.hasOwnProperty(name)&&delete store[name]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}for(var match,remember=storage.get("remember")||{},jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];remember[name]=State.variables[name]}if(!storage.set("remember",remember))return this.error("unknown error, cannot remember: ".concat(this.args.raw));Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var remember=storage.get("remember");remember&&Object.keys(remember).forEach((function(name){return State.variables[name]=remember[name]}))}}),Macro.add("forget",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var match,remember=storage.get("remember"),jsVarRe=this.self.jsVarRe,needStore=!1;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];State.variables.hasOwnProperty(name)&&delete State.variables[name],remember&&remember.hasOwnProperty(name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",remember))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add("include",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?(Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),void(this.args[1]?jQuery(document.createElement(this.args[1])).addClass("".concat(passage.domId," macro-").concat(this.name)).attr("data-passage",passage.title).appendTo(this.output):jQuery(this.output)).wiki(passage.processText())):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,"-"===this.name?Util.escape(result):result)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{var errList=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent}));if(errList.length>0)return this.error("error".concat(1===errList.length?"":"s"," within contents (").concat(errList.join("; "),")"))}}}),Macro.add("type",{isAsync:!0,tags:null,typeId:0,handler:function(){if(0===this.args.length)return this.error("no speed specified");var cursor,speed=Util.fromCssTime(this.args[0]);if(speed<0)return this.error("speed time value must be non-negative (received: ".concat(this.args[0],")"));for(var elClass="",elId="",elTag="div",skipKey=Config.macros.typeSkipKey,start=400,options=this.args.slice(1);options.length>0;){var option=options.shift();switch(option){case"class":if(0===options.length)return this.error("class option missing required class name(s)");if(""===(elClass=options.shift()))throw new Error('class option class name(s) must be non-empty (received: "")');break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=options.shift()))throw new Error('element option tag name must be non-empty (received: "")');break;case"id":if(0===options.length)return this.error("id option missing required ID");if(""===(elId=options.shift()))throw new Error('id option ID must be non-empty (received: "")');break;case"keep":cursor="keep";break;case"none":cursor="none";break;case"skipkey":if(0===options.length)return this.error("skipkey option missing required key value");if(""===(skipKey=options.shift()))throw new Error('skipkey option key value must be non-empty (received: "")');break;case"start":if(0===options.length)return this.error("start option missing required time value");var value=options.shift();if((start=Util.fromCssTime(value))<0)throw new Error("start option time value must be non-negative (received: ".concat(value,")"));break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:!0});var className="macro-".concat(this.name),namespace=".".concat(className),$target=jQuery(document.createElement(elTag)).addClass("".concat(className," ").concat(className,"-target")).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(":passageinit".concat(namespace),(function(){return $(document).off(namespace)})));var startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler:function(){var $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr("id",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);var passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((function(title){return title===passage}))||$wrapper.find(".error").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());var typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:"none"===cursor?null:"".concat(className,"-cursor")});$target.replaceWith($wrapper);var keydownAndNS="keydown".concat(namespace),typingStopAndNS="".concat(":typingstop").concat(namespace);$(document).off(keydownAndNS).on(keydownAndNS,(function(ev){Util.scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(function(){TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(":typingcomplete"):TempState.macroTypeQueue.first().handler())}));var typeNode=function(){var typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(":typingstop"),$wrapper.addClass("".concat(className,"-done")),"keep"===cursor&&$wrapper.addClass("".concat(className,"-cursor")))};$wrapper.trigger(":typingstart"),typeNodeMember();var typeNodeMemberId=setInterval((function(){return typeNodeMember(typeNodeMemberId)}),speed)};start?setTimeout(typeNode,start):typeNode()}}),startTyping&&(Engine.isPlaying()?$(document).one(":passageend".concat(namespace),(function(){return TempState.macroTypeQueue.first().handler()})):TempState.macroTypeQueue.first().handler())}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],elseifWsRe:/^\s*if\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler:function(){var i;try{var len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if("else"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'.concat(i>0?" (#"+i+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<else>> must be the final clause")}else{if(0===this.payload[i].args.full.length)return this.error("no conditional expression specified for <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""));if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error("assignment operator found within <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""," (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ").concat(this.payload[i].args.raw))}var evalJavaScript=Scripting.evalJavaScript,success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"else"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error("bad conditional expression in <<".concat(0===i?"if":"elseif",">> clause").concat(i>0?" (#"+i+")":"",": ").concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var i,result,len=this.payload.length;if(1===len)return this.error("no cases specified");for(i=1;i<len;++i)if("default"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error("<<default>> does not accept values, invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<default>> must be the final case")}else if(0===this.payload[i].args.length)return this.error("no value(s) specified for <<".concat(this.payload[i].name,">> (#").concat(i,")"));try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}var debugView=this.debugView,success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"default"===this.payload[i].name||this.payload[i].args.some((function(val){return val===result}))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add("for",{skipArgs:!0,tags:null,hasRangeRe:new RegExp("^\\S".concat(Patterns.anyChar,"*?\\s+range\\s+\\S").concat(Patterns.anyChar,"*?$")),rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")\\s*,\\s*)?State\\.(variables|temporary)\\.(").concat(Patterns.identifier,")\\s+range\\s+(\\S").concat(Patterns.anyChar,"*?)$")),threePartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,forInRe:/^\S+\s+in\s+\S+/i,forOfRe:/^\S+\s+of\s+\S+/i,handler:function(){var argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\n$/,"");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){var parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{var init,condition,post;if(-1===argsStr.indexOf(";")){if(this.self.forInRe.test(argsStr))return this.error("invalid syntax, for…in is not supported; see: for…range");if(this.self.forOfRe.test(argsStr))return this.error("invalid syntax, for…of is not supported; see: for…range");condition=argsStr}else{var _parts=argsStr.match(this.self.threePartRe);if(null===_parts)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");init=_parts[1],condition=_parts[2].trim(),post=_parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor:function(payload,init,condition,post){var evalJavaScript=Scripting.evalJavaScript,first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error("bad init expression: ".concat("object"===_typeof(ex)?ex.message:ex))}for(;evalJavaScript(condition);){if(--safety<0)return this.error("exceeded configured maximum loop iterations (".concat(Config.macros.maxLoopIterations,")"));if(new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error("bad post expression: ".concat("object"===_typeof(ex)?ex.message:ex))}}}catch(ex){return this.error("bad conditional expression: ".concat("object"===_typeof(ex)?ex.message:ex))}finally{TempState.break=null}},handleForRange:function(payload,indexVar,valueVar,rangeExp){var rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error("object"===_typeof(ex)?ex.message:ex)}finally{TempState.break=null}},toRangeList:function(rangeExp){var value,list,evalJavaScript=Scripting.evalJavaScript;try{value=evalJavaScript("{"===rangeExp[0]?"(".concat(rangeExp,")"):rangeExp)}catch(ex){if("object"!==_typeof(ex))throw new Error("bad range expression: ".concat(ex));throw ex.message="bad range expression: ".concat(ex.message),ex}switch(_typeof(value)){case"string":list=[];for(var i=0;i<value.length;){var obj=Util.charAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case"object":if(Array.isArray(value))list=value.map((function(val,i){return[i,val]}));else if(value instanceof Set)list=_toConsumableArray(value).map((function(val,i){return[i,val]}));else if(value instanceof Map)list=_toConsumableArray(value.entries());else{if("Object"!==Util.toStringTag(value))throw new Error("unsupported range expression type: ".concat(Util.toStringTag(value)));list=Object.keys(value).map((function(key){return[key,value[key]]}))}break;default:throw new Error("unsupported range expression type: ".concat(_typeof(value)))}return list}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas((function(ctx){return"for"===ctx.name})))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var _this15=this;if(0===this.args.length)return this.error("no ".concat("button"===this.name?"button":"link"," text specified"));var passage,$link=jQuery(document.createElement("button"===this.name?"button":"a"));if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var $image=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo($link);$link.addClass("link-image"),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:"core"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken")):$link.addClass("link-internal"),$link.addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:null!=passage?"link":"button",one:null!=passage},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(_this15.payload[0].contents.trim())}:null,null!=passage?function(){return Engine.play(passage)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("unchecked value"),this.args.length<3&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement("input");switch(jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:"checkbox",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case"autocheck":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case"checked":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var _this16=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),len=this.payload.length;if(1===len)return this.error("no options specified");for(var config={autoselect:!1,once:!1},i=1;i<this.args.length;++i){var arg=this.args[i];switch(arg){case"once":config.once=!0;break;case"autoselect":config.autoselect=!0;break;default:return this.error("unknown argument: ".concat(arg))}}for(var options=[],tagCount={option:0,optionsfrom:0},selectedIdx=-1,_i5=1;_i5<len;++_i5){var payload=this.payload[_i5];if("option"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error("no arguments specified for <<".concat(payload.name,">> (#").concat(tagCount.option,")"));var option={label:String(payload.args[0])},isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:"selected"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],"selected"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==selectedIdx)return this.error("multiple selected keywords specified for <<".concat(payload.name,">> (#").concat(selectedIdx+1," & #").concat(tagCount.option,")"));selectedIdx=options.length-1}}else{var _ret=function(){if(++tagCount.optionsfrom,0===payload.args.full.length)return{v:_this16.error("no expression specified for <<".concat(payload.name,">> (#").concat(tagCount.optionsfrom,")"))};var result=void 0;try{var exp=payload.args.full;result=Scripting.evalJavaScript("{"===exp[0]?"(".concat(exp,")"):exp)}catch(ex){return{v:_this16.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}if("object"!==_typeof(result)||null===result)return{v:_this16.error("expression must yield a supported collection or generic object (type: ".concat(null===result?"null":_typeof(result),")"))};if(result instanceof Array||result instanceof Set)result.forEach((function(val){return options.push({label:String(val),value:val})}));else if(result instanceof Map)result.forEach((function(val,key){return options.push({label:String(key),value:val})}));else{var oType=Util.toStringTag(result);if("Object"!==oType)return{v:_this16.error("expression must yield a supported collection or generic object (object type: ".concat(oType,")"))};Object.keys(result).forEach((function(key){return options.push({label:key,value:result[key]})}))}}();if("object"===_typeof(_ret))return _ret.v}}if(-1===selectedIdx)if(config.autoselect){var sameValueZero=Util.sameValueZero,curValue=State.getVar(varName),curValueIdx=options.findIndex((function(opt){return sameValueZero(opt.value,curValue)}));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if("cycle"===this.name){var lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:"core"},options[selectedIdx].label);else{var cycleIdx=selectedIdx;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},options[selectedIdx].label).attr("id","".concat(this.name,"-").concat(varId)).addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:"button"},this.createShadowWrapper((function(){var $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:"core"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{var $select=jQuery(document.createElement("select"));options.forEach((function(opt,i){jQuery(document.createElement("option")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),tabindex:0}).addClass("macro-".concat(this.name)).val(selectedIdx).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this17=this;if(0===this.args.length)return this.error("no link text specified");var $link=jQuery(document.createElement("a")),$insert=jQuery(document.createElement("span")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-".concat(this.name)).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper((function(){if("linkreplace"===_this17.name?$link.remove():$link.wrap('<span class="macro-'.concat(_this17.name,'"></span>')).replaceWith((function(){return $link.html()})),""!==_this17.payload[0].contents){var frag=document.createDocumentFragment();new Wikifier(frag,_this17.payload[0].contents),$insert.append(frag)}transition&&setTimeout((function(){return $insert.removeClass("macro-".concat(_this17.name,"-in"))}),Engine.minDomActionDelay)}))).appendTo(this.output),$insert.addClass("macro-".concat(this.name,"-insert")),transition&&$insert.addClass("macro-".concat(this.name,"-in")),"linkprepend"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add(["numberbox","textbox"],{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var asNumber="numberbox"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error('default value "'.concat(this.args[1],'" is neither a number nor can it be parsed into a number'));var passage,varId=Util.slugify(varName),el=document.createElement("input"),autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?autofocus=!0:passage=this.args[2]),"object"===_typeof(passage)&&(passage=passage.link),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:asNumber?"number":"text",inputmode:asNumber?"decimal":"text",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on("keypress.macros",this.createShadowWrapper((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step="any"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),checkValue=this.args[1],el=document.createElement("input");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId,"-").concat(TempState[this.name][varId]++),name:"".concat(this.name,"-").concat(varId),type:"radio",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case"autocheck":State.getVar(varName)===checkValue&&(el.checked=!0);break;case"checked":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var varId=Util.slugify(varName),defaultValue=this.args[1],autofocus="autofocus"===this.args[2],el=document.createElement("textarea");jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),rows:4,tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var $list=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),i=0;i<this.args.length;++i){var passage=void 0,text=void 0,$image=void 0,setFn=void 0;if("object"===_typeof(this.args[i])?this.args[i].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[i].source),this.args[i].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[i].passage),this.args[i].hasOwnProperty("title")&&$image.attr("title",this.args[i].title),this.args[i].hasOwnProperty("align")&&$image.attr("align",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],!(State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(passage)&&State.variables["#actions"][passage])){var $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo($list),passage,null,function(passage,fn){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][passage]=!0,"function"==typeof fn&&fn()}}(passage,setFn))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text));$image&&$link.addClass("link-image")}}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(var i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&"return"===this.name)for(var _i6=State.expired.length-1;_i6>=0;--_i6)if(State.expired[_i6]!==State.passage){passage=State.expired[_i6];break}}else{if(!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));if("back"===this.name){for(var _i7=State.length-2;_i7>=0;--_i7)if(State.history[_i7].title===passage){momentIndex=_i7;break}if(-1===momentIndex)return this.error('cannot find passage "'.concat(passage,'" in the current story history'))}}if(null==passage)return this.error("cannot find passage");"back"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(passage)}:function(){return Engine.goTo(momentIndex)}),$image&&$link.addClass("link-image")):$link=jQuery(document.createElement("span")).addClass("link-disabled"),$link.addClass("macro-".concat(this.name)).append($image||document.createTextNode(text||L10n.get("macro".concat(this.name.toUpperFirst(),"Text")))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var passage,text,$image,setFn,$link,choiceId=State.passage;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(choiceId)&&State.variables["#choice"][choiceId])return $link=jQuery(document.createElement("span")).addClass("link-disabled macro-".concat(this.name)).attr("tabindex",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass("link-image"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][choiceId]=!0,"function"==typeof setFn&&setFn()}))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text)),$image&&$link.addClass("link-image")}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("selector"),this.args.length<2&&errors.push("class names"),this.error("no ".concat(errors.join(" or ")," specified"))}var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));switch(this.name){case"addclass":$targets.addClass(this.args[1].trim());break;case"toggleclass":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this18=this;if(0===this.args.length)return this.error("no selector specified");var $insert,$targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));if(""!==this.payload[0].contents)switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?(($insert=jQuery(document.createElement("span"))).addClass("macro-".concat(this.name,"-insert macro-").concat(this.name,"-in")),setTimeout((function(){return $insert.removeClass("macro-".concat(_this18.name,"-in"))}),Engine.minDomActionDelay)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case"replace":$targets.empty();case"append":$targets.append($insert);break;case"prepend":$targets.prepend($insert)}else"replace"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){var errorOnePlaybackAction=function(cur,prev){return'only one playback action allowed per invocation, "'.concat(cur,'" cannot be combined with "').concat(prev,'"')};Macro.add("audio",{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track and/or group IDs"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}for(var action,fadeTo,loop,mute,passage,time,volume,args=this.args.slice(1),fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors=[];return args.length<1&&_errors.push("seconds"),args.length<2&&_errors.push("level"),this.error("fadeoverto missing required ".concat(_errors.join(" and ")," value").concat(_errors.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"time":if(0===args.length)return this.error("time missing required seconds value");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error("cannot parse time: ".concat(raw));break;case"loop":case"unloop":loop="loop"===arg;break;case"goto":if(0===args.length)return this.error("goto missing required passage title");if(raw=args.shift(),passage="object"===_typeof(raw)?raw.link:raw,!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));break;default:return this.error("unknown action: ".concat(arg))}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){var nsEnded="ended.macros.macro-".concat(this.name,"_goto");selected.off(nsEnded).one(nsEnded,(function(){selected.off(nsEnded),Engine.play(passage)}))}switch(action){case"fade":selected.fade(fadeOver,fadeTo);break;case"load":selected.load();break;case"pause":selected.pause();break;case"play":selected.playWhenAllowed();break;case"stop":selected.stop();break;case"unload":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("cacheaudio",{handler:function(){var _this19=this;if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track ID"),this.args.length<2&&errors.push("sources"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim(),oldFmtRe=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((function(source){if(oldFmtRe.test(source)){if(Config.debug)return _this19.error('track ID "'.concat(id,'": format specifier migration required, "format:formatId;" → "formatId|"'));source=source.replace(oldFmtRe,"$1|")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error('track ID "'.concat(id,'": no supported audio sources found'));Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var groupId=String(this.args[0]).trim(),trackIds=[],i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error("no track ID specified");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var playlist=Macro.get("playlist");if(null!==playlist.from&&"createplaylist"!==playlist.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var listId=String(this.args[0]).trim(),trackObjs=[],i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error("no track ID specified");for(var trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);args.length>0;){var arg=args.shift(),raw=void 0,parsed=void 0;switch(arg){case"copy":case"own":trackObj.own=!0;break;case"rate":args.length>0&&args.shift();break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error("cannot parse volume: ".concat(raw));trackObj.volume=parsed;break;default:return this.error("unknown action: ".concat(arg))}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="createplaylist"),Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var action,mute,muteOnHide,volume,args=this.args.slice(0);args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"mute":case"unmute":mute="mute"===arg;break;case"muteonhide":case"nomuteonhide":muteOnHide="muteonhide"===arg;break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("playlist",{from:null,handler:function(){var list,args,action,from=this.self.from;if(null===from)return this.error("no playlists have been created");if("createplaylist"===from){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("list ID"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");list=SimpleAudio.lists.get("setplaylist"),args=this.args.slice(0)}for(var fadeTo,loop,mute,shuffle,volume,fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors2=[];return args.length<1&&_errors2.push("seconds"),args.length<2&&_errors2.push("level"),this.error("fadeoverto missing required ".concat(_errors2.join(" and ")," value").concat(_errors2.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"loop":case"unloop":loop="loop"===arg;break;case"shuffle":case"unshuffle":shuffle="shuffle"===arg;break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case"fade":list.fade(fadeOver,fadeTo);break;case"load":list.load();break;case"pause":list.pause();break;case"play":list.playWhenAllowed();break;case"skip":list.skip();break;case"stop":list.stop();break;case"unload":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error('group "'.concat(id,'" does not exist'));SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}}),Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var playlist=Macro.get("playlist");if(null!==playlist.from&&"setplaylist"!==playlist.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var contents=this.payload[0].contents.trim();""!==contents&&setTimeout(this.createShadowWrapper((function(){return $.wiki(contents)})),Engine.minDomActionDelay)}}),Macro.add("goto",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?void setTimeout((function(){return Engine.play(passage)}),Engine.minDomActionDelay):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){var delay,_this20=this;if(0===this.args.length)return this.error("no time value specified");try{delay=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper((function(){var frag=document.createDocumentFragment();new Wikifier(frag,_this20.payload[0].contents);var $output=$wrapper;transition&&($output=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-repeat-in")}),Engine.minDomActionDelay)})),delay)},registerInterval:function(callback,delay){var _this21=this;if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null;timerId=setInterval((function(){if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);var timerIdCache;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(_this21)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearInterval(timerId)})),timers.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var timers=Macro.get("repeat").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var i,items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error("".concat(ex.message," in <<timed>>"))}if(this.payload.length>1)try{var len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error("".concat(ex.message," in <<next>> (#").concat(i,")"))}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper((function(item){var frag=document.createDocumentFragment();new Wikifier(frag,item.content);var $output=$wrapper;Config.debug&&"next"===item.name&&($output=jQuery(new DebugView($output[0],"macro",item.name,item.source).output)),transition&&($output=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-timed-in")}),Engine.minDomActionDelay)})),items)},registerTimeout:function(callback,items){if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null,nextItem=items.shift();timerId=setTimeout((function worker(){if(timers.delete(timerId),State.passage===passage&&State.turns===turn){var curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)}}),nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearTimeout(timerId)})),timers.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var widgetCode,widgetName=this.args[0],isNonVoid=this.args.length>1&&"container"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error('cannot clobber existing macro "'.concat(widgetName,'"'));Macro.delete(widgetName)}try{var widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){var shadowStore={};State.temporary.hasOwnProperty("args")&&(shadowStore._args=State.temporary.args),State.temporary.args=_toConsumableArray(this.args),State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow("_args"),isNonVoid&&(State.temporary.hasOwnProperty("contents")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow("_contents")),State.variables.hasOwnProperty("args")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow("$args");try{var resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(".error")).forEach((function(errEl){errList.push(errEl.textContent)})),0!==errList.length)return this.error("error".concat(errList.length>1?"s":""," within widget code (").concat(errList.join("; "),")"));this.output.appendChild(resFrag)}catch(ex){return this.error("cannot execute widget: ".concat(ex.message))}finally{shadowStore.hasOwnProperty("_args")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty("_contents")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty("$args")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error('cannot create widget macro "'.concat(widgetName,'": ').concat(ex.message))}}})}();var Dialog=function(){var _$overlay=null,_$dialog=null,_$dialogTitle=null,_$dialogBody=null,_lastActive=null,_scrollbarWidth=0,_dialogObserver=null;function dialogClose(ev){return _$dialogBody.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),_dialogObserver?(_dialogObserver.disconnect(),_dialogObserver=null):_$dialogBody.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),_$dialog.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),_$overlay.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),_$dialogTitle.empty(),_$dialogBody.empty().removeClass(),null!==_lastActive&&(jQuery(_lastActive).focus(),_lastActive=null),ev&&ev.data&&"function"==typeof ev.data.closeFn&&ev.data.closeFn(ev),_$dialogBody.trigger(":dialogclose"),_$dialogBody.trigger(":dialogclosed"),Dialog}function dialogIsOpen(classNames){return _$dialog.hasClass("open")&&(!classNames||classNames.splitOrEmpty(/\s+/).every((function(cn){return _$dialogBody.hasClass(cn)})))}function dialogOpen(options,closeFn){_$dialogBody.trigger(":dialogopening");var top=jQuery.extend({top:50},options).top;return dialogIsOpen()||(_lastActive=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),_$overlay.addClass("open"),null!==_$dialogBody[0].querySelector("img")&&_$dialogBody.imagesLoaded().always((function(){return _resizeHandler({data:{top:top}})})),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),_$dialog.css(_calcPosition(top)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),Has.mutationObserver?(_dialogObserver=new MutationObserver((function(mutations){for(var i=0;i<mutations.length;++i)if("childList"===mutations[i].type){_resizeHandler({data:{top:top}});break}}))).observe(_$dialogBody[0],{childList:!0,subtree:!0}):_$dialogBody.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),jQuery(document).one("click.dialog-close",".ui-close",{closeFn:closeFn},(function(ev){dialogClose(ev)})).one("keypress.dialog-close",".ui-close",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger("click")})),_$dialogBody.trigger(":dialogopen"),_$dialogBody.trigger(":dialogopened"),Dialog}function _calcPosition(topPos){var top=null!=topPos?topPos:50,$parent=jQuery(window),dialogPos={left:"",right:"",top:"",bottom:""};_$dialog.css(dialogPos);var horzSpace=$parent.width()-_$dialog.outerWidth(!0)-1,vertSpace=$parent.height()-_$dialog.outerHeight(!0)-1;return horzSpace<=32+_scrollbarWidth&&(vertSpace-=_scrollbarWidth),vertSpace<=32+_scrollbarWidth&&(horzSpace-=_scrollbarWidth),dialogPos.left=dialogPos.right=horzSpace<=32?16:horzSpace/2>>0,dialogPos.top=vertSpace<=32?dialogPos.bottom=16:vertSpace/2>top?top:dialogPos.bottom=vertSpace/2>>0,Object.keys(dialogPos).forEach((function(key){""!==dialogPos[key]&&(dialogPos[key]+="px")})),dialogPos}function _resizeHandler(ev){var top=ev&&ev.data&&void 0!==ev.data.top?ev.data.top:50;"block"===_$dialog.css("display")&&(_$dialog.css({display:"none"}),_$dialog.css(jQuery.extend({display:""},_calcPosition(top))))}return Object.freeze(Object.defineProperties({},{append:{value:function(){var _$dialogBody2;return(_$dialogBody2=_$dialogBody).append.apply(_$dialogBody2,arguments),Dialog}},body:{value:function(){return _$dialogBody.get(0)}},close:{value:dialogClose},init:{value:function(){if(!document.getElementById("ui-dialog")){_scrollbarWidth=function(){var scrollbarWidth;try{var inner=document.createElement("p"),outer=document.createElement("div");inner.style.width="100%",inner.style.height="200px",outer.style.position="absolute",outer.style.left="0px",outer.style.top="0px",outer.style.width="100px",outer.style.height="100px",outer.style.visibility="hidden",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="auto";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),scrollbarWidth=w1-w2}catch(ex){}return scrollbarWidth||17}();var $elems=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1>'+'<button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'.concat(L10n.get("close"),'"></button>')+'</div><div id="ui-dialog-body"></div></div>');_$overlay=jQuery($elems.find("#ui-overlay").get(0)),_$dialog=jQuery($elems.find("#ui-dialog").get(0)),_$dialogTitle=jQuery($elems.find("#ui-dialog-title").get(0)),_$dialogBody=jQuery($elems.find("#ui-dialog-body").get(0)),$elems.insertBefore("body>script#script-sugarcube")}}},isOpen:{value:dialogIsOpen},open:{value:dialogOpen},resize:{value:function(data){return _resizeHandler("object"===_typeof(data)?{data:data}:undefined)}},setup:{value:function(title,classNames){return _$dialogBody.empty().removeClass(),null!=classNames&&_$dialogBody.addClass(classNames),_$dialogTitle.empty().append((null!=title?String(title):"")||" "),_$dialogBody.get(0)}},wiki:{value:function(){var _$dialogBody3;return(_$dialogBody3=_$dialogBody).wiki.apply(_$dialogBody3,arguments),Dialog}},addClickHandler:{value:function(targets,options,startFn,doneFn,closeFn){return jQuery(targets).ariaClick((function(ev){ev.preventDefault(),"function"==typeof startFn&&startFn(ev),dialogOpen(options,closeFn),"function"==typeof doneFn&&doneFn(ev)}))}}}))}(),Engine=function(){var States=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),_initDebugViews=[],_state=States.Idle,_lastPlay=null,_outlinePatch=null,_updating=null;function engineGo(offset){var succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){var passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),"function"==typeof Config.navigation.override)try{var overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}var passage=Story.get(passageTitle);if(jQuery.event.trigger({type:":passageinit",passage:passage}),Object.keys(prehistory).forEach((function(task){"function"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=""),_lastPlay=Util.now(),Object.keys(predisplay).forEach((function(task){"function"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has("PassageReady"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(ex){console.error(ex),Alert.error("PassageReady",ex.message)}_state=States.Rendering;var dataTags=passage.tags.length>0?passage.tags.join(" "):null,passageEl=document.createElement("div");jQuery(passageEl).attr({id:passage.domId,"data-passage":passage.title,"data-tags":dataTags}).addClass("passage ".concat(passage.className)),jQuery(document.body).attr("data-tags",dataTags).addClass(passage.className),jQuery(document.documentElement).attr("data-tags",dataTags),jQuery.event.trigger({type:":passagestart",content:passageEl,passage:passage}),Object.keys(prerender).forEach((function(task){"function"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has("PassageHeader")&&new Wikifier(passageEl,Story.get("PassageHeader").processText()),passageEl.appendChild(passage.render()),Story.has("PassageFooter")&&new Wikifier(passageEl,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:passageEl,passage:passage}),Object.keys(postrender).forEach((function(task){"function"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));var debugView,containerEl=document.getElementById("passages");if(containerEl.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?_toConsumableArray(containerEl.childNodes).forEach((function(outgoing){var $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass("passage")){if($outgoing.hasClass("passage-out"))return;$outgoing.attr({id:"out-".concat($outgoing.attr("id")),"aria-live":"off"}).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(function(ev){ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((function(){return $outgoing.remove()}),Math.max(40,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass("passage-in").appendTo(containerEl),setTimeout((function(){return jQuery(passageEl).removeClass("passage-in")}),40),Story.has("StoryDisplayTitle")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get("StoryDisplayTitle").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title="".concat(passage.title," | ").concat(Story.title)),window.scroll(0,0),_state=States.Playing,Story.has("PassageDone"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(ex){console.error(ex),Alert.error("PassageDone",ex.message)}(jQuery.event.trigger({type:":passagedisplay",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((function(task){"function"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((function(pair){jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug)&&(null!=passageReadyOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady")).modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone")).modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews));switch(jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":passage.tags.some((function(tag){return Config.saves.autosave.includes(tag)}))&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=Util.now(),passageEl}function _hideOutlines(){_outlinePatch.set("*:focus{outline:none;}")}return Object.freeze(Object.defineProperties({},{States:{value:States},minDomActionDelay:{value:40},init:{value:function(){var _lastOutlineEvent;jQuery("#init-no-js,#init-lacking").remove(),function(){var $elems=jQuery(document.createDocumentFragment()),markup=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),$elems.append(markup);var $passages=$elems.find("#passages");if(0===$passages.length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');$passages.empty().not("[aria-live]").attr("aria-live","polite").end(),$elems.find("[data-init-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-init-passage" content attribute'));var passage=el.getAttribute("data-init-passage").trim();if(el.hasAttribute("data-passage"))throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> must not contain a "data-passage" content attribute'));if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));var updating=[];$elems.find("[data-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-passage" content attribute'));var passage=el.getAttribute("data-passage").trim();if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id="story" role="main"><div id="passages" aria-live="polite"></div></div>');$elems.insertBefore("body>script#script-sugarcube")}(),_outlinePatch=new StyleWrapper(jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)),_hideOutlines(),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",(function(ev){ev.type!==_lastOutlineEvent&&(_lastOutlineEvent=ev.type,"keydown"===ev.type?_outlinePatch.clear():_hideOutlines())}))}},start:{value:function(){if(Story.getAllInit().forEach((function(passage){try{var debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","".concat(passage.title," [init-tagged]"),"".concat(passage.title," [init-tagged]"));debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("".concat(passage.title," [init-tagged]"),"object"===_typeof(ex)?ex.message:ex)}})),Story.has("StoryInit"))try{var debugBuffer=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("StoryInit","object"===_typeof(ex)?ex.message:ex)}if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'.concat(Config.passages.start,'") not found'));if(jQuery(document.documentElement).focus(),State.restore())engineShow();else{var loadStart=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){var succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){var noHistory=!1;switch(option){case undefined:break;case"replace":case"back":noHistory=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'.concat(option,'"; please notify the developer'))}enginePlay(title,noHistory)}}}))}(),Passage=(_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\..*)$/i,function(){function Passage(title,el){var _this22=this;_classCallCheck(this,Passage),Object.defineProperties(this,{title:{value:Util.unescape(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute("tags")?Array.from(new Set(el.getAttribute("tags").trim().splitOrEmpty(/\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-".concat(Util.slugify(this.title))},classes:{value:Object.freeze(0===this.tags.length?[]:_this22.tags.filter((function(tag){return!_tagsToSkip.test(tag)})).map((function(tag){return Util.slugify(tag)})))}})}return _createClass(Passage,[{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var passage=Util.escapeMarkup(this.title),mesg="".concat(L10n.get("errorTitle"),": ").concat(L10n.get("errorNonexistentPassage",{passage:passage}));return'<div class="error-view"><span class="error">'.concat(mesg,"</span></div>")}return this.element.textContent.replace(/\r/g,"")}},{key:"description",value:function(){var descriptions=Config.passages.descriptions;switch(_typeof(descriptions)){case"boolean":if(descriptions)return this.title;break;case"object":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case"function":var result=descriptions.call(this);if(result)return result}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img[".concat(this.text,"]]");var processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes("nobr"))&&(processed=processed.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),processed}},{key:"render",value:function(options){var frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),this._excerpt=Passage.getExcerptFromNode(frag),frag}}],[{key:"getExcerptFromNode",value:function(node,count){if(!node.hasChildNodes())return"";var excerpt=node.textContent.trim();if(""!==excerpt){var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})"));excerpt=excerpt.replace(/\s+/g," ").match(excerptRe)}return excerpt?"".concat(excerpt[1],"…"):"…"}},{key:"getExcerptFromText",value:function(text,count){if(""===text)return"";var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})")),excerpt=text.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(excerptRe);return excerpt?"".concat(excerpt[1],"…"):"…"}}]),Passage}()),_tagsToSkip,Save=function(){var Type=Util.toEnum({Autosave:"autosave",Disk:"disk",Serialize:"serialize",Slot:"slot"}),_slotsUBound=-1,_onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){var saves=storage.get("saves");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete("saves"),!0}function autosaveOk(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return"cookie"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;for(var saves=savesObjGet(),count=0,i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(var i=0;i<num;++i)array.push(null);return array}function _savesObjIsEmpty(saves){for(var slots=saves.slots,isSlotsEmpty=!0,i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}function _savesObjSave(saves){return _savesObjIsEmpty(saves)?(storage.delete("saves"),!0):storage.set("saves",saves)}function _savesObjUpdate(saveObj){if(null==saveObj||"object"!==_typeof(saveObj))return!1;var updated=!1;return saveObj.hasOwnProperty("state")&&saveObj.state.hasOwnProperty("delta")&&saveObj.state.hasOwnProperty("index")||(saveObj.hasOwnProperty("data")?(delete saveObj.mode,saveObj.state={delta:State.deltaEncode(saveObj.data)},delete saveObj.data):saveObj.state.hasOwnProperty("delta")?saveObj.state.hasOwnProperty("index")||delete saveObj.state.mode:(delete saveObj.state.mode,saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history),saveObj.state.index=saveObj.state.delta.length-1,updated=!0),saveObj.state.hasOwnProperty("rseed")&&(saveObj.state.seed=saveObj.state.rseed,delete saveObj.state.rseed,saveObj.state.delta.forEach((function(_,i,delta){delta[i].hasOwnProperty("rcount")&&(delta[i].pull=delta[i].rcount,delete delta[i].rcount)})),updated=!0),(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired||saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired&&delete saveObj.state.expired,(saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.expired=[],saveObj.state.hasOwnProperty("unique")&&(saveObj.state.expired.push(saveObj.state.unique),delete saveObj.state.unique),saveObj.state.hasOwnProperty("last")&&(saveObj.state.expired.push(saveObj.state.last),delete saveObj.state.last)),updated=!0),updated}function _marshal(supplemental,details){if(null!=supplemental&&"object"!==_typeof(supplemental))throw new Error("supplemental parameter must be an object");var saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((function(fn){return fn(saveObj,details)})),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(_savesObjUpdate(saveObj),!saveObj||!saveObj.hasOwnProperty("id")||!saveObj.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(saveObj.state.history=State.deltaDecode(saveObj.state.delta),delete saveObj.state.delta,_onLoadHandlers.forEach((function(fn){return fn(saveObj)})),saveObj.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert("".concat(ex.message.toUpperFirst(),".</p><p>").concat(L10n.get("aborting"),".")),!1}return!0}return Object.freeze(Object.defineProperties({},{init:{value:function(){if("cookie"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;var saves=savesObjGet(),updated=!1;Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),_savesObjUpdate(saves.autosave)&&(updated=!0);for(var i=0;i<saves.slots.length;++i)_savesObjUpdate(saves.slots[i])&&(updated=!0);return _savesObjIsEmpty(saves)&&(storage.delete("saves"),updated=!1),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){var saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){var saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;var saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),!1;if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();if(slot>=saves.slots.length)return!1;var supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if("function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()){var str,now,MM,DD,hh,mm,ss,baseName=null==filename?Story.domId:(str=filename,Util.sanitizeFilename(str).replace(/[_\s\u2013\u2014-]+/g,"-")),saveName="".concat(baseName,"-").concat((now=new Date,MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds(),MM<10&&(MM="0".concat(MM)),DD<10&&(DD="0".concat(DD)),hh<10&&(hh="0".concat(hh)),mm<10&&(mm="0".concat(mm)),ss<10&&(ss="0".concat(ss)),"".concat(now.getFullYear()).concat(MM).concat(DD,"-").concat(hh).concat(mm).concat(ss)),".save"),supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:"text/plain;charset=UTF-8"}),saveName)}else Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed"))}},import:{value:function(event){var file=event.target.files[0],reader=new FileReader;jQuery(reader).one("loadend",(function(){if(reader.error){var ex=reader.error;UI.alert("".concat(L10n.get("errorSaveDiskLoadFailed").toUpperFirst()," (").concat(ex.name,": ").concat(ex.message,").</p><p>").concat(L10n.get("aborting"),"."))}else{var saveObj;try{saveObj=JSON.parse(/\.json$/i.test(file.name)||/^\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)}})),reader.readAsText(file)}},serialize:{value:function(metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),null;var supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){var saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onLoad.add handler parameter must be a function (received: ".concat(valueType,")"));_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}}}))},onSave:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onSave.add handler parameter must be a function (received: ".concat(valueType,")"));_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}}}))}}))}(),Setting=function(){var Types=Util.toEnum({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){var savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((function(def){return def.type!==Types.Header&&settings[def.name]!==def.default})).forEach((function(def){return savedSettings[def.name]=settings[def.name]})),0===Object.keys(savedSettings).length?(storage.delete("settings"),!0):storage.set("settings",savedSettings)}function settingsLoad(){var defaultSettings=settingsCreate(),loadedSettings=storage.get("settings")||settingsCreate();_definitions.filter((function(def){return def.type!==Types.Header})).forEach((function(def){return defaultSettings[def.name]=def.default})),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete("settings"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){var errors=[];throw arguments.length<1&&errors.push("type"),arguments.length<2&&errors.push("name"),arguments.length<3&&errors.push("definition"),new Error("missing parameters, no ".concat(errors.join(" or ")," specified"))}if("object"!==_typeof(def))throw new TypeError("definition parameter must be an object");if(definitionsHas(name))throw new Error('cannot clobber existing setting "'.concat(name,'"'));var str,pos,definition={type:type,name:name,label:"string"==typeof def.label?def.label.trim():""};if("string"==typeof def.desc){var desc=def.desc.trim();""!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(def.list))throw new TypeError("list must be an array");if(0===def.list.length)throw new Error("list must not be empty");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{var defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error("list does not contain default");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError("min must be a finite number");if(!def.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError("max must be a finite number");if(!def.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError("step must be a finite number greater than zero");var stepValidate=function(value){if(fracDigits>0){var ma=Number("".concat(def.min,"e").concat(fracDigits)),sa=Number("".concat(def.step,"e").concat(fracDigits)),_va=Number("".concat(value,"e").concat(fracDigits))-ma;return Number("".concat(_va-_va%sa+ma,"e-").concat(fracDigits))}var va=value-def.min;return va-va%def.step+def.min},fracDigits=(str=String(def.step),-1===(pos=str.lastIndexOf("."))?0:str.length-pos-1);if(stepValidate(def.max)!==def.max)throw new RangeError("max (".concat(def.max,") is not a multiple of the step (").concat(def.step,") plus the min (").concat(def.min,")"));if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if("number"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError("default must be a finite number");if(def.default<def.min)throw new RangeError("default (".concat(def.default,") is less than min (").concat(def.min,")"));if(def.default>def.max)throw new RangeError("default (".concat(def.default,") is greater than max (").concat(def.max,")"));definition.default=def.default}break;default:throw new Error("unknown Setting type: ".concat(type))}"function"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),"function"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((function(definition){return definition.name===name}))}function definitionsGet(name){return _definitions.find((function(definition){return definition.name===name}))}return Object.freeze(Object.defineProperties({},{Types:{value:Types},init:{value:function(){if(storage.has("options")){var old=storage.get("options");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete("options")}settingsLoad(),_definitions.forEach((function(def){if(def.hasOwnProperty("onInit")){var thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty("list")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error('nonexistent setting "'.concat(name,'"'));var def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];definitionsAdd.apply(void 0,[Types.Toggle].concat(args))}},addList:{value:function(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];definitionsAdd.apply(void 0,[Types.List].concat(args))}},addRange:{value:function(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];definitionsAdd.apply(void 0,[Types.Range].concat(args))}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(var i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))}(),Story=function(){var _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[],_title="",_ifId="",_domId="";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error("story title must not be null or undefined");var title=Util.unescape(String(rawTitle)).trim();if(""===title)throw new Error("story title must not be empty or consist solely of whitespace");if(document.title=_title=title,""===(_domId=Util.slugify(_title)))if(""!==_ifId)_domId=_ifId;else for(var i=0,len=_title.length;i<len;++i){var _Util$charAndPosAt2=Util.charAndPosAt(_title,i),char=_Util$charAndPosAt2.char,start=_Util$charAndPosAt2.start,end=_Util$charAndPosAt2.end;_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.freeze(Object.defineProperties({},{load:{value:function(){var validationCodeTags=["init","widget"],validationNoCodeTagPassages=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error('starting passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(passage.tags.filter((function(tag){return validationCodeTags.includes(tag)})).sort().join('", "'),'"'))}function validateSpecialPassages(passage){if(validationNoCodeTagPassages.includes(passage.title)){for(var _len19=arguments.length,tags=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++)tags[_key19-1]=arguments[_key19];throw new Error('special passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(tags.sort().join('", "'),'"'))}var codeTags=[].concat(validationCodeTags),foundTags=[];if(passage.tags.forEach((function(tag){codeTags.includes(tag)&&foundTags.push.apply(foundTags,_toConsumableArray(codeTags.delete(tag)))})),foundTags.length>1)throw new Error('passage "'.concat(passage.title,'" contains multiple special tags; invalid: "').concat(foundTags.sort().join('", "'),'"'))}var $storydata=jQuery("tw-storydata"),startNode=$storydata.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test($storydata.attr("options")),$storydata.children("style").each((function(i){_styles.push(new Passage("tw-user-style-".concat(i),this))})),$storydata.children("script").each((function(i){_scripts.push(new Passage("tw-user-script-".concat(i),this))})),$storydata.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each((function(){var $this=jQuery(this),pid=$this.attr("pid")||"",passage=new Passage($this.attr("name"),this);pid===startNode&&""!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes("init")?(validateSpecialPassages(passage,"init"),_inits.push(passage)):passage.tags.includes("widget")?(validateSpecialPassages(passage,"widget"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr("ifid"),_storySetTitle("不原谅也没关系"),Config.saves.id=Story.domId}},init:{value:function(){var storyStyle;storyStyle=document.createElement("style"),new StyleWrapper(storyStyle).add(_styles.map((function(style){return style.text.trim()})).join("\n")),jQuery(storyStyle).appendTo(document.head).attr({id:"style-story",type:"text/css"});for(var i=0;i<_scripts.length;++i)try{Scripting.evalJavaScript(_scripts[i].text)}catch(ex){console.error(ex),Alert.error(_scripts[i].title,"object"===_typeof(ex)?ex.message:ex)}for(var _i8=0;_i8<_widgets.length;++_i8)try{Wikifier.wikifyEval(_widgets[_i8].processText())}catch(ex){console.error(ex),Alert.error(_widgets[_i8].title,"object"===_typeof(ex)?ex.message:ex)}}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError("Story.add passage parameter must be an instance of Passage");var title=passage.title;return!_passages.hasOwnProperty(title)&&(_passages[title]=passage,!0)}},has:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":return _passages.hasOwnProperty(String(title));case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.has title parameter cannot be ".concat(type))}},get:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":var id=String(title);return _passages.hasOwnProperty(id)?_passages[id]:new Passage(id||"(unknown)");case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.get title parameter cannot be ".concat(type))}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value){var sortKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];"object"===_typeof(passage[key])&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((function(m){return Util.sameValueZero(m,value)}))&&results.push(passage):Util.sameValueZero(passage[key],value)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}},lookupWith:{value:function(predicate){var sortKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof predicate)throw new TypeError("Story.lookupWith predicate parameter must be a function");var results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}}}))}(),UI=function(){function uiAssembleLinkList(passage,listEl){var list=listEl,debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement("ul"));var frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "));for(;frag.hasChildNodes();){var node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.nodeName.toUpperCase()){var li=document.createElement("li");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message){jQuery(Dialog.setup(L10n.get("alertTitle"),"alert")).append("<p>".concat(message,'</p><ul class="buttons">')+'<li><button id="alert-ok" class="ui-close">'.concat(L10n.get(["alertOk","ok"]),"</button></li>")+"</ul>");for(var _len20=arguments.length,args=new Array(_len20>1?_len20-1:0),_key20=1;_key20<_len20;_key20++)args[_key20-1]=arguments[_key20];Dialog.open.apply(Dialog,args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>".concat(L10n.get("autoloadPrompt"),'</p><ul class="buttons">')+'<li><button id="autoload-ok" class="ui-close">'.concat(L10n.get(["autoloadOk","ok"]),"</button></li>")+'<li><button id="autoload-cancel" class="ui-close">'.concat(L10n.get(["autoloadCancel","cancel"]),"</button></li>")+"</ul>"),jQuery(document).one("click.autoload",".ui-close",(function(ev){var isAutoloadOk="autoload-ok"===ev.target.id;jQuery(document).one(":dialogclosed",(function(){isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){var list=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(list);for(var expired=State.expired.length,i=State.size-1;i>=0;--i)if(i!==State.activeIndex){var passage=Story.get(State.history[i].title);passage&&passage.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(idx){return function(){return jQuery(document).one(":dialogclosed",(function(){return Engine.goTo(idx)}))}}(i)).addClass("ui-close").text("".concat(L10n.get("jumptoTurn")," ").concat(expired+i+1,": ").concat(passage.description()))).appendTo(list)}list.hasChildNodes()||jQuery(list).append("<li><a><em>".concat(L10n.get("jumptoUnavailable"),"</em></a></li>"))}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>".concat(L10n.get("restartPrompt"),'</p><ul class="buttons">')+'<li><button id="restart-ok">'.concat(L10n.get(["restartOk","ok"]),"</button></li>")+'<li><button id="restart-cancel" class="ui-close">'.concat(L10n.get(["restartCancel","cancel"]),"</button></li>")+"</ul>").find("#restart-ok").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){return Engine.restart()})),Dialog.close()})),!0}function uiBuildSaves(){var savesAllowed="function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId)).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement("li")).append($btn)}var $dialogBody=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId,"-").concat(bSlot)).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?"auto"===bSlot?$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelAuto"))},(function(){return bAction()})):$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelSlot")," ").concat(bSlot+1)},(function(){return bAction(bSlot)})):$btn.ariaDisabled(!0),$btn}var saves=Save.get(),$tbody=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var $tdSlot=jQuery(document.createElement("td")),$tdLoad=jQuery(document.createElement("td")),$tdDesc=jQuery(document.createElement("td")),$tdDele=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),"auto",(function(){jQuery(document).one(":dialogclosed",(function(){return Save.autosave.load()}))}))),jQuery(document.createElement("div")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.autosave.date?"".concat(new Date(saves.autosave.date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo($tdDesc),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto",(function(){Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton("load",null,L10n.get("savesLabelLoad"),"auto")),$tdDesc.addClass("empty").text("•  •  •"),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(var i=0,iend=saves.slots.length;i<iend;++i){var _$tdSlot=jQuery(document.createElement("td")),_$tdLoad=jQuery(document.createElement("td")),_$tdDesc=jQuery(document.createElement("td")),_$tdDele=jQuery(document.createElement("td"));_$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?(_$tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),i,(function(slot){jQuery(document).one(":dialogclosed",(function(){return Save.slots.load(slot)}))}))),jQuery(document.createElement("div")).text(saves.slots[i].title).appendTo(_$tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.slots[i].date?"".concat(new Date(saves.slots[i].date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo(_$tdDesc),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i,(function(slot){Save.slots.delete(slot),uiBuildSaves()})))):(_$tdLoad.append(createButton("save","ui-close",L10n.get("savesLabelSave"),i,savesAllowed?Save.slots.save:null)),_$tdDesc.addClass("empty").text("•  •  •"),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i))),jQuery(document.createElement("tr")).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody)}return jQuery(document.createElement("table")).attr("id","saves-list").append($tbody)}()),savesOk||fileOk){var $btnBar=jQuery(document.createElement("ul")).addClass("buttons").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem("export","ui-close",L10n.get("savesLabelExport"),savesAllowed?function(){return Save.export()}:null)),$btnBar.append(createActionItem("import",null,L10n.get("savesLabelImport"),(function(){return $dialogBody.find("#saves-import-file").trigger("click")}))),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",(function(ev){jQuery(document).one(":dialogclosed",(function(){return Save.import(ev)})),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get("savesIncapable")),!1}function uiBuildSettings(){var $dialogBody=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach((function(control){if(control.type===Setting.Types.Header){var _name=control.name,_id=Util.slugify(_name),$header=jQuery(document.createElement("div")),$heading=jQuery(document.createElement("h2"));return $header.attr("id","header-body-".concat(_id)).append($heading).appendTo($dialogBody),$heading.attr("id","header-heading-".concat(_id)).wiki(_name),void(control.desc&&jQuery(document.createElement("p")).attr("id","header-desc-".concat(_id)).wiki(control.desc).appendTo($header))}var $control,name=control.name,id=Util.slugify(name),$setting=jQuery(document.createElement("div")),$label=jQuery(document.createElement("label")),$controlBox=jQuery(document.createElement("div"));switch(jQuery(document.createElement("div")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-".concat(id)).wiki(control.desc).appendTo($setting),$label.attr({id:"setting-label-".concat(id),for:"setting-control-".concat(id)}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement("button")),settings[name]?$control.addClass("enabled").text(L10n.get("settingsOn")):$control.text(L10n.get("settingsOff")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[name]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[name]=!0),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement("select"));for(var i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement("option")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr("tabindex",0).on("change",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:($control=jQuery(document.createElement("input"))).attr({type:"range",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on("change input",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$control.trigger("change"))}))}$control.attr("id","setting-control-".concat(id)).appendTo($controlBox),$setting.attr("id","setting-body-".concat(id)).appendTo($dialogBody)})),$dialogBody.append('<ul class="buttons">'+'<li><button id="settings-ok" class="ui-close">'.concat(L10n.get(["settingsOk","ok"]),"</button></li>")+'<li><button id="settings-reset">'.concat(L10n.get("settingsReset"),"</button></li>")+"</ul>").find("#settings-reset").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(uiAssembleLinkList("StoryShare"))}catch(ex){return console.error(ex),Alert.error("StoryShare",ex.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(){uiBuildJumpto(),Dialog.open.apply(Dialog,arguments)}},restart:{value:function(){uiBuildRestart(),Dialog.open.apply(Dialog,arguments)}},saves:{value:function(){uiBuildSaves(),Dialog.open.apply(Dialog,arguments)}},settings:{value:function(){uiBuildSettings(),Dialog.open.apply(Dialog,arguments)}},share:{value:function(){uiBuildShare(),Dialog.open.apply(Dialog,arguments)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))}(),UIBar=function(){var _$uiBar=null;function uiBarStow(noAnimation){var $story;_$uiBar&&!_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.addClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay));return this}function uiBarUpdate(){if(Story.has("StoryDisplayTitle")&&setDisplayTitle(Story.get("StoryDisplayTitle").processText()),_$uiBar){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var menuStory=document.getElementById("menu-story");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",menuStory)}catch(ex){console.error(ex),Alert.error("StoryMenu",ex.message)}}}return Object.freeze(Object.defineProperties({},{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(!document.getElementById("ui-bar")){var toggleLabel,backwardLabel,jumptoLabel,forwardLabel,$backward,$forward,$elems=(toggleLabel=L10n.get("uiBarToggle"),backwardLabel=L10n.get("uiBarBackward"),jumptoLabel=L10n.get("uiBarJumpto"),forwardLabel=L10n.get("uiBarForward"),jQuery(document.createDocumentFragment()).append('<div id="ui-bar" aria-live="polite"><div id="ui-bar-tray">'+'<button id="ui-bar-toggle" tabindex="0" title="'.concat(toggleLabel,'" aria-label="').concat(toggleLabel,'"></button>')+'<div id="ui-bar-history">'+'<button id="history-backward" tabindex="0" title="'.concat(backwardLabel,'" aria-label="').concat(backwardLabel,'"></button>')+'<button id="history-jumpto" tabindex="0" title="'.concat(jumptoLabel,'" aria-label="').concat(jumptoLabel,'"></button>')+'<button id="history-forward" tabindex="0" title="'.concat(forwardLabel,'" aria-label="').concat(forwardLabel,'"></button>')+'</div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core">'+'<li id="menu-item-saves"><a tabindex="0">'.concat(L10n.get("savesTitle"),"</a></li>")+'<li id="menu-item-settings"><a tabindex="0">'.concat(L10n.get("settingsTitle"),"</a></li>")+'<li id="menu-item-restart"><a tabindex="0">'.concat(L10n.get("restartTitle"),"</a></li>")+'<li id="menu-item-share"><a tabindex="0">'.concat(L10n.get("shareTitle"),"</a></li>")+"</ul></nav></div></div>"));_$uiBar=jQuery($elems.find("#ui-bar").get(0)),$elems.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",($backward=jQuery("#history-backward"),$forward=jQuery("#history-forward"),function(){$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}}},isHidden:{value:function(){return _$uiBar&&"none"===_$uiBar.css("display")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass("stowed")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},(function(){return _$uiBar.toggleClass("stowed")})),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},(function(){return Engine.backward()})),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},(function(){return UI.jumpto()})):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},(function(){return Engine.forward()}))):jQuery("#ui-bar-history").remove(),Story.has("StoryDisplayTitle")?setDisplayTitle(Story.get("StoryDisplayTitle").processText()):jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery("#menu-item-saves a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSaves(),Dialog.open()})).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){var $story;return _$uiBar&&_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.removeClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay)),this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))}(),DebugBar=function(){var _variableRe=new RegExp("^".concat(Patterns.variable,"$")),_numericKeyRe=/^\d+$/,_watchList=[],_$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css("right","-".concat(_$debugBar.outerWidth(),"px")),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css("right",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((function(name){return _watchList.pushUnique("$".concat(name))})),Object.keys(State.temporary).map((function(name){return _watchList.pushUnique("_".concat(name))})),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(var i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr("hidden")}function debugBarWatchToggle(){_$watchBody.attr("hidden")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({"aria-hidden":!0,hidden:"hidden"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr("aria-hidden hidden")}function _clearSession(){session.delete("debugState")}function _hasSession(){return session.has("debugState")}function _updateSession(){session.set("debugState",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0!==_watchList.length){for(var delLabel=L10n.get("debugBarDeleteWatch"),$table=jQuery(document.createElement("table")),$tbody=jQuery(document.createElement("tbody")),_loop4=function(i,len){var varName=_watchList[i],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement("tr")),$delBtn=jQuery(document.createElement("button")),$code=jQuery(document.createElement("code"));$delBtn.addClass("watch-delete").attr("data-name",varName).ariaClick({one:!0,label:delLabel},(function(){return debugBarWatchDelete(varName)})),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement("td")).append($delBtn).appendTo($row),jQuery(document.createElement("td")).text(varName).appendTo($row),jQuery(document.createElement("td")).append($code).appendTo($row),$row.appendTo($tbody)},i=0,len=_watchList.length;i<len;++i)_loop4(i);$table.append($tbody),_$watchBody.empty().append($table)}else _$watchBody.empty().append("<div>".concat(L10n.get("debugBarNoWatches"),"</div>"))}function _updateWatchList(){var svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0!==svn.length||0!==tvn.length){var names=[].concat(_toConsumableArray(svn.map((function(name){return"$".concat(name)}))),_toConsumableArray(tvn.map((function(name){return"_".concat(name)})))).sort(),options=document.createDocumentFragment();names.delete(_watchList);for(var i=0,len=names.length;i<len;++i)jQuery(document.createElement("option")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}else _$watchList.empty()}function _updateTurnSelect(){for(var histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment(),i=0;i<histLen;++i)jQuery(document.createElement("option")).val(i).text("".concat(expLen+i+1,". ").concat(Util.escape(State.history[i].title))).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return"null";switch(_typeof(value)){case"number":if(Number.isNaN(value))return"NaN";if(!Number.isFinite(value))return"Infinity";case"boolean":case"symbol":case"undefined":return String(value);case"string":return JSON.stringify(value);case"function":return"Function"}var objType=Util.toStringTag(value);if("Date"===objType)return"Date {".concat(value.toLocaleString(),"}");if("RegExp"===objType)return"RegExp ".concat(value.toString());var result=[];if(value instanceof Array||value instanceof Set){for(var list=value instanceof Array?value:Array.from(value),i=0,len=list.length;i<len;++i)result.push(list.hasOwnProperty(i)?_toWatchString(list[i]):"<empty>");return Object.keys(list).filter((function(key){return!_numericKeyRe.test(key)})).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(list[key])))})),"".concat(objType,"(").concat(list.length,") [").concat(result.join(", "),"]")}return value instanceof Map?(value.forEach((function(val,key){return result.push("".concat(_toWatchString(key)," → ").concat(_toWatchString(val)))})),"".concat(objType,"(").concat(value.size,") {").concat(result.join(", "),"}")):(Object.keys(value).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(value[key])))})),"".concat(objType," {").concat(result.join(", "),"}"))}return Object.freeze(Object.defineProperties({},{init:{value:function(){var barToggleLabel=L10n.get("debugBarToggle"),watchAddLabel=L10n.get("debugBarAddWatch"),watchAllLabel=L10n.get("debugBarWatchAll"),watchNoneLabel=L10n.get("debugBarWatchNone"),watchToggleLabel=L10n.get("debugBarWatchToggle"),viewsToggleLabel=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch">'+"<div>".concat(L10n.get("debugBarNoWatches"),"</div>>")+"</div><div>"+'<button id="debug-bar-watch-toggle" tabindex="0" title="'.concat(watchToggleLabel,'" aria-label="').concat(watchToggleLabel,'">').concat(L10n.get("debugBarLabelWatch"),"</button>")+'<label id="debug-bar-watch-label" for="debug-bar-watch-input">'.concat(L10n.get("debugBarLabelAdd"),"</label>")+'<input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist>'+'<button id="debug-bar-watch-add" tabindex="0" title="'.concat(watchAddLabel,'" aria-label="').concat(watchAddLabel,'"></button>')+'<button id="debug-bar-watch-all" tabindex="0" title="'.concat(watchAllLabel,'" aria-label="').concat(watchAllLabel,'"></button>')+'<button id="debug-bar-watch-none" tabindex="0" title="'.concat(watchNoneLabel,'" aria-label="').concat(watchNoneLabel,'"></button>')+"</div><div>"+'<button id="debug-bar-views-toggle" tabindex="0" title="'.concat(viewsToggleLabel,'" aria-label="').concat(viewsToggleLabel,'">').concat(L10n.get("debugBarLabelViews"),"</button>")+'<label id="debug-bar-turn-label" for="debug-bar-turn-select">'.concat(L10n.get("debugBarLabelTurn"),"</label>")+'<select id="debug-bar-turn-select" tabindex="0"></select></div>'+'<button id="debug-bar-toggle" tabindex="0" title="'.concat(barToggleLabel,'" aria-label="').concat(barToggleLabel,'"></button>')+'</div><div id="debug-bar-hint"></div>').appendTo("body"),_$debugBar=jQuery("#debug-bar"),_$watchBody=jQuery(_$debugBar.find("#debug-bar-watch").get(0)),_$watchList=jQuery(_$debugBar.find("#debug-bar-watch-list").get(0)),_$turnSelect=jQuery(_$debugBar.find("#debug-bar-turn-select").get(0));var $barToggle=jQuery(_$debugBar.find("#debug-bar-toggle").get(0)),$watchToggle=jQuery(_$debugBar.find("#debug-bar-watch-toggle").get(0)),$watchInput=jQuery(_$debugBar.find("#debug-bar-watch-input").get(0)),$watchAdd=jQuery(_$debugBar.find("#debug-bar-watch-add").get(0)),$watchAll=jQuery(_$debugBar.find("#debug-bar-watch-all").get(0)),$watchNone=jQuery(_$debugBar.find("#debug-bar-watch-none").get(0)),$viewsToggle=jQuery(_$debugBar.find("#debug-bar-views-toggle").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(":addwatch",(function(){debugBarWatchAdd(this.value.trim()),this.value=""})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$watchInput.trigger(":addwatch"))})),$watchAdd.ariaClick((function(){return $watchInput.trigger(":addwatch")})),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on("change",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((function(){DebugView.toggle(),_updateSession()})),jQuery(document).on(":historyupdate.debug-bar",_updateTurnSelect).on(":passageend.debug-bar",(function(){_updateWatchBody(),_updateWatchList()})).on(":enginerestart.debug-bar",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;var debugState=session.get("debugState");_stowed=debugState.stowed,_watchList.push.apply(_watchList,_toConsumableArray(debugState.watchList)),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.freeze(Object.defineProperties({},{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))}(),LoadScreen=function(){var _locks=new Set,_autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr("data-init")}function loadScreenShow(){jQuery(document.documentElement).attr("data-init","loading")}return Object.freeze(Object.defineProperties({},{init:{value:function(){jQuery(document).on("readystatechange.SugarCube",(function(){_locks.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout((function(){0===_locks.size&&loadScreenHide()}),Math.max(Engine.minDomActionDelay,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off("readystatechange.SugarCube"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error("LoadScreen.unlock called with a null or undefined ID");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger("readystatechange")}}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:36,patch:1,prerelease:null,build:9717,date:new Date("2021-12-22T05:37:33.467Z"),extensions:{},toString:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,"+").concat(this.build)},short:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.title," (v").concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,")")},long:function(){return"".concat(this.title," v").concat(this.toString()," (").concat(this.date.toUTCString(),")")}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery((function(){try{var lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();var $window=$(window),vprCheckId=setInterval((function(){$window.width()&&(clearInterval(vprCheckId),UIBar.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:":storyready"}),setTimeout((function(){return LoadScreen.unlock(lockId)}),2*Engine.minDomActionDelay))}),Engine.minDomActionDelay);Object.defineProperty(window,"SugarCube",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))})}catch(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}}))})(window,window.document,jQuery);}
	</script>
</body>
</html>
